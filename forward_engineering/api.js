var kt=Object.defineProperty;var up=Object.getOwnPropertyDescriptor;var lp=Object.getOwnPropertyNames;var pp=Object.prototype.hasOwnProperty;var i=(t,e)=>kt(t,"name",{value:e,configurable:!0});var mp=(t,e)=>()=>(t&&(e=t(t=0)),e);var C=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),dp=(t,e)=>{for(var r in e)kt(t,r,{get:e[r],enumerable:!0})},fp=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of lp(e))!pp.call(t,s)&&s!==r&&kt(t,s,{get:()=>e[s],enumerable:!(n=up(e,s))||n.enumerable});return t};var hp=t=>fp(kt({},"__esModule",{value:!0}),t);var Nr=C((BT,zi)=>{var gp=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",a=""){e.progress({message:n,containerName:s,entityName:a})},error(n){e.log("error",yp(n),t)}}),"createLogger"),yp=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");zi.exports={createLogger:gp}});var Zi=C((GT,Xi)=>{var ft=1e3,ht=ft*60,gt=ht*60,yt=gt*24,_p=yt*365.25;Xi.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return Ep(t);if(r==="number"&&isNaN(t)===!1)return e.long?Sp(t):Tp(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function Ep(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*_p;case"days":case"day":case"d":return r*yt;case"hours":case"hour":case"hrs":case"hr":case"h":return r*gt;case"minutes":case"minute":case"mins":case"min":case"m":return r*ht;case"seconds":case"second":case"secs":case"sec":case"s":return r*ft;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}i(Ep,"parse");function Tp(t){return t>=yt?Math.round(t/yt)+"d":t>=gt?Math.round(t/gt)+"h":t>=ht?Math.round(t/ht)+"m":t>=ft?Math.round(t/ft)+"s":t+"ms"}i(Tp,"fmtShort");function Sp(t){return $t(t,yt,"day")||$t(t,gt,"hour")||$t(t,ht,"minute")||$t(t,ft,"second")||t+" ms"}i(Sp,"fmtLong");function $t(t,e,r){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}i($t,"plural")});var Ir=C((H,Ji)=>{H=Ji.exports=vr.debug=vr.default=vr;H.coerce=vp;H.disable=Np;H.enable=Ap;H.enabled=bp;H.humanize=Zi();H.names=[];H.skips=[];H.formatters={};var br;function Cp(t){var e=0,r;for(r in t)e=(e<<5)-e+t.charCodeAt(r),e|=0;return H.colors[Math.abs(e)%H.colors.length]}i(Cp,"selectColor");function vr(t){function e(){if(e.enabled){var r=e,n=+new Date,s=n-(br||n);r.diff=s,r.prev=br,r.curr=n,br=n;for(var a=new Array(arguments.length),o=0;o<a.length;o++)a[o]=arguments[o];a[0]=H.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(l,p){if(l==="%%")return l;c++;var m=H.formatters[p];if(typeof m=="function"){var d=a[c];l=m.call(r,d),a.splice(c,1),c--}return l}),H.formatArgs.call(r,a);var u=e.log||H.log||console.log.bind(console);u.apply(r,a)}}return i(e,"debug"),e.namespace=t,e.enabled=H.enabled(t),e.useColors=H.useColors(),e.color=Cp(t),typeof H.init=="function"&&H.init(e),e}i(vr,"createDebug");function Ap(t){H.save(t),H.names=[],H.skips=[];for(var e=(typeof t=="string"?t:"").split(/[\s,]+/),r=e.length,n=0;n<r;n++)e[n]&&(t=e[n].replace(/\*/g,".*?"),t[0]==="-"?H.skips.push(new RegExp("^"+t.substr(1)+"$")):H.names.push(new RegExp("^"+t+"$")))}i(Ap,"enable");function Np(){H.enable("")}i(Np,"disable");function bp(t){var e,r;for(e=0,r=H.skips.length;e<r;e++)if(H.skips[e].test(t))return!1;for(e=0,r=H.names.length;e<r;e++)if(H.names[e].test(t))return!0;return!1}i(bp,"enabled");function vp(t){return t instanceof Error?t.stack||t.message:t}i(vp,"coerce")});var ra=C((de,ta)=>{de=ta.exports=Ir();de.log=Rp;de.formatArgs=Op;de.save=wp;de.load=ea;de.useColors=Ip;de.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:Dp();de.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function Ip(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}i(Ip,"useColors");de.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function Op(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+de.humanize(this.diff),!!e){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,function(a){a!=="%%"&&(n++,a==="%c"&&(s=n))}),t.splice(s,0,r)}}i(Op,"formatArgs");function Rp(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}i(Rp,"log");function wp(t){try{t==null?de.storage.removeItem("debug"):de.storage.debug=t}catch{}}i(wp,"save");function ea(){var t;try{t=de.storage.debug}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}i(ea,"load");de.enable(ea());function Dp(){try{return window.localStorage}catch{}}i(Dp,"localstorage")});var aa=C((oe,ia)=>{var na=require("tty"),_t=require("util");oe=ia.exports=Ir();oe.init=Up;oe.log=Lp;oe.formatArgs=Pp;oe.save=Mp;oe.load=sa;oe.useColors=xp;oe.colors=[6,2,3,4,5,1];oe.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(s,a){return a.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});var Xe=parseInt(process.env.DEBUG_FD,10)||2;Xe!==1&&Xe!==2&&_t.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var qp=Xe===1?process.stdout:Xe===2?process.stderr:Fp(Xe);function xp(){return"colors"in oe.inspectOpts?!!oe.inspectOpts.colors:na.isatty(Xe)}i(xp,"useColors");oe.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,_t.inspect(t,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};oe.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,_t.inspect(t,this.inspectOpts)};function Pp(t){var e=this.namespace,r=this.useColors;if(r){var n=this.color,s="  \x1B[3"+n+";1m"+e+" \x1B[0m";t[0]=s+t[0].split(`
`).join(`
`+s),t.push("\x1B[3"+n+"m+"+oe.humanize(this.diff)+"\x1B[0m")}else t[0]=new Date().toUTCString()+" "+e+" "+t[0]}i(Pp,"formatArgs");function Lp(){return qp.write(_t.format.apply(_t,arguments)+`
`)}i(Lp,"log");function Mp(t){t==null?delete process.env.DEBUG:process.env.DEBUG=t}i(Mp,"save");function sa(){return process.env.DEBUG}i(sa,"load");function Fp(t){var e,r=process.binding("tty_wrap");switch(r.guessHandleType(t)){case"TTY":e=new na.WriteStream(t),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(t,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var s=require("net");e=new s.Socket({fd:t,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=t,e._isStdio=!0,e}i(Fp,"createWritableStdioStream");function Up(t){t.inspectOpts={};for(var e=Object.keys(oe.inspectOpts),r=0;r<e.length;r++)t.inspectOpts[e[r]]=oe.inspectOpts[e[r]]}i(Up,"init");oe.enable(sa())});var Rr=C((YT,Or)=>{typeof process<"u"&&process.type==="renderer"?Or.exports=ra():Or.exports=aa()});var oa=C(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.default=null});var ha=C((zT,fa)=>{var ua=9007199254740991,kp="[object Arguments]",$p="[object Function]",Bp="[object GeneratorFunction]",Kp=/^(?:0|[1-9]\d*)$/;function la(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}i(la,"apply");function Gp(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}i(Gp,"baseTimes");var Et=Object.prototype,Tt=Et.hasOwnProperty,pa=Et.toString,Vp=Et.propertyIsEnumerable,ca=Math.max;function Hp(t,e){var r=tm(t)||em(t)?Gp(t.length,String):[],n=r.length,s=!!n;for(var a in t)(e||Tt.call(t,a))&&!(s&&(a=="length"||da(a,n)))&&r.push(a);return r}i(Hp,"arrayLikeKeys");function Wp(t,e,r,n){return t===void 0||Dr(t,Et[r])&&!Tt.call(n,r)?e:t}i(Wp,"assignInDefaults");function Qp(t,e,r){var n=t[e];(!(Tt.call(t,e)&&Dr(n,r))||r===void 0&&!(e in t))&&(t[e]=r)}i(Qp,"assignValue");function Yp(t){if(!xr(t))return Jp(t);var e=Zp(t),r=[];for(var n in t)n=="constructor"&&(e||!Tt.call(t,n))||r.push(n);return r}i(Yp,"baseKeysIn");function ma(t,e){return e=ca(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=ca(r.length-e,0),a=Array(s);++n<s;)a[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=a,la(t,this,o)}}i(ma,"baseRest");function jp(t,e,r,n){r||(r={});for(var s=-1,a=e.length;++s<a;){var o=e[s],c=n?n(r[o],t[o],o,r,t):void 0;Qp(r,o,c===void 0?t[o]:c)}return r}i(jp,"copyObject");function zp(t){return ma(function(e,r){var n=-1,s=r.length,a=s>1?r[s-1]:void 0,o=s>2?r[2]:void 0;for(a=t.length>3&&typeof a=="function"?(s--,a):void 0,o&&Xp(r[0],r[1],o)&&(a=s<3?void 0:a,s=1),e=Object(e);++n<s;){var c=r[n];c&&t(e,c,n,a)}return e})}i(zp,"createAssigner");function da(t,e){return e=e??ua,!!e&&(typeof t=="number"||Kp.test(t))&&t>-1&&t%1==0&&t<e}i(da,"isIndex");function Xp(t,e,r){if(!xr(r))return!1;var n=typeof e;return(n=="number"?qr(r)&&da(e,r.length):n=="string"&&e in r)?Dr(r[e],t):!1}i(Xp,"isIterateeCall");function Zp(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Et;return t===r}i(Zp,"isPrototype");function Jp(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}i(Jp,"nativeKeysIn");function Dr(t,e){return t===e||t!==t&&e!==e}i(Dr,"eq");function em(t){return rm(t)&&Tt.call(t,"callee")&&(!Vp.call(t,"callee")||pa.call(t)==kp)}i(em,"isArguments");var tm=Array.isArray;function qr(t){return t!=null&&sm(t.length)&&!nm(t)}i(qr,"isArrayLike");function rm(t){return im(t)&&qr(t)}i(rm,"isArrayLikeObject");function nm(t){var e=xr(t)?pa.call(t):"";return e==$p||e==Bp}i(nm,"isFunction");function sm(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ua}i(sm,"isLength");function xr(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}i(xr,"isObject");function im(t){return!!t&&typeof t=="object"}i(im,"isObjectLike");var am=zp(function(t,e,r,n){jp(e,cm(e),t,n)}),om=ma(function(t){return t.push(void 0,Wp),la(am,void 0,t)});function cm(t){return qr(t)?Hp(t,!0):Yp(t)}i(cm,"keysIn");fa.exports=om});var ya=C((ZT,ga)=>{var um=require("util"),lm=ha(),pm=Rr()("tunnel-ssh-config"),Pr=i(function(t,e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=t,this.extra=e},"ConfigError");um.inherits(Pr,Error);function mm(t){var e=process.env;if(lm(t||{},{username:e.TUNNELSSH_USER||e.USER||e.USERNAME||"root",port:22,host:null,srcPort:0,srcHost:"127.0.0.1",dstPort:null,dstHost:"127.0.0.1",localHost:"127.0.0.1",localPort:t.dstPort,agent:process.env.SSH_AUTH_SOCK}),!t.host)throw new Pr("host not set");if(!t.dstPort)throw new Pr("dstPort not set");return pm("ssh-config",function(){var r=["password","privateKey"];return Object.keys(t).reduce(function(n,s){return r.indexOf(s)===-1?n[s]=t[s]:n[s]="***HIDDEN***",n},{})}()),t}i(mm,"createConfig");ga.exports=mm});var Ea=C((eS,_a)=>{var dm=require("net"),Lr=Rr()("tunnel-ssh"),fm=oa().Client,hm=ya(),gm=require("events"),ym=i(function(){},"noop");function _m(t,e){var r=new fm;return e.on("close",r.end.bind(r)),r.on("ready",function(){Lr("sshConnection:ready"),e.emit("sshConnection",r,e),r.forwardOut(t.srcHost,t.srcPort,t.dstHost,t.dstPort,function(n,s){if(n){e.emit("error",n),Lr("Destination port:",n);return}Lr("sshStream:create"),e.emit("sshStream",s),e.pipe(s).pipe(e)})}),r}i(_m,"bindSSHConnection");function Em(t,e){return e.reduce(function(r,n){return delete r[n],r},Object.assign({},t))}i(Em,"omit");function Tm(t){var e,r=[],n=0;return e=dm.createServer(function(s){var a;n++,s.on("error",e.emit.bind(e,"error")),s.on("close",function(){n--,n===0&&(t.keepAlive||setTimeout(function(){n===0&&e.close()},2))}),e.emit("netConnection",s,e),a=_m(t,s),a.on("error",e.emit.bind(e,"error")),s.on("sshStream",function(o){o.on("error",function(){e.close()})}),r.push(a,s);try{a.connect(Em(t,["localPort","localHost"]))}catch(o){e.emit("error",o)}}),e.on("close",function(){r.forEach(function(s){s.end()})}),e}i(Tm,"createServer");function Sm(t,e){var r,n;e||(e=ym);try{n=hm(t),r=Tm(n),r.listen(n.localPort,n.localHost,function(s){e(s,r)})}catch(s){r=new gm.EventEmitter,setImmediate(function(){e(s),r.emit("error",s)})}return r}i(Sm,"tunnel");_a.exports=Sm});var Fr=C(Ta=>{"use strict";Ta.parse=function(t,e){return new Mr(t,e).parse()};var Bt=class Bt{constructor(e,r){this.source=e,this.transform=r||Cm,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new Bt(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(Bt,"ArrayParser");var Mr=Bt;function Cm(t){return t}i(Cm,"identity")});var Ur=C((sS,Sa)=>{var Am=Fr();Sa.exports={create:i(function(t,e){return{parse:i(function(){return Am.parse(t,e)},"parse")}},"create")}});var Na=C((aS,Aa)=>{"use strict";var Nm=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,bm=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,vm=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Im=/^-?infinity$/;Aa.exports=i(function(e){if(Im.test(e))return Number(e.replace("i","I"));var r=Nm.exec(e);if(!r)return Om(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=Ca(s));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),u=parseInt(r[5],10),l=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var m,d=Rm(e);return d!=null?(m=new Date(Date.UTC(s,a,o,c,u,l,p)),kr(s)&&m.setUTCFullYear(s),d!==0&&m.setTime(m.getTime()-d)):(m=new Date(s,a,o,c,u,l,p),kr(s)&&m.setFullYear(s)),m},"parseDate");function Om(t){var e=bm.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=Ca(r));var s=parseInt(e[2],10)-1,a=e[3],o=new Date(r,s,a);return kr(r)&&o.setFullYear(r),o}}i(Om,"getDate");function Rm(t){if(t.endsWith("+00"))return 0;var e=vm.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(Rm,"timeZoneOffset");function Ca(t){return-(t-1)}i(Ca,"bcYearToNegativeYear");function kr(t){return t>=0&&t<100}i(kr,"is0To99")});var va=C((cS,ba)=>{ba.exports=Dm;var wm=Object.prototype.hasOwnProperty;function Dm(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)wm.call(r,n)&&(t[n]=r[n])}return t}i(Dm,"extend")});var Ra=C((lS,Oa)=>{"use strict";var qm=va();Oa.exports=Ze;function Ze(t){if(!(this instanceof Ze))return new Ze(t);qm(this,Vm(t))}i(Ze,"PostgresInterval");var xm=["seconds","minutes","hours","days","months","years"];Ze.prototype.toPostgres=function(){var t=xm.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var Pm={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Lm=["years","months","days"],Mm=["hours","minutes","seconds"];Ze.prototype.toISOString=Ze.prototype.toISO=function(){var t=Lm.map(r,this).join(""),e=Mm.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+Pm[n]}};var $r="([+-]?\\d+)",Fm=$r+"\\s+years?",Um=$r+"\\s+mons?",km=$r+"\\s+days?",$m="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Bm=new RegExp([Fm,Um,km,$m].map(function(t){return"("+t+")?"}).join("\\s*")),Ia={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Km=["hours","minutes","seconds","milliseconds"];function Gm(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Gm,"parseMilliseconds");function Vm(t){if(!t)return{};var e=Bm.exec(t),r=e[8]==="-";return Object.keys(Ia).reduce(function(n,s){var a=Ia[s],o=e[a];return!o||(o=s==="milliseconds"?Gm(o):parseInt(o,10),!o)||(r&&~Km.indexOf(s)&&(o*=-1),n[s]=o),n},{})}i(Vm,"parse")});var Da=C((mS,wa)=>{"use strict";wa.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var a=0;a<Math.floor(s/2);++a)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var Ua=C((fS,Fa)=>{var St=Fr(),Ct=Ur(),Kt=Na(),xa=Ra(),Pa=Da();function Gt(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(Gt,"allowNull");function La(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(La,"parseBool");function Hm(t){return t?St.parse(t,La):null}i(Hm,"parseBoolArray");function Wm(t){return parseInt(t,10)}i(Wm,"parseBaseTenInt");function Br(t){return t?St.parse(t,Gt(Wm)):null}i(Br,"parseIntegerArray");function Qm(t){return t?St.parse(t,Gt(function(e){return Ma(e).trim()})):null}i(Qm,"parseBigIntegerArray");var Ym=i(function(t){if(!t)return null;var e=Ct.create(t,function(r){return r!==null&&(r=Hr(r)),r});return e.parse()},"parsePointArray"),Kr=i(function(t){if(!t)return null;var e=Ct.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),Ne=i(function(t){if(!t)return null;var e=Ct.create(t);return e.parse()},"parseStringArray"),Gr=i(function(t){if(!t)return null;var e=Ct.create(t,function(r){return r!==null&&(r=Kt(r)),r});return e.parse()},"parseDateArray"),jm=i(function(t){if(!t)return null;var e=Ct.create(t,function(r){return r!==null&&(r=xa(r)),r});return e.parse()},"parseIntervalArray"),zm=i(function(t){return t?St.parse(t,Gt(Pa)):null},"parseByteAArray"),Vr=i(function(t){return parseInt(t,10)},"parseInteger"),Ma=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),qa=i(function(t){return t?St.parse(t,Gt(JSON.parse)):null},"parseJsonArray"),Hr=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Xm=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var a=Hr(e);return a.radius=parseFloat(r),a},"parseCircle"),Zm=i(function(t){t(20,Ma),t(21,Vr),t(23,Vr),t(26,Vr),t(700,parseFloat),t(701,parseFloat),t(16,La),t(1082,Kt),t(1114,Kt),t(1184,Kt),t(600,Hr),t(651,Ne),t(718,Xm),t(1e3,Hm),t(1001,zm),t(1005,Br),t(1007,Br),t(1028,Br),t(1016,Qm),t(1017,Ym),t(1021,Kr),t(1022,Kr),t(1231,Kr),t(1014,Ne),t(1015,Ne),t(1008,Ne),t(1009,Ne),t(1040,Ne),t(1041,Ne),t(1115,Gr),t(1182,Gr),t(1185,Gr),t(1186,xa),t(1187,jm),t(17,Pa),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,qa),t(3807,qa),t(3907,Ne),t(2951,Ne),t(791,Ne),t(1183,Ne),t(1270,Ne)},"init");Fa.exports={init:Zm}});var $a=C((gS,ka)=>{"use strict";var ge=1e6;function Jm(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",a,o,c,u,l,p;{if(a=e%ge,e=e/ge>>>0,o=4294967296*a+r,r=o/ge>>>0,c=""+(o-ge*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,p=0;p<l;p++)u+="0";s=u+c+s}{if(a=e%ge,e=e/ge>>>0,o=4294967296*a+r,r=o/ge>>>0,c=""+(o-ge*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,p=0;p<l;p++)u+="0";s=u+c+s}{if(a=e%ge,e=e/ge>>>0,o=4294967296*a+r,r=o/ge>>>0,c=""+(o-ge*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,p=0;p<l;p++)u+="0";s=u+c+s}return a=e%ge,o=4294967296*a+r,c=""+o%ge,n+c+s}i(Jm,"readInt8");ka.exports=Jm});var Ha=C((_S,Va)=>{var ed=$a(),Y=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(f,h,T){return f*Math.pow(2,T)+h};var a=r>>3,o=i(function(f){return n?~f&255:f},"inv"),c=255,u=8-r%8;e<u&&(c=255<<8-e&255,u=e),r&&(c=c>>r%8);var l=0;r%8+e>=8&&(l=s(0,o(t[a])&c,u));for(var p=e+r>>3,m=a+1;m<p;m++)l=s(l,o(t[m]),8);var d=(e+r)%8;return d>0&&(l=s(l,o(t[p])>>8-d,d)),l},"parseBits"),Ga=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=Y(t,1),a=Y(t,r,1);if(a===0)return 0;var o=1,c=i(function(l,p,m){l===0&&(l=1);for(var d=1;d<=m;d++)o/=2,(p&1<<m-d)>0&&(l+=o);return l},"parsePrecisionBits"),u=Y(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?u===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,a-n)*u},"parseFloatFromBits"),td=i(function(t){return Y(t,1)==1?-1*(Y(t,15,1,!0)+1):Y(t,15,1)},"parseInt16"),Ba=i(function(t){return Y(t,1)==1?-1*(Y(t,31,1,!0)+1):Y(t,31,1)},"parseInt32"),rd=i(function(t){return Ga(t,23,8)},"parseFloat32"),nd=i(function(t){return Ga(t,52,11)},"parseFloat64"),sd=i(function(t){var e=Y(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,Y(t,16,16)),n=0,s=[],a=Y(t,16),o=0;o<a;o++)n+=Y(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,Y(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),Ka=i(function(t,e){var r=Y(e,1),n=Y(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(a){this.usec=a},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),At=i(function(t){for(var e=Y(t,32),r=Y(t,32,32),n=Y(t,32,64),s=96,a=[],o=0;o<e;o++)a[o]=Y(t,32,s),s+=32,s+=32;var c=i(function(l){var p=Y(t,32,s);if(s+=32,p==4294967295)return null;var m;if(l==23||l==20)return m=Y(t,p*8,s),s+=p*8,m;if(l==25)return m=t.toString(this.encoding,s>>3,(s+=p<<3)>>3),m;console.log("ERROR: ElementType not implemented: "+l)},"parseElement"),u=i(function(l,p){var m=[],d;if(l.length>1){var f=l.shift();for(d=0;d<f;d++)m[d]=u(l,p);l.unshift(f)}else for(d=0;d<l[0];d++)m[d]=c(p);return m},"parse");return u(a,n)},"parseArray"),id=i(function(t){return t.toString("utf8")},"parseText"),ad=i(function(t){return t===null?null:Y(t,8)>0},"parseBool"),od=i(function(t){t(20,ed),t(21,td),t(23,Ba),t(26,Ba),t(1700,sd),t(700,rd),t(701,nd),t(16,ad),t(1114,Ka.bind(null,!1)),t(1184,Ka.bind(null,!0)),t(1e3,At),t(1007,At),t(1016,At),t(1008,At),t(1009,At),t(25,id)},"init");Va.exports={init:od}});var Qa=C((TS,Wa)=>{Wa.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var vt=C(bt=>{var cd=Ua(),ud=Ha(),ld=Ur(),pd=Qa();bt.getTypeParser=md;bt.setTypeParser=dd;bt.arrayParser=ld;bt.builtins=pd;var Nt={text:{},binary:{}};function Ya(t){return String(t)}i(Ya,"noParse");function md(t,e){return e=e||"text",Nt[e]&&Nt[e][t]||Ya}i(md,"getTypeParser");function dd(t,e,r){typeof e=="function"&&(r=e,e="text"),Nt[e][t]=r}i(dd,"setTypeParser");cd.init(function(t,e){Nt.text[t]=e});ud.init(function(t,e){Nt.binary[t]=e})});var It=C((AS,Wr)=>{"use strict";Wr.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Je=vt(),fd=Je.getTypeParser(20,"text"),hd=Je.getTypeParser(1016,"text");Wr.exports.__defineSetter__("parseInt8",function(t){Je.setTypeParser(20,"text",t?Je.getTypeParser(23,"text"):fd),Je.setTypeParser(1016,"text",t?Je.getTypeParser(1007,"text"):hd)})});var Ot=C((NS,za)=>{"use strict";var gd=It();function yd(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(yd,"escapeElement");function ja(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+ja(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=yd(Vt(t[r]));return e=e+"}",e}i(ja,"arrayString");var Vt=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?gd.parseInputDatesAsUTC?Td(t):Ed(t):Array.isArray(t)?ja(t):typeof t=="object"?_d(t,e):t.toString()},"prepareValue");function _d(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),Vt(t.toPostgres(Vt),e)}return JSON.stringify(t)}i(_d,"prepareObject");function pe(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(pe,"pad");function Ed(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=pe(r,4)+"-"+pe(t.getMonth()+1,2)+"-"+pe(t.getDate(),2)+"T"+pe(t.getHours(),2)+":"+pe(t.getMinutes(),2)+":"+pe(t.getSeconds(),2)+"."+pe(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=pe(Math.floor(e/60),2)+":"+pe(e%60,2),n&&(s+=" BC"),s}i(Ed,"dateToString");function Td(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=pe(e,4)+"-"+pe(t.getUTCMonth()+1,2)+"-"+pe(t.getUTCDate(),2)+"T"+pe(t.getUTCHours(),2)+":"+pe(t.getUTCMinutes(),2)+":"+pe(t.getUTCSeconds(),2)+"."+pe(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(Td,"dateToStringUTC");function Sd(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(Sd,"normalizeQueryConfig");var Cd=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),Ad=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");za.exports={prepareValue:i(function(e){return Vt(e)},"prepareValueWrapper"),normalizeQueryConfig:Sd,escapeIdentifier:Cd,escapeLiteral:Ad}});var Za=C((vS,Xa)=>{"use strict";var Rt=require("crypto");function Qr(t){return Rt.createHash("md5").update(t,"utf-8").digest("hex")}i(Qr,"md5");function Nd(t,e,r){var n=Qr(e+t),s=Qr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Nd,"postgresMd5PasswordHash");function bd(t){return Rt.createHash("sha256").update(t).digest()}i(bd,"sha256");function vd(t,e){return Rt.createHmac("sha256",t).update(e).digest()}i(vd,"hmacSha256");async function Id(t,e,r){return Rt.pbkdf2Sync(t,e,r,32,"sha256")}i(Id,"deriveKey");Xa.exports={postgresMd5PasswordHash:Nd,randomBytes:Rt.randomBytes,deriveKey:Id,sha256:bd,hmacSha256:vd,md5:Qr}});var ro=C((OS,to)=>{var Ja=require("crypto");to.exports={postgresMd5PasswordHash:Rd,randomBytes:Od,deriveKey:qd,sha256:wd,hmacSha256:Dd,md5:Yr};var eo=Ja.webcrypto||globalThis.crypto,et=eo.subtle,jr=new TextEncoder;function Od(t){return eo.getRandomValues(Buffer.alloc(t))}i(Od,"randomBytes");async function Yr(t){try{return Ja.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?jr.encode(t):t,n=await et.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(Yr,"md5");async function Rd(t,e,r){var n=await Yr(e+t),s=await Yr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Rd,"postgresMd5PasswordHash");async function wd(t){return await et.digest("SHA-256",t)}i(wd,"sha256");async function Dd(t,e){let r=await et.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await et.sign("HMAC",r,jr.encode(e))}i(Dd,"hmacSha256");async function qd(t,e,r){let n=await et.importKey("raw",jr.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await et.deriveBits(s,n,32*8,["deriveBits"])}i(qd,"deriveKey")});var Xr=C((wS,zr)=>{"use strict";var xd=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;xd?zr.exports=Za():zr.exports=ro()});var ao=C((DS,io)=>{"use strict";var We=Xr();function Pd(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=We.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(Pd,"startSession");async function Ld(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=Ud(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o="c=biws,r="+n.nonce,c=s+","+a+","+o,u=Buffer.from(n.salt,"base64"),l=await We.deriveKey(e,u,n.iteration),p=await We.hmacSha256(l,"Client Key"),m=await We.sha256(p),d=await We.hmacSha256(m,c),f=$d(Buffer.from(p),Buffer.from(d)).toString("base64"),h=await We.hmacSha256(l,"Server Key"),T=await We.hmacSha256(h,c);t.message="SASLResponse",t.serverSignature=Buffer.from(T).toString("base64"),t.response=o+",p="+f}i(Ld,"continueSession");function Md(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=kd(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(Md,"finalizeSession");function Fd(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Fd,"isPrintableChars");function no(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(no,"isBase64");function so(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(so,"parseAttributePairs");function Ud(t){let e=so(t),r=e.get("r");if(r){if(!Fd(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!no(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(s,10);return{nonce:r,salt:n,iteration:a}}i(Ud,"parseServerFirstMessage");function kd(t){let r=so(t).get("v");if(r){if(!no(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(kd,"parseServerFinalMessage");function $d(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i($d,"xorBuffers");io.exports={startSession:Pd,continueSession:Ld,finalizeSession:Md}});var Zr=C((xS,oo)=>{"use strict";var Bd=vt();function Ht(t){this._types=t||Bd,this.text={},this.binary={}}i(Ht,"TypeOverrides");Ht.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};Ht.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};Ht.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};oo.exports=Ht});var uo=C((LS,co)=>{"use strict";function Jr(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(Jr,"parse");co.exports=Jr;Jr.parse=Jr});var rn=C((FS,mo)=>{"use strict";var Kd=require("dns"),po=It(),lo=uo().parse,fe=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||po[t]},"val"),Gd=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return po.ssl},"readSSLConfigFromEnvironment"),tt=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),be=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+tt(n))},"add"),tn=class tn{constructor(e){e=typeof e=="string"?lo(e):e||{},e.connectionString&&(e=Object.assign({},e,lo(e.connectionString))),this.user=fe("user",e),this.database=fe("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(fe("port",e),10),this.host=fe("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:fe("password",e)}),this.binary=fe("binary",e),this.options=fe("options",e),this.ssl=typeof e.ssl>"u"?Gd():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=fe("client_encoding",e),this.replication=fe("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=fe("application_name",e,"PGAPPNAME"),this.fallback_application_name=fe("fallback_application_name",e,!1),this.statement_timeout=fe("statement_timeout",e,!1),this.lock_timeout=fe("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=fe("idle_in_transaction_session_timeout",e,!1),this.query_timeout=fe("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];be(r,this,"user"),be(r,this,"password"),be(r,this,"port"),be(r,this,"application_name"),be(r,this,"fallback_application_name"),be(r,this,"connect_timeout"),be(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(be(r,n,"sslmode"),be(r,n,"sslca"),be(r,n,"sslkey"),be(r,n,"sslcert"),be(r,n,"sslrootcert"),this.database&&r.push("dbname="+tt(this.database)),this.replication&&r.push("replication="+tt(this.replication)),this.host&&r.push("host="+tt(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+tt(this.client_encoding)),Kd.lookup(this.host,function(s,a){return s?e(s,null):(r.push("hostaddr="+tt(a)),e(null,r.join(" ")))})}};i(tn,"ConnectionParameters");var en=tn;mo.exports=en});var go=C((kS,ho)=>{"use strict";var Vd=vt(),fo=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,sn=class sn{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=fo.exec(e.text):r=fo.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var a=e[n];a!==null?r[n]=this._parsers[n](a):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var a=e[n],o=this.fields[n].name;a!==null?r[o]=this._parsers[n](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=Vd.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(sn,"Result");var nn=sn;ho.exports=nn});var To=C((BS,Eo)=>{"use strict";var{EventEmitter:Hd}=require("events"),yo=go(),_o=Ot(),on=class on extends Hd{constructor(e,r,n){super(),e=_o.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new yo(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new yo(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:_o.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(on,"Query");var an=on;Eo.exports=an});var Mn=C(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.NoticeMessage=F.DataRowMessage=F.CommandCompleteMessage=F.ReadyForQueryMessage=F.NotificationResponseMessage=F.BackendKeyDataMessage=F.AuthenticationMD5Password=F.ParameterStatusMessage=F.ParameterDescriptionMessage=F.RowDescriptionMessage=F.Field=F.CopyResponse=F.CopyDataMessage=F.DatabaseError=F.copyDone=F.emptyQuery=F.replicationStart=F.portalSuspended=F.noData=F.closeComplete=F.bindComplete=F.parseComplete=void 0;F.parseComplete={name:"parseComplete",length:5};F.bindComplete={name:"bindComplete",length:5};F.closeComplete={name:"closeComplete",length:5};F.noData={name:"noData",length:5};F.portalSuspended={name:"portalSuspended",length:5};F.replicationStart={name:"replicationStart",length:4};F.emptyQuery={name:"emptyQuery",length:4};F.copyDone={name:"copyDone",length:4};var Cn=class Cn extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(Cn,"DatabaseError");var cn=Cn;F.DatabaseError=cn;var An=class An{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(An,"CopyDataMessage");var un=An;F.CopyDataMessage=un;var Nn=class Nn{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(Nn,"CopyResponse");var ln=Nn;F.CopyResponse=ln;var bn=class bn{constructor(e,r,n,s,a,o,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(bn,"Field");var pn=bn;F.Field=pn;var vn=class vn{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(vn,"RowDescriptionMessage");var mn=vn;F.RowDescriptionMessage=mn;var In=class In{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(In,"ParameterDescriptionMessage");var dn=In;F.ParameterDescriptionMessage=dn;var On=class On{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(On,"ParameterStatusMessage");var fn=On;F.ParameterStatusMessage=fn;var Rn=class Rn{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(Rn,"AuthenticationMD5Password");var hn=Rn;F.AuthenticationMD5Password=hn;var wn=class wn{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(wn,"BackendKeyDataMessage");var gn=wn;F.BackendKeyDataMessage=gn;var Dn=class Dn{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(Dn,"NotificationResponseMessage");var yn=Dn;F.NotificationResponseMessage=yn;var qn=class qn{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(qn,"ReadyForQueryMessage");var _n=qn;F.ReadyForQueryMessage=_n;var xn=class xn{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(xn,"CommandCompleteMessage");var En=xn;F.CommandCompleteMessage=En;var Pn=class Pn{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(Pn,"DataRowMessage");var Tn=Pn;F.DataRowMessage=Tn;var Ln=class Ln{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(Ln,"NoticeMessage");var Sn=Ln;F.NoticeMessage=Sn});var So=C(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.Writer=void 0;var Un=class Un{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(Un,"Writer");var Fn=Un;Wt.Writer=Fn});var Ao=C(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.serialize=void 0;var kn=So(),j=new kn.Writer,Wd=i(t=>{j.addInt16(3).addInt16(0);for(let n of Object.keys(t))j.addCString(n).addCString(t[n]);j.addCString("client_encoding").addCString("UTF8");var e=j.addCString("").flush(),r=e.length+4;return new kn.Writer().addInt32(r).add(e).flush()},"startup"),Qd=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Yd=i(t=>j.addCString(t).flush(112),"password"),jd=i(function(t,e){return j.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),j.flush(112)},"sendSASLInitialResponseMessage"),zd=i(function(t){return j.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Xd=i(t=>j.addCString(t).flush(81),"query"),Co=[],Zd=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Co;for(var n=r.length,s=j.addCString(e).addCString(t.text).addInt16(n),a=0;a<n;a++)s.addInt32(r[a]);return j.flush(80)},"parse"),rt=new kn.Writer,Jd=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(j.addInt16(0),rt.addInt32(-1)):n instanceof Buffer?(j.addInt16(1),rt.addInt32(n.length),rt.add(n)):(j.addInt16(0),rt.addInt32(Buffer.byteLength(n)),rt.addString(n))}},"writeValues"),ef=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||Co,a=s.length;return j.addCString(e).addCString(r),j.addInt16(a),Jd(s,t.valueMapper),j.addInt16(a),j.add(rt.flush()),j.addInt16(n?1:0),j.flush(66)},"bind"),tf=Buffer.from([69,0,0,0,9,0,0,0,0,0]),rf=i(t=>{if(!t||!t.portal&&!t.rows)return tf;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,a=Buffer.allocUnsafe(1+s);return a[0]=69,a.writeInt32BE(s,1),a.write(e,5,"utf-8"),a[n+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),nf=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),$n=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),sf=j.addCString("P").flush(68),af=j.addCString("S").flush(68),of=i(t=>t.name?$n(68,`${t.type}${t.name||""}`):t.type==="P"?sf:af,"describe"),cf=i(t=>{let e=`${t.type}${t.name||""}`;return $n(67,e)},"close"),uf=i(t=>j.add(t).flush(100),"copyData"),lf=i(t=>$n(102,t),"copyFail"),Qt=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),pf=Qt(72),mf=Qt(83),df=Qt(88),ff=Qt(99),hf={startup:Wd,password:Yd,requestSsl:Qd,sendSASLInitialResponseMessage:jd,sendSCRAMClientFinalMessage:zd,query:Xd,parse:Zd,bind:ef,execute:rf,describe:of,close:cf,flush:i(()=>pf,"flush"),sync:i(()=>mf,"sync"),end:i(()=>df,"end"),copyData:uf,copyDone:i(()=>ff,"copyDone"),copyFail:lf,cancel:nf};Yt.serialize=hf});var No=C(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.BufferReader=void 0;var gf=Buffer.allocUnsafe(0),Kn=class Kn{constructor(e=0){this.offset=e,this.buffer=gf,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(Kn,"BufferReader");var Bn=Kn;jt.BufferReader=Bn});var Io=C(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.Parser=void 0;var z=Mn(),yf=No(),Gn=1,_f=4,bo=Gn+_f,vo=Buffer.allocUnsafe(0),Hn=class Hn{constructor(e){if(this.buffer=vo,this.bufferLength=0,this.bufferOffset=0,this.reader=new yf.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+bo<=n;){let a=this.buffer[s],o=this.buffer.readUInt32BE(s+Gn),c=Gn+o;if(c+s<=n){let u=this.handlePacket(s+bo,a,o,this.buffer);r(u),s+=c}else break}s===n?(this.buffer=vo,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;s=Buffer.allocUnsafe(a)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return z.bindComplete;case 49:return z.parseComplete;case 51:return z.closeComplete;case 110:return z.noData;case 115:return z.portalSuspended;case 99:return z.copyDone;case 87:return z.replicationStart;case 73:return z.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new z.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new z.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new z.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new z.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new z.CopyResponse(r,s,a,o);for(let u=0;u<o;u++)c.columnTypes[u]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new z.NotificationResponseMessage(r,s,a,o)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new z.RowDescriptionMessage(r,s);for(let o=0;o<s;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new z.Field(e,r,n,s,a,o,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new z.ParameterDescriptionMessage(r,s);for(let o=0;o<s;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new Array(s);for(let o=0;o<s;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new z.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),a=this.reader.cstring();return new z.ParameterStatusMessage(r,s,a)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.int32();return new z.BackendKeyDataMessage(r,s,a)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new z.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return a}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,u=s==="notice"?new z.NoticeMessage(r,c):new z.DatabaseError(c,r,s);return u.severity=a.S,u.code=a.C,u.detail=a.D,u.hint=a.H,u.position=a.P,u.internalPosition=a.p,u.internalQuery=a.q,u.where=a.W,u.schema=a.s,u.table=a.t,u.column=a.c,u.dataType=a.d,u.constraint=a.n,u.file=a.F,u.line=a.L,u.routine=a.R,u}};i(Hn,"Parser");var Vn=Hn;zt.Parser=Vn});var Wn=C($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.DatabaseError=$e.serialize=$e.parse=void 0;var Ef=Mn();Object.defineProperty($e,"DatabaseError",{enumerable:!0,get:i(function(){return Ef.DatabaseError},"get")});var Tf=Ao();Object.defineProperty($e,"serialize",{enumerable:!0,get:i(function(){return Tf.serialize},"get")});var Sf=Io();function Cf(t,e){let r=new Sf.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(Cf,"parse");$e.parse=Cf});var Oo={};dp(Oo,{default:()=>Af});var Af,Ro=mp(()=>{Af={}});var wo=C((tC,Qn)=>{Qn.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(Ro(),hp(Oo));return new n(e)}},"getStream");Qn.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var zn=C((sC,Do)=>{"use strict";var nC=require("net"),Nf=require("events").EventEmitter,{parse:bf,serialize:ce}=Wn(),{getStream:vf,getSecureStream:If}=wo(),Of=ce.flush(),Rf=ce.sync(),wf=ce.end(),jn=class jn extends Nf{constructor(e){super(),e=e||{},this.stream=e.stream||vf(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(a){n._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||n.emit("error",a)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var u=require("net");u.isIP&&u.isIP(r)===0&&(c.servername=r);try{n.stream=If(c)}catch(l){return n.emit("error",l)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){bf(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(ce.requestSsl())}startup(e){this.stream.write(ce.startup(e))}cancel(e,r){this._send(ce.cancel(e,r))}password(e){this._send(ce.password(e))}sendSASLInitialResponseMessage(e,r){this._send(ce.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(ce.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(ce.query(e))}parse(e){this._send(ce.parse(e))}bind(e){this._send(ce.bind(e))}execute(e){this._send(ce.execute(e))}flush(){this.stream.writable&&this.stream.write(Of)}sync(){this._ending=!0,this._send(Rf)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(wf,()=>{this.stream.end()})}close(e){this._send(ce.close(e))}describe(e){this._send(ce.describe(e))}sendCopyFromChunk(e){this._send(ce.copyData(e))}endCopyFrom(){this._send(ce.copyDone())}sendCopyFail(e){this._send(ce.copyFail(e))}};i(jn,"Connection");var Yn=jn;Do.exports=Yn});var Lo=C((aC,Po)=>{"use strict";var{Transform:Df}=require("stream"),{StringDecoder:qf}=require("string_decoder"),Be=Symbol("last"),Xt=Symbol("decoder");function xf(t,e,r){let n;if(this.overflow){if(n=this[Xt].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[Be]+=this[Xt].write(t),n=this[Be].split(this.matcher);this[Be]=n.pop();for(let s=0;s<n.length;s++)try{xo(this,this.mapper(n[s]))}catch(a){return r(a)}if(this.overflow=this[Be].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(xf,"transform");function Pf(t){if(this[Be]+=this[Xt].end(),this[Be])try{xo(this,this.mapper(this[Be]))}catch(e){return t(e)}t()}i(Pf,"flush");function xo(t,e){e!==void 0&&t.push(e)}i(xo,"push");function qo(t){return t}i(qo,"noop");function Lf(t,e,r){switch(t=t||/\r?\n/,e=e||qo,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=qo)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=xf,r.flush=Pf,r.readableObjectMode=!0;let n=new Df(r);return n[Be]="",n[Xt]=new qf("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,a){this._writableState.errorEmitted=!1,a(s)},n}i(Lf,"split");Po.exports=Lf});var Uo=C((cC,Ue)=>{"use strict";var Mo=require("path"),Mf=require("stream").Stream,Ff=Lo(),Fo=require("util"),Uf=5432,Zt=process.platform==="win32",wt=process.stderr,kf=56,$f=7,Bf=61440,Kf=32768;function Gf(t){return(t&Bf)==Kf}i(Gf,"isRegFile");var nt=["host","port","database","user","password"],Xn=nt.length,Vf=nt[Xn-1];function Zn(){var t=wt instanceof Mf&&wt.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);wt.write(Fo.format.apply(Fo,e))}}i(Zn,"warn");Object.defineProperty(Ue.exports,"isWin",{get:i(function(){return Zt},"get"),set:i(function(t){Zt=t},"set")});Ue.exports.warnTo=function(t){var e=wt;return wt=t,e};Ue.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Zt?Mo.join(e.APPDATA||"./","postgresql","pgpass.conf"):Mo.join(e.HOME||"./",".pgpass"));return r};Ue.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Zt?!0:(e=e||"<unkn>",Gf(t.mode)?t.mode&(kf|$f)?(Zn('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Zn('WARNING: password file "%s" is not a plain file',e),!1))};var Hf=Ue.exports.match=function(t,e){return nt.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||Uf)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};Ue.exports.getPassword=function(t,e,r){var n,s=e.pipe(Ff());function a(u){var l=Wf(u);l&&Qf(l)&&Hf(t,l)&&(n=l[Vf],s.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(u){e.destroy(),Zn("WARNING: error on reading file: %s",u),r(void 0)},"onErr");e.on("error",c),s.on("data",a).on("end",o).on("error",c)};var Wf=Ue.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,a=0,o={},c=!1,u=i(function(p,m,d){var f=t.substring(m,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),o[nt[p]]=f},"addToObj"),l=0;l<t.length-1;l+=1){if(e=t.charAt(l+1),r=t.charAt(l),c=n==Xn-1,c){u(n,s);break}l>=0&&e==":"&&r!=="\\"&&(u(n,s,l+1),s=l+2,n+=1)}return o=Object.keys(o).length===Xn?o:null,o},Qf=Ue.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<nt.length;r+=1){var n=e[r],s=t[nt[r]]||"",a=n(s);if(!a)return!1}return!0}});var $o=C((pC,Jn)=>{"use strict";var lC=require("path"),ko=require("fs"),Jt=Uo();Jn.exports=function(t,e){var r=Jt.getFileName();ko.stat(r,function(n,s){if(n||!Jt.usePgPass(s,r))return e(void 0);var a=ko.createReadStream(r);Jt.getPassword(t,a,e)})};Jn.exports.warnTo=Jt.warnTo});var Vo=C((mC,Go)=>{"use strict";var Yf=require("events").EventEmitter,Bo=Ot(),es=ao(),jf=Zr(),zf=rn(),Ko=To(),Xf=It(),Zf=zn(),Jf=Xr(),ts=class ts extends Yf{constructor(e){super(),this.connectionParameters=new zf(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new jf(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Zf({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Xf.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{$o()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await Jf.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=es.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await es.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{es.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Bo.escapeIdentifier(e)}escapeLiteral(e){return Bo.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,a,o,c,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(o=this.connectionParameters.query_timeout,s=new Ko(e,r,n),s.callback||(a=new this._Promise((l,p)=>{s.callback=(m,d)=>m?p(m):l(d)}).catch(l=>{throw Error.captureStackTrace(l),l}))),o&&(u=s.callback,c=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),u(l),s.callback=()=>{};var p=this.queryQueue.indexOf(s);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},o),s.callback=(l,p)=>{clearTimeout(c),u(l,p)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(s),this._pulseQueryQueue(),a):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(ts,"Client");var er=ts;er.Query=Ko;Go.exports=er});var Yo=C((fC,Qo)=>{"use strict";var eh=require("events").EventEmitter,Ho=i(function(){},"NOOP"),Wo=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),ss=class ss{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(ss,"IdleItem");var rs=ss,is=class is{constructor(e){this.callback=e}};i(is,"PendingItem");var st=is;function th(){throw new Error("Release called on client which has already been released to the pool.")}i(th,"throwOnDoubleRelease");function tr(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(o,c){o?r(o):n(c)},"cb"),a=new t(function(o,c){n=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:s,result:a}}i(tr,"promisify");function rh(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(rh,"makeIdleListener");var as=class as extends eh{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||os().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=Wo(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=tr(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new st(r.callback)),n;let s=i((c,u,l)=>{clearTimeout(o),r.callback(c,u,l)},"queueCallback"),a=new st(s),o=setTimeout(()=>{Wo(this._pendingQueue,c=>c.callback===s),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),n}return this.newClient(new st(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=rh(this,r);this.log("checking client timeout");let s,a=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(s&&clearTimeout(s),r.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,Ho);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(l=>l.client===r)!==-1&&this._acquireClient(r,new st((l,p,m)=>m()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,Ho);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&th(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new rs(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=tr(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let s=tr(this.Promise,n);return n=s.callback,this.connect((a,o)=>{if(a)return n(a);let c=!1,u=i(l=>{c||(c=!0,o.release(l),n(l))},"onError");o.once("error",u),this.log("dispatching query");try{o.query(e,r,(l,p)=>{if(this.log("query dispatched"),o.removeListener("error",u),!c)return c=!0,o.release(l),l?n(l):n(void 0,p)})}catch(l){return o.release(l),n(l)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=tr(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(as,"Pool");var ns=as;Qo.exports=ns});var Xo=C((gC,zo)=>{"use strict";var jo=require("events").EventEmitter,nh=require("util"),cs=Ot(),it=zo.exports=function(t,e,r){jo.call(this),t=cs.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};nh.inherits(it,jo);var sh={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};it.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=sh[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};it.prototype.then=function(t,e){return this._getPromise().then(t,e)};it.prototype.catch=function(t){return this._getPromise().catch(t)};it.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};it.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((u,l)=>{u.forEach(p=>{e.emit("row",p,c[l])})}):o.forEach(function(u){e.emit("row",u,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(cs.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var s=this.values.map(cs.prepareValue);t.native.query(this.text,s,r)}else t.native.query(this.text,r)}});var rc=C((_C,tc)=>{"use strict";var Zo;try{Zo=require("pg-native")}catch(t){throw t}var ih=Zr(),Jo=require("events").EventEmitter,ah=require("util"),oh=rn(),ec=Xo(),ye=tc.exports=function(t){Jo.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new ih(t.types),this.native=new Zo({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new oh(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ye.Query=ec;ah.inherits(ye,Jo);ye.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ye.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ye.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ye.prototype.query=function(t,e,r){var n,s,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,n=new ec(t,e,r),!n.callback){let u,l;s=new this._Promise((p,m)=>{u=p,l=m}).catch(p=>{throw Error.captureStackTrace(p),p}),n.callback=(p,m)=>p?l(p):u(m)}return a&&(c=n.callback,o=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),c(u),n.callback=()=>{};var l=this._queryQueue.indexOf(n);l>-1&&this._queryQueue.splice(l,1),this._pulseQueryQueue()},a),n.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};ye.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(a=>a?s(a):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ye.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ye.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};ye.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ye.prototype.ref=function(){};ye.prototype.unref=function(){};ye.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ye.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var us=C((TC,nc)=>{"use strict";nc.exports=rc()});var os=C((SC,Dt)=>{"use strict";var ch=Vo(),uh=It(),lh=zn(),ph=Yo(),{DatabaseError:mh}=Wn(),{escapeIdentifier:dh,escapeLiteral:fh}=Ot(),hh=i(t=>{var e;return e=class extends ph{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),ls=i(function(t){this.defaults=uh,this.Client=t,this.Query=this.Client.Query,this.Pool=hh(this.Client),this._pools=[],this.Connection=lh,this.types=vt(),this.DatabaseError=mh,this.escapeIdentifier=dh,this.escapeLiteral=fh},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Dt.exports=new ls(us()):(Dt.exports=new ls(ch),Object.defineProperty(Dt.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new ls(us())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Dt.exports,"native",{value:t}),t}}))});var ic=C((AC,sc)=>{var Qe=require("fs"),gh=Ea(),yh=os(),_h="The server does not support SSL connections",Eh="28000",Th=i(t=>{let e={username:t.ssh_user,host:t.ssh_host,port:t.ssh_port,dstHost:t.host,dstPort:t.port,localHost:"127.0.0.1",localPort:t.port,keepAlive:!0};return t.ssh_method==="privateKey"?Object.assign({},e,{privateKey:Qe.readFileSync(t.ssh_key_file),passphrase:t.ssh_key_passphrase}):Object.assign({},e,{password:t.ssh_password})},"getSshConfig"),Sh=i(t=>new Promise((e,r)=>{gh(Th(t),(n,s)=>{n?r(n):e({tunnel:s,info:Object.assign({},t,{host:"127.0.0.1"})})})}),"connectViaSsh"),Ch=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,a){e.info("Certificate",{hostname:s,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return Qe.existsSync(t.certAuthority)&&(n.ca=Qe.readFileSync(t.certAuthority).toString()),Qe.existsSync(t.clientCert)&&(n.cert=Qe.readFileSync(t.clientCert).toString()),Qe.existsSync(t.clientPrivateKey)&&(n.key=Qe.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),Ah=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),Nh=i(async(t,e)=>{let r=null;if(t.ssh){let{info:a,tunnel:o}=await Sh(t);r=o,t=a}t=Object.assign({},t,{sslType:Ah(t.sslType)});let n={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:Ch(t,e),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await ps(n,e),sshTunnel:r}},"createClient"),bh=i((t,e,r)=>{var n;if(r.message===_h&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),ps({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===Eh&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),ps({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),ps=i((t,e)=>{let r=new yh.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return bh(t,e,n)})},"createConnectionPool");sc.exports={createClient:Nh}});var ds=C((bC,cc)=>{var ms=i(t=>`
        SELECT indexname,
               index_method,
               index_unique,
               index_indnullsnotdistinct,
               number_of_keys,
               where_expression,
               array_agg(attname
                         ORDER BY ord)::text[] AS columns,
               array_agg(coll
                         ORDER BY ord) AS collations,
               array_agg(opclass
                         ORDER BY ord) AS opclasses,
               array_agg(expression
                         ORDER BY ord) AS expressions,
               array_agg(ascending
                         ORDER BY ord) AS ascendings,
               array_agg(nulls_first
                         ORDER BY ord) AS nulls_first,
                reloptions AS storage_parameters,
                tablespace_name
        FROM
            (SELECT ct.oid AS table_oid,
                    c.relname AS indexname,
                    m.amname AS index_method,
                    indexes.indisunique AS index_unique,
                    ${t===15?"indexes.indnullsnotdistinct":"FALSE"} AS index_indnullsnotdistinct,
                    indexes.ord,
                    attribute.attname,
                     c.reloptions,
                     tablespace_t.spcname AS tablespace_name,
                    indexes.${t===10?"indnatts":"indnkeyatts"} AS number_of_keys,
                    pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
                    CASE
                        WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
                    END AS coll,
                    CASE
                        WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
                    END AS opclass,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'asc')
                    END AS ascending,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'nulls_first')
                    END AS nulls_first,
                    pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
             FROM
                 (SELECT *,
                         generate_series(1,array_length(i.indkey,1)) AS ord,
                         unnest(i.indkey) AS key,
                         unnest(i.indcollation) AS coll,
                         unnest(i.indclass) AS class,
                         unnest(i.indoption) AS option
                  FROM pg_catalog.pg_index i) indexes
             JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
             JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
             JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
             LEFT JOIN pg_catalog.pg_attribute attribute ON (attribute.attrelid=indexes.indrelid
                                                  AND attribute.attnum=indexes.key)
             LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
             LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
             LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
             LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
             LEFT JOIN pg_catalog.pg_tablespace tablespace_t ON (tablespace_t.oid = c.reltablespace)) s2
        WHERE table_oid = $1
        GROUP BY indexname,
                 index_method,
                 index_unique,
                 index_indnullsnotdistinct,
                 reloptions,
                 number_of_keys,
                 where_expression,
                 tablespace_name;
        `,"getGET_TABLE_INDEXES"),ac=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),oc={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
        SELECT tables.table_name, tables.table_type FROM information_schema.tables AS tables
        INNER JOIN 
        (SELECT
                pg_class.relname AS table_name,
                 pg_namespace.nspname AS table_schema
        FROM pg_catalog.pg_class AS pg_class
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace 
                ON (pg_namespace.oid = pg_class.relnamespace)
        WHERE pg_class.relispartition = false
                AND pg_class.relkind = ANY('{"r","v","t","m","p"}'))
        AS catalog_table_data
        ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
	LEFT JOIN (SELECT relname AS child_name FROM pg_catalog.pg_inherits AS inherit
		LEFT JOIN pg_catalog.pg_class AS child ON (child.oid = inherit.inhrelid)) AS inherited_tables
	ON (inherited_tables.child_name = tables.table_name)
	WHERE inherited_tables.child_name IS NULL
        AND tables.table_schema = $1;`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pt.spcname, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc 
            LEFT JOIN pg_catalog.pg_tablespace AS pt 
            ON pc.reltablespace = pt.oid
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_PARTITION_DATA:`
        SELECT partstrat as partition_method,
	            partattrs::int2[] as partition_attributes_positions,
	            pg_catalog.pg_get_expr(partexprs, partrelid) AS expressions
            FROM pg_catalog.pg_partitioned_table
            WHERE partrelid = $1;`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1)",GET_ROWS_COUNT:i(t=>`SELECT COUNT(*) AS quantity FROM ${t};`,"GET_ROWS_COUNT"),GET_SAMPLED_DATA:i((t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,"GET_SAMPLED_DATA"),GET_SAMPLED_DATA_SIZE:i((t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,"GET_SAMPLED_DATA_SIZE"),GET_INHERITS_PARENT_TABLE_NAME:`
        SELECT pc.relname AS parent_table_name FROM pg_catalog.pg_inherits AS pi
	        INNER JOIN pg_catalog.pg_class AS pc
	        ON pc.oid = pi.inhparent
	        WHERE pi.inhrelid = $1;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.connoinherit AS no_inherit,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters,
	            pt.spcname AS tablespace
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        LEFT JOIN pg_catalog.pg_tablespace AS pt
	        ON pc.reltablespace = pt.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:ms(),GET_TABLE_INDEXES_V_10:ms(10),GET_TABLE_INDEXES_V_15:ms(15),GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_tablespace AS pt ON pc.reltablespace = pt.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:ac(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:ac(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND ((pg_type.typtype = 'c'
               AND pg_class.relkind = 'c')
              OR pg_type.typtype = 'e'
              OR pg_type.typtype = 'r')
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DOMAIN_TYPES:"SELECT * FROM information_schema.domains WHERE domain_schema = $1",GET_DOMAIN_TYPES_CONSTRAINTS:`
        SELECT pg_type.typname AS type_name,
        	pg_type.typnotnull AS not_null,
        	pg_constraint.conname AS constraint_name,
        	pg_catalog.pg_get_expr(pg_constraint.conbin, pg_constraint.conrelid) AS expression
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_constraint AS pg_constraint ON (pg_constraint.contypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        WHERE pg_type.typname = $1 AND pg_namespace.nspname = $2 AND pg_constraint.contype = 'c';`,GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;",GET_TRIGGERS:`
        SELECT trigger_name,
                array_agg(event_manipulation::text) AS trigger_events,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement
        FROM
            -- This is information_schema.triggers view but without permitions
            (SELECT (current_database())::information_schema.sql_identifier AS trigger_catalog,
                    (n.nspname)::information_schema.sql_identifier AS trigger_schema,
                    (t.tgname)::information_schema.sql_identifier AS trigger_name,
                    (em.text)::information_schema.character_data AS event_manipulation,
                    (current_database())::information_schema.sql_identifier AS event_object_catalog,
                    (n.nspname)::information_schema.sql_identifier AS event_object_schema,
                    (c.relname)::information_schema.sql_identifier AS event_object_table,
                    (rank() OVER (PARTITION BY (n.nspname)::information_schema.sql_identifier,
                                               (c.relname)::information_schema.sql_identifier,
                                               em.num, ((t.tgtype)::integer & 1), ((t.tgtype)::integer & 66)
                                  ORDER BY t.tgname))::information_schema.cardinal_number AS action_order,
                    (regexp_match(pg_get_triggerdef(t.oid), '.{35,} WHEN ((.+)) EXECUTE FUNCTION'::text))[1]::information_schema.character_data AS action_condition,
                    (SUBSTRING(pg_get_triggerdef(t.oid)
                               FROM (POSITION(('EXECUTE FUNCTION'::text) IN (SUBSTRING(pg_get_triggerdef(t.oid)
                                                                                       FROM 48))) + 47)))::information_schema.character_data AS action_statement,
                    (CASE ((t.tgtype)::integer & 1)
                         WHEN 1 THEN 'ROW'::text
                         ELSE 'STATEMENT'::text
                     END)::information_schema.character_data AS action_orientation,
                    (CASE ((t.tgtype)::integer & 66)
                         WHEN 2 THEN 'BEFORE'::text
                         WHEN 64 THEN 'INSTEAD OF'::text
                         ELSE 'AFTER'::text
                     END)::information_schema.character_data AS action_timing,
                    (t.tgoldtable)::information_schema.sql_identifier AS action_reference_old_table,
                    (t.tgnewtable)::information_schema.sql_identifier AS action_reference_new_table,
                    (NULL::timestamp with time zone)::information_schema.time_stamp AS created
                FROM pg_namespace n,
                        pg_class c,
                        pg_trigger t, (VALUES (4,'INSERT'::text), (8,'DELETE'::text), (16,'UPDATE'::text)) em(num, text)
                WHERE ((n.oid = c.relnamespace)
                        AND (c.oid = t.tgrelid)
                        AND (((t.tgtype)::integer & em.num) <> 0)
                        AND (NOT t.tgisinternal)
                        AND (NOT pg_is_other_temp_schema(n.oid)))) AS tmp_views
        WHERE event_object_schema = $1 AND event_object_table = $2
        GROUP BY
                trigger_schema,
                trigger_name,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement;`,GET_TRIGGERS_ADDITIONAL_DATA:`
        SELECT
                pg_catalog.obj_description(pg_trigger.oid, 'pg_trigger') AS description,
        	pg_trigger.tgname AS trigger_name,
        	pg_proc.proname AS function_name,
        	CASE WHEN pg_trigger.tgconstraint != 0 THEN true ELSE false END AS "constraint",
        	array_agg(pg_attribute.attname)::text[] AS update_attributes,
        	tgdeferrable AS "deferrable",
        	tginitdeferred AS deferred,
                pg_class_referenced.relname AS referenced_table_name,
                pg_namespace_referenced.nspname AS referenced_table_schema
        FROM pg_catalog.pg_trigger as pg_trigger
        LEFT JOIN pg_catalog.pg_proc AS pg_proc 
        	ON (pg_trigger.tgfoid = pg_proc.oid)
        LEFT JOIN pg_catalog.pg_attribute AS pg_attribute
        	ON (pg_attribute.attnum = ANY(pg_trigger.tgattr::int2[]) AND pg_trigger.tgrelid = pg_attribute.attrelid)
        INNER JOIN pg_catalog.pg_class AS pg_class
        	ON (pg_class.oid = pg_trigger.tgrelid)
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace
        	ON (pg_class.relnamespace = pg_namespace.oid)
        LEFT JOIN pg_catalog.pg_class AS pg_class_referenced
                ON(pg_class_referenced.oid = pg_trigger.tgconstrrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace_referenced
                ON(pg_namespace_referenced.oid = pg_class_referenced.relnamespace)
        WHERE pg_class.relnamespace = $1 AND pg_class.oid = $2
        GROUP BY 
        	trigger_name,
        	function_name,
        	"constraint",
        	"deferrable",
        	deferred,
                description,
                referenced_table_name,
                referenced_table_schema;`,GET_PARTITIONS:`
        SELECT
        	inher_child.relname AS child_name,
        	inher_parent.relname AS parent_name,
                CASE WHEN inher_parent.relkind = 'p' THEN TRUE ELSE FALSE END AS is_parent_partitioned
        FROM pg_inherits
        LEFT JOIN pg_class AS inher_child ON (inher_child.oid = pg_inherits.inhrelid)
        LEFT JOIN pg_class AS inher_parent ON (inher_parent.oid = pg_inherits.inhparent)
        WHERE inher_parent.relnamespace = $1;`,GET_SEQUENCES:`
        SELECT DISTINCT ON (sequence_name)
                information_schema."sequences".sequence_name,
                information_schema."sequences".data_type,
                information_schema."sequences".start_value,
                information_schema."sequences".minimum_value,
                information_schema."sequences".maximum_value,
                information_schema."sequences"."increment",
                information_schema."sequences".cycle_option,
                pg_catalog.pg_sequences.cache_size,
                pg_class.relpersistence as rel_persistance,
                inner_pg_class.relname AS table_name,
                pg_attribute.attname AS column_name
        FROM information_schema."sequences"
        JOIN pg_class ON pg_class.relname = information_schema."sequences".sequence_name
        JOIN pg_depend ON pg_depend.objid = pg_class.oid
        LEFT JOIN pg_catalog.pg_sequences ON (pg_catalog.pg_sequences.schemaname, pg_catalog.pg_sequences.sequencename) = (information_schema."sequences".sequence_schema, information_schema."sequences".sequence_name)
        LEFT JOIN pg_class AS inner_pg_class ON pg_depend.refobjid = inner_pg_class.oid
        LEFT JOIN pg_attribute ON (pg_depend.refobjid, pg_depend.refobjsubid) = (pg_attribute.attrelid, pg_attribute.attnum)
        WHERE pg_class.relkind = 'S'
        AND information_schema."sequences".sequence_schema = $1
        ORDER BY sequence_name, column_name;
        `},vh=i(t=>(Object.entries(oc).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");cc.exports={getQueryName:vh,...oc}});var lc=C((IC,uc)=>{var Ih=ds(),Ye=null,rr=null;uc.exports={initializeClient(t,e){Ye=t,rr=e,Ye.on("error",r=>e.error(r))},isClientInitialized(){return!!Ye},releaseClient(){return Ye?new Promise(t=>{Ye.end(()=>{Ye=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=Ih.getQueryName(t);rr.info("Execute query",{queryName:n,params:e});let s=Date.now(),a=await Ye.query(t,e),o=Date.now()-s;rr.info("Query executed",{queryName:n,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,rr.error(n),null}}}});var dc=C((OC,mc)=>{var pc=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...pc(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");mc.exports={getJsonSchema:pc}});var fs=C((wC,fc)=>{var Ke=null,Oh=i(t=>{Ke=t.require("lodash")},"setDependencies"),qt={column_default:"default",is_nullable:{keyword:"required",values:{YES:!1,NO:!0}},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:i((t,e)=>e!==-1&&Fh(t.data_type),"check")},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:"length",description:"description",domain_name:"domain_name"},Rh=i((t,e,r)=>{var n;return(n=qt[e])!=null&&n.check?qt[e].check(t,r)?r:"":Ke.get(qt,`${e}.values.${r}`,r)},"getColumnValue"),wh=i(t=>e=>Ke.chain(e).toPairs().map(([r,n])=>{var s;return[((s=qt[r])==null?void 0:s.keyword)||qt[r],Rh(e,r,n)]}).filter(([r,n])=>r&&!Ke.isNil(n)).fromPairs().thru(Dh(t)).value(),"mapColumnData"),Dh=i(t=>e=>({...e,...qh(t,e)}),"setColumnType"),qh=i((t,e)=>e.type==="ARRAY"?xh(t,e):e.type==="USER-DEFINED"?nr(t,e.udt_name):e.domain_name?nr(t,e.domain_name):nr(t,e.type),"getType"),xh=i((t,e)=>({...nr(t,e.udt_name.slice(1)),array_type:Ke.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),nr=i((t,e)=>{switch(e){case"bigint":case"bigserial":case"smallint":case"integer":case"numeric":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"int8":return{type:"numeric",mode:"bigint"};case"int2":return{type:"numeric",mode:"smallint"};case"int4":return{type:"numeric",mode:"integer"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return Ke.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Ph=i((t,e)=>{let r=Ke.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],a=Lh(s),o=Mh(a);return{...n,subtype:o}})},"setSubtypeFromSampledJsonValues"),Lh=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),Mh=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),Fh=i(t=>Ke.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");fc.exports={setDependencies:Oh,mapColumnData:wh,setSubtypeFromSampledJsonValues:Ph}});var xt=C((qC,hc)=>{var Uh=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],at=null,kh=i(t=>{at=t.require("lodash")},"setDependencies"),$h=i(t=>at.chain(t).toPairs().reject(([e,r])=>at.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Bh=i(t=>e=>{var r;return(r=at.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),Kh=i(t=>/\s|\W/.test(t)||at.includes(Uh,at.toUpper(t))?`"${t}"`:t,"wrapInQuotes");hc.exports={clearEmptyPropertiesInObject:$h,setDependencies:kh,getColumnNameByPosition:Bh,wrapInQuotes:Kh}});var _c=C((PC,yc)=>{var{getColumnNameByPosition:Gh}=xt(),hs=null,Vh=i(t=>{hs=t.require("lodash")},"setDependencies"),gc=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),Hh=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";case"p":return"PARTIAL";default:return""}},"prepareMatch"),Wh=i((t,e,r,n)=>hs.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:hs.map(s.table_columns_positions,Gh(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:gc(s.relationship_on_delete),relationshipOnUpdate:gc(s.relationship_on_update),relationshipMatch:Hh(s.relationship_match)}})),"prepareForeignKeys");yc.exports={setDependencies:Vh,prepareForeignKeys:Wh}});var Sc=C((MC,Tc)=>{var sr=null,Qh=i(t=>{sr=t.require("lodash")},"setDependencies"),Ec=i(t=>sr.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Yh(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Yh=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),jh=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),zh=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),Xh=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Zh=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:Ec(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:sr.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:jh(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:Xh(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:zh(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Jh=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:sr.toLower(t.external_language),inputArgs:Ec(e),body:t.routine_definition}),"mapProcedureData");Tc.exports={setDependencies:Qh,mapFunctionData:Zh,mapProcedureData:Jh}});var vc=C((UC,bc)=>{var{clearEmptyPropertiesInObject:Pt,getColumnNameByPosition:ir}=xt(),V=null,eg=i(t=>{V=t.require("lodash")},"setDependencies"),Ac=i((t,e)=>{if(!t&&!e)return null;let r=Cc(t),n=Cc(e==null?void 0:e.toast_options),s=r.fillfactor,a=r.parallel_workers,o=r.autovacuum_enabled,c=Pt({vacuum_index_cleanup:r.vacuum_index_cleanup,vacuum_truncate:r.vacuum_truncate,autovacuum_vacuum_threshold:r.autovacuum_vacuum_threshold,autovacuum_vacuum_scale_factor:r.autovacuum_vacuum_scale_factor,autovacuum_vacuum_insert_threshold:r.autovacuum_vacuum_insert_threshold,autovacuum_vacuum_insert_scale_factor:r.autovacuum_vacuum_insert_scale_factor,autovacuum_analyze_threshold:r.autovacuum_analyze_threshold,autovacuum_analyze_scale_factor:r.autovacuum_analyze_scale_factor,autovacuum_vacuum_cost_delay:r.autovacuum_vacuum_cost_delay,autovacuum_vacuum_cost_limit:r.autovacuum_vacuum_cost_limit,autovacuum_freeze_min_age:r.autovacuum_freeze_min_age,autovacuum_freeze_max_age:r.autovacuum_freeze_max_age,autovacuum_freeze_table_age:r.autovacuum_freeze_table_age,autovacuum_multixact_freeze_min_age:r.autovacuum_multixact_freeze_min_age,autovacuum_multixact_freeze_max_age:r.autovacuum_multixact_freeze_max_age,autovacuum_multixact_freeze_table_age:r.autovacuum_multixact_freeze_table_age,log_autovacuum_min_duration:r.log_autovacuum_min_duration}),u=r.user_catalog_table,l=n.autovacuum_enabled,p=Pt({toast_tuple_target:r.toast_tuple_target,toast_vacuum_index_cleanup:n.vacuum_index_cleanup,toast_vacuum_truncate:n.vacuum_truncate,toast_autovacuum_vacuum_threshold:n.autovacuum_vacuum_threshold,toast_autovacuum_vacuum_scale_factor:n.autovacuum_vacuum_scale_factor,toast_autovacuum_vacuum_insert_threshold:n.autovacuum_vacuum_insert_threshold,toast_autovacuum_vacuum_insert_scale_factor:n.autovacuum_vacuum_insert_scale_factor,toast_autovacuum_vacuum_cost_delay:n.autovacuum_vacuum_cost_delay,toast_autovacuum_vacuum_cost_limit:n.autovacuum_vacuum_cost_limit,toast_autovacuum_freeze_min_age:n.autovacuum_freeze_min_age,toast_autovacuum_freeze_max_age:n.autovacuum_freeze_max_age,toast_autovacuum_freeze_table_age:n.autovacuum_freeze_table_age,toast_autovacuum_multixact_freeze_min_age:n.autovacuum_multixact_freeze_min_age,toast_autovacuum_multixact_freeze_max_age:n.autovacuum_multixact_freeze_max_age,toast_autovacuum_multixact_freeze_table_age:n.autovacuum_multixact_freeze_table_age,toast_log_autovacuum_min_duration:n.log_autovacuum_min_duration}),m={fillfactor:s,parallel_workers:a,autovacuum_enabled:o,autovacuum:V.isEmpty(c)?null:c,toast_autovacuum_enabled:l,toast:V.isEmpty(p)?null:p,user_catalog_table:u};return Pt(m)},"prepareStorageParameters"),tg=i((t,e)=>{if(!t)return null;let r=rg(t),n=V.some(t.partition_attributes_positions,o=>o===0),s=n?"partitioning_expression":"compositePartitionKey",a=n?ng(t,e):V.map(t.partition_attributes_positions,ir(e));return[{partitionMethod:r,partitionBy:n?"expression":"keys",[s]:a}]},"prepareTablePartition"),rg=i(t=>{switch(t.partition_method){case"h":return"HASH";case"l":return"LIST";case"r":return"RANGE";default:return""}},"getPartitionMethod"),ng=i((t,e)=>{let r=0,n=V.split(t.expressions,",");return V.chain(t.partition_attributes_positions).map(s=>{if(s===0){let a=n[r];return r++,a}return ir(e)(s)}).join(",").value()},"getPartitionExpression"),Nc=i(t=>V.split(t,"="),"splitByEqualitySymbol"),sg=i(t=>V.find(t,{type:"json"}),"checkHaveJsonTypes"),ig=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),ag=i((t,e,r)=>V.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,ug(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,og(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,cg(s,e,r)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),og=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:V.map(t.constraint_keys,ir(e)),indexStorageParameters:V.join(t.storage_parameters,","),indexTablespace:t.tablespace}),"getPrimaryKeyConstraint"),cg=i((t,e,r)=>{let n=V.find(r,a=>a.indexname===t.constraint_name),s=n!=null&&n.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"";return{constraintName:t.constraint_name,compositeUniqueKey:V.map(t.constraint_keys,ir(e)),indexStorageParameters:V.join(t.storage_parameters,","),indexTablespace:t.tablespace,indexComment:t.description,...s&&{nullsDistinct:s}}},"getUniqueKeyConstraint"),ug=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,noInherit:t.no_inherit,constrDescription:t.description}),"getCheckConstraint"),lg=i(t=>V.map(t,e=>{let r=pg(e),n=V.slice(r,0,e.number_of_keys),s=V.chain(r).slice(e.number_of_keys).map(c=>V.pick(c,"name")).value(),a=e.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"",o={indxName:e.indexname,index_method:e.index_method,unique:e.index_unique??!1,index_tablespace_name:e.tablespace_name||"",index_storage_parameter:dg(e.storage_parameters),where:e.where_expression||"",include:s,columns:e.index_method==="btree"?n:V.map(n,c=>V.omit(c,"sortOrder","nullsOrder")),...a&&{nullsDistinct:a}};return Pt(o)}),"prepareTableIndexes"),pg=i(t=>V.chain(t.columns).map((e,r)=>{if(!e)return;let n=V.get(t,`ascendings.${r}`,!1)?"ASC":"DESC",s=mg(V.get(t,`nulls_first.${r}`)),a=V.get(t,`opclasses.${r}`,""),o=V.get(t,`collations.${r}`,"");return{name:e,sortOrder:n,nullsOrder:s,opclass:a,collation:o}}).compact().value(),"mapIndexColumns"),mg=i(t=>V.isNil(t)?"":t?"NULLS FIRST":"NULLS LAST","getNullsOrder"),dg=i(t=>{if(!t)return null;let e=V.fromPairs(V.map(t,n=>Nc(n))),r={index_fillfactor:e.fillfactor,deduplicate_items:e.deduplicate_items,index_buffering:e.index_buffering,fastupdate:e.fastupdate,gin_pending_list_limit:e.gin_pending_list_limit,pages_per_range:e.pages_per_range,autosummarize:e.autosummarize};return Pt(r)},"getIndexStorageParameters"),fg=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Ac(t==null?void 0:t.reloptions,e),a=t==null?void 0:t.spcname,o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,table_tablespace_name:a,partitionBounds:o}},"prepareTableLevelData"),hg=i(t=>{switch(gg(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),gg=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),Cc=i(t=>V.chain(t).map(Nc).map(([e,r])=>[e,hg(r)]).fromPairs().value()||{},"prepareOptions"),yg=i((t,e)=>V.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");bc.exports={prepareStorageParameters:Ac,prepareTablePartition:tg,setDependencies:eg,checkHaveJsonTypes:sg,prepareTableConstraints:ag,prepareTableLevelData:fg,prepareTableIndexes:lg,getSampleDocSize:ig,prepareTableInheritance:yg}});var Oc=C(($C,Ic)=>{var{mapColumnData:_g}=fs(),De=null,Eg=i(t=>{De=t.require("lodash")},"setDependencies"),Tg=i((t,e)=>De.chain(t).map(r=>{switch(r.type){case"e":return Sg(r);case"r":return Cg(r);case"c":return Ag(r);default:return null}}).compact().concat(De.map(e,bg)).value(),"getUserDefinedTypes"),Sg=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Cg=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Ag=i(t=>{let e=De.map(t.columns,_g([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Ng=i(t=>t.type==="c","isTypeComposite"),bg=i(t=>{var e;return{name:t.domain_name,type:"domain",underlyingType:De.flow(Ig(t),Og(t),Rg(t),wg(t))(vg(t)),collation:t.collation_name||"",default:t.domain_default||"",required:(e=De.first(t.constraints))==null?void 0:e.not_null,checkConstraints:De.map(t.constraints,Dg)}},"mapDomainType"),vg=i(t=>t.data_type==="USER-DEFINED"?t.udt_name:t.data_type,"getUnderlyingType"),Ig=i(t=>e=>t.character_maximum_length?`${e}(${t.character_maximum_length})`:e,"setLength"),Og=i(t=>e=>e!=="numeric"?e:De.isNumber(t.numeric_precision)&&De.isNumber(t.numeric_scale)?`${e}(${t.numeric_precision},${t.numeric_scale})`:De.isNumber(t.numeric_precision)?`${e}(${t.numeric_precision})`:e,"setPrecisionAndScale"),Rg=i(t=>e=>t.interval_type?`${e} ${t.interval_type}`:e,"setIntervalType"),wg=i(t=>e=>De.isNumber(t.interval_precision)?`${e}(${t.interval_precision})`:e,"setIntervalPrecision"),Dg=i(t=>({name:t.constraint_name,expression:t.expression}),"mapDomainConstraint");Ic.exports={setDependencies:Eg,getUserDefinedTypes:Tg,isTypeComposite:Ng}});var wc=C((KC,Rc)=>{var{clearEmptyPropertiesInObject:qg,wrapInQuotes:xg}=xt(),ke=null,Pg=i(t=>{ke=t.require("lodash")},"setDependencies"),gs=" (v)",Lg=i(t=>t==="VIEW","isViewByTableType"),Mg=i(t=>ke.endsWith(t,gs),"isViewByName"),Fg=i(t=>t.slice(0,-gs.length),"removeViewNameSuffix"),Ug=i(t=>`${t}${gs}`,"setViewSuffix"),kg=i((t,e,r={})=>{let n=ke.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${xg(t)} AS ${n}`:""},"generateCreateViewScript"),$g=i((t,e,r)=>{let n={withCheckOption:t.check_option!=="NONE"||ke.isNil(t.check_option),checkTestingScope:Bg(t.check_option),viewOptions:ke.fromPairs(ke.map(e==null?void 0:e.view_options,Gg)),temporary:(e==null?void 0:e.persistence)==="t",recursive:Kg(t),description:e==null?void 0:e.description,triggers:r};return qg(n)},"prepareViewData"),Bg=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),Kg=i(t=>ke.startsWith(ke.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),Gg=i(t=>ke.split(t,"="),"splitByEqualitySymbol");Rc.exports={setDependencies:Pg,isViewByTableType:Lg,isViewByName:Mg,removeViewNameSuffix:Fg,generateCreateViewScript:kg,setViewSuffix:Ug,prepareViewData:$g}});var qc=C((VC,Dc)=>{var ar=null,Vg=i(t=>{ar=t.require("lodash")},"setDependencies"),Hg=i((t,e)=>ar.chain(t).map(r=>({...r,...ar.find(e,{trigger_name:r.trigger_name})||{}})).map(Wg).value(),"getTriggers"),Wg=i(t=>{var e;return{name:t.trigger_name,triggerDescription:t.description,triggerConstraint:t.constraint,triggerTable:`${t.event_object_schema}.${t.event_object_table}`,triggerReferencedTable:t.referenced_table_name?[t.referenced_table_schema,t.referenced_table_name]:[],triggerType:t.action_timing,triggerEvents:Qg(t),triggerUpdateColumns:(e=t.update_attributes)==null?void 0:e.filter(Boolean),triggerDeferrable:t.deferrable,triggerTimeConstraintCheck:t.deferred?"INITIALLY DEFERRED":"INITIALLY IMMEDIATE",triggerReferencing:!!t.action_reference_old_table||!!t.action_reference_new_table,triggerBeforeImageTransitionRelation:t.action_reference_old_table||"",triggerAfterImageTransitionRelation:t.action_reference_new_table||"",triggerEachRowStatement:t.action_orientation==="ROW"?"FOR EACH ROW":"FOR EACH STATEMENT",triggerCondition:t.action_condition,triggerFunction:Yg(t.action_statement)}},"getTrigger"),Qg=i(t=>ar.map(t.trigger_events,e=>({triggerEvent:e})),"getTriggerEvents"),Yg=i(t=>{var e,r,n;return((n=(r=(e=/EXECUTE (?:FUNCTION|PROCEDURE)(?<function>[\s\S]*)/.exec(t))==null?void 0:e.groups)==null?void 0:r.function)==null?void 0:n.trim())||""},"getFunctionFromTrigger");Dc.exports={setDependencies:Vg,getTriggers:Hg}});var Lc=C((WC,Pc)=>{var jg=i((t,e)=>[zg,Xg].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),zg=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Zg(t,s,n),entityLevel:ry(e)}},"reorganizePrimaryKeys"),Xg=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let o=s.compositeUniqueKey[0];return{attributes:ey(r,o,s),entityLevel:ny(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Zg=i((t,e,r)=>t.map(n=>n.name!==e?n:Jg(n,r)),"setAttributesPrimaryKeyData"),Jg=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:xc(e)}),"setPrimaryKeyData"),ey=i((t,e,r)=>t.map(n=>n.name!==e?n:ty(n,r)),"setAttributesUniqueKeyData"),ty=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:xc(e)}),"setUniqueKeyData"),xc=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexComment:t.indexComment}],"getOptions"),ry=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),ny=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");Pc.exports={reorganizeConstraints:jg}});var or=C((YC,Mc)=>{var Es=class Es{cache;cycle;dataType;ifNotExist;increment;maxValue;minValue;ownedByColumn;ownedByNone;sequenceName;start;temporary;unlogged};i(Es,"Sequence");var ys=Es,Ts=class Ts{sequence_name;increment;start;data_type;maximum_value;minimum_value;cycle_option;cache_size;rel_persistance;column_name;table_name};i(Ts,"SequenceDto");var _s=Ts;Mc.exports={Sequence:ys,SequenceDto:_s}});var Uc=C((ZC,Fc)=>{var{Sequence:zC,SequenceDto:XC}=or(),sy=i(({sequence:t})=>t.column_name?[{entity:t.table_name,name:t.column_name}]:[],"getOwnedByColumn"),iy=i(({sequence:t})=>({sequenceName:t.sequence_name,increment:Number(t.increment),start:Number(t.start_value),dataType:t.data_type,maxValue:Number(t.maximum_value),minValue:Number(t.minimum_value),cache:Number(t.cache_size),temporary:t.rel_persistance==="t",unlogged:t.rel_persistance==="u",cycle:t.cycle_option==="YES",ownedByColumn:sy({sequence:t}),ownedByNone:!t.column_name}),"mapSequenceData");Fc.exports={mapSequenceData:iy}});var Cs=C((eA,Bc)=>{var{createClient:ay}=ic(),k=lc(),{getJsonSchema:kc}=dc(),{setDependencies:oy,mapColumnData:cy,setSubtypeFromSampledJsonValues:uy}=fs(),{setDependencies:ly,clearEmptyPropertiesInObject:$c}=xt(),{setDependencies:py,prepareForeignKeys:my}=_c(),{setDependencies:dy,mapFunctionData:fy,mapProcedureData:hy}=Sc(),{setDependencies:gy,prepareTablePartition:yy,checkHaveJsonTypes:_y,prepareTableConstraints:Ey,getSampleDocSize:Ty,prepareTableLevelData:Sy,prepareTableIndexes:Cy,prepareTableInheritance:Ay}=vc(),{setDependencies:Ny,getUserDefinedTypes:by,isTypeComposite:vy}=Oc(),{setDependencies:Iy,isViewByTableType:Oy,isViewByName:Ry,removeViewNameSuffix:wy,generateCreateViewScript:Dy,setViewSuffix:qy,prepareViewData:xy}=wc(),{setDependencies:Py,getTriggers:Ly}=qc(),$=ds(),{reorganizeConstraints:My}=Lc(),{mapSequenceData:Fy}=Uc(),cr=null,ee=null,_e=null,Ss=14;Bc.exports={setDependencies(t){ee=t.require("lodash"),ly(t),gy(t),oy(t),py(t),Iy(t),dy(t),Ny(t),Py(t)},async connect(t,e){k.isClientInitialized()&&await this.disconnect();let{client:r,sshTunnel:n}=await ay(t,e);k.initializeClient(r,e),cr=n,_e=e,Ss=await this._getServerVersion()},async disconnect(){cr&&(cr.close(),cr=null),await k.releaseClient()},pingDb(){return k.query($.PING)},applyScript(t){return k.query(t)},async getDatabaseNames(){return ee.map(await k.query($.GET_DATABASES),"database_name")},async logVersion(){let t=await k.queryTolerant($.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved";_e.info(`PostgreSQL version: ${e}`)},async getAllSchemasNames(){return(await k.query($.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!Uy(e))},async getTablesNames(t){let e=await k.query($.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!ee.includes(r,n)).map(({table_name:n,table_type:s})=>Oy(s)?qy(n):n)},async getDbLevelData(){var n,s,a;_e.progress("Get database data");let t=(n=await k.queryTolerant($.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await k.queryTolerant($.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(a=await k.queryTolerant($.GET_DB_COLLATE_NAME,[],!0))==null?void 0:a.default_collate_name;return $c({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r,n=!1,s=!1){let a=await this._retrieveUserDefinedTypes(t),o=await k.queryTolerant($.GET_NAMESPACE_OID,[t],!0),c=o==null?void 0:o.oid,u=n?await k.queryTolerant($.GET_PARTITIONS,[c]):[],[l,p]=ee.partition(e,Ry),m=p.flatMap(h=>[{tableName:h},...ee.filter(u,{parent_name:h}).map(({child_name:T,is_parent_partitioned:_})=>({isParentPartitioned:_,tableName:T}))]),d=await ot(ee.uniq(m),ee.bind(this._retrieveSingleTableData,this,r,c,t,a,s));return{views:await ot(l,ee.bind(this._retrieveSingleViewData,this,c,t,s)),tables:d,modelDefinitions:kc(a)}},async retrieveSchemaLevelData(t,e){var m;if(e)return _e.info("Functions and procedures ignored"),{functions:[],procedures:[]};_e.progress("Get Functions and Procedures",t);let r=(m=await k.queryTolerant($.GET_NAMESPACE_OID,[t],!0))==null?void 0:m.oid,n=await k.queryTolerant($.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await k.queryTolerant($y(Ss),[r]),[a,o]=ee.partition(ee.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await ot(a,async d=>{let f=await k.queryTolerant($.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[d.specific_name]),h=ee.find(s,{function_name:d.name});return fy(d,f,h)}),u=await ot(o,async d=>{let f=await k.queryTolerant($.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[d.specific_name]),h=ee.find(s,{function_name:d.name});return hy(d,f,h)}),p=(await k.queryTolerant($.GET_SEQUENCES,[t])).map(d=>Fy({sequence:d}));return{functions:c,procedures:u,sequences:p}},async _retrieveUserDefinedTypes(t){_e.progress("Get User-Defined Types",t);let e=await k.queryTolerant($.GET_USER_DEFINED_TYPES,[t]),r=await k.queryTolerant($.GET_DOMAIN_TYPES,[t]),n=await ot(e,async a=>vy(a)?{...a,columns:await k.queryTolerant($.GET_COMPOSITE_TYPE_COLUMNS,[a.pg_class_oid])}:a),s=await ot(r,async a=>({...a,constraints:await k.queryTolerant($.GET_DOMAIN_TYPES_CONSTRAINTS,[a.domain_name,t])}));return by(n,s)},async _retrieveSingleTableData(t,e,r,n,s,{tableName:a,isParentPartitioned:o}){var Ie;_e.progress("Get table data",r,a);let c=await k.queryTolerant($.GET_TABLE_LEVEL_DATA,[a,e],!0),u=c==null?void 0:c.oid,l=await k.queryTolerant($.GET_TABLE_TOAST_OPTIONS,[a,e],!0),p=await k.queryTolerant($.GET_TABLE_PARTITION_DATA,[u],!0),m=await this._getTableColumns(a,r,u),d=await k.queryTolerant($.GET_DESCRIPTION_BY_OID,[u],!0),f=await k.queryTolerant($.GET_INHERITS_PARENT_TABLE_NAME,[u]),h=await k.queryTolerant($.GET_TABLE_CONSTRAINTS,[u]),T=await k.queryTolerant(ky(Ss),[u]),_=await k.queryTolerant($.GET_TABLE_FOREIGN_KEYS,[u]),y=await this._getTriggers(r,a,e,u,s);_e.info("Table data retrieved",{schemaName:r,tableName:a,columnTypes:m.map(A=>A.data_type)});let N=yy(p,m),S=Sy(c,l),b=By(d),I=Ay(r,f),R=Ey(h,m,T),M=Cy(T),v=my(_,a,r,m),D={partitioning:N,description:b,triggers:y,Indxs:M,...S,...R,...o?{partitionOf:(Ie=ee.first(I))==null?void 0:Ie.parentTable}:{inherits:I}},G=$c(D),P=m.map(cy(n)),X=_y(P),ve=[];X&&(ve=await this._getDocuments(r,a,P,t),P=uy(P,ve));let{attributes:me,entityLevel:U}=My(P,G);return{name:a,entityLevel:U,jsonSchema:kc(me),documents:ve,relationships:v}},async _getTriggers(t,e,r,n,s){if(s)return _e.info("Triggers ignored"),[];let a=await k.queryTolerant($.GET_TRIGGERS,[t,e]),o=await k.queryTolerant($.GET_TRIGGERS_ADDITIONAL_DATA,[r,n]);return Ly(a,o)},async _getTableColumns(t,e,r){_e.progress("Get columns",e,t);let n=await k.query($.GET_TABLE_COLUMNS,[t,e]),s=await k.queryTolerant($.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return ee.map(n,a=>({...a,...ee.find(s,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,n){var p;_e.progress("Sampling table",t,e);let s=`${t}.${e}`,a=((p=await k.queryTolerant($.GET_ROWS_COUNT(s),[],!0))==null?void 0:p.quantity)||0,o=Ty(a,n),c=r.filter(({type:m})=>ee.includes(["json","jsonb"],m)),u=ee.map(c,"name").join(", "),l=await k.queryTolerant($.GET_SAMPLED_DATA_SIZE(s,u),[o],!0);return _e.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:l==null?void 0:l._hackolade_tmp_sampling_tbl_size}),await k.queryTolerant($.GET_SAMPLED_DATA(s,u),[o])},async _retrieveSingleViewData(t,e,r,n){_e.progress("Get view data",e,n),n=wy(n);let s=await k.query($.GET_VIEW_DATA,[n,e],!0),a=!s.view_definition&&await k.queryTolerant($.GET_VIEW_SELECT_STMT_FALLBACK,[n,e],!0),o=await k.queryTolerant($.GET_VIEW_OPTIONS,[n,t],!0),c=await this._getTriggers(e,n,t,o==null?void 0:o.oid,r),u=Dy(n,s,a),l=xy(s,o,c);return u?{name:n,data:l,ddl:{script:u,type:"postgres"}}:(_e.info("View select statement was not retrieved",{schemaName:e,viewName:n}),{name:n,data:l,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await k.queryTolerant($.GET_VERSION_AS_NUM,[],!0),e=ee.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var Uy=i(t=>!!(ee.startsWith(t,"pg_")||ee.includes(["information_schema"],t)),"isSystemSchema"),ky=i(t=>t===10?$.GET_TABLE_INDEXES_V_10:t>15?$.GET_TABLE_INDEXES_V_15:$.GET_TABLE_INDEXES,"getGetIndexesQuery"),$y=i(t=>t===10?$.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:$.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),By=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),ot=i((t,e)=>Promise.all(ee.map(t,e)),"mapPromises")});var Gc=C((rA,Kc)=>{"use strict";var{createLogger:ur}=Nr(),re=Cs();Kc.exports={async disconnect(t,e,r,n){await re.disconnect(),r()},async testConnection(t,e,r,n){try{As("Test connection",t,e);let s=ur({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});re.setDependencies(n),await re.connect(t,s),await re.pingDb(),await re.logVersion(),r()}catch(s){e.log("error",je(s),"Test connection instance log"),r(je(s))}finally{await re.disconnect()}},async getDatabases(t,e,r,n){try{As("Get databases",t,e);let s=ur({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});re.setDependencies(n),await re.connect(t,s),await re.logVersion();let a=await re.getDatabaseNames();return e.log("info",a,"All databases list",t.hiddenKeys),r(null,a)}catch(s){return e.log("error",s),r(je(s))}},getDocumentKinds:i(function(t,e,r){r(null,[])},"getDocumentKinds"),async getDbCollectionsNames(t,e,r,n){try{As("Get DB table names",t,e);let s=ur({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});re.setDependencies(n),await re.connect(t,s),await re.logVersion();let o=await(await re.getAllSchemasNames()).reduce(async(c,u)=>{let l=await c;try{let p=await re.getTablesNames(u);return l.concat({dbName:u,dbCollections:p,isEmpty:p.length===0})}catch(p){return s.info(`Error reading database "${u}"`),s.error(p),l.concat({dbName:u,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,o)}catch(s){e.log("error",je(s),"Get DB collections names"),r(je(s)),await re.disconnect()}},async getDbCollectionsData(t,e,r,n){try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let s=ur({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});s.progress("Start reverse engineering...");let a=t.collectionData.collections,o=t.collectionData.dataBaseNames,c=await re.getDbLevelData(),{packages:u,relationships:l}=await Promise.all(o.map(async p=>{let{tables:m,views:d,modelDefinitions:f}=await re.retrieveEntitiesData(p,a[p],t.recordSamplingSettings,t.includePartitions,t.ignoreUdfUdpTriggers),{functions:h,procedures:T,triggers:_,sequences:y}=await re.retrieveSchemaLevelData(p,t.ignoreUdfUdpTriggers);return s.progress("Schema data fetched successfully",p),{schemaName:p,tables:m,views:d,functions:h,procedures:T,modelDefinitions:f,triggers:_,sequences:y}})).then(p=>{let m=p.flatMap(({tables:f})=>f.map(h=>h.relationships)).flat();return{packages:p.flatMap(({schemaName:f,tables:h,views:T,functions:_,procedures:y,triggers:N,modelDefinitions:S,sequences:b})=>{let I={UDFs:_,Procedures:y,triggers:N,sequences:b},R=h.map(M=>({dbName:f,collectionName:M.name,documents:M.documents,views:[],emptyBucket:!1,entityLevel:M.entityLevel,validation:{jsonSchema:M.jsonSchema},bucketInfo:I,modelDefinitions:S})).sort(M=>n.require("lodash").isEmpty(M.entityLevel.inherits)?-1:1);if(T!=null&&T.length){let M={dbName:f,views:T,emptyBucket:!1};return[...R,M]}return R}),relationships:m}}).then(({packages:p,relationships:m})=>({packages:Ky(p),relationships:m}));s.info("The data is processed and sent to the application",{packagesLength:u==null?void 0:u.length,relationshipsLength:l==null?void 0:l.length}),r(null,u,c,l)}catch(s){e.log("error",je(s),"Retrieve tables data"),r(je(s))}finally{await re.disconnect()}}};var je=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),As=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),Ky=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages")});var Hc=C((sA,Vc)=>{var lr=Cs(),Gy=i(async(t,e,r)=>{try{lr.setDependencies(r),await lr.connect(t,e),await lr.logVersion(),await lr.applyScript(Vy(t.script))}catch(n){throw e.error(n),Hy(n)}},"applyToInstance"),Vy=i(t=>{let e=/CREATE DATABASE[^;]*;/gi;return t.replace(e,"")},"removeCreateDbScript"),Hy=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");Vc.exports={applyToInstance:Gy}});var ne=C((aA,Wc)=>{var vs=class vs{script;isDropScript};i(vs,"ModificationScript");var Ns=vs,Is=class Is{isActivated;scripts;static getInstances(e,r,n){return(e||[]).filter(Boolean).map(s=>({isActivated:r,scripts:[{isDropScript:n,script:s}]}))}static getInstance(e,r,n){var s;if((s=e==null?void 0:e.filter(Boolean))!=null&&s.length)return{isActivated:r,scripts:e.filter(Boolean).map(a=>({isDropScript:n,script:a}))}}static getDropAndRecreateInstance(e,r,n){let s=[];if(e&&s.push({isDropScript:!0,script:e}),r&&s.push({isDropScript:!1,script:r}),!!(s!=null&&s.length))return{isActivated:n,scripts:s}}};i(Is,"AlterScriptDto");var bs=Is;Wc.exports={ModificationScript:Ns,AlterScriptDto:bs}});var Ps=C((cA,Qc)=>{var Ds=class Ds{sortOrder;nullsOrder;isActivated;keyId;collation;opclass};i(Ds,"AlterIndexColumnDto");var Os=Ds,qs=class qs{keyId};i(qs,"AlterIndexIncludeColumnDto");var Rs=qs,xs=class xs{id;isActivated;index_method;ifNotExist;only;index_tablespace_name;indxName;columns;include;index_storage_parameter};i(xs,"AlterIndexDto");var ws=xs;Qc.exports={AlterIndexDto:ws,AlterIndexColumnDto:Os,AlterIndexIncludeColumnDto:Rs}});var Ge=C((pA,Yc)=>{var{AlterIndexDto:lA}=Ps(),Ks=class Ks{id;constraintName;indexStorageParameters;indexTablespace;indexInclude};i(Ks,"AlterCollectionColumnKeyOptionDto");var Lt=Ks,Gs=class Gs{type;isActivated;primaryKey;unique;mode;length;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;primaryKeyOptions;triggerUpdateColumns;compMod;GUID};i(Gs,"AlterCollectionColumnDto");var Ls=Gs,Vs=class Vs extends Lt{compositePrimaryKey};i(Vs,"AlterCollectionRoleCompModPKDto");var Ms=Vs,Hs=class Hs extends Lt{compositeUniqueKey};i(Hs,"AlterCollectionRoleCompModUniqueKeyDto");var Fs=Hs,Ws=class Ws{new;old};i(Ws,"AlterCollectionRoleCompModPrimaryKey");var Us=Ws,Qs=class Qs{new;old};i(Qs,"AlterCollectionRoleCompModUniqueKey");var ks=Qs,Ys=class Ys{id;type;collectionName;properties;definitions;isActivated;additionalProperties;memory_optimized;collectionUsers;ifNotExist;on_commit;table_tablespace_name;bucketId;compMod;name;roleType;patternProperties};i(Ys,"AlterCollectionRoleDto");var $s=Ys,js=class js{type;isActivated;unique;subtype;properties;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(js,"AlterCollectionDto");var Bs=js;Yc.exports={AlterCollectionDto:Bs,AlterCollectionRoleDto:$s,AlterCollectionColumnDto:Ls,AlterCollectionColumnKeyOptionDto:Lt,AlterCollectionRoleCompModPrimaryKey:Us,AlterCollectionRoleCompModPKDto:Ms,AlterCollectionRoleCompModUniqueKeyDto:Fs,AlterCollectionRoleCompModUniqueKey:ks}});var zc=C((dA,jc)=>{var Wy=Object.freeze({ALL:"ALL",ANALYSE:"ANALYSE",ANALYZE:"ANALYZE",AND:"AND",ANY:"ANY",ARRAY:"ARRAY",ASC:"ASC",ASYMMETRIC:"ASYMMETRIC",AUTHORIZATION:"AUTHORIZATION",BINARY:"BINARY",BOTH:"BOTH",CASE:"CASE",CAST:"CAST",CHECK:"CHECK",COLLATE:"COLLATE",COLUMN:"COLUMN",CONCURRENTLY:"CONCURRENTLY",CONSTRAINT:"CONSTRAINT",CREATE:"CREATE",CROSS:"CROSS",CURRENT_CATALOG:"CURRENT_CATALOG",CURRENT_DATE:"CURRENT_DATE",CURRENT_ROLE:"CURRENT_ROLE",CURRENT_SCHEMA:"CURRENT_SCHEMA",CURRENT_TIME:"CURRENT_TIME",CURRENT_TIMESTAMP:"CURRENT_TIMESTAMP",CURRENT_USER:"CURRENT_USER",DEFAULT:"DEFAULT",DEFERRABLE:"DEFERRABLE",DESC:"DESC",DISTINCT:"DISTINCT",DO:"DO",ELSE:"ELSE",END:"END",EXCEPT:"EXCEPT",FALSE:"FALSE",FOR:"FOR",FOREIGN:"FOREIGN",FREEZE:"FREEZE",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",GROUP:"GROUP",HAVING:"HAVING",ILIKE:"ILIKE",IN:"IN",INITIALLY:"INITIALLY",INTERSECT:"INTERSECT",INTO:"INTO",IS:"IS",ISNULL:"ISNULL",JOIN:"JOIN",LATERAL:"LATERAL",LEADING:"LEADING",LEFT:"LEFT",LIKE:"LIKE",LIMIT:"LIMIT",LOCALTIME:"LOCALTIME",LOCALTIMESTAMP:"LOCALTIMESTAMP",NATURAL:"NATURAL",NOT:"NOT",NULL:"NULL",OFFSET:"OFFSET",ON:"ON",ONLY:"ONLY",OR:"OR",ORDER:"ORDER",OUTER:"OUTER",OVERLAPS:"OVERLAPS",PLACING:"PLACING",PRIMARY:"PRIMARY",REFERENCES:"REFERENCES",RETURNING:"RETURNING",RIGHT:"RIGHT",SELECT:"SELECT",SESSION_USER:"SESSION_USER",SIMILAR:"SIMILAR",SOME:"SOME",SYMMETRIC:"SYMMETRIC",TABLE:"TABLE",TABLESAMPLE:"TABLESAMPLE",THEN:"THEN",TO:"TO",TRAILING:"TRAILING",TRUE:"TRUE",UNION:"UNION",UNIQUE:"UNIQUE",USER:"USER",USING:"USING",VARIADIC:"VARIADIC",VERBOSE:"VERBOSE",WHEN:"WHEN",WHERE:"WHERE",WINDOW:"WINDOW",WITH:"WITH"}),Qy=Object.values(Wy);jc.exports={ReservedWordsAsArray:Qy}});var L=C((gA,Xc)=>{var{AlterCollectionDto:fA,AlterCollectionRoleDto:hA}=Ge(),{ReservedWordsAsArray:Yy}=zc(),jy=/\t|\n|'|\f|\r/gm;Xc.exports=t=>{let e=i(A=>t.get(A,"[0].code")||t.get(A,"[0].name",""),"getDbName"),r=i(A=>A&&(A.code||A.collectionName)||"","getEntityName"),n=i(A=>A&&(A.code||A.name)||"","getViewName"),s=i(A=>Object.assign({},t.get(A,"[0]",{}),{name:e(A)}),"getDbData"),a=i(A=>t.get(A,"[0].viewOn"),"getViewOn"),o=i((A,q="	")=>A.split(`
`).map(B=>q+B).join(`
`),"tab"),c=i((A,q)=>Object.keys(A).map(t.toLower).includes(t.toLower(q)),"hasType"),u=i(A=>({...A,...t.omit(A==null?void 0:A.role,"properties")||{}}),"getSchemaOfAlterCollection"),l=i(A=>{var W;let q=r(A),B=(W=A.compMod)==null?void 0:W.keyspaceName;return G(q,B)},"getFullCollectionName"),p=i(A=>Object.entries(A).filter(([q,B])=>!t.isNil(B)).reduce((q,[B,W])=>({...q,[B]:W}),{}),"clean"),m=i(A=>A.every(q=>t.get(q,"isActivated",!0)),"checkAllKeysActivated"),d=i(A=>A.length?A.every(q=>!t.get(q,"isActivated",!0)):!1,"checkAllKeysDeactivated"),f=i((A,q)=>{let B=A.filter(ie=>t.get(ie,"isActivated",!0)).map(q),W=A.filter(ie=>!t.get(ie,"isActivated",!0)).map(q);return{activatedItems:B,deactivatedItems:W}},"divideIntoActivatedAndDeactivated"),h=i((A,{isActivated:q,isPartOfLine:B,inlineComment:W="--"})=>A?q!==!1?A:B?"/* "+A+" */":A.includes(`
`)?`/*
`+A+` */
`:W+" "+A:"","commentIfDeactivated"),T=i((A,q="'",B="'")=>{let W=A[0];return A[A.length-1]===q&&W===B?A:`${q}${A}${B}`},"wrap"),_=i((A,q)=>q.some(B=>(A==null?void 0:A.oldField[B])!==(A==null?void 0:A.newField[B])),"checkFieldPropertiesChanged"),y=i(A=>{let q={...A,...t.omit(A==null?void 0:A.role,"properties")||{}},B=r(q),W=N({collection:q});return G(B,W)},"getFullTableName"),N=i(({collection:A})=>{var q;return(q=A.compMod)==null?void 0:q.keyspaceName},"getSchemaNameFromCollection"),S=i((A,q)=>{let{wrapInQuotes:B}=L()(t);return`${y(A)}.${B(q)}`},"getFullColumnName"),b=i(A=>{var ie;let q={...A,...t.omit(A==null?void 0:A.role,"properties")||{}},B=n(q),W=(ie=q.compMod)==null?void 0:ie.keyspaceName;return G(B,W)},"getFullViewName"),I=i(A=>A.code||A.name,"getUdtName"),R=i((A="")=>{let q=A.match(/\d+/);return Number(t.get(q,[0],0))},"getDbVersion"),M=i((A="")=>A.replace(jy,q=>`\\${q}`),"prepareComment"),v=i(A=>`E'${M(JSON.stringify(A)).slice(1,-1)}'`,"wrapComment"),D=i(A=>t.map(A,q=>{let B=q.defaultExpression?`DEFAULT ${q.defaultExpression}`:"";return t.trim(`${q.argumentMode} ${q.argumentName||""} ${q.argumentType} ${B}`)}).join(", "),"getFunctionArguments"),G=i((A,q)=>q?`${P(q)}.${P(A)}`:P(A),"getNamePrefixedWithSchemaName"),P=i(A=>/\s|\W/.test(A)||t.includes(Yy,t.toUpper(A))?`"${A}"`:A,"wrapInQuotes"),X=i(({name:A})=>P(A),"columnMapToString"),ve=i((A,q,B,W=X)=>{var qe;let ie=f(A,W),Pe=(qe=ie==null?void 0:ie.deactivatedItems)!=null&&qe.length?h(ie.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!q&&B?" ("+ie.activatedItems.join(", ")+Pe+")":" ("+A.map(W).join(", ")+")"},"getColumnsList"),me=i(A=>A?A.alias?`${P(A.name)} as ${P(A.alias)}`:P(A.name):"","getKeyWithAlias");return{getDbName:e,getDbData:s,getEntityName:r,getViewName:n,getViewOn:a,tab:o,hasType:c,clean:p,checkAllKeysActivated:m,checkAllKeysDeactivated:d,divideIntoActivatedAndDeactivated:f,commentIfDeactivated:h,wrap:T,checkFieldPropertiesChanged:_,getFullTableName:y,getFullColumnName:S,getFullViewName:b,getUdtName:I,getDbVersion:R,wrapComment:v,getFunctionArguments:D,getNamePrefixedWithSchemaName:G,wrapInQuotes:P,getColumnsList:ve,getViewData:i(A=>Array.isArray(A)?A.reduce((q,B)=>{if(!B.tableName)return q.columns.push(me(B)),q;let W=`${P(B.dbName)}.${P(B.tableName)}`;return q.tables.includes(W)||q.tables.push(W),q.columns.push({statement:`${W}.${me(B)}`,isActivated:B.isActivated}),q},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getSchemaOfAlterCollection:u,getFullCollectionName:l,getSchemaNameFromCollection:N,getGroupItemsByCompMode:i(({newItems:A=[],oldItems:q=[]})=>{let B=A.filter(Pe=>!q.some(qe=>qe.id===Pe.id)),W=[],ie=[];return q.forEach(Pe=>{let qe=A.find(Sr=>Sr.id===Pe.id);qe?t.isEqual(qe,Pe)||ie.push(qe):W.push(Pe)}),{added:B,removed:W,modified:ie}},"getGroupItemsByCompMode")}}});var tu=C((_A,eu)=>{var{AlterScriptDto:Zc}=ne(),Jc=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),zy=i((t,e)=>r=>{let{wrapComment:n,wrapInQuotes:s}=L()(t),a=Jc(r);if(a.new&&a.new!==a.old){let o=n(a.new),c=s(r.role.name),u=e.updateSchemaComment(c,o);return Zc.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),Xy=i((t,e)=>r=>{let{wrapInQuotes:n}=L()(t),s=Jc(r);if(s.old&&!s.new){let a=n(r.role.name),o=e.dropSchemaComment(a);return Zc.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),Zy=i((t,e)=>r=>{let n=zy(t,e)(r),s=Xy(t,e)(r);return[n,s].filter(Boolean)},"getModifySchemaCommentsScriptDtos");eu.exports={getModifySchemaCommentsScriptDtos:Zy}});var nu=C((TA,ru)=>{ru.exports={number:"numeric",string:"text",date:"date",timestamp:"timestamp",binary:"bytea",boolean:"boolean",document:"jsonb",array:"jsonb",objectId:"uuid",default:"char"}});var iu=C((SA,su)=>{su.exports={char:{size:1},varchar:{mode:"varying"},text:{mode:"text"},bit:{size:1,mode:"bit"},varbit:{size:1,mode:"varying"},tsvector:{mode:"text"},tsquery:{mode:"text"},smallint:{capacity:2},integer:{capacity:4},bigint:{capacity:8},numeric:{capacity:12,mode:"decimal"},real:{capacity:4,mode:"floating"},"double precision":{capacity:8,mode:"floating"},smallserial:{capacity:2},serial:{capacity:4},bigserial:{capacity:8},money:{capacity:8,mode:"decimal"},bytea:{size:4,mode:"binary"},date:{format:"YYYY-MM-DD"},time:{format:"hh:mm:ss.nnnnnn"},timestamp:{format:"YYYY-MM-DD hh:mm:ss"},interval:{format:"PnYnMnDTnHnMnS"},boolean:{mode:"boolean"},int4range:{mode:"range",modeType:"integer",capacity:4},int8range:{mode:"range",modeType:"integer",capacity:8},numrange:{mode:"range",modeType:"decimal",capacity:12},daterange:{mode:"range",modeType:"date",format:"YYYY-MM-DD"},tsrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},int4multirange:{mode:"multirange",modeType:"integer",capacity:4},int8multirange:{mode:"multirange",modeType:"integer",capacity:8},nummultirange:{mode:"multirange",modeType:"decimal",capacity:12},datemultirange:{mode:"multirange",modeType:"date",format:"YYYY-MM-DD"},tsmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},geometry:{format:"euclidian",mode:"geospatial"},geography:{format:"euclidian",mode:"geospatial"},box2d:{format:"euclidian",mode:"geospatial"},box3d:{format:"euclidian",mode:"geospatial"},geometry_dump:{format:"euclidian",mode:"geospatial"},point:{format:"euclidian",mode:"geospatial"},line:{format:"euclidian",mode:"geospatial"},lseg:{format:"euclidian",mode:"geospatial"},box:{format:"euclidian",mode:"geospatial"},path:{format:"euclidian",mode:"geospatial"},polygon:{format:"euclidian",mode:"geospatial"},circle:{format:"euclidian",mode:"geospatial"},inet:{mode:"ip"},cidr:{mode:"ip"},macaddr:{},macaddr8:{},uuid:{mode:"uuid"},oid:{mode:"uuid"},regclass:{},regcollation:{},regconfig:{},regdictionary:{},regnamespace:{},regoper:{},regoperator:{},regproc:{},regprocedure:{},regrole:{},regtype:{},xml:{mode:"xml"},json:{format:"semi-structured"},jsonb:{format:"semi-structured"},composite:{format:"semi-structured",mode:"object"},enum:{mode:"enum"},range_udt:{mode:"range"},domain:{mode:"domain"}}});var ou=C((CA,au)=>{au.exports={createDatabase:"CREATE DATABASE ${name}${template}${encoding}${locale}${collate}${characterClassification}${tablespace};\n",createSchema:"CREATE SCHEMA${ifNotExist} ${name};\nSET search_path TO ${name};\n\n${comment}\n",comment:"COMMENT ON ${object} ${objectName} IS ${comment};\n",createTable:"CREATE${temporary} TABLE${ifNotExist} ${name} (\n${columnDefinitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options};\n\n${comment}${columnDescriptions}",createTablePartitionOf:"CREATE${temporary} TABLE${ifNotExist} ${name}\n${partitionOf} ${openParenthesis}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n${closeParenthesis}${options};\n\n${comment}${columnDescriptions}",generatedColumnClause:" GENERATED ALWAYS AS (${generationExpression}) STORED",columnDefinition:"${name} ${type}${collation}${generatedColumnClause}${primaryKey}${uniqueKey}${defaultValue}${notNull}",checkConstraint:"${name} CHECK (${expression})${noInherit}",createForeignKeyConstraint:"${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable} (${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime}",createKeyConstraint:"${constraintName}${keyType}${columns}${includeNonKey}${storageParameters}${tablespace}${deferrable}${deferrableConstraintCheckTime}",alterColumnType:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DATA TYPE ${dataType};",addNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET NOT NULL;",dropNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP NOT NULL;",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldColumnName} TO ${newColumnName};",addCheckConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",dropConstraint:"ALTER TABLE IF EXISTS ${tableName} DROP CONSTRAINT IF EXISTS ${constraintName};",createForeignKey:"ALTER TABLE IF EXISTS ${foreignTable} ADD CONSTRAINT ${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime};",dropForeignKey:"ALTER TABLE ${tableName} DROP CONSTRAINT ${fkConstraintName};",addPkConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD ${constraintStatement};",dropTable:"DROP TABLE IF EXISTS ${tableName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",dropDomain:"DROP DOMAIN IF EXISTS ${udtName};",dropType:"DROP TYPE IF EXISTS ${udtName};",alterTypeAddAttribute:"ALTER TYPE ${udtName} ADD ATTRIBUTE ${columnDefinition};",alterTypeDropAttribute:"ALTER TYPE ${udtName} DROP ATTRIBUTE IF EXISTS ${attributeName};",alterTypeRenameAttribute:"ALTER TYPE ${udtName} RENAME ATTRIBUTE ${oldAttributeName} TO ${newAttributeName};",alterTypeChangeAttributeType:"ALTER TYPE ${udtName} ALTER ATTRIBUTE ${attributeName} SET DATA TYPE ${newDataType};",updateCommentOnTable:"COMMENT ON TABLE ${tableName} IS ${comment};",updateCommentOnColumn:"COMMENT ON COLUMN ${columnName} IS ${comment};",updateCommentOnSchema:"COMMENT ON SCHEMA ${schemaName} IS ${comment};",updateCommentOnView:"COMMENT ON VIEW ${viewName} IS ${comment};",createSchemaOnly:"CREATE SCHEMA IF NOT EXISTS ${schemaName};",dropSchema:"DROP SCHEMA IF EXISTS ${schemaName};",index:"CREATE${unique} INDEX${concurrently}${ifNotExist} ${name}\n ON${only} ${tableName}${using}${keys}${nullsDistinct}${options};\n",dropIndex:"DROP INDEX IF EXISTS ${indexName};\n",alterIndexRename:"ALTER INDEX IF EXISTS ${oldIndexName} RENAME TO ${newIndexName};\n",alterIndexTablespace:"ALTER INDEX IF EXISTS ${indexName} SET TABLESPACE ${tablespaceName};\n",alterIndexStorageParams:`ALTER INDEX IF EXISTS \${indexName} SET (
	\${options}
);
`,reindexIndex:"REINDEX INDEX ${indexName};\n",createView:"CREATE${orReplace}${temporary} VIEW ${name}${withOptions}\nAS ${selectStatement}${checkOption};\n\n${comment}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",dropView:"DROP VIEW IF EXISTS ${viewName};",createFunction:"CREATE${orReplace} FUNCTION ${name}\n	(${parameters})\n	RETURNS ${returnType}\n	LANGUAGE ${language}\n${properties}AS $BODY$\n${definition}\n$BODY$;\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name} (${parameters})\n	LANGUAGE ${language}\nAS $BODY$\n${body}\n$BODY$;\n",createCompositeType:`CREATE TYPE \${name} AS (
	\${columnDefinitions}
);

\${comment}`,createEnumType:"CREATE TYPE ${name} AS ENUM (${values});\n\n${comment}",createRangeType:"CREATE TYPE ${name} AS RANGE (\n	SUBTYPE=${subtype}${options}\n);\n\n${comment}",createDomainType:"CREATE DOMAIN ${name} AS ${underlyingType}${notNull}${collate}${default}${constraints};\n\n${comment}",createTrigger:"CREATE${orReplace}${constraint} TRIGGER ${name} ${actionTiming} ${events}\n	ON ${tableName}\n${options}	EXECUTE ${functionKey} ${functionName};\n",createSequence:"CREATE${sequenceType} SEQUENCE${ifNotExists} ${name}${options};\n",dropSequence:"DROP SEQUENCE IF EXISTS ${name};\n",renameSequence:"ALTER SEQUENCE IF EXISTS ${name} RENAME TO ${newName};\n",setSequenceType:"ALTER SEQUENCE IF EXISTS ${name} SET ${sequenceType};\n",alterSequence:"ALTER SEQUENCE IF EXISTS ${name}${options};\n"}});var lu=C((AA,uu)=>{var cu=i((t="")=>new RegExp("\\$\\{(.*?)\\}",t),"template"),Jy=i(t=>t.match(cu("gi"))||[],"getAllTemplates"),e_=i(t=>(t.match(cu("i"))||[])[1],"parseTemplate"),t_=i((t,e)=>Jy(t).reduce((r,n)=>{let s=e_(n);return r.replace(n,()=>e[s]||e[s]===0?e[s]:"")},t),"assignTemplates");uu.exports=t_});var mu=C((bA,pu)=>{pu.exports=({_:t,commentIfDeactivated:e,checkAllKeysDeactivated:r,assignTemplates:n,wrapInQuotes:s,getColumnsList:a})=>({generateConstraintsString:i((d,f)=>{var y,N;let h=e(((d==null?void 0:d.deactivatedItems)||[]).join(`,
	`),{isActivated:!f,isPartOfLine:!0}),T=(y=d==null?void 0:d.activatedItems)!=null&&y.length?`,
	`+d.activatedItems.join(`,
	`):"",_=(N=d==null?void 0:d.deactivatedItems)!=null&&N.length?`
	`+h:"";return T+_},"generateConstraintsString"),foreignKeysToString:i(d=>{if(Array.isArray(d)){let f=d.filter(_=>t.get(_,"isActivated",!0)).map(_=>s(t.trim(_.name))),h=d.filter(_=>!t.get(_,"isActivated",!0)).map(_=>s(t.trim(_.name))),T=h.length?e(h,{isActivated:!1,isPartOfLine:!0}):"";return f.join(", ")+T}return d},"foreignKeysToString"),foreignActiveKeysToString:i(d=>d.map(f=>t.trim(f.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:i((d,f)=>h=>{let T=s(t.trim(h.name)),_=r(h.columns||[]),y=t.isEmpty(h.columns)?"":a(h.columns,_,f),N=h.include.length?` INCLUDE${a(h.include,_,f)}`:"",S=h.storageParameters?` WITH (${h.storageParameters})`:"",b=h.tablespace?` USING INDEX TABLESPACE ${s(h.tablespace)}`:"",I=h!=null&&h.deferrable?` ${h.deferrable}`:"",R=(h==null?void 0:h.deferrable)==="DEFERRABLE"&&(h!=null&&h.deferrableConstraintCheckTime)?` ${h==null?void 0:h.deferrableConstraintCheckTime}`:"";return{statement:n(d.createKeyConstraint,{constraintName:h.name?`CONSTRAINT ${T} `:"",keyType:h.keyType,columns:y,includeNonKey:N,storageParameters:S,tablespace:b,deferrable:I,deferrableConstraintCheckTime:R}),isActivated:!_}},"createKeyConstraint"),getConstraintsWarnings:i((d=[])=>t.isEmpty(d)?"":`
	`+d.map(f=>{let h=f.name?` [constraint name: ${f.name}]`:"";return`-- ${f.errorMessage}${h}`}).join(`
	`),"getConstraintsWarnings"),additionalPropertiesForForeignKey:i(d=>{let f=t.get(d,"relationshipOnDelete",""),h=t.get(d,"relationshipOnUpdate",""),T=t.get(d,"relationshipMatch",""),_=t.get(d,"deferrable",""),y=t.get(d,"deferrableConstraintCheckTime","");return{foreignOnDelete:f,foreignOnUpdate:h,foreignMatch:T,deferrable:_,deferrableConstraintCheckTime:y}},"additionalPropertiesForForeignKey")})});var pr=C((IA,du)=>{du.exports=(t,e)=>{let r=i((_,y)=>Object.entries(_.properties).map(y),"mapProperties"),n=i(_=>_.compositeUniqueKey?!1:!!_.unique,"isUniqueKey"),s=i(_=>{var y,N;return n(_)&&(((y=_.uniqueKeyOptions)==null?void 0:y.length)===1&&!((N=t.first(_.uniqueKeyOptions))!=null&&N.constraintName)||t.isEmpty(_.uniqueKeyOptions))},"isInlineUnique"),a=i(_=>_.compositeUniqueKey||_.compositePrimaryKey?!1:!!_.primaryKey,"isPrimaryKey"),o=i(_=>{var y;return a(_)&&!((y=t.first(_.primaryKeyOptions))!=null&&y.constraintName)},"isInlinePrimaryKey"),c=i((_,y)=>{let N=_.nullsDistinct;return`UNIQUE${y>=15&&N?` ${N}`:""}`},"getUniqueKeyType"),u=i(({options:_,columnName:y,isActivated:N,jsonSchema:S,dbVersion:b})=>e({keyType:c(_,b),name:_.constraintName,columns:[{name:y,isActivated:N}],include:d(_.indexInclude||[],S),storageParameters:_.indexStorageParameters,comment:_.indexComment,tablespace:_.indexTablespace,nullsDistinct:_.nullsDistinct,deferrable:_.deferrable,deferrableConstraintCheckTime:_.deferrableConstraintCheckTime}),"hydrateUniqueOptions"),l=i((_,y,N,S)=>e({keyType:"PRIMARY KEY",name:_.constraintName,columns:[{name:y,isActivated:N}],include:d(_.indexInclude||[],S),storageParameters:_.indexStorageParameters,comment:_.indexComment,tablespace:_.indexTablespace,deferrable:_.deferrable,deferrableConstraintCheckTime:_.deferrableConstraintCheckTime}),"hydratePrimaryKeyOptions"),p=i((_,y)=>Object.keys(y).find(N=>y[N].GUID===_),"findName"),m=i((_,y)=>t.get(Object.values(y).find(N=>N.GUID===_),"isActivated",!0),"checkIfActivated"),d=i((_,y)=>t.map(_,N=>({name:p(N.keyId,y.properties),isActivated:m(N.keyId,y.properties)})),"getKeys"),f=i(_=>Array.isArray(_.primaryKey)?_.primaryKey.map(y=>t.isEmpty(y.compositePrimaryKey)?{name:y.constraintName,errorMessage:"A primary key constraint cannot be created without any primary key selected"}:{...l(y,null,null,_),columns:d(y.compositePrimaryKey,_)}):[],"getCompositePrimaryKeys"),h=i((_,y)=>Array.isArray(_.uniqueKey)?_.uniqueKey.map(N=>t.isEmpty(N.compositeUniqueKey)?{name:N.constraintName,errorMessage:"A unique key constraint cannot be created without any unique key selected"}:{...u({options:N,columnName:null,isActivated:null,jsonSchema:_,dbVersion:y}),columns:d(N.compositeUniqueKey,_)}):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i((_,y)=>{if(!_.properties)return[];let N=r(_,([b,I])=>{if(!(!a(I)||o(I)))return l(t.first(I.primaryKeyOptions),b,I.isActivated,_)}).filter(Boolean),S=t.flatten(r(_,([b,I])=>!n(I)||s(I)?[]:(I.uniqueKeyOptions||[]).map(R=>u({options:R,columnName:b,isActivated:I.isActivated,jsonSchema:_,dbVersion:y})))).filter(Boolean);return[...N,...f(_),...S,...h(_,y)]},"getTableKeyConstraints"),isInlineUnique:s,isInlinePrimaryKey:o,getKeys:d,hydratePrimaryKeyOptions:l,hydrateUniqueOptions:u,getUniqueKeyType:c}}});var hu=C((RA,fu)=>{fu.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=i((S,b)=>t.map(b,I=>{let R=I.functionOrReplace?" OR REPLACE":"",M=r(e.createFunction,{name:s(I.name,S),orReplace:R,parameters:n(I.functionArguments),returnType:I.functionReturnsSetOf?`SETOF ${I.functionReturnType}`:I.functionReturnType,language:I.functionLanguage,properties:c(I),definition:I.functionBody}),v=I.functionDescription?r(e.comment,{object:"FUNCTION",objectName:s(I.name,S),comment:a(I.functionDescription)}):"";return[M,v].filter(Boolean).join(`
`)}).join(`
`),"getFunctionsScript"),c=i(S=>{let b=i(I=>I?`	${I}
`:"","wrap");return[{key:"functionWindow",getValue:u},{key:"functionVolatility",getValue:l},{key:"functionLeakProof",getValue:p},{key:"functionNullArgs",getValue:m},{key:"functionSqlSecurity",getValue:d},{key:"functionParallel",getValue:f},{key:"functionExecutionCost",getValue:h},{key:"functionExecutionRows",getValue:T},{key:"functionSupportFunction",getValue:_},{key:"functionConfigurationParameters",getValue:y}].map(I=>b(I.getValue(S[I.key],S))).filter(Boolean).join("")},"getProperties"),u=i((S,b)=>b.language!=="c"||!S?"":"WINDOW","getWindow"),l=i(S=>S,"getVolatility"),p=i(S=>S?"LEAKPROOF":"NOT LEAKPROOF","getLeakProof"),m=i(S=>S,"getNullArgs"),d=i(S=>{if(S)return`SECURITY ${S}`},"getSqlSecurity"),f=i(S=>{if(S)return`PARALLEL ${S}`},"getParallel"),h=i(S=>{if(S)return`COST ${S}`},"getExecutionCost"),T=i((S,b)=>!S||!b.functionReturnsSetOf&&!N(b)?"":`ROWS ${S}`,"getExecutionRows"),_=i(S=>{if(S)return`SUPPORT ${S}`},"getSupportFunction"),y=i(S=>{if(S)return`SET ${S}`},"getConfigurationParameters"),N=i(S=>(S.functionReturnType||"").trim().toUpperCase().startsWith("TABLE"),"isFunctionReturnsTable");return{getFunctionsScript:o}}});var yu=C((DA,gu)=>{gu.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s})=>({getProceduresScript:i((o,c)=>t.map(c,u=>{let l=u.orReplace?" OR REPLACE":"";return r(e.createProcedure,{name:s(u.name,o),orReplace:l,parameters:n(u.inputArgs),language:u.language,body:u.body})}).join(`
`),"getProceduresScript")})});var Eu=C((PA,_u)=>{var{Sequence:xA}=or();_u.exports=({_:t,templates:e,assignTemplates:r,getNamePrefixedWithSchemaName:n,wrapInQuotes:s})=>{let a=i(({schemaName:S,sequences:b})=>t.map(b,I=>o({schemaName:S,sequence:I})).join(`
`),"getSequencesScript"),o=i(({schemaName:S,sequence:b})=>{let I=b.temporary?"":S,R=n(b.sequenceName,I),M=f({sequence:b}),v=h({sequence:b}),D=l({sequence:b,schemaName:S});return r(e.createSequence,{name:R,ifNotExists:M,sequenceType:v,options:D})},"createSequenceScript"),c=i(({schemaName:S,sequence:b,oldSequence:I})=>{let R=b.temporary?"":S,M=I.sequenceName||b.sequenceName,v=n(M,R),D=N({sequence:b,oldSequence:I}),G=l({schemaName:S,sequence:D}),P=T({sequence:D}),X=D.sequenceName;return[{key:"options",value:G,template:e.alterSequence},{key:"sequenceType",value:P,template:e.setSequenceType},{key:"newName",value:X,template:e.renameSequence}].filter(me=>me.value).map(me=>r(me.template,{[me.key]:me.value,name:v})).join(`
`)},"alterSequenceScript"),u=i(({schemaName:S,sequence:b})=>{let I=b.temporary?"":S,R=n(b.sequenceName,I);return r(e.dropSequence,{name:R})},"dropSequenceScript"),l=i(({schemaName:S,sequence:b})=>{let R=[{getOption:p,key:"dataType",clause:"AS"},{getOption:p,key:"increment",clause:"INCREMENT BY"},{getOption:p,key:"start",clause:"START WITH"},{getOption:p,key:"restart",clause:"RESTART WITH"},{getOption:p,key:"minValue",clause:"MINVALUE"},{getOption:p,key:"maxValue",clause:"MAXVALUE"},{getOption:p,key:"cache",clause:"CACHE"},{getOption:_,key:"cycle"},{getOption:y,key:"ownedByColumn"}].map(M=>{let v=M.getOption({sequence:b,schemaName:S,config:M});return m({option:v})}).filter(Boolean).join("");return R&&d({options:R})},"getSequenceOptions"),p=i(({sequence:S,config:b})=>{let I=S[b.key];return I||I===0?`${b.clause} ${I}`:""},"getOption"),m=i(({option:S})=>S?`	${S}
`:"","wrapOption"),d=i(({options:S})=>`
`+S.replace(/\n$/,""),"wrapOptionsBlock"),f=i(({sequence:S})=>S.ifNotExist?" IF NOT EXISTS":"","getIfNotExists"),h=i(({sequence:S})=>S.temporary?" TEMPORARY":S.unlogged?" UNLOGGED":"","getSequenceType"),T=i(({sequence:S})=>S.temporary?"":S.unlogged===!0?"UNLOGGED":S.unlogged===!1?"LOGGED":"","getAlterSequenceType"),_=i(({sequence:S})=>S.cycle===!0?"CYCLE":S.cycle===!1?"NO CYCLE":"","getCycle"),y=i(({sequence:S,schemaName:b})=>{var R,M;if(S.ownedByNone)return"OWNED BY NONE";let I=(R=S.ownedByColumn)==null?void 0:R[0];if(I){let[v,D]=((M=I.name)==null?void 0:M.split("."))||[];return`OWNED BY ${[b,v,D].filter(Boolean).map(s).join(".")}`}return""},"getOwnedBy"),N=i(({sequence:S,oldSequence:b})=>{let I=t.omitBy(S,(R,M)=>t.isEqual(R,b[M]));return S.minValue>b.minValue?{...I,restart:S.start}:I},"getModifiedSequence");return{getSequencesScript:a,createSequenceScript:o,dropSequenceScript:u,alterSequenceScript:c}}});var Su=C((MA,Tu)=>{Tu.exports=({_:t,getColumnsList:e,checkAllKeysDeactivated:r})=>{let n=i((m,d)=>m?" TEMPORARY":d?" UNLOGGED":"","getTableTemporaryValue"),s=i(m=>{let d=i(h=>h?`${h}
`:"","wrap"),f=[{key:"inherits",getValue:u("INHERITS")},{key:"partitionBounds",getValue:u("")},{key:"partitioning",getValue:a},{key:"usingMethod",getValue:u("USING")},{key:"storage_parameter",getValue:p},{key:"on_commit",getValue:c},{key:"table_tablespace_name",getValue:u("TABLESPACE")},{key:"selectStatement",getValue:u("AS")}].map(h=>d(h.getValue(m[h.key],m))).filter(Boolean).join("");return t.trim(f)?` ${t.trim(f)}`:""},"getTableOptions"),a=i((m,{isActivated:d})=>{if(m&&m.partitionMethod){let f=m.partitionBy==="keys"?o(m,d):` (${m.partitioning_expression})`;return`PARTITION BY ${m.partitionMethod}${f}`}},"getPartitioning"),o=i((m,d)=>{let f=r(m.compositePartitionKey);return e(m.compositePartitionKey,f,d)},"getPartitionKeys"),c=i((m,d)=>{if(m&&d.temporary)return`ON COMMIT ${m}`},"getOnCommit"),u=i(m=>d=>{if(d)return`${m} ${d}`},"getBasicValue"),l=["toast_autovacuum_enabled","toast_vacuum_index_cleanup","toast_vacuum_truncate","toast_autovacuum_vacuum_threshold","toast_autovacuum_vacuum_scale_factor","toast_autovacuum_vacuum_insert_threshold","toast_autovacuum_vacuum_insert_scale_factor","toast_autovacuum_vacuum_cost_delay","toast_autovacuum_vacuum_cost_limit","toast_autovacuum_freeze_min_age","toast_autovacuum_freeze_max_age","toast_autovacuum_freeze_table_age","toast_autovacuum_multixact_freeze_min_age","toast_autovacuum_multixact_freeze_max_age","toast_autovacuum_multixact_freeze_table_age","toast_log_autovacuum_min_duration"],p=i(m=>{if(t.isEmpty(m))return"";let d=["autovacuum","toast","id"];return t.chain(m).toPairs().flatMap(([f,h])=>f==="autovacuum"||f==="toast"?t.toPairs(h):[[f,h]]).reject(([f])=>t.includes(d,f)).map(([f,h])=>{if(!(!h&&h!==0))return t.includes(l,f)?`toast.${f.slice(6)}=${h}`:`${f}=${h}`}).compact().join(`,
	`).trim().thru(f=>{if(f)return`WITH (
	${f}
)`}).value()},"getStorageParameters");return{getTableTemporaryValue:n,getTableOptions:s}}});var Au=C((UA,Cu)=>{Cu.exports=({_:t,commentIfDeactivated:e,assignTemplates:r,templates:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=["composite","enum","range_udt","domain"],c=i((f,h)=>{let T=s(f.name,f.schemaName),_=r(n.comment,{object:"TYPE",objectName:T,comment:a(f.comment)});switch(f.type){case"composite":return r(n.createCompositeType,{name:T,columnDefinitions:t.join(h,`,
	`),comment:f.comment?_:""});case"enum":return r(n.createEnumType,{name:T,values:t.map(f.enum,y=>`'${y}'`).join(", "),comment:f.comment?_:""});case"range_udt":return r(n.createRangeType,{name:T,subtype:f.rangeSubtype,options:l(f),comment:f.comment?_:""});case"domain":{let y=r(n.comment,{object:"DOMAIN",objectName:T,comment:a(f.comment)});return r(n.createDomainType,{name:T,underlyingType:f.underlyingType,notNull:f.nullable?"":" NOT NULL",collate:f.collation?`
	COLLATE ${f.collation}`:"",default:f.default?`
	DEFAULT ${f.default}`:"",constraints:p(f),comment:f.comment?y:""})}default:return""}},"getPlainUdt"),u=i(f=>o.includes(f.type),"isNotPlainType"),l=i(f=>{let h=i(_=>_?`	${_}`:"","wrap"),T=[{key:"operatorClass",getValue:m("SUBTYPE_OPCLASS")},{key:"collation",getValue:m("COLLATION")},{key:"canonicalFunction",getValue:m("CANONICAL")},{key:"subtypeDiffFunction",getValue:m("SUBTYPE_DIFF")},{key:"multiRangeType",getValue:m("MULTIRANGE_TYPE_NAME")}].map(_=>h(_.getValue(f[_.key]))).filter(Boolean).join(`,
`);return t.trim(T)?`,
	`+t.trim(T):""},"getRangeOptions"),p=i(f=>t.map(f.checkConstraints,h=>h.name?`
	CONSTRAINT ${h.name} CHECK (${h.expression})`:`
	CHECK (${h.expression})`).join(""),"getDomainConstraints"),m=i(f=>h=>{if(h)return`${f}=${h}`},"getBasicValue");return{getUserDefinedType:i((f,h)=>e(c(f,h),{isActivated:f.isActivated}),"getUserDefinedType"),isNotPlainType:u}}});var bu=C(($A,Nu)=>{Nu.exports=({_:t,wrapInQuotes:e,checkAllKeysDeactivated:r,getColumnsList:n})=>{let s=i(({name:p,sortOrder:m,nullsOrder:d,collation:f,opclass:h})=>{let T=m?` ${m}`:"",_=d?` ${d}`:"",y=t.includes(f,'"')?f:`"${f}"`,N=f?` COLLATE ${y}`:"",S=h?` ${h}`:"";return`${e(p)}${N}${S}${T}${_}`},"mapIndexKey"),a=i((p=[],m)=>{let d=r(p);return n(p,d,m,s)},"getIndexKeys"),o=i((p,m)=>{var N;let d=n(p.include||[],r(p.include||[]),m),f=(N=p.include)!=null&&N.length?` INCLUDE ${t.trim(d)}`:"",h=u(p),T=h?` WITH (
	${h})`:"",_=p.index_tablespace_name?` TABLESPACE ${p.index_tablespace_name}`:"",y=p.where?` WHERE ${p.where}`:"";return t.compact([" ",f,T,_,y]).join(`
`)},"getIndexOptions"),c={btree:{index_fillfactor:"fillfactor",deduplicate_items:"deduplicate_items"},hash:{index_fillfactor:"fillfactor"},spgist:{index_fillfactor:"fillfactor"},gist:{index_fillfactor:"fillfactor",index_buffering:"buffering"},gin:{fastupdate:"fastupdate",gin_pending_list_limit:"gin_pending_list_limit"},brin:{pages_per_range:"pages_per_range",autosummarize:"autosummarize"}},u=i(p=>{let m=c[p.index_method];return t.chain(m).toPairs().map(([d,f])=>{let h=(p.index_storage_parameter||{})[d];if(!(t.isNil(h)||h===""))return`${f}=${l(h)}`}).compact().join(`,
	`).value()},"getWithOptions"),l=i(p=>t.isBoolean(p)?p?"ON":"OFF":p,"getValue");return{getIndexKeys:a,getIndexOptions:o,getWithOptions:u}}});var Iu=C((KA,vu)=>{vu.exports=({_:t,assignTemplates:e,templates:r,commentIfDeactivated:n,wrapComment:s,wrapInQuotes:a})=>{let o=i((v,D)=>`${v}(${D})`,"addLength"),c=i((v,D,G)=>t.isNumber(G)?`${v}(${D},${G})`:`${v}(${D})`,"addScalePrecision"),u=i((v,D)=>t.isNumber(D)?`${v}(${D})`:v,"addPrecision"),l=i((v,D)=>D?`${v} ${D}`:v,"addWithTimezone"),p=i(({type:v,typeModifier:D,srid:G})=>{let P=G?`, ${G}`:"";return D&&D!==""?`${v}(${D}${P})`:v},"addTypeModifier"),m=i((v,D)=>{let G=(D==null?void 0:D.map(P=>`[${(P==null?void 0:P.array_size_limit)??""}]`).join("").trim())||"";return`${v}${G}`},"addArrayDecorator"),d=i(v=>["char","varchar","bit","varbit"].includes(v),"canHaveLength"),f=i(v=>v==="numeric","canHavePrecision"),h=i(v=>["time","timestamp"].includes(v),"canHaveTimePrecision"),T=i(v=>v==="numeric","canHaveScale"),_=i(v=>["geography","geometry"].includes(v),"canHaveTypeModifier"),y=i((v,D)=>(d(v)&&t.isNumber(D.length)?v=o(v,D.length):f(v)&&T(v)&&t.isNumber(D.precision)?v=c(v,D.precision,D.scale):f(v)&&t.isNumber(D.precision)?v=u(v,D.precision):_(v)?v=p({type:v,typeModifier:D.typeModifier,srid:D.srid}):h(v)&&(t.isNumber(D.timePrecision)||D.timezone)&&(v=l(u(v,D.timePrecision),D.timezone)),m(v,D.array_type)),"decorateType"),N=i(v=>["char","varchar","text","bit","varbit"].includes(v),"isString"),S=i(v=>["date","time","timestamp","interval"].includes(v),"isDateTime"),b=i((v,D,G)=>{let P=["current_timestamp","null"];return(N(v)||S(v))&&!P.includes(t.toLower(D))&&!G?s(D):D},"decorateDefault"),I=i((v,D)=>t.chain(D).filter("comment").map(G=>{let P=e(r.comment,{object:"COLUMN",objectName:`${v}.${a(G.name)}`,comment:s(G.comment)});return n(P,G)}).join(`
`).value(),"getColumnComments"),R={"v13.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v12.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v11.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v10.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"}};return{decorateType:y,decorateDefault:b,getColumnComments:I,replaceTypeByVersion:i((v,D)=>{let G=R[D];return t.get(G,v)||v},"replaceTypeByVersion")}}});var Ru=C((VA,Ou)=>{Ou.exports=({_:t,assignTemplates:e,templates:r,getNamePrefixedWithSchemaName:n,wrap:s,commentIfDeactivated:a})=>{let o=i(({dbVersion:m,triggers:d,tableName:f})=>t.map(d,c(m,f)).join(`
`).trim(),"getTriggersScript"),c=i((m,d)=>f=>{let h=u(f),T=l(f);return e(r.createTrigger,{orReplace:f.triggerOrReplace?" OR REPLACE":"",constraint:f.triggerConstraint?" CONSTRAINT":"",actionTiming:f.triggerType??"",functionKey:m==="v10.x"?"PROCEDURE":"FUNCTION",functionName:f.triggerFunction,name:f.name,tableName:d,events:h,options:T})},"getTriggerScript"),u=i(m=>{var d;return(d=m.triggerEvents)==null?void 0:d.map(f=>{if(f.triggerEvent!=="UPDATE"||t.isEmpty(m.triggerUpdateColumns))return f.triggerEvent;let h=t.chain(m.triggerUpdateColumns).filter("isActivated").map(({name:y})=>y).join(", ").thru(y=>y&&`OF ${y}`).value(),T=t.chain(m.triggerUpdateColumns).reject("isActivated").map(({name:y})=>y).join(", ").thru(y=>!h&&y?`OF ${y}`:y).value(),_=T&&a(T,{isActivated:!1,isPartOfLine:!0});return`UPDATE ${h} ${_}`}).join(" OR ")},"getTriggerEvents"),l=i(m=>{let d="";if(m.triggerConstraint&&(m.triggerReferencedTable&&(d+=s(`FROM ${m.triggerReferencedTable}`,"	",`
`)),d+=s(m.triggerDeferrable?"DEFERRABLE":"NOT DEFERRABLE","	",`
`),m.triggerDeferrable&&m.triggerTimeConstraintCheck&&(d+=s(m.triggerTimeConstraintCheck,"	",`
`))),m.triggerReferencing){let f="REFERENCING";m.triggerBeforeImageTransitionRelation&&(f+=` OLD TABLE ${m.triggerBeforeImageTransitionRelation}`),m.triggerAfterImageTransitionRelation&&(f+=` NEW TABLE ${m.triggerAfterImageTransitionRelation}`),d+=s(f,"	",`
`)}return d+=s(m.triggerConstraint||m.triggerType==="INSTEAD OF"?"FOR EACH ROW":m.triggerEachRowStatement||"FOR EACH STATEMENT","	",`
`),m.triggerCondition&&(d+=s(`WHEN ${m.triggerCondition}`,"	",`
`)),d},"getTriggerOptions");return{getTriggersScript:o,hydrateTriggers:i((m,d={})=>{var f;return(((f=t.find(m,"triggers"))==null?void 0:f.triggers)||[]).map(h=>{let T=d[h.triggerReferencedTable];if(!T)return{...h,triggerReferencedTable:""};let _=n(T.code||T.collectionName,T.bucketName);return{...h,triggerReferencedTable:_}})},"hydrateTriggers")}}});var Du=C((WA,wu)=>{wu.exports=()=>({getLocaleProperties:i(e=>{let r=["v13.x","v14.x","v15.x"].includes(e.dbVersion);return r&&e.locale?{locale:e.locale}:!r&&e.locale?{collate:e.locale,characterClassification:e.locale}:{collate:e.collate,characterClassification:e.characterClassification}},"getLocaleProperties")})});var se=C((jA,xu)=>{var r_=nu(),qu=iu(),x=ou(),{Sequence:YA}=or();xu.exports=(t,e,r)=>{let n=r.require("lodash"),{tab:s,commentIfDeactivated:a,checkAllKeysDeactivated:o,divideIntoActivatedAndDeactivated:c,hasType:u,wrap:l,clean:p,wrapComment:m,getFunctionArguments:d,wrapInQuotes:f,getNamePrefixedWithSchemaName:h,getColumnsList:T,getViewData:_}=L()(n),y=lu(),{generateConstraintsString:N,foreignKeysToString:S,foreignActiveKeysToString:b,createKeyConstraint:I,getConstraintsWarnings:R,additionalPropertiesForForeignKey:M}=mu()({_:n,commentIfDeactivated:a,checkAllKeysDeactivated:o,assignTemplates:y,getColumnsList:T,wrapInQuotes:f}),v=pr()(n,p),{getFunctionsScript:D}=hu()({_:n,templates:x,assignTemplates:y,getFunctionArguments:d,getNamePrefixedWithSchemaName:h,wrapComment:m}),{getProceduresScript:G}=yu()({_:n,templates:x,assignTemplates:y,getFunctionArguments:d,getNamePrefixedWithSchemaName:h}),{getSequencesScript:P,createSequenceScript:X,dropSequenceScript:ve,alterSequenceScript:me}=Eu()({_:n,templates:x,assignTemplates:y,getNamePrefixedWithSchemaName:h,wrapInQuotes:f}),{getTableTemporaryValue:U,getTableOptions:Ie}=Su()({_:n,checkAllKeysDeactivated:o,getColumnsList:T}),{getUserDefinedType:A,isNotPlainType:q}=Au()({_:n,commentIfDeactivated:a,assignTemplates:y,templates:x,getNamePrefixedWithSchemaName:h,wrapComment:m}),{getIndexKeys:B,getIndexOptions:W,getWithOptions:ie}=bu()({_:n,wrapInQuotes:f,checkAllKeysDeactivated:o,getColumnsList:T}),{decorateType:Pe,decorateDefault:qe,getColumnComments:Sr,replaceTypeByVersion:Jl}=Iu()({_:n,wrap:l,assignTemplates:y,templates:x,commentIfDeactivated:a,wrapInQuotes:f,wrapComment:m}),{getTriggersScript:Vi,hydrateTriggers:Hi}=Ru()({_:n,wrap:l,assignTemplates:y,templates:x,getNamePrefixedWithSchemaName:h,commentIfDeactivated:a}),{getLocaleProperties:ep}=Du()();return{createDatabase(g){if(!g.databaseName)return"";let{locale:E,collate:O,characterClassification:w}=ep(g);return y(x.createDatabase,{name:f(g.databaseName),template:g.template?`
	TEMPLATE ${g.template}`:"",encoding:g.encoding?`
	ENCODING ${g.encoding}`:"",locale:E?`
	LOCALE '${g.locale}'`:"",collate:O?`
	LC_COLLATE '${g.collate}'`:"",characterClassification:w?`
	LC_CTYPE '${w}'`:"",tablespace:g.tablespace?`
	TABLESPACE '${g.tablespace}'`:""})},createSchema({schemaName:g,ifNotExist:E,comments:O,udfs:w,procedures:K,sequences:Z}){let Q=y(x.comment,{object:"SCHEMA",objectName:f(g),comment:m(O)}),te=y(x.createSchema,{name:f(g),ifNotExist:E?" IF NOT EXISTS":"",comment:O?Q:""}),ae=D(g,w),ue=G(g,K);return n.chain([te,ae,ue]).compact().map(n.trim).join(`

`).trim().value()},createTable({name:g,columns:E,checkConstraints:O,foreignKeyConstraints:w,schemaData:K,columnDefinitions:Z,keyConstraints:Q,inherits:te,description:ae,ifNotExist:ue,usingMethod:Ce,on_commit:he,partitioning:J,storage_parameter:Oe,table_tablespace_name:Re,temporary:Se,unlogged:we,selectStatement:Le,triggers:xe,partitionOf:le,partitionBounds:Me},Fe){let Ut=ue?" IF NOT EXISTS":"",Ve=h(g,K.schemaName),Ae=y(x.comment,{object:"TABLE",objectName:Ve,comment:m(ae)}),Cr=c(Q.filter(({errorMessage:He})=>!He).map(I(x,Fe)),He=>He.statement),Ar=R(Q.filter(({errorMessage:He})=>He)),dt=`${N(Cr,Fe)}${Ar}`,Wi=le?dt==null?void 0:dt.slice(1):dt,tp=c(w,He=>He.statement),Qi=N(tp,Fe),rp=`
`+Sr(Ve,Z),np=le?x.createTablePartitionOf:x.createTable,sp=le&&!dt?`
	`:`,
	`,Yi=n.isEmpty(O)?"":l(n.join(O,`,
	`),sp,""),ji=le&&!Wi&&!Yi&&!Qi,ip=ji?"":"(",ap=ji?"":")",op=y(np,{temporary:U(Se,we),ifNotExist:Ut,name:Ve,columnDefinitions:le?"":"	"+n.join(E,`,
	`),keyConstraints:Wi,checkConstraints:Yi,foreignKeyConstraints:Qi,options:Ie({inherits:te,partitioning:J,usingMethod:Ce,on_commit:he,storage_parameter:Oe,table_tablespace_name:Re,selectStatement:Le,partitionBounds:Me}),comment:ae?Ae:"",partitionOf:le?` PARTITION OF ${le} `:"",columnDescriptions:rp,openParenthesis:ip,closeParenthesis:ap}),cp=Vi({dbVersion:K.dbVersion,tableName:Ve,triggers:xe});return a([op,cp].map(n.trim).join(`

`).trim()+`
`,{isActivated:Fe})},convertColumnDefinition(g){let E=Jl(g.type,g.dbVersion),O=g.nullable?"":" NOT NULL",w=g.primaryKey?" "+I(x,!0)(g.primaryKeyOptions).statement:"",K=g.unique?" "+I(x,!0)(g.uniqueKeyOptions).statement:"",Z=g.collationRule?` COLLATE "${g.collationRule}"`:"",Q=Array.isArray(g.array_type)&&g.array_type.length>0,te=n.isUndefined(g.default)?"":" DEFAULT "+qe(E,g.default,Q),ae=g.dbVersion>=12&&g.generatedColumn&&g.columnGenerationExpression?y(x.generatedColumnClause,{generationExpression:g.columnGenerationExpression}):"";return a(y(x.columnDefinition,{name:f(g.name),type:Pe(E,g),generatedColumnClause:ae,notNull:O,primaryKey:w,uniqueKey:K,collation:Z,defaultValue:te}),{isActivated:g.isActivated})},createIndex(g,E,O,w=!0){let K=E.unique&&E.index_method==="btree",Z=f(E.indxName),Q=K?" UNIQUE":"",te=E.concurrently?" CONCURRENTLY":"",ae=E.ifNotExist?" IF NOT EXISTS":"",ue=E.only?" ONLY":"",Ce=E.index_method?` USING ${n.toUpper(E.index_method)}`:"",{getDbVersion:he}=L()(n),J=he(n.get(O,"dbVersion","")),Oe=K&&E.nullsDistinct&&J>=15?`
 ${E.nullsDistinct}`:"",Re=B(E.index_method==="btree"?E.columns:n.map(E.columns,we=>n.omit(we,"sortOrder","nullsOrder")),w),Se=W(E,w);return a(y(x.index,{unique:Q,concurrently:te,ifNotExist:ae,name:Z,only:ue,using:Ce,keys:Re,options:Se,nullsDistinct:Oe,tableName:h(g,E.schemaName)}),{isActivated:E.isActivated})},createCheckConstraint(g){return y(x.checkConstraint,{name:g.name?`CONSTRAINT ${f(g.name)}`:"",expression:n.trim(g.expression).replace(/^\(([\s\S]*)\)$/,"$1"),noInherit:g.noInherit?" NO INHERIT":""})},createForeignKeyConstraint({name:g,foreignKey:E,primaryTable:O,primaryKey:w,primaryTableActivated:K,foreignTableActivated:Z,foreignSchemaName:Q,primarySchemaName:te,customProperties:ae,isActivated:ue},Ce,he){let J=o(w),Oe=o(E),Re=!J&&!Oe&&K&&Z,{foreignOnDelete:Se,foreignOnUpdate:we,foreignMatch:Le,deferrable:xe,deferrableConstraintCheckTime:le}=M(ae),Me=y(x.createForeignKeyConstraint,{primaryTable:h(O,te||he.schemaName),name:g?`CONSTRAINT ${f(g)}`:"",foreignKey:Re?S(E):b(E),primaryKey:Re?S(w):b(w),onDelete:Se?` ON DELETE ${Se}`:"",onUpdate:we?` ON UPDATE ${we}`:"",match:Le?` MATCH ${Le}`:"",deferrable:xe?` ${xe}`:"",deferrableConstraintCheckTime:xe==="DEFERRABLE"&&le?` ${le}`:""});return{statement:n.trim(Me),isActivated:Re&&ue}},createForeignKey({name:g,foreignTable:E,foreignKey:O,primaryTable:w,primaryKey:K,primaryTableActivated:Z,foreignTableActivated:Q,foreignSchemaName:te,primarySchemaName:ae,customProperties:ue,isActivated:Ce},he,J){let Oe=o(K),Re=o(O),Se=!Oe&&!Re&&Z&&Q,{foreignOnDelete:we,foreignOnUpdate:Le,foreignMatch:xe,deferrable:le,deferrableConstraintCheckTime:Me}=M(ue),Fe=y(x.createForeignKey,{primaryTable:h(w,ae||J.schemaName),foreignTable:h(E,te||J.schemaName),name:g?f(g):"",foreignKey:Se?S(O):b(O),primaryKey:Se?S(K):b(K),onDelete:we?` ON DELETE ${we}`:"",onUpdate:Le?` ON UPDATE ${Le}`:"",match:xe?` MATCH ${xe}`:"",deferrable:le?` ${le}`:"",deferrableConstraintCheckTime:le==="DEFERRABLE"&&Me?` ${Me}`:""});return{statement:n.trim(Fe),isActivated:Se&&Ce}},createView(g,E,O){var Me,Fe,Ut,Ve;let w=h(g.name,g.schemaName),K=y(x.comment,{object:"VIEW",objectName:w,comment:m(g.comment)}),Q=o(g.keys||[])||!O,{columns:te,tables:ae}=_(g.keys),ue=te.map(Ae=>Ae.statement).join(`,
		`);if(!Q){let Ae=c(te,Ar=>Ar.statement),Cr=Ae.deactivatedItems.length?a(Ae.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";ue=Ae.activatedItems.join(`,
		`)+Cr}let Ce=n.trim(g.selectStatement)?n.trim(s(g.selectStatement)):y(x.viewSelectStatement,{tableName:ae.join(", "),keys:ue}),he=(Me=g.viewOptions)!=null&&Me.check_option?`check_option=${(Fe=g.viewOptions)==null?void 0:Fe.check_option}`:"",J=(Ut=g.viewOptions)!=null&&Ut.security_barrier?"security_barrier":"",Oe=15,{getDbVersion:Re}=L()(n),Se=(Ve=g.viewOptions)!=null&&Ve.security_invoker&&Re(E.dbVersion)>=Oe?"security_invoker":"",we=he||J||Se?`
	WITH (${n.compact([he,J,Se]).join(",")})`:"",Le=i(Ae=>Ae.withCheckOption&&Ae.checkTestingScope?`
	WITH ${Ae.checkTestingScope} CHECK OPTION`:Ae.withCheckOption?`
	WITH CHECK OPTION`:"","getCheckOption"),xe=a(y(x.createView,{name:w,orReplace:g.orReplace?" OR REPLACE":"",temporary:g.temporary?" TEMPORARY":"",checkOption:Le(g),comment:g.comment?K:"",withOptions:we,selectStatement:Ce}),{isActivated:!Q}),le=Vi({dbVersion:g.dbVersion,tableName:w,triggers:g.triggers});return[xe,le].map(n.trim).join(`

`).trim()+`
`},dropView(g){let E={viewName:g};return y(x.dropView,E)},createViewIndex(){return""},createUdt(g){let E=n.map(g.properties,this.convertColumnDefinition);return A(g,E)},getDefaultType(g){return r_[g]},getTypesDescriptors(){return qu},hasType(g){return u(qu,g)},hydrateDatabase({modelData:g}){return g=n.get(g,"0",{}),{databaseName:g.database_name,tablespace:g.tablespace_name,encoding:g.encoding,template:g.template,collate:g.LC_COLLATE,characterClassification:g.LC_CTYPE,dbVersion:g.dbVersion,locale:g.locale}},hydrateColumn({columnDefinition:g,jsonSchema:E,schemaData:O,definitionJsonSchema:w={},parentJsonSchema:K}){let Z=n.includes(["char","varchar","text"],g.type)?E.collationRule:"",Q=["time","timestamp"],te=n.includes(Q,g.type)?E.timePrecision:"",ae=n.includes(Q,g.type)?E.timezone:"",ue=g.type==="interval"?E.intervalOptions:"",{getDbVersion:Ce}=L()(n),he=Ce(O.dbVersion),J=n.omit(v.hydratePrimaryKeyOptions(n.first(E.primaryKeyOptions)||{},g.name,g.isActivated,K),"columns"),Oe=n.omit(v.hydrateUniqueOptions({options:n.first(E.uniqueKeyOptions)||{},columnName:g.name,isActivated:g.isActivated,jsonSchema:K,dbVersion:he}),"columns");return{name:g.name,type:g.type,primaryKey:v.isInlinePrimaryKey(E),primaryKeyOptions:J,unique:v.isInlineUnique(E),uniqueKeyOptions:Oe,nullable:g.nullable,default:g.default,comment:E.refDescription||E.description||w.description,isActivated:g.isActivated,scale:g.scale,precision:g.precision,length:g.length,enum:E.enum,array_type:E.array_type,unit:E.unit,rangeSubtype:E.rangeSubtype,operatorClass:E.operatorClass,collation:E.collation,canonicalFunction:E.canonicalFunction,subtypeDiffFunction:E.subtypeDiffFunction,multiRangeType:E.multiRangeType,schemaName:O.schemaName,underlyingType:E.underlyingType,checkConstraints:E.checkConstraints,typeModifier:E.typeModifier,srid:E.srid,collationRule:Z,timePrecision:te,timezone:ae,intervalOptions:ue,dbVersion:he,generatedColumn:!!E.generatedColumn,columnGenerationExpression:E.columnGenerationExpression}},hydrateJsonSchemaColumn(g,E){return!g.$ref||n.isEmpty(E)||q(E)?g:(g=n.omit(g,"$ref"),{...E,...g})},hydrateIndex(g,E,O){return{...g,schemaName:O.schemaName}},hydrateViewIndex(g){return{}},hydrateCheckConstraint(g){return{name:g.chkConstrName,expression:g.constrExpression,noInherit:g.noInherit}},hydrateSchema(g,E){let O=n.get(E,"modelData.0.dbVersion");return{schemaName:g.name,ifNotExist:g.ifNotExist,comments:g.description,udfs:(E==null?void 0:E.udfs)||[],procedures:(E==null?void 0:E.procedures)||[],sequences:(E==null?void 0:E.sequences)||[],dbVersion:O}},hydrateTable({tableData:g,entityData:E,jsonSchema:O}){let w=E[0],K=n.chain(w.inherits).map(({parentTable:J})=>n.get(g,`relatedSchemas[${J}]`,"")).compact().map(J=>J.code||J.collectionName).join(", ").thru(J=>J?`(${J})`:"").value(),Z=n.first(w.partitioning)||{},Q=v.getKeys(Z.compositePartitionKey,O),te=n.get(g,`relatedSchemas[${w.partitionOf}]`),ae=te?h(te.collectionName,te.bucketName):"",ue=Hi(E,g.relatedSchemas),{getDbVersion:Ce}=L()(n),he=Ce(n.get(g,"dbData.dbVersion",""));return{...g,triggers:ue,partitionOf:ae,keyConstraints:v.getTableKeyConstraints(O,he),inherits:K,selectStatement:n.trim(w.selectStatement),partitioning:n.assign({},Z,{compositePartitionKey:Q}),...n.pick(w,"temporary","unlogged","description","ifNotExist","usingMethod","on_commit","storage_parameter","table_tablespace_name","partitionBounds")}},hydrateViewColumn(g){return{name:g.name,tableName:g.entityName,alias:g.alias,isActivated:g.isActivated,dbName:g.dbName}},hydrateView({viewData:g,entityData:E,relatedSchemas:O}){let w=E[0],K=Hi(E,O);return{name:g.name,keys:g.keys,comment:w.description,orReplace:w.orReplace,temporary:w.temporary,recursive:w.recursive,viewOptions:w.viewOptions,selectStatement:w.selectStatement,withCheckOption:w.withCheckOption,checkTestingScope:w.withCheckOption?w.checkTestingScope:"",schemaName:g.schemaData.schemaName,triggers:K}},commentIfDeactivated(g,E,O){return g},alterColumnType(g,E,O,w){let K=O;return w.length?K+=`(${w.length})`:w.precision&&w.scale?K+=`(${w.precision},${w.scale})`:w.precision&&(K+=`(${w.precision})`),y(x.alterColumnType,{tableName:g,columnName:E,dataType:K})},setNotNullConstraint(g,E){return y(x.addNotNullConstraint,{tableName:g,columnName:E})},dropNotNullConstraint(g,E){return y(x.dropNotNullConstraint,{tableName:g,columnName:E})},renameColumn(g,E,O){return y(x.renameColumn,{tableName:g,oldColumnName:E,newColumnName:O})},addCheckConstraint(g,E,O){let w={tableName:g,constraintName:E,expression:O};return y(x.addCheckConstraint,w)},dropConstraint(g,E){let O={tableName:g,constraintName:E};return y(x.dropConstraint,O)},updateTableComment(g,E){let O={tableName:g,comment:E};return y(x.updateCommentOnTable,O)},dropTableComment(g){let E={tableName:g,comment:"NULL"};return y(x.updateCommentOnTable,E)},updateColumnComment(g,E){let O={columnName:g,comment:E};return y(x.updateCommentOnColumn,O)},dropColumnComment(g){let E={columnName:g,comment:"NULL"};return y(x.updateCommentOnColumn,E)},updateSchemaComment(g,E){let O={schemaName:g,comment:E};return y(x.updateCommentOnSchema,O)},dropSchemaComment(g){let E={schemaName:g,comment:"NULL"};return y(x.updateCommentOnSchema,E)},updateViewComment(g,E){let O={viewName:g,comment:E};return y(x.updateCommentOnView,O)},dropViewComment(g){let E={viewName:g,comment:"NULL"};return y(x.updateCommentOnView,E)},createSchemaOnly(g){let E={schemaName:g};return y(x.createSchemaOnly,E)},dropSchema(g){let E={schemaName:g};return y(x.dropSchema,E)},dropTable(g){let E={tableName:g};return y(x.dropTable,E)},addColumn(g,E){let O={tableName:g,columnDefinition:E};return y(x.addColumn,O)},dropColumn(g,E){let O={tableName:g,columnName:E};return y(x.dropColumn,O)},dropDomain(g){let E={udtName:g};return y(x.dropDomain,E)},dropType(g){let E={udtName:g};return y(x.dropType,E)},alterTypeAddAttribute(g,E){let O={udtName:g,columnDefinition:E};return y(x.alterTypeAddAttribute,O)},alterTypeDropAttribute(g,E){let O={udtName:g,attributeName:E};return y(x.alterTypeDropAttribute,O)},alterTypeRenameAttribute(g,E,O){let w={udtName:g,oldAttributeName:E,newAttributeName:O};return y(x.alterTypeRenameAttribute,w)},alterTypeChangeAttributeType(g,E,O){let w={udtName:g,attributeName:E,newDataType:O};return y(x.alterTypeChangeAttributeType,w)},dropForeignKey(g,E){let O={tableName:g,fkConstraintName:E};return y(x.dropForeignKey,O)},createKeyConstraint(g,E,O){let w=I(x,E)(O);return{statement:y(x.addPkConstraint,{constraintStatement:(w.statement||"").trim(),tableName:g}),isActivated:w.isActivated}},dropKeyConstraint(g,E){let O={tableName:g,constraintName:E};return y(x.dropConstraint,O)},createSchemaSequences({schemaName:g,sequences:E}){return P({schemaName:g,sequences:E})},createSchemaSequence({schemaName:g,sequence:E}){return X({schemaName:g,sequence:E})},dropSchemaSequence({schemaName:g,sequence:E}){return ve({schemaName:g,sequence:E})},alterSchemaSequence({schemaName:g,sequence:E,oldSequence:O}){return me({schemaName:g,sequence:E,oldSequence:O})},dropIndex({indexName:g}){let E={indexName:g};return y(x.dropIndex,E)},alterIndexRename({schemaName:g,oldIndexName:E,newIndexName:O}){let w=f(g),K=h(f(E),w),Z=f(O),Q={oldIndexName:K,newIndexName:Z};return y(x.alterIndexRename,Q)},alterIndexTablespace({schemaName:g,indexName:E,tablespaceName:O}){let w=f(g),Z={indexName:h(f(E),w),tablespaceName:O};return y(x.alterIndexTablespace,Z)},alterIndexStorageParams({schemaName:g,indexName:E,index:O}){let w=f(g),K=h(f(E),w),Z=ie(O),Q={indexName:K,options:Z};return y(x.alterIndexStorageParams,Q)},reindexIndex({schemaName:g,indexName:E}){let O=f(g),K={indexName:h(f(E),O)};return y(x.reindexIndex,K)}}}});var Mu=C((XA,Lu)=>{var{getModifySchemaCommentsScriptDtos:n_}=tu(),{AlterScriptDto:Pu}=ne(),s_=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t),{wrapInQuotes:s}=L()(r),a=n.createSchemaOnly(s(e));return Pu.getInstance([a],!0,!1)},"getAddContainerScriptDto"),i_=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t),{wrapInQuotes:s}=L()(r),a=n.dropSchema(s(e));return Pu.getInstance([a],!0,!0)},"getDeleteContainerScriptDto"),a_=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t);return[...n_(r,n)(e)]},"getModifyContainerScriptDtos");Lu.exports={getAddContainerScriptDto:s_,getDeleteContainerScriptDto:i_,getModifyContainerScriptDtos:a_}});var Uu=C((eN,Fu)=>{var{AlterCollectionDto:JA}=Ge(),{AlterScriptDto:mr}=ne(),o_=i(t=>e=>{var o;let r=(o=e==null?void 0:e.compMod)==null?void 0:o.chkConstr;if(!r)return[];let n=r.new||[],s=r.old||[];return t.chain([...n,...s]).map(c=>c.chkConstrName).uniq().value().map(c=>({old:t.find(s,{chkConstrName:c}),new:t.find(n,{chkConstrName:c})}))},"mapCheckConstraintNamesToChangeHistory"),c_=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=L()(t);return r.filter(a=>a.old&&!a.new).map(a=>{let o=s(a.old.chkConstrName);return e.dropConstraint(n,o)}).map(a=>mr.getInstance([a],!0,!0))},"getDropCheckConstraintScriptDtos"),u_=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=L()(t);return r.filter(a=>a.new&&!a.old).map(a=>{let{chkConstrName:o,constrExpression:c}=a.new;return e.addCheckConstraint(n,s(o),c)}).map(a=>mr.getInstance([a],!0,!1))},"getAddCheckConstraintScriptDtos"),l_=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=L()(t);return r.filter(a=>{if(a.old&&a.new){let o=a.old.constrExpression,c=a.new.constrExpression;return o!==c}return!1}).map(a=>{let{chkConstrName:o}=a.old,c=e.dropConstraint(n,s(o)),{chkConstrName:u,constrExpression:l}=a.new,p=e.addCheckConstraint(n,s(u),l);return[mr.getInstance([c],!0,!0),mr.getInstance([p],!0,!1)]}).flat()},"getUpdateCheckConstraintScriptDtos"),p_=i((t,e)=>r=>{let{getFullTableName:n}=L()(t),s=n(r),a=o_(t)(r),o=u_(t,e)(a,s),c=c_(t,e)(a,s),u=l_(t,e)(a,s);return[...o,...c,...u]},"getModifyCheckConstraintScriptDtos");Fu.exports={getModifyCheckConstraintScriptDtos:p_}});var Bu=C((nN,$u)=>{var{AlterScriptDto:ku}=ne(),{AlterCollectionDto:rN}=Ge(),m_=i((t,e)=>r=>{var m;let{getFullTableName:n,wrapComment:s}=L()(t),a=(m=r==null?void 0:r.role.compMod)==null?void 0:m.description;if(!a)return;let{old:o,new:c}=a;if(!c||c===o)return;let u=n(r),l=s(c),p=e.updateTableComment(u,l);return ku.getInstance([p],!0,!1)},"getUpdatedCommentOnCollectionScriptDto"),d_=i((t,e)=>r=>{var l;let{getFullTableName:n}=L()(t),s=(l=r==null?void 0:r.role.compMod)==null?void 0:l.description;if(!s)return;let{old:a,new:o}=s;if(!a||o)return;let c=n(r),u=e.dropTableComment(c);return ku.getInstance([u],!0,!0)},"getDeletedCommentOnCollectionScriptDto"),f_=i((t,e)=>r=>{let n=m_(t,e)(r),s=d_(t,e)(r);return[n,s].filter(Boolean)},"getModifyEntityCommentsScriptDtos");$u.exports={getModifyEntityCommentsScriptDtos:f_}});var Gu=C((iN,Ku)=>{var{AlterScriptDto:h_}=ne(),g_=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.length,a=r==null?void 0:r.length;return s!==a},"hasLengthChanged"),y_=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.precision,a=r==null?void 0:r.precision,o=n==null?void 0:n.scale,c=r==null?void 0:r.scale;return s!==a||o!==c},"hasPrecisionOrScaleChanged"),__=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:a}=L()(t),o=s(r);return t.toPairs(r.properties).filter(([c,u])=>{let l=n(u.compMod,["type","mode"]);if(!l){let p=u.compMod.oldField.name,m=g_(r,p,u),d=y_(r,p,u);return m||d}return l}).map(([c,u])=>{let l=u.compMod.newField.mode||u.compMod.newField.type,p=a(c),m=t.pick(u,["length","precision","scale"]);return e.alterColumnType(o,p,l,m)}).map(c=>h_.getInstance([c],!0,!1))},"getUpdateTypesScriptDtos");Ku.exports={getUpdateTypesScriptDtos:__}});var Wu=C((oN,Hu)=>{var{AlterScriptDto:Vu}=ne(),E_=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s}=L()(t),a=n(r),o=r.required||[],c=r.role.required||[],u=t.difference(o,c),l=t.difference(c,o),p=t.toPairs(r.properties).filter(([d,f])=>{let h=f.compMod.oldField.name,T=l.includes(h);return u.includes(d)&&!T}).map(([d])=>e.setNotNullConstraint(a,s(d))).map(d=>Vu.getInstance([d],!0,!1)),m=t.toPairs(r.properties).filter(([d,f])=>{let h=f.compMod.oldField.name,T=l.includes(h),_=u.includes(d);return T&&!_}).map(([d])=>e.dropNotNullConstraint(a,s(d))).map(d=>Vu.getInstance([d],!0,!0));return[...p,...m]},"getModifyNonNullColumnsScriptDtos");Hu.exports={getModifyNonNullColumnsScriptDtos:E_}});var ju=C((uN,Yu)=>{var{AlterScriptDto:Qu}=ne(),T_=i((t,e)=>r=>{let{getFullColumnName:n,wrapComment:s}=L()(t);return t.toPairs(r.properties).filter(([a,o])=>{var p;let c=o.description,u=o.compMod.oldField.name,l=(p=r.role.properties[u])==null?void 0:p.description;return c&&(!l||c!==l)}).map(([a,o])=>{let c=o.description,u=s(c),l=n(r,a);return e.updateColumnComment(l,u)}).map(a=>Qu.getInstance([a],!0,!1))},"getUpdatedCommentOnColumnScriptDtos"),S_=i((t,e)=>r=>{let{getFullColumnName:n}=L()(t);return t.toPairs(r.properties).filter(([s,a])=>{var l;let o=a.description,c=a.compMod.oldField.name;return((l=r.role.properties[c])==null?void 0:l.description)&&!o}).map(([s,a])=>{let o=n(r,s);return e.dropColumnComment(o)}).map(s=>Qu.getInstance([s],!0,!0))},"getDeletedCommentOnColumnScriptDtos"),C_=i((t,e)=>r=>{let n=T_(t,e)(r),s=S_(t,e)(r);return[...n,...s]},"getModifiedCommentOnColumnScriptDtos");Yu.exports={getModifiedCommentOnColumnScriptDtos:C_}});var Xu=C((pN,zu)=>{var{AlterScriptDto:A_}=ne(),N_=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:a}=L()(t),o=s(r);return t.values(r.properties).filter(c=>n(c.compMod,["name"])).map(c=>{let u=a(c.compMod.oldField.name),l=a(c.compMod.newField.name);return e.renameColumn(o,u,l)}).map(c=>A_.getInstance([c],!0,!1))},"getRenameColumnScriptDtos");zu.exports={getRenameColumnScriptDtos:N_}});var ei=C((dN,Zu)=>{var Zs=class Zs{didTransitionHappen;wasPkChangedInTransition;static noTransition(){return{didTransitionHappen:!1}}static transition(e){return{didTransitionHappen:!0,wasPkChangedInTransition:e}}};i(Zs,"KeyTransitionDto");var zs=Zs,Js=class Js{script;isDropScript;fullTableName;isActivated;constructor(e,r,n,s){this.script=e,this.isDropScript=n,this.fullTableName=r,this.isActivated=s}};i(Js,"KeyScriptModificationDto");var Xs=Js;Zu.exports={KeyScriptModificationDto:Xs,KeyTransitionDto:zs}});var nl=C((TN,rl)=>{var{AlterScriptDto:b_}=ne(),{AlterCollectionDto:hN,AlterCollectionColumnDto:gN,AlterCollectionRoleCompModPKDto:yN,AlterCollectionColumnKeyOptionDto:_N,AlterCollectionRoleCompModPrimaryKey:EN}=Ge(),{KeyTransitionDto:Ee,KeyScriptModificationDto:dr}=ei(),ct=1,ti=i(t=>`${t}_pkey`,"getDefaultConstraintName"),Ju=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularPkOptions"),ut=i(t=>(t.primaryKeyOptions||[]).map(r=>Ju(r)),"getCustomPropertiesOfRegularPkForComparisonWithRegularPkOptions"),fr=i(t=>[Ju(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositePkForComparisonWithRegularPkOptions"),v_=i(t=>e=>{var p,m;let n=(((m=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:m.primaryKey)||{}).old||[],s=n.flatMap(d=>d.compositePrimaryKey.map(f=>f.keyId));if(s.length!==ct)return Ee.noTransition();let a=s[0],o=Object.values(e.properties).find(d=>d.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return Ee.noTransition();let u=ut(o),l=n.some(d=>{if(d.compositePrimaryKey.length!==ct)return!1;let f=fr(d);return t(f).differenceWith(u,t.isEqual).isEmpty()});return Ee.transition(!l)},"wasCompositePkChangedInTransitionFromCompositeToRegular"),I_=i(t=>e=>{var p,m;let n=(((m=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:m.primaryKey)||{}).new||[],s=n.flatMap(d=>d.compositePrimaryKey.map(f=>f.keyId));if(s.length!==ct)return Ee.noTransition();let a=s[0],o=Object.values(e.role.properties).find(d=>d.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return Ee.noTransition();let u=ut(o),l=n.some(d=>{if(d.compositePrimaryKey.length!==ct)return!1;let f=fr(d);return t(f).differenceWith(u,t.isEqual).isEmpty()});return Ee.transition(!l)},"wasCompositePkChangedInTransitionFromRegularToComposite"),O_=i((t,e)=>t.constraintName?t.constraintName:ti(e),"getConstraintNameForCompositePk"),R_=i(t=>(e,r,n)=>{let s=O_(e,r),a=t.toPairs(n.role.properties).filter(([l,p])=>!!e.compositePrimaryKey.find(m=>m.keyId===p.GUID)).map(([l,p])=>({name:l,isActivated:p.isActivated})),o="",c="",u=[];return e.indexStorageParameters&&(o=e.indexStorageParameters),e.indexTablespace&&(c=e.indexTablespace),e.indexInclude&&(u=t.toPairs(n.role.properties).filter(([l,p])=>!!e.indexInclude.find(m=>m.keyId===p.GUID)).map(([l,p])=>({name:l,isActivated:p.isActivated}))),{name:s,keyType:"PRIMARY KEY",columns:a,include:u,storageParameters:o,tablespace:c}},"getCreateCompositePKDDLProviderConfig"),w_=i((t,e)=>r=>{var f,h;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=L()(t),o=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.primaryKey)||{},c=o.new||[],u=o.old||[];if(c.length===0&&u.length===0)return[];let l=I_(t)(r);if(l.didTransitionHappen&&!l.wasPkChangedInTransition)return[];if(c.length===u.length&&t(u).differenceWith(c,t.isEqual).isEmpty())return[];let p=s(r),m=n(p),d=a(p);return c.map(T=>{let _=R_(t)(T,d,r),y=e.createKeyConstraint(m,r.isActivated,_);return new dr(y.statement,m,!1,y.isActivated)}).filter(T=>!!T.script)},"getAddCompositePkScriptDtos"),D_=i((t,e)=>r=>{var h,T;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=((T=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:T.primaryKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let p=v_(t)(r);if(p.didTransitionHappen&&!p.wasPkChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let m=s(r),d=n(m),f=a(m);return l.map(_=>{let y=ti(f);_.constraintName&&(y=_.constraintName);let N=o(y),S=e.dropKeyConstraint(d,N);return new dr(S,d,!0,r.isActivated)}).filter(_=>!!_.script)},"getDropCompositePkScriptDtos"),q_=i((t,e)=>r=>{let n=D_(t,e)(r),s=w_(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyCompositePkScriptDtos"),el=i((t,e)=>{let r=t.primaryKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return ti(e)},"getConstraintNameForRegularPk"),x_=i(t=>(e,r,n,s)=>{let a=el(r,n),o=[{name:e,isActivated:r.isActivated}],c="",u="",l=[],p=r.primaryKeyOptions;if(p!=null&&p.length&&(p==null?void 0:p.length)>0){let m=p[0];m.indexStorageParameters&&(c=m.indexStorageParameters),m.indexTablespace&&(u=m.indexTablespace),m.indexInclude&&(l=t.toPairs(s.role.properties).filter(([d,f])=>!!m.indexInclude.find(h=>h.keyId===f.GUID)).map(([d,f])=>({name:d,isActivated:f.isActivated})))}return{name:a,keyType:"PRIMARY KEY",columns:o,include:l,storageParameters:c,tablespace:u}},"getCreateRegularPKDDLProviderConfig"),P_=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);return a&&!o},"wasFieldChangedToBeARegularPk"),L_=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);if(!(a&&o))return Ee.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.primaryKey)||{},u=c.new||[],l=c.old||[],p=l.some(T=>T.compositePrimaryKey.some(_=>_.keyId===s.GUID)),m=u.some(T=>T.compositePrimaryKey.some(_=>_.keyId===e.GUID));if(a&&(p&&!m)){let T=ut(e),_=l.some(y=>{if(y.compositePrimaryKey.length!==ct)return!1;let N=fr(y);return t(N).differenceWith(T,t.isEqual).isEmpty()});return Ee.transition(!_)}return Ee.noTransition()},"wasRegularPkChangedInTransitionFromCompositeToRegular"),M_=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=s.primaryKey&&!s.compositePrimaryKey,o=!!(e!=null&&e.primaryKey);if(!(a&&o))return Ee.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.primaryKey)||{},u=c.new||[],p=(c.old||[]).some(T=>T.compositePrimaryKey.some(_=>_.keyId===s.GUID)),d=u.some(T=>T.compositePrimaryKey.some(_=>_.keyId===e.GUID))&&!p;if(a&&d){let T=ut(s),_=u.some(y=>{if(y.compositePrimaryKey.length!==ct)return!1;let N=fr(y);return t(N).differenceWith(T,t.isEqual).isEmpty()});return Ee.transition(!_)}return Ee.noTransition()},"wasRegularPkChangedInTransitionFromRegularToComposite"),F_=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey),o=!e.primaryKey&&!e.compositePrimaryKey;return a&&o},"isFieldNoLongerARegularPk"),tl=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},a=e.primaryKey&&!e.compositePrimaryKey,o=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey);if(!(a&&o))return!1;let c=ut(e),u=ut(s);return!t(u).differenceWith(c,t.isEqual).isEmpty()},"wasRegularPkModified"),U_=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=L()(t),o=s(r),c=n(o),u=a(o);return t.toPairs(r.properties).filter(([l,p])=>{if(P_(t)(p,r))return!0;let m=L_(t)(p,r);return m.didTransitionHappen?m.wasPkChangedInTransition:tl(t)(p,r)}).map(([l,p])=>{let m=x_(t)(l,p,u,r),d=e.createKeyConstraint(c,r.isActivated,m);return new dr(d.statement,c,!1,d.isActivated)}).filter(l=>!!l.script)},"getAddPkScriptDtos"),k_=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=s(r),u=n(c),l=a(c);return t.toPairs(r.properties).filter(([p,m])=>{if(F_(t)(m,r))return!0;let d=M_(t)(m,r);return d.didTransitionHappen?d.wasPkChangedInTransition:tl(t)(m,r)}).map(([p,m])=>{let d=m.compMod.oldField.name,f=r.role.properties[d],h=o(el(f,l)),T=e.dropKeyConstraint(u,h);return new dr(T,u,!0,r.isActivated)}).filter(p=>!!p.script)},"getDropPkScriptDto"),$_=i((t,e)=>r=>{let n=k_(t,e)(r),s=U_(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyPkScriptDtos"),B_=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyPkConstraints"),K_=i((t,e)=>r=>{let n=q_(t,e)(r),s=$_(t,e)(r),a=[...n,...s];return B_(a).map(c=>b_.getInstance([c.script],c.isActivated,c.isDropScript)).filter(Boolean)},"getModifyPkConstraintsScriptDtos");rl.exports={getModifyPkConstraintsScriptDtos:K_}});var cl=C((IN,ol)=>{var{AlterScriptDto:G_}=ne(),{AlterCollectionDto:CN,AlterCollectionColumnDto:AN,AlterCollectionRoleCompModUniqueKeyDto:NN,AlterCollectionColumnKeyOptionDto:bN,AlterCollectionRoleCompModUniqueKey:vN}=Ge(),{KeyTransitionDto:Te,KeyScriptModificationDto:hr}=ei(),lt=1,ri=i(t=>`${t}_ukey`,"getDefaultConstraintName"),sl=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularUniqueKeyOptions"),pt=i(t=>(t.uniqueKeyOptions||[]).map(r=>sl(r)),"getCustomPropertiesOfRegularUniqueKeyForComparisonWithRegularUniqueKeyOptions"),gr=i(t=>[sl(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositeUniqueKeyForComparisonWithRegularUniqueKeyOptions"),V_=i(t=>e=>{var p,m;let n=(((m=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:m.uniqueKey)||{}).old||[],s=n.flatMap(d=>d.compositeUniqueKey.map(f=>f.keyId));if(s.length!==lt)return Te.noTransition();let a=s[0],o=Object.values(e.properties).find(d=>d.GUID===a);if(!o||!((o==null?void 0:o.unique)&&!(o!=null&&o.compositeUniqueKey)))return Te.noTransition();let u=pt(o),l=n.some(d=>{if(d.compositeUniqueKey.length!==lt)return!1;let f=gr(d);return t(f).differenceWith(u,t.isEqual).isEmpty()});return Te.transition(!l)},"wasCompositeUniqueKeyChangedInTransitionFromCompositeToRegular"),H_=i(t=>e=>{var p,m;let n=(((m=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:m.uniqueKey)||{}).new||[],s=n.flatMap(d=>d.compositeUniqueKey.map(f=>f.keyId));if(s.length!==lt)return Te.noTransition();let a=s[0],o=Object.values(e.role.properties).find(d=>d.GUID===a);if(!o||!((o==null?void 0:o.unique)&&!(o!=null&&o.compositeUniqueKey)))return Te.noTransition();let u=pt(o),l=n.some(d=>{if(d.compositeUniqueKey.length!==lt)return!1;let f=gr(d);return t(f).differenceWith(u,t.isEqual).isEmpty()});return Te.transition(!l)},"wasCompositeUniqueKeyChangedInTransitionFromRegularToComposite"),W_=i((t,e)=>t.constraintName?t.constraintName:ri(e),"getConstraintNameForCompositeUniqueKey"),Q_=i(t=>(e,r,n,s)=>{let{clean:a,getDbVersion:o}=L()(t),c=pr()(t,a),u=W_(e,r),l=t.toPairs(n.role.properties).filter(([_,y])=>!!e.compositeUniqueKey.find(N=>N.keyId===y.GUID)).map(([_,y])=>({name:_,isActivated:y.isActivated})),p="",m="",d=[],f=e.deferrable,h=e.deferrableConstraintCheckTime;e.indexStorageParameters&&(p=e.indexStorageParameters),e.indexTablespace&&(m=e.indexTablespace),e.indexInclude&&(d=t.toPairs(n.role.properties).filter(([_,y])=>!!e.indexInclude.find(N=>N.keyId===y.GUID)).map(([_,y])=>({name:_,isActivated:y.isActivated})));let T=c.getUniqueKeyType(e,o(s));return{name:u,keyType:T,columns:l,include:d,storageParameters:p,tablespace:m,deferrable:f,deferrableConstraintCheckTime:h}},"getCreateCompositeUniqueKeyDDLProviderConfig"),Y_=i((t,e)=>(r,n)=>{var h,T;let{getFullCollectionName:s,getSchemaOfAlterCollection:a,getEntityName:o}=L()(t),c=((T=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:T.uniqueKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let p=H_(t)(r);if(p.didTransitionHappen&&!p.wasUniqueKeyChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let m=a(r),d=s(m),f=o(m);return u.map(_=>{let y=Q_(t)(_,f,r,n),N=e.createKeyConstraint(d,r.isActivated,y);return new hr(N.statement,d,!1,N.isActivated)}).filter(_=>!!_.script)},"getAddCompositeUniqueKeyScriptDtos"),j_=i((t,e)=>r=>{var h,T;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=((T=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:T.uniqueKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let p=V_(t)(r);if(p.didTransitionHappen&&!p.wasUniqueKeyChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let m=s(r),d=n(m),f=a(m);return l.map(_=>{let y=ri(f);_.constraintName&&(y=_.constraintName);let N=o(y),S=e.dropKeyConstraint(d,N);return new hr(S,d,!0,r.isActivated)}).filter(_=>!!_.script)},"getDropCompositeUniqueKeyScriptDtos"),z_=i((t,e)=>(r,n)=>{let s=j_(t,e)(r),a=Y_(t,e)(r,n);return[...s,...a].filter(Boolean)},"getModifyCompositeUniqueKeyScriptDtos"),il=i((t,e)=>{let r=t.uniqueKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return ri(e)},"getConstraintNameForRegularUniqueKey"),X_=i(t=>(e,r,n,s,a)=>{let{clean:o,getDbVersion:c}=L()(t),u=pr()(t,o),l=il(r,n),p=[{name:e,isActivated:r.isActivated}],m="",d="",f=[],h="",T="",_="",y=r.uniqueKeyOptions;if(y!=null&&y.length&&(y==null?void 0:y.length)>0){let S=y[0];S.indexStorageParameters&&(m=S.indexStorageParameters),S.indexTablespace&&(d=S.indexTablespace),S.indexInclude&&(f=t.toPairs(s.role.properties).filter(([b,I])=>!!S.indexInclude.find(R=>R.keyId===I.GUID)).map(([b,I])=>({name:b,isActivated:I.isActivated}))),h=S.deferrable,T=S.deferrableConstraintCheckTime,_=S.nullsDistinct}let N=u.getUniqueKeyType({nullsDistinct:_},c(a));return{name:l,keyType:N,columns:p,include:f,storageParameters:m,tablespace:d,deferrable:h,deferrableConstraintCheckTime:T}},"getCreateRegularUniqueKeyDDLProviderConfig"),Z_=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)||s.compositeUniqueKey;return a&&!o},"wasFieldChangedToBeARegularUniqueKey"),J_=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)||s.compositeUniqueKey;if(!(a&&o))return Te.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.uniqueKey)||{},u=c.new||[],l=c.old||[],p=l.some(T=>T.compositeUniqueKey.some(_=>_.keyId===s.GUID)),m=u.some(T=>T.compositeUniqueKey.some(_=>_.keyId===e.GUID));if(a&&(p&&!m)){let T=pt(e),_=l.some(y=>{if(y.compositeUniqueKey.length!==lt)return!1;let N=gr(y);return t(N).differenceWith(T,t.isEqual).isEmpty()});return Te.transition(!_)}return Te.noTransition()},"wasRegularUniqueKeyChangedInTransitionFromCompositeToRegular"),eE=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=s.unique&&!s.compositeUniqueKey,o=!!(e!=null&&e.unique);if(!(a&&o))return Te.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.uniqueKey)||{},u=c.new||[],p=(c.old||[]).some(T=>T.compositeUniqueKey.some(_=>_.keyId===s.GUID)),d=u.some(T=>T.compositeUniqueKey.some(_=>_.keyId===e.GUID))&&!p;if(a&&d){let T=pt(s),_=u.some(y=>{if(y.compositeUniqueKey.length!==lt)return!1;let N=gr(y);return t(N).differenceWith(T,t.isEqual).isEmpty()});return Te.transition(!_)}return Te.noTransition()},"wasRegularUniqueKeyChangedInTransitionFromRegularToComposite"),tE=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=(s==null?void 0:s.unique)&&!(s!=null&&s.compositeUniqueKey),o=!e.unique&&!e.compositeUniqueKey;return a&&o},"isFieldNoLongerARegularUniqueKey"),al=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)&&!(s!=null&&s.compositeUniqueKey);if(!(a&&o))return!1;let c=pt(e),u=pt(s);return!t(u).differenceWith(c,t.isEqual).isEmpty()},"wasRegularUniqueKeyModified"),rE=i((t,e)=>(r,n)=>{let{getFullCollectionName:s,getSchemaOfAlterCollection:a,getEntityName:o}=L()(t),c=a(r),u=s(c),l=o(c);return t.toPairs(r.properties).filter(([p,m])=>{if(Z_(t)(m,r))return!0;let d=J_(t)(m,r);return d.didTransitionHappen?d.wasUniqueKeyChangedInTransition:al(t)(m,r)}).map(([p,m])=>{let d=X_(t)(p,m,l,r,n),f=e.createKeyConstraint(u,r.isActivated,d);return new hr(f.statement,u,!1,f.isActivated)}).filter(p=>!!p.script)},"getAddUniqueKeyScriptDtos"),nE=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=s(r),u=n(c),l=a(c);return t.toPairs(r.properties).filter(([p,m])=>{if(tE(t)(m,r))return!0;let d=eE(t)(m,r);return d.didTransitionHappen?d.wasUniqueKeyChangedInTransition:al(t)(m,r)}).map(([p,m])=>{let d=m.compMod.oldField.name,f=r.role.properties[d],h=o(il(f,l)),T=e.dropKeyConstraint(u,h);return new hr(T,u,!0,r.isActivated)}).filter(p=>!!p.script)},"getDropUniqueKeyScriptDto"),sE=i((t,e)=>(r,n)=>{let s=nE(t,e)(r),a=rE(t,e)(r,n);return[...s,...a].filter(Boolean)},"getModifyUniqueKeyScriptDtos"),iE=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyUniqueKeyConstraints"),aE=i(({_:t,ddlProvider:e})=>({collection:r,dbVersion:n})=>{let s=z_(t,e)(r,n),a=sE(t,e)(r,n),o=[...s,...a];return iE(o).map(u=>G_.getInstance([u.script],u.isActivated,u.isDropScript)).filter(Boolean)},"getModifyUniqueKeyConstraintsScriptDtos");ol.exports={getModifyUniqueKeyConstraintsScriptDtos:aE}});var gl=C((DN,hl)=>{var{AlterCollectionDto:RN}=Ge(),{AlterIndexDto:wN}=Ps(),{AlterScriptDto:mt}=ne(),oE=i(({_:t})=>({columnId:e,collection:r})=>{var c,u,l;let n=t.toPairs(((c=r==null?void 0:r.role)==null?void 0:c.properties)||(r==null?void 0:r.properties)||{}).map(([p,m])=>({...m,name:p})),s=(((l=(u=r==null?void 0:r.role)==null?void 0:u.compMod)==null?void 0:l.oldProperties)||[]).map(p=>({...p,GUID:p.id})),o=(n.length>0?n:s).find(p=>p.GUID===e);if(o)return o.name},"getColumnNameById"),ul=i(({_:t})=>({columns:e,collection:r})=>(e||[]).map(n=>({...n,name:oE({_:t})({columnId:n.keyId,collection:r})})).filter(n=>!!n.name),"setNamesToColumns"),cE=i(({_:t})=>({index:e,collection:r})=>{let{getSchemaNameFromCollection:n}=L()(t),s=n({collection:r}),a=ul({_:t})({columns:e.columns,collection:r}),o=ul({_:t})({columns:e.include,collection:r});return{...e,schemaName:s,columns:a,include:o}},"mapIndexToFeIndexDto"),ll=i(({_:t})=>({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})=>{let s=t.pick(r,n),a=t.pick(e,n);return!t.isEqual(s,a)},"areIndexesDifferent"),uE=i(({_:t})=>({oldIndex:e,newIndex:r})=>{let n=["index_method","columns","include","nullsDistinct","where"];return ll({_:t})({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})},"shouldDropAndRecreateIndex"),lE=i(({_:t})=>({oldIndex:e,newIndex:r})=>{let n=["indxName","index_tablespace_name","index_storage_parameter"];return ll({_:t})({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})},"shouldAlterIndex"),ni=i(({oldIndex:t,newIndex:e})=>t.id===e.id||t.indxName===e.indxName,"areOldIndexDtoAndNewIndexDtoDescribingSameDatabaseIndex"),pl=i(({_:t,ddlProvider:e})=>({index:r,collection:n,additionalDataForDdlProvider:s})=>{let{dbData:a,tableName:o,isParentActivated:c}=s,u=cE({_:t})({index:r,collection:n}),l=e.createIndex(o,u,a,c),p=u.isActivated&&c;return mt.getInstance([l],p,!1)},"getCreateIndexScriptDto"),ml=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l;let s=((o=r==null?void 0:r.role)==null?void 0:o.Indxs)||[],a=((l=(u=(c=r==null?void 0:r.role)==null?void 0:c.compMod)==null?void 0:u.Indxs)==null?void 0:l.old)||[];return s.filter(p=>!a.find(d=>ni({oldIndex:d,newIndex:p}))).map(p=>pl({_:t,ddlProvider:e})({index:p,collection:r,additionalDataForDdlProvider:n})).filter(Boolean)},"getAddedIndexesScriptDtos"),dl=i(({_:t,ddlProvider:e})=>({index:r,additionalDataForDdlProvider:n})=>{let{getNamePrefixedWithSchemaName:s}=L()(t),{isParentActivated:a,schemaName:o}=n,c=s(r.indxName,o),u=e.dropIndex({indexName:c}),l=r.isActivated&&a;return mt.getInstance([u],l,!0)},"getDeleteIndexScriptDto"),pE=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l,p,m;let s=((u=(c=(o=r==null?void 0:r.role)==null?void 0:o.compMod)==null?void 0:c.Indxs)==null?void 0:u.new)||[];return(((m=(p=(l=r==null?void 0:r.role)==null?void 0:l.compMod)==null?void 0:p.Indxs)==null?void 0:m.old)||[]).filter(d=>!s.find(h=>ni({oldIndex:d,newIndex:h}))).map(d=>dl({_:t,ddlProvider:e})({index:d,additionalDataForDdlProvider:n})).filter(Boolean)},"getDeletedIndexesScriptDtos"),mE=i(({_:t,ddlProvider:e})=>({newIndex:r,oldIndex:n,additionalDataForDdlProvider:s})=>{let a=[],{isParentActivated:o,schemaName:c}=s,u=r.isActivated&&o;if(!t.isEqual(r.indxName,n.indxName)){let d=e.alterIndexRename({schemaName:c,oldIndexName:n.indxName,newIndexName:r.indxName}),f=mt.getInstance([d],u,!1);a.push(f)}if(!t.isEqual(r.index_tablespace_name,n.index_tablespace_name)){let d=e.alterIndexTablespace({schemaName:c,indexName:r.indxName,tablespaceName:r.index_tablespace_name}),f=mt.getInstance([d],u,!1);a.push(f)}if(!t.isEqual(r.index_storage_parameter,n.index_storage_parameter)){let d=e.alterIndexStorageParams({schemaName:c,indexName:r.indxName,index:r}),f=mt.getInstance([d],u,!1);a.push(f);let h=e.reindexIndex({schemaName:c,indexName:r.indxName}),T=mt.getInstance([h],u,!1);a.push(T)}return a.filter(Boolean)},"getAlterIndexScriptDtos"),dE=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l,p,m;let s=((u=(c=(o=r==null?void 0:r.role)==null?void 0:o.compMod)==null?void 0:c.Indxs)==null?void 0:u.new)||[],a=((m=(p=(l=r==null?void 0:r.role)==null?void 0:l.compMod)==null?void 0:p.Indxs)==null?void 0:m.old)||[];return s.map(d=>{let f=a.find(h=>ni({oldIndex:h,newIndex:d}));if(f)return{newIndex:d,oldIndex:f}}).filter(Boolean).flatMap(({newIndex:d,oldIndex:f})=>{if(uE({_:t})({newIndex:d,oldIndex:f})){let _=dl({_:t,ddlProvider:e})({index:f,additionalDataForDdlProvider:n}),y=pl({_:t,ddlProvider:e})({index:d,collection:r,additionalDataForDdlProvider:n});return[_,y]}return lE({_:t})({oldIndex:f,newIndex:d})?mE({_:t,ddlProvider:e})({oldIndex:f,newIndex:d,additionalDataForDdlProvider:n}):[]}).filter(Boolean)},"getModifiedIndexesScriptDtos"),fE=i(({_:t,ddlProvider:e})=>({collection:r,dbVersion:n})=>{let s=fl({_:t,dbVersion:n,collection:r}),a=pE({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s}),o=ml({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s}),c=dE({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s});return[...a,...o,...c].filter(Boolean)},"getModifyIndexesScriptDtos"),fl=i(({_:t,dbVersion:e,collection:r})=>{var s,a,o;let{getSchemaNameFromCollection:n}=L()(t);return{dbData:{dbVersion:e},tableName:((a=(s=r==null?void 0:r.compMod)==null?void 0:s.collectionName)==null?void 0:a.new)||((o=r==null?void 0:r.role)==null?void 0:o.name)||"",schemaName:n({collection:r})||"",isParentActivated:r.isActivated}},"getAdditionalDataForDdlProvider");hl.exports={getModifyIndexesScriptDtos:fE,getAddedIndexesScriptDtos:ml,getAdditionalDataForDdlProvider:fl}});var Mt=C((xN,yl)=>{yl.exports=t=>{let{createColumnDefinition:e}=t.require("@hackolade/ddl-fe-utils"),r=i(s=>s.$ref?s.$ref.split("/").pop():s.mode||s.childType||s.type,"getType");return{createColumnDefinitionBySchema:i(({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l})=>e({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l,getType:r}),"createColumnDefinitionBySchema")}}});var Cl=C((MN,Sl)=>{var{getModifyCheckConstraintScriptDtos:hE}=Uu(),{getModifyEntityCommentsScriptDtos:gE}=Bu(),{getUpdateTypesScriptDtos:yE}=Gu(),{getModifyNonNullColumnsScriptDtos:_E}=Wu(),{getModifiedCommentOnColumnScriptDtos:EE}=ju(),{getRenameColumnScriptDtos:TE}=Xu(),{AlterScriptDto:yr}=ne(),{AlterCollectionDto:LN}=Ge(),{getModifyPkConstraintsScriptDtos:SE}=nl(),{getModifyUniqueKeyConstraintsScriptDtos:CE}=cl(),{getModifyIndexesScriptDtos:AE,getAddedIndexesScriptDtos:NE,getAdditionalDataForDdlProvider:bE}=gl(),vE=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{getEntityName:c}=L()(o),{createColumnDefinitionBySchema:u}=Mt()(t),l=se()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),d={schemaName:a.compMod.keyspaceName,dbVersion:e},f={...a,...o.omit(a==null?void 0:a.role,"properties")||{}},h=o.toPairs(f.properties).map(([b,I])=>{let R=p({propertySchema:I,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return u({name:b,jsonSchema:I,parentJsonSchema:f,ddlProvider:l,schemaData:d,definitionJsonSchema:R})}),T=(f.chkConstr||[]).map(b=>l.createCheckConstraint(l.hydrateCheckConstraint(b))),_={name:c(f),columns:h.map(l.convertColumnDefinition),checkConstraints:T,foreignKeyConstraints:[],schemaData:d,columnDefinitions:h,dbData:{dbVersion:e}},y=l.hydrateTable({tableData:_,entityData:[f],jsonSchema:f}),N=El({_:o,ddlProvider:l,collection:a,dbVersion:e}).flatMap(({scripts:b})=>b.map(({script:I})=>I)),S=l.createTable(y,f.isActivated);return yr.getInstance([S,...N],!0,!1)},"getAddCollectionScriptDto"),IE=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t),{getFullTableName:s}=L()(r),a=s(e),o=n.dropTable(a);return yr.getInstance([o],!0,!0)},"getDeleteCollectionScriptDto"),OE=i(({app:t,dbVersion:e})=>r=>{let n=t.require("lodash"),s=se()(null,null,t),a=hE(n,s)(r),o=gE(n,s)(r),c=SE(n,s)(r),u=CE({_:n,ddlProvider:s})({collection:r,dbVersion:e}),l=AE({_:n,ddlProvider:s})({collection:r,dbVersion:e});return[...a,...o,...c,...u,...l].filter(Boolean)},"getModifyCollectionScriptDtos"),_l=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>(a,o)=>{var b;let c=t.require("lodash"),{getEntityName:u,getNamePrefixedWithSchemaName:l}=L()(c),{createColumnDefinitionBySchema:p}=Mt()(t),m=se()(null,null,t),{getDefinitionByReference:d}=t.require("@hackolade/ddl-fe-utils"),f={...a,...c.omit(a==null?void 0:a.role,"properties")||{}},h=u(f),T=(b=f.compMod)==null?void 0:b.keyspaceName,_=l(h,T),y={schemaName:T,dbVersion:e},N=c.toPairs(a.properties).filter(([I,R])=>o([I,R])).map(([I,R])=>{let M=d({propertySchema:R,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return p({name:I,jsonSchema:R,parentJsonSchema:f,ddlProvider:m,schemaData:y,definitionJsonSchema:M})}).map(m.convertColumnDefinition).map(I=>m.addColumn(_,I)).map(I=>yr.getInstance([I],!0,!1)),S=El({_:c,ddlProvider:m,collection:a});return N.concat(S).filter(Boolean)},"getAddColumnsByConditionScriptDtos"),El=i(({_:t,ddlProvider:e,dbVersion:r,collection:n})=>{var l,p;let s=((l=n==null?void 0:n.role)==null?void 0:l.Indxs)||[],a={...n==null?void 0:n.properties,...(p=n==null?void 0:n.role)==null?void 0:p.properties},o=Object.values(a).map(({GUID:m})=>m);if(s.length===0||o.length===0)return[];if(!s.some(({columns:m})=>m.find(({keyId:d})=>o.includes(d))))return[];let u=bE({_:t,dbVersion:r,collection:n});return NE({_:t,ddlProvider:e})({collection:n,additionalDataForDdlProvider:u})},"getNewlyCreatedIndexesScripts"),RE=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>_l({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(a,([o,c])=>!c.compMod),"getAddColumnScriptDtos"),Tl=i(t=>(e,r)=>{var d;let n=t.require("lodash"),s=se()(null,null,t),{getEntityName:a,getNamePrefixedWithSchemaName:o,wrapInQuotes:c}=L()(n),u={...e,...n.omit(e==null?void 0:e.role,"properties")||{}},l=a(u),p=(d=u.compMod)==null?void 0:d.keyspaceName,m=o(l,p);return n.toPairs(e.properties).filter(([f,h])=>r([f,h])).map(([f])=>{let h=c(f);return s.dropColumn(m,h)}).map(f=>yr.getInstance([f],!0,!0)).filter(Boolean)},"getDeleteColumnsByConditionScriptDtos"),wE=i(t=>e=>Tl(t)(e,([r,n])=>!n.compMod),"getDeleteColumnScriptDtos"),DE=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash");return o.toPairs(a.properties).filter(([c,u])=>{let l=u.compMod.oldField.name,p=a.role.properties[l];return p.generatedColumn!==u.generatedColumn||p.columnGenerationExpression!==u.columnGenerationExpression}).flatMap(([c,u])=>{let l={...a,properties:o.fromPairs([[c,u]])},p=Tl(t)(l,()=>!0),m=_l({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(l,()=>!0);return[...p,...m]}).filter(Boolean)},"getDropAndRecreateColumnsScriptDtos"),qE=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),c=se()(null,null,t),u=TE(o,c)(a),l=DE({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(a);if(l.length)return[...u,...l].filter(Boolean);let p=yE(o,c)(a),m=_E(o,c)(a),d=EE(o,c)(a);return[...u,...p,...m,...d].filter(Boolean)},"getModifyColumnScriptDtos");Sl.exports={getAddCollectionScriptDto:vE,getDeleteCollectionScriptDto:IE,getModifyCollectionScriptDtos:OE,getAddColumnScriptDtos:RE,getDeleteColumnScriptDtos:wE,getModifyColumnScriptDtos:qE}});var Nl=C((UN,Al)=>{var{AlterScriptDto:ze}=ne(),xE=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=Mt()(t),u=se()(null,null,t),{getDefinitionByReference:l}=t.require("@hackolade/ddl-fe-utils"),p={dbVersion:e},m=o.toPairs(a.properties||{}).map(([T,_])=>{let y=l({propertySchema:_,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:T,jsonSchema:_,parentJsonSchema:a,ddlProvider:u,schemaData:p,definitionJsonSchema:y})}),f={...c({name:a.code||a.name,jsonSchema:a,parentJsonSchema:{required:[]},definitionJsonSchema:{},ddlProvider:u,schemaData:p}),properties:m},h=u.createUdt(f);return ze.getInstance([h],!0,!1)},"getCreateUdtScriptDto"),PE=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t),{getUdtName:s,wrapInQuotes:a}=L()(r),o=a(s(e));if(e.type==="domain"){let c=n.dropDomain(o);return ze.getInstance([c],!0,!0)}else{let c=n.dropType(o);return ze.getInstance([c],!0,!0)}},"getDeleteUdtScriptDto"),LE=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=Mt()(t),{getUdtName:u,wrapInQuotes:l}=L()(o),p=se()(null,null,t),{getDefinitionByReference:m}=t.require("@hackolade/ddl-fe-utils"),d=l(u(a)),f={dbVersion:e};return o.toPairs(a.properties).filter(([h,T])=>!T.compMod).map(([h,T])=>{let _=m({propertySchema:T,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:h,jsonSchema:T,parentJsonSchema:{required:[]},ddlProvider:p,schemaData:f,definitionJsonSchema:_})}).map(p.convertColumnDefinition).map(h=>p.alterTypeAddAttribute(d,h)).map(h=>ze.getInstance([h],!0,!1)).filter(Boolean)},"getAddColumnToTypeScriptDtos"),ME=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t),{wrapInQuotes:s}=L()(r),a=s(e.code||e.name);return r.toPairs(e.properties).filter(([o,c])=>!c.compMod).map(([o])=>n.alterTypeDropAttribute(a,s(o))).map(o=>ze.getInstance([o],!0,!0)).filter(Boolean)},"getDeleteColumnFromTypeScriptDtos"),FE=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t),{checkFieldPropertiesChanged:s,wrapInQuotes:a}=L()(r),o=a(e.code||e.name),c=r.values(e.properties).filter(l=>s(l.compMod,["name"])).map(l=>{let p=a(l.compMod.oldField.name),m=a(l.compMod.newField.name);return n.alterTypeRenameAttribute(o,p,m)}).map(l=>ze.getInstance([l],!0,!1)),u=r.toPairs(e.properties).filter(([l,p])=>s(p.compMod,["type","mode"])).map(([l,p])=>{let m=a(l),d=p.compMod.newField.mode||p.compMod.newField.type;return n.alterTypeChangeAttributeType(o,m,d)}).map(l=>ze.getInstance([l],!0,!1));return[...c,...u].filter(Boolean)},"getModifyColumnOfTypeScriptDtos");Al.exports={getCreateUdtScriptDto:xE,getDeleteUdtScriptDto:PE,getAddColumnToTypeScriptDtos:LE,getDeleteColumnFromTypeScriptDtos:ME,getModifyColumnOfTypeScriptDtos:FE}});var Ol=C(($N,Il)=>{var{AlterScriptDto:bl}=ne(),vl=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),UE=i((t,e)=>r=>{let{getFullViewName:n,wrapComment:s}=L()(t),a=vl(r);if(a.new&&a.new!==a.old){let o=s(a.new),c=n(r),u=e.updateViewComment(c,o);return bl.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),kE=i((t,e)=>r=>{let n=vl(r),{getFullViewName:s}=L()(t);if(n.old&&!n.new){let a=s(r),o=e.dropViewComment(a);return bl.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),$E=i((t,e)=>r=>{let n=UE(t,e)(r),s=kE(t,e)(r);return[n,s].filter(Boolean)},"getModifyViewCommentsScriptDtos");Il.exports={getModifyViewCommentsScriptDtos:$E}});var Dl=C((KN,wl)=>{var{getModifyViewCommentsScriptDtos:BE}=Ol(),{AlterScriptDto:Rl}=ne(),KE=i(t=>e=>{let r=se()(null,null,t),n={name:e.code||e.name,keys:[],schemaData:{schemaName:""}},s=r.hydrateView({viewData:n,entityData:[e]}),a=r.createView(s,{},e.isActivated);return Rl.getInstance([a],!0,!1)},"getAddViewScriptDto"),GE=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t),{wrapInQuotes:s}=L()(r),a=s(e.code||e.name),o=n.dropView(a);return Rl.getInstance([o],!0,!0)},"getDeleteViewScriptDto"),VE=i(t=>e=>{let r=t.require("lodash"),n=se()(null,null,t);return[...BE(r,n)(e)].filter(Boolean)},"getModifyViewScriptDtos");wl.exports={getAddViewScriptDto:KE,getDeleteViewScriptDto:GE,getModifyViewScriptDtos:VE}});var xl=C((VN,ql)=>{var pi=class pi{isActivated;name};i(pi,"AlterRelationshipFKField");var si=pi,mi=class mi{bucket;collection};i(mi,"AlterRelationshipParentDto");var ii=mi,di=class di{bucket;collection};i(di,"AlterRelationshipChildDto");var ai=di,fi=class fi{relationshipOnDelete;relationshipOnUpdate;relationshipMatch};i(fi,"AlterRelationshipCustomProperties");var oi=fi,hi=class hi{created;deleted;modified;parent;child;name;description;customProperties;isActivated};i(hi,"AlterRelationshipRoleCompModDto");var ci=hi,gi=class gi{id;name;relationshipType;parentField;parentCardinality;childField;isActivated;childCardinality;parentCollection;childCollection;hackoladeStyles;compMod;roleType};i(gi,"AlterRelationshipRoleDto");var ui=gi,yi=class yi{type;isActivated;unique;subtype;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(yi,"AlterRelationshipDto");var li=yi;ql.exports={AlterRelationshipRoleCompModDto:ci,AlterRelationshipRoleDto:ui,AlterRelationshipDto:li,AlterRelationshipFKField:si,AlterRelationshipParentDto:ii,AlterRelationshipChildDto:ai,AlterRelationshipCustomProperties:oi}});var kl=C((QN,Ul)=>{var{AlterScriptDto:_i}=ne(),{AlterRelationshipDto:WN}=xl(),_r=i(t=>t.role.name,"getRelationshipName"),HE=i(t=>e=>{let{getNamePrefixedWithSchemaName:r}=L()(t),n=e.role.compMod,s=n.child.bucket.name,a=n.child.collection.name;return r(a,s)},"getFullChildTableName"),Pl=i((t,e)=>r=>{var a,o,c,u,l;let n=r.role.compMod,s=((a=n.name)==null?void 0:a.new)||_r(r)||"";return t.createForeignKey({name:s,foreignKey:n.child.collection.fkFields,primaryKey:n.parent.collection.fkFields,customProperties:(o=n.customProperties)==null?void 0:o.new,foreignTable:n.child.collection.name,foreignSchemaName:n.child.bucket.name,foreignTableActivated:n.child.collection.isActivated,primaryTable:n.parent.collection.name,primarySchemaName:n.parent.bucket.name,primaryTableActivated:n.parent.collection.isActivated,isActivated:!!((l=(u=(c=r.role)==null?void 0:c.compMod)==null?void 0:u.isActivated)!=null&&l.new)})},"getAddSingleForeignKeyStatementDto"),Ll=i(t=>{var r,n,s,a,o,c,u,l,p,m,d;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.new)||_r(t),(n=e.parent)==null?void 0:n.bucket,(s=e.parent)==null?void 0:s.collection,(c=(o=(a=e.parent)==null?void 0:a.collection)==null?void 0:o.fkFields)==null?void 0:c.length,(u=e.child)==null?void 0:u.bucket,(l=e.child)==null?void 0:l.collection,(d=(m=(p=e.child)==null?void 0:p.collection)==null?void 0:m.fkFields)==null?void 0:d.length].every(f=>!!f):!1},"canRelationshipBeAdded"),WE=i((t,e)=>r=>r.filter(n=>Ll(n)).map(n=>{let s=Pl(t,e)(n);return _i.getInstance([s.statement],s.isActivated,!1)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getAddForeignKeyScriptDtos"),Ml=i((t,e)=>r=>{var m,d,f,h;let{wrapInQuotes:n}=L()(e),s=r.role.compMod,a=HE(e)(r),o=((m=s.name)==null?void 0:m.old)||_r(r)||"",c=n(o),u=t.dropForeignKey(a,c),l=!!((h=(f=(d=r.role)==null?void 0:d.compMod)==null?void 0:f.isActivated)!=null&&h.new),p=s.child.collection.isActivated;return{statement:u,isActivated:l&&p}},"getDeleteSingleForeignKeyStatementDto"),Fl=i(t=>{var r,n,s;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.old)||_r(t),(n=e.child)==null?void 0:n.bucket,(s=e.child)==null?void 0:s.collection].every(a=>!!a):!1},"canRelationshipBeDeleted"),QE=i((t,e)=>r=>r.filter(n=>Fl(n)).map(n=>{let s=Ml(t,e)(n);return _i.getInstance([s.statement],s.isActivated,!0)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getDeleteForeignKeyScriptDtos"),YE=i((t,e)=>r=>r.filter(n=>Ll(n)&&Fl(n)).map(n=>{let s=Ml(t,e)(n),a=Pl(t,e)(n),o=a.isActivated&&s.isActivated;return _i.getDropAndRecreateInstance(s.statement,a.statement,o)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getModifyForeignKeyScriptDtos");Ul.exports={getDeleteForeignKeyScriptDtos:QE,getModifyForeignKeyScriptDtos:YE,getAddForeignKeyScriptDtos:WE}});var Ii=C((jN,$l)=>{var Ai=class Ai{message;stack};i(Ai,"PluginError");var Ei=Ai,Ni=class Ni{require};i(Ni,"App");var Ti=Ni,bi=class bi{log;clear};i(bi,"Logger");var Si=bi,vi=class vi{jsonSchema;modelDefinitions;internalDefinitions;externalDefinitions;containerData;entityData;entities;views;viewData;relationships;collectionRefsDefinitionsMap;isUpdateScript;level;host;clusterId;accessToken;applyToInstanceQueryRequestTimeout;script;hiddenKeys;options;modelData};i(vi,"CoreData");var Ci=vi;$l.exports={App:Ti,CoreData:Ci,Logger:Si,PluginError:Ei}});var Kl=C((XN,Bl)=>{var Mi=class Mi{name;isActivated};i(Mi,"ContainerJsonSchema");var Oi=Mi,Fi=class Fi{backgroundColor};i(Fi,"ContainerStyles");var Ri=Fi,Ui=class Ui{collectionName;isActivated;bucketId;additionalProperties;tableIfNotExists};i(Ui,"EntityData");var wi=Ui,ki=class ki{$schema;type;GUID};i(ki,"InternalDefinitions");var Di=ki,$i=class $i{$schema;type;GUID};i($i,"ModelDefinitions");var qi=$i,Bi=class Bi{$schema;type;GUID};i(Bi,"ExternalDefinitions");var xi=Bi,Ki=class Ki{type;isActivated;mode;subtype;compositeKey;compositePartitionKey;compositeClusteringKey;compositePrimaryKey;compositeUniqueKey;GUID};i(Ki,"FieldJsonSchema");var Pi=Ki,Gi=class Gi{$schema;type;title;properties;isActivated;additionalProperties;tableIfNotExists;GUID};i(Gi,"EntityJsonSchema");var Li=Gi;Bl.exports={ContainerJsonSchema:Oi,ContainerStyles:Ri,EntityData:wi,InternalDefinitions:Di,ModelDefinitions:qi,ExternalDefinitions:xi,FieldJsonSchema:Pi,EntityJsonSchema:Li}});var Er=C((JN,Gl)=>{Gl.exports=se()});var Hl=C((tb,Vl)=>{var{AlterScriptDto:Ft}=ne(),{App:eb}=Ii(),jE="sequences",zE=i(({app:t})=>({container:e})=>{var o;let r=t.require("lodash"),n=Er()(null,null,t),{getDbName:s}=L()(r),a=s([e.role]);return(((o=e.role)==null?void 0:o.sequences)||[]).map(c=>n.createSchemaSequence({schemaName:a,sequence:c})).map(c=>Ft.getInstance([c],!0,!1)).filter(Boolean)},"getAddContainerSequencesScriptDtos"),XE=i(({app:t})=>({container:e})=>{var _,y;let r=t.require("lodash"),n=Er()(null,null,t),{getDbName:s,getGroupItemsByCompMode:a}=L()(r),o=s([e.role]),c=((y=(_=e.role)==null?void 0:_.compMod)==null?void 0:y[jE])||{},{new:u=[],old:l=[]}=c,{removed:p,added:m,modified:d}=a({newItems:u,oldItems:l}),f=p.map(N=>n.dropSchemaSequence({schemaName:o,sequence:N})).map(N=>Ft.getInstance([N],!0,!0)),h=m.map(N=>n.createSchemaSequence({schemaName:o,sequence:N})).map(N=>Ft.getInstance([N],!0,!1));return[...d.map(N=>{let S=r.find(l,{id:N.id})||{};return n.alterSchemaSequence({schemaName:o,sequence:N,oldSequence:S})}).map(N=>Ft.getInstance([N],!0,!1)),...f,...h].filter(Boolean)},"getModifyContainerSequencesScriptDtos"),ZE=i(({app:t})=>({container:e})=>{var o;let r=t.require("lodash"),n=Er()(null,null,t),{getDbName:s}=L()(r),a=s([e.role]);return(((o=e.role)==null?void 0:o.sequences)||[]).map(c=>n.dropSchemaSequence({schemaName:a,sequence:c})).map(c=>Ft.getInstance([c],!0,!0)).filter(Boolean)},"getDeleteContainerSequencesScriptDtos");Vl.exports={getAddContainerSequencesScriptDtos:zE,getModifyContainerSequencesScriptDtos:XE,getDeleteContainerSequencesScriptDtos:ZE}});var Ql=C((lb,Wl)=>{var{getAddContainerScriptDto:JE,getDeleteContainerScriptDto:eT,getModifyContainerScriptDtos:tT}=Mu(),{getAddCollectionScriptDto:rT,getDeleteCollectionScriptDto:nT,getAddColumnScriptDtos:sT,getDeleteColumnScriptDtos:iT,getModifyColumnScriptDtos:aT,getModifyCollectionScriptDtos:oT}=Cl(),{getDeleteUdtScriptDto:cT,getCreateUdtScriptDto:uT,getAddColumnToTypeScriptDtos:lT,getDeleteColumnFromTypeScriptDtos:pT,getModifyColumnOfTypeScriptDtos:mT}=Nl(),{getAddViewScriptDto:dT,getDeleteViewScriptDto:fT,getModifyViewScriptDtos:hT}=Dl(),{getModifyForeignKeyScriptDtos:gT,getDeleteForeignKeyScriptDtos:yT,getAddForeignKeyScriptDtos:_T}=kl(),{AlterScriptDto:nb,ModificationScript:sb}=ne(),{App:ib,CoreData:ab}=Ii(),{InternalDefinitions:ob,ModelDefinitions:cb,ExternalDefinitions:ub}=Kl(),{getModifyContainerSequencesScriptDtos:ET,getDeleteContainerSequencesScriptDtos:TT,getAddContainerSequencesScriptDtos:ST}=Hl(),CT=i(({collection:t,app:e})=>{var u,l,p,m,d,f,h,T,_,y,N,S;let r=(m=(p=(l=(u=t.properties)==null?void 0:u.containers)==null?void 0:l.properties)==null?void 0:p.added)==null?void 0:m.items,n=(T=(h=(f=(d=t.properties)==null?void 0:d.containers)==null?void 0:f.properties)==null?void 0:h.deleted)==null?void 0:T.items,s=(S=(N=(y=(_=t.properties)==null?void 0:_.containers)==null?void 0:y.properties)==null?void 0:N.modified)==null?void 0:S.items,a=[].concat(r).filter(Boolean).map(b=>JE(e)(Object.keys(b.properties)[0])),o=[].concat(n).filter(Boolean).map(b=>eT(e)(Object.keys(b.properties)[0])),c=[].concat(s).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>tT(e)(b));return[...a,...o,...c].filter(Boolean)},"getAlterContainersScriptDtos"),AT=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var T,_,y,N,S,b,I,R,M,v,D,G;let o=[].concat((N=(y=(_=(T=t.properties)==null?void 0:T.entities)==null?void 0:_.properties)==null?void 0:y.added)==null?void 0:N.items).filter(Boolean).map(P=>Object.values(P.properties)[0]),c=[].concat((R=(I=(b=(S=t.properties)==null?void 0:S.entities)==null?void 0:b.properties)==null?void 0:I.deleted)==null?void 0:R.items).filter(Boolean).map(P=>Object.values(P.properties)[0]),u=[].concat((G=(D=(v=(M=t.properties)==null?void 0:M.entities)==null?void 0:v.properties)==null?void 0:D.modified)==null?void 0:G.items).filter(Boolean).map(P=>Object.values(P.properties)[0]),l=o.filter(P=>{var X;return(X=P.compMod)==null?void 0:X.created}).map(rT({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),p=c.filter(P=>{var X;return(X=P.compMod)==null?void 0:X.deleted}).map(nT(e)),m=u.flatMap(oT({app:e,dbVersion:r})),d=o.filter(P=>{var X;return!((X=P==null?void 0:P.compMod)!=null&&X.created)}).flatMap(sT({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),f=c.filter(P=>{var X;return!((X=P==null?void 0:P.compMod)!=null&&X.deleted)}).flatMap(iT(e)),h=u.flatMap(aT({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}));return[...l,...p,...m,...d,...f,...h].filter(Boolean)},"getAlterCollectionsScriptDtos"),NT=i((t,e)=>{var a,o,c,u,l,p,m,d,f,h,T,_;let r=[].concat((u=(c=(o=(a=t.properties)==null?void 0:a.views)==null?void 0:o.properties)==null?void 0:c.added)==null?void 0:u.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).filter(y=>{var N;return((N=y.compMod)==null?void 0:N.created)&&y.selectStatement}).map(dT(e)),n=[].concat((d=(m=(p=(l=t.properties)==null?void 0:l.views)==null?void 0:p.properties)==null?void 0:m.deleted)==null?void 0:d.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).map(fT(e)),s=[].concat((_=(T=(h=(f=t.properties)==null?void 0:f.views)==null?void 0:h.properties)==null?void 0:T.modified)==null?void 0:_.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).flatMap(y=>hT(e)(y));return[...n,...r,...s].filter(Boolean)},"getAlterViewScriptDtos"),bT=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var m,d,f,h,T,_,y,N,S,b,I,R,M,v,D,G,P,X,ve,me;let o=[].concat((h=(f=(d=(m=t.properties)==null?void 0:m.modelDefinitions)==null?void 0:d.properties)==null?void 0:f.added)==null?void 0:h.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).map(U=>({...U,...e.require("lodash").omit(U.role,"properties")||{}})).filter(U=>{var Ie;return(Ie=U.compMod)==null?void 0:Ie.created}).map(uT({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),c=[].concat((N=(y=(_=(T=t.properties)==null?void 0:T.modelDefinitions)==null?void 0:_.properties)==null?void 0:y.deleted)==null?void 0:N.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).map(U=>({...U,...e.require("lodash").omit(U.role,"properties")||{}})).filter(U=>{var Ie;return(Ie=U.compMod)==null?void 0:Ie.deleted}).map(cT(e)),u=[].concat((R=(I=(b=(S=t.properties)==null?void 0:S.modelDefinitions)==null?void 0:b.properties)==null?void 0:I.added)==null?void 0:R.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>!U.compMod).map(U=>({...U,...e.require("lodash").omit(U.role,"properties")||{}})).filter(U=>U.childType==="composite").flatMap(lT({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),l=[].concat((G=(D=(v=(M=t.properties)==null?void 0:M.modelDefinitions)==null?void 0:v.properties)==null?void 0:D.deleted)==null?void 0:G.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>!U.compMod).map(U=>({...U,...e.require("lodash").omit(U.role,"properties")||{}})).filter(U=>U.childType==="composite").flatMap(pT(e)),p=[].concat((me=(ve=(X=(P=t.properties)==null?void 0:P.modelDefinitions)==null?void 0:X.properties)==null?void 0:ve.modified)==null?void 0:me.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>!U.compMod).map(U=>({...U,...e.require("lodash").omit(U.role,"properties")||{}})).filter(U=>U.childType==="composite").flatMap(mT(e));return[...c,...o,...u,...l,...p].filter(Boolean)},"getAlterModelDefinitionsScriptDtos"),vT=i(({collection:t,app:e})=>{var p,m,d,f,h,T,_,y,N,S,b,I;let r=e.require("lodash"),n=se()(null,null,e),s=[].concat((f=(d=(m=(p=t.properties)==null?void 0:p.relationships)==null?void 0:m.properties)==null?void 0:d.added)==null?void 0:f.items).filter(Boolean).map(R=>Object.values(R.properties)[0]).filter(R=>{var M,v;return(v=(M=R==null?void 0:R.role)==null?void 0:M.compMod)==null?void 0:v.created}),a=[].concat((y=(_=(T=(h=t.properties)==null?void 0:h.relationships)==null?void 0:T.properties)==null?void 0:_.deleted)==null?void 0:y.items).filter(Boolean).map(R=>Object.values(R.properties)[0]).filter(R=>{var M,v;return(v=(M=R==null?void 0:R.role)==null?void 0:M.compMod)==null?void 0:v.deleted}),o=[].concat((I=(b=(S=(N=t.properties)==null?void 0:N.relationships)==null?void 0:S.properties)==null?void 0:b.modified)==null?void 0:I.items).filter(Boolean).map(R=>Object.values(R.properties)[0]).filter(R=>{var M,v;return(v=(M=R==null?void 0:R.role)==null?void 0:M.compMod)==null?void 0:v.modified}),c=yT(n,r)(a),u=_T(n,r)(s),l=gT(n,r)(o);return[...c,...u,...l].filter(Boolean)},"getAlterRelationshipsScriptDtos"),IT=i(t=>{if(!t)return;let e=t.scripts.map(r=>({...r,script:(r.script||"").trim()})).filter(r=>!!r.script);if(e.length)return{...t,scripts:e}},"prettifyAlterScriptDto"),OT=i(({collection:t,app:e})=>{var u,l,p,m,d,f,h,T,_,y,N,S;let r=(m=(p=(l=(u=t.properties)==null?void 0:u.containers)==null?void 0:l.properties)==null?void 0:p.added)==null?void 0:m.items,n=(T=(h=(f=(d=t.properties)==null?void 0:d.containers)==null?void 0:f.properties)==null?void 0:h.deleted)==null?void 0:T.items,s=(S=(N=(y=(_=t.properties)==null?void 0:_.containers)==null?void 0:y.properties)==null?void 0:N.modified)==null?void 0:S.items,a=[].concat(r).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>ST({app:e})({container:b})),o=[].concat(n).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>TT({app:e})({container:b})),c=[].concat(s).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>ET({app:e})({container:b}));return[...a,...o,...c].filter(Boolean)},"getAlterContainersSequencesScriptDtos"),RT=i((t,e)=>{var f;let r=JSON.parse(t.jsonSchema);if(!r)throw new Error('"comparisonModelCollection" is not found. Alter script can be generated only from Delta model');let n=JSON.parse(t.modelDefinitions),s=JSON.parse(t.internalDefinitions),a=JSON.parse(t.externalDefinitions),o=(f=t.modelData[0])==null?void 0:f.dbVersion,c=CT({collection:r,app:e}),u=AT({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),l=NT(r,e),p=bT({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),m=vT({collection:r,app:e}),d=OT({collection:r,app:e});return[...c,...p,...u,...d,...l,...m].filter(Boolean).map(h=>IT(h)).filter(Boolean)},"getAlterScriptDtos");Wl.exports={getAlterScriptDtos:RT}});var Xl=C((db,zl)=>{var{getAlterScriptDtos:Tr}=Ql(),{AlterScriptDto:mb}=ne(),Yl=i(t=>(e,r)=>{let{commentIfDeactivated:n}=L()(t);return e.map(s=>s.isActivated===!1?s.scripts.map(a=>n(a.script,{isActivated:!1,isPartOfLine:!1})):r?s.scripts.map(a=>a.script):s.scripts.map(a=>n(a.script,{isActivated:!a.isDropScript,isPartOfLine:!1}))).flat().filter(Boolean).map(s=>s.trim()).filter(Boolean).join(`

`)},"joinAlterScriptDtosIntoScript"),wT=i((t,e)=>{var a,o;let r=e.require("lodash"),n=Tr(t,e),s=(o=(a=t.options)==null?void 0:a.additionalOptions)==null?void 0:o.some(c=>c.id==="applyDropStatements"&&c.value);return Yl(r)(n,s)},"buildEntityLevelAlterScript"),DT=i((t,e)=>Tr(t,e).some(n=>n.isActivated&&n.scripts.some(s=>s.isDropScript)),"doesEntityLevelAlterScriptContainDropStatements"),jl=i(t=>({...t,jsonSchema:t.collections[0],internalDefinitions:Object.values(t.internalDefinitions)[0]}),"mapCoreDataForContainerLevelScripts"),qT=i((t,e)=>{var o,c;let r=jl(t),n=e.require("lodash"),s=Tr(r,e),a=(c=(o=r.options)==null?void 0:o.additionalOptions)==null?void 0:c.some(u=>u.id==="applyDropStatements"&&u.value);return Yl(n)(s,a)},"buildContainerLevelAlterScript"),xT=i((t,e)=>{let r=jl(t);return Tr(r,e).some(s=>s.isActivated&&s.scripts.some(a=>a.isDropScript))},"doesContainerLevelAlterScriptContainDropStatements");zl.exports={buildEntityLevelAlterScript:wT,doesEntityLevelAlterScriptContainDropStatements:DT,buildContainerLevelAlterScript:qT,doesContainerLevelAlterScriptContainDropStatements:xT}});var Zl=Gc(),{createLogger:PT}=Nr(),LT=Hc(),{buildEntityLevelAlterScript:MT,buildContainerLevelAlterScript:FT,doesContainerLevelAlterScriptContainDropStatements:UT,doesEntityLevelAlterScriptContainDropStatements:kT}=Xl();module.exports={generateScript(t,e,r,n){try{let s=MT(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"PostgreSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},generateViewScript(t,e,r,n){r(new Error("Forward-Engineering of delta model on view level is not supported"))},generateContainerScript(t,e,r,n){try{let s=FT(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"PostgreSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},getDatabases(t,e,r,n){e.progress({message:"Find all databases"}),Zl.getDatabases(t,e,r,n)},applyToInstance(t,e,r,n){e.clear(),e.log("info",n.require("lodash").omit(t,"script","containerData"),"connectionInfo",t.hiddenKeys);let s=PT({title:"Apply to instance",hiddenKeys:t.hiddenKeys,logger:e});LT.applyToInstance(t,s,n).then(r,r)},testConnection(t,e,r,n){Zl.testConnection(t,e,r,n).then(r,r)},isDropInStatements(t,e,r,n){try{if(t.level==="container"){let s=UT(t,n);r(null,s)}else{let s=kT(t,n);r(null,s)}}catch(s){r({message:s.message,stack:s.stack})}}};
