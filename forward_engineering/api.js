"use strict";var At=Object.defineProperty;var Ll=Object.getOwnPropertyDescriptor;var Ml=Object.getOwnPropertyNames;var Fl=Object.prototype.hasOwnProperty;var i=(t,e)=>At(t,"name",{value:e,configurable:!0});var Ul=(t,e)=>()=>(t&&(e=t(t=0)),e);var C=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),kl=(t,e)=>{for(var r in e)At(t,r,{get:e[r],enumerable:!0})},$l=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ml(e))!Fl.call(t,s)&&s!==r&&At(t,s,{get:()=>e[s],enumerable:!(n=Ll(e,s))||n.enumerable});return t};var Bl=t=>$l(At({},"__esModule",{value:!0}),t);var or=C((PE,Ni)=>{"use strict";var Kl=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",a=""){e.progress({message:n,containerName:s,entityName:a})},error(n){e.log("error",Gl(n),t)}}),"createLogger"),Gl=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");Ni.exports={createLogger:Kl}});var ur=C(bi=>{"use strict";bi.parse=function(t,e){return new cr(t,e).parse()};var Nt=class Nt{constructor(e,r){this.source=e,this.transform=r||Vl,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new Nt(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(Nt,"ArrayParser");var cr=Nt;function Vl(t){return t}i(Vl,"identity")});var lr=C((UE,Ii)=>{var Hl=ur();Ii.exports={create:function(t,e){return{parse:function(){return Hl.parse(t,e)}}}}});var Ri=C((kE,Oi)=>{"use strict";var Wl=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Ql=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Yl=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,jl=/^-?infinity$/;Oi.exports=i(function(e){if(jl.test(e))return Number(e.replace("i","I"));var r=Wl.exec(e);if(!r)return zl(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=vi(s));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),u=parseInt(r[5],10),l=parseInt(r[6],10),d=r[7];d=d?1e3*parseFloat(d):0;var p,m=Xl(e);return m!=null?(p=new Date(Date.UTC(s,a,o,c,u,l,d)),pr(s)&&p.setUTCFullYear(s),m!==0&&p.setTime(p.getTime()-m)):(p=new Date(s,a,o,c,u,l,d),pr(s)&&p.setFullYear(s)),p},"parseDate");function zl(t){var e=Ql.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=vi(r));var s=parseInt(e[2],10)-1,a=e[3],o=new Date(r,s,a);return pr(r)&&o.setFullYear(r),o}}i(zl,"getDate");function Xl(t){if(t.endsWith("+00"))return 0;var e=Yl.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(Xl,"timeZoneOffset");function vi(t){return-(t-1)}i(vi,"bcYearToNegativeYear");function pr(t){return t>=0&&t<100}i(pr,"is0To99")});var Di=C((BE,wi)=>{wi.exports=Jl;var Zl=Object.prototype.hasOwnProperty;function Jl(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Zl.call(r,n)&&(t[n]=r[n])}return t}i(Jl,"extend")});var Pi=C((GE,xi)=>{"use strict";var ep=Di();xi.exports=Ke;function Ke(t){if(!(this instanceof Ke))return new Ke(t);ep(this,mp(t))}i(Ke,"PostgresInterval");var tp=["seconds","minutes","hours","days","months","years"];Ke.prototype.toPostgres=function(){var t=tp.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var rp={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},np=["years","months","days"],sp=["hours","minutes","seconds"];Ke.prototype.toISOString=Ke.prototype.toISO=function(){var t=np.map(r,this).join(""),e=sp.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+rp[n]}};var mr="([+-]?\\d+)",ip=mr+"\\s+years?",ap=mr+"\\s+mons?",op=mr+"\\s+days?",cp="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",up=new RegExp([ip,ap,op,cp].map(function(t){return"("+t+")?"}).join("\\s*")),qi={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},lp=["hours","minutes","seconds","milliseconds"];function pp(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(pp,"parseMilliseconds");function mp(t){if(!t)return{};var e=up.exec(t),r=e[8]==="-";return Object.keys(qi).reduce(function(n,s){var a=qi[s],o=e[a];return!o||(o=s==="milliseconds"?pp(o):parseInt(o,10),!o)||(r&&~lp.indexOf(s)&&(o*=-1),n[s]=o),n},{})}i(mp,"parse")});var Mi=C((HE,Li)=>{"use strict";Li.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var a=0;a<Math.floor(s/2);++a)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var Gi=C((QE,Ki)=>{var it=ur(),at=lr(),bt=Ri(),Ui=Pi(),ki=Mi();function It(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(It,"allowNull");function $i(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i($i,"parseBool");function dp(t){return t?it.parse(t,$i):null}i(dp,"parseBoolArray");function fp(t){return parseInt(t,10)}i(fp,"parseBaseTenInt");function dr(t){return t?it.parse(t,It(fp)):null}i(dr,"parseIntegerArray");function hp(t){return t?it.parse(t,It(function(e){return Bi(e).trim()})):null}i(hp,"parseBigIntegerArray");var gp=i(function(t){if(!t)return null;var e=at.create(t,function(r){return r!==null&&(r=yr(r)),r});return e.parse()},"parsePointArray"),fr=i(function(t){if(!t)return null;var e=at.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),ye=i(function(t){if(!t)return null;var e=at.create(t);return e.parse()},"parseStringArray"),hr=i(function(t){if(!t)return null;var e=at.create(t,function(r){return r!==null&&(r=bt(r)),r});return e.parse()},"parseDateArray"),yp=i(function(t){if(!t)return null;var e=at.create(t,function(r){return r!==null&&(r=Ui(r)),r});return e.parse()},"parseIntervalArray"),_p=i(function(t){return t?it.parse(t,It(ki)):null},"parseByteAArray"),gr=i(function(t){return parseInt(t,10)},"parseInteger"),Bi=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Fi=i(function(t){return t?it.parse(t,It(JSON.parse)):null},"parseJsonArray"),yr=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Ep=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var a=yr(e);return a.radius=parseFloat(r),a},"parseCircle"),Tp=i(function(t){t(20,Bi),t(21,gr),t(23,gr),t(26,gr),t(700,parseFloat),t(701,parseFloat),t(16,$i),t(1082,bt),t(1114,bt),t(1184,bt),t(600,yr),t(651,ye),t(718,Ep),t(1e3,dp),t(1001,_p),t(1005,dr),t(1007,dr),t(1028,dr),t(1016,hp),t(1017,gp),t(1021,fr),t(1022,fr),t(1231,fr),t(1014,ye),t(1015,ye),t(1008,ye),t(1009,ye),t(1040,ye),t(1041,ye),t(1115,hr),t(1182,hr),t(1185,hr),t(1186,Ui),t(1187,yp),t(17,ki),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Fi),t(3807,Fi),t(3907,ye),t(2951,ye),t(791,ye),t(1183,ye),t(1270,ye)},"init");Ki.exports={init:Tp}});var Hi=C((jE,Vi)=>{"use strict";var ce=1e6;function Sp(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",a,o,c,u,l,d;{if(a=e%ce,e=e/ce>>>0,o=4294967296*a+r,r=o/ce>>>0,c=""+(o-ce*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,d=0;d<l;d++)u+="0";s=u+c+s}{if(a=e%ce,e=e/ce>>>0,o=4294967296*a+r,r=o/ce>>>0,c=""+(o-ce*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,d=0;d<l;d++)u+="0";s=u+c+s}{if(a=e%ce,e=e/ce>>>0,o=4294967296*a+r,r=o/ce>>>0,c=""+(o-ce*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,d=0;d<l;d++)u+="0";s=u+c+s}return a=e%ce,o=4294967296*a+r,c=""+o%ce,n+c+s}i(Sp,"readInt8");Vi.exports=Sp});var zi=C((XE,ji)=>{var Cp=Hi(),G=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(f,g,T){return f*Math.pow(2,T)+g};var a=r>>3,o=i(function(f){return n?~f&255:f},"inv"),c=255,u=8-r%8;e<u&&(c=255<<8-e&255,u=e),r&&(c=c>>r%8);var l=0;r%8+e>=8&&(l=s(0,o(t[a])&c,u));for(var d=e+r>>3,p=a+1;p<d;p++)l=s(l,o(t[p]),8);var m=(e+r)%8;return m>0&&(l=s(l,o(t[d])>>8-m,m)),l},"parseBits"),Yi=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=G(t,1),a=G(t,r,1);if(a===0)return 0;var o=1,c=i(function(l,d,p){l===0&&(l=1);for(var m=1;m<=p;m++)o/=2,(d&1<<p-m)>0&&(l+=o);return l},"parsePrecisionBits"),u=G(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?u===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,a-n)*u},"parseFloatFromBits"),Ap=i(function(t){return G(t,1)==1?-1*(G(t,15,1,!0)+1):G(t,15,1)},"parseInt16"),Wi=i(function(t){return G(t,1)==1?-1*(G(t,31,1,!0)+1):G(t,31,1)},"parseInt32"),Np=i(function(t){return Yi(t,23,8)},"parseFloat32"),bp=i(function(t){return Yi(t,52,11)},"parseFloat64"),Ip=i(function(t){var e=G(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,G(t,16,16)),n=0,s=[],a=G(t,16),o=0;o<a;o++)n+=G(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,G(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),Qi=i(function(t,e){var r=G(e,1),n=G(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(a){this.usec=a},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),ot=i(function(t){for(var e=G(t,32),r=G(t,32,32),n=G(t,32,64),s=96,a=[],o=0;o<e;o++)a[o]=G(t,32,s),s+=32,s+=32;var c=i(function(l){var d=G(t,32,s);if(s+=32,d==4294967295)return null;var p;if(l==23||l==20)return p=G(t,d*8,s),s+=d*8,p;if(l==25)return p=t.toString(this.encoding,s>>3,(s+=d<<3)>>3),p;console.log("ERROR: ElementType not implemented: "+l)},"parseElement"),u=i(function(l,d){var p=[],m;if(l.length>1){var f=l.shift();for(m=0;m<f;m++)p[m]=u(l,d);l.unshift(f)}else for(m=0;m<l[0];m++)p[m]=c(d);return p},"parse");return u(a,n)},"parseArray"),vp=i(function(t){return t.toString("utf8")},"parseText"),Op=i(function(t){return t===null?null:G(t,8)>0},"parseBool"),Rp=i(function(t){t(20,Cp),t(21,Ap),t(23,Wi),t(26,Wi),t(1700,Ip),t(700,Np),t(701,bp),t(16,Op),t(1114,Qi.bind(null,!1)),t(1184,Qi.bind(null,!0)),t(1e3,ot),t(1007,ot),t(1016,ot),t(1008,ot),t(1009,ot),t(25,vp)},"init");ji.exports={init:Rp}});var Zi=C((JE,Xi)=>{Xi.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var lt=C(ut=>{var wp=Gi(),Dp=zi(),qp=lr(),xp=Zi();ut.getTypeParser=Pp;ut.setTypeParser=Lp;ut.arrayParser=qp;ut.builtins=xp;var ct={text:{},binary:{}};function Ji(t){return String(t)}i(Ji,"noParse");function Pp(t,e){return e=e||"text",ct[e]&&ct[e][t]||Ji}i(Pp,"getTypeParser");function Lp(t,e,r){typeof e=="function"&&(r=e,e="text"),ct[e][t]=r}i(Lp,"setTypeParser");wp.init(function(t,e){ct.text[t]=e});Dp.init(function(t,e){ct.binary[t]=e})});var pt=C((rT,_r)=>{"use strict";_r.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Ge=lt(),Mp=Ge.getTypeParser(20,"text"),Fp=Ge.getTypeParser(1016,"text");_r.exports.__defineSetter__("parseInt8",function(t){Ge.setTypeParser(20,"text",t?Ge.getTypeParser(23,"text"):Mp),Ge.setTypeParser(1016,"text",t?Ge.getTypeParser(1007,"text"):Fp)})});var mt=C((nT,ta)=>{"use strict";var Up=pt();function kp(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(kp,"escapeElement");function ea(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+ea(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=kp(vt(t[r]));return e=e+"}",e}i(ea,"arrayString");var vt=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?Up.parseInputDatesAsUTC?Kp(t):Bp(t):Array.isArray(t)?ea(t):typeof t=="object"?$p(t,e):t.toString()},"prepareValue");function $p(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),vt(t.toPostgres(vt),e)}return JSON.stringify(t)}i($p,"prepareObject");function ie(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(ie,"pad");function Bp(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=ie(r,4)+"-"+ie(t.getMonth()+1,2)+"-"+ie(t.getDate(),2)+"T"+ie(t.getHours(),2)+":"+ie(t.getMinutes(),2)+":"+ie(t.getSeconds(),2)+"."+ie(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=ie(Math.floor(e/60),2)+":"+ie(e%60,2),n&&(s+=" BC"),s}i(Bp,"dateToString");function Kp(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=ie(e,4)+"-"+ie(t.getUTCMonth()+1,2)+"-"+ie(t.getUTCDate(),2)+"T"+ie(t.getUTCHours(),2)+":"+ie(t.getUTCMinutes(),2)+":"+ie(t.getUTCSeconds(),2)+"."+ie(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(Kp,"dateToStringUTC");function Gp(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(Gp,"normalizeQueryConfig");var Vp=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),Hp=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");ta.exports={prepareValue:i(function(e){return vt(e)},"prepareValueWrapper"),normalizeQueryConfig:Gp,escapeIdentifier:Vp,escapeLiteral:Hp}});var na=C((iT,ra)=>{"use strict";var dt=require("crypto");function Er(t){return dt.createHash("md5").update(t,"utf-8").digest("hex")}i(Er,"md5");function Wp(t,e,r){var n=Er(e+t),s=Er(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Wp,"postgresMd5PasswordHash");function Qp(t){return dt.createHash("sha256").update(t).digest()}i(Qp,"sha256");function Yp(t,e){return dt.createHmac("sha256",t).update(e).digest()}i(Yp,"hmacSha256");async function jp(t,e,r){return dt.pbkdf2Sync(t,e,r,32,"sha256")}i(jp,"deriveKey");ra.exports={postgresMd5PasswordHash:Wp,randomBytes:dt.randomBytes,deriveKey:jp,sha256:Qp,hmacSha256:Yp,md5:Er}});var oa=C((oT,aa)=>{var sa=require("crypto");aa.exports={postgresMd5PasswordHash:Xp,randomBytes:zp,deriveKey:em,sha256:Zp,hmacSha256:Jp,md5:Tr};var ia=sa.webcrypto||globalThis.crypto,Ve=ia.subtle,Sr=new TextEncoder;function zp(t){return ia.getRandomValues(Buffer.alloc(t))}i(zp,"randomBytes");async function Tr(t){try{return sa.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?Sr.encode(t):t,n=await Ve.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(Tr,"md5");async function Xp(t,e,r){var n=await Tr(e+t),s=await Tr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Xp,"postgresMd5PasswordHash");async function Zp(t){return await Ve.digest("SHA-256",t)}i(Zp,"sha256");async function Jp(t,e){let r=await Ve.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await Ve.sign("HMAC",r,Sr.encode(e))}i(Jp,"hmacSha256");async function em(t,e,r){let n=await Ve.importKey("raw",Sr.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await Ve.deriveBits(s,n,32*8,["deriveBits"])}i(em,"deriveKey")});var Ar=C((uT,Cr)=>{"use strict";var tm=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;tm?Cr.exports=na():Cr.exports=oa()});var pa=C((lT,la)=>{"use strict";var Ue=Ar();function rm(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=Ue.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(rm,"startSession");async function nm(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=am(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o="c=biws,r="+n.nonce,c=s+","+a+","+o,u=Buffer.from(n.salt,"base64"),l=await Ue.deriveKey(e,u,n.iteration),d=await Ue.hmacSha256(l,"Client Key"),p=await Ue.sha256(d),m=await Ue.hmacSha256(p,c),f=cm(Buffer.from(d),Buffer.from(m)).toString("base64"),g=await Ue.hmacSha256(l,"Server Key"),T=await Ue.hmacSha256(g,c);t.message="SASLResponse",t.serverSignature=Buffer.from(T).toString("base64"),t.response=o+",p="+f}i(nm,"continueSession");function sm(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=om(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(sm,"finalizeSession");function im(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(im,"isPrintableChars");function ca(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(ca,"isBase64");function ua(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(ua,"parseAttributePairs");function am(t){let e=ua(t),r=e.get("r");if(r){if(!im(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!ca(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(s,10);return{nonce:r,salt:n,iteration:a}}i(am,"parseServerFirstMessage");function om(t){let r=ua(t).get("v");if(r){if(!ca(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(om,"parseServerFinalMessage");function cm(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(cm,"xorBuffers");la.exports={startSession:rm,continueSession:nm,finalizeSession:sm}});var Nr=C((mT,ma)=>{"use strict";var um=lt();function Ot(t){this._types=t||um,this.text={},this.binary={}}i(Ot,"TypeOverrides");Ot.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};Ot.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};Ot.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};ma.exports=Ot});var fa=C((fT,da)=>{"use strict";function br(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(br,"parse");da.exports=br;br.parse=br});var Or=C((gT,ya)=>{"use strict";var lm=require("dns"),ga=pt(),ha=fa().parse,ae=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||ga[t]},"val"),pm=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return ga.ssl},"readSSLConfigFromEnvironment"),He=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),_e=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+He(n))},"add"),vr=class vr{constructor(e){e=typeof e=="string"?ha(e):e||{},e.connectionString&&(e=Object.assign({},e,ha(e.connectionString))),this.user=ae("user",e),this.database=ae("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(ae("port",e),10),this.host=ae("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:ae("password",e)}),this.binary=ae("binary",e),this.options=ae("options",e),this.ssl=typeof e.ssl>"u"?pm():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=ae("client_encoding",e),this.replication=ae("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=ae("application_name",e,"PGAPPNAME"),this.fallback_application_name=ae("fallback_application_name",e,!1),this.statement_timeout=ae("statement_timeout",e,!1),this.lock_timeout=ae("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=ae("idle_in_transaction_session_timeout",e,!1),this.query_timeout=ae("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];_e(r,this,"user"),_e(r,this,"password"),_e(r,this,"port"),_e(r,this,"application_name"),_e(r,this,"fallback_application_name"),_e(r,this,"connect_timeout"),_e(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(_e(r,n,"sslmode"),_e(r,n,"sslca"),_e(r,n,"sslkey"),_e(r,n,"sslcert"),_e(r,n,"sslrootcert"),this.database&&r.push("dbname="+He(this.database)),this.replication&&r.push("replication="+He(this.replication)),this.host&&r.push("host="+He(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+He(this.client_encoding)),lm.lookup(this.host,function(s,a){return s?e(s,null):(r.push("hostaddr="+He(a)),e(null,r.join(" ")))})}};i(vr,"ConnectionParameters");var Ir=vr;ya.exports=Ir});var Ta=C((_T,Ea)=>{"use strict";var mm=lt(),_a=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,wr=class wr{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=_a.exec(e.text):r=_a.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var a=e[n];a!==null?r[n]=this._parsers[n](a):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var a=e[n],o=this.fields[n].name;a!==null?r[o]=this._parsers[n](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=mm.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(wr,"Result");var Rr=wr;Ea.exports=Rr});var Na=C((TT,Aa)=>{"use strict";var{EventEmitter:dm}=require("events"),Sa=Ta(),Ca=mt(),qr=class qr extends dm{constructor(e,r,n){super(),e=Ca.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Sa(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Sa(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Ca.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(qr,"Query");var Dr=qr;Aa.exports=Dr});var cn=C(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.NoticeMessage=x.DataRowMessage=x.CommandCompleteMessage=x.ReadyForQueryMessage=x.NotificationResponseMessage=x.BackendKeyDataMessage=x.AuthenticationMD5Password=x.ParameterStatusMessage=x.ParameterDescriptionMessage=x.RowDescriptionMessage=x.Field=x.CopyResponse=x.CopyDataMessage=x.DatabaseError=x.copyDone=x.emptyQuery=x.replicationStart=x.portalSuspended=x.noData=x.closeComplete=x.bindComplete=x.parseComplete=void 0;x.parseComplete={name:"parseComplete",length:5};x.bindComplete={name:"bindComplete",length:5};x.closeComplete={name:"closeComplete",length:5};x.noData={name:"noData",length:5};x.portalSuspended={name:"portalSuspended",length:5};x.replicationStart={name:"replicationStart",length:4};x.emptyQuery={name:"emptyQuery",length:4};x.copyDone={name:"copyDone",length:4};var Qr=class Qr extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(Qr,"DatabaseError");var xr=Qr;x.DatabaseError=xr;var Yr=class Yr{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(Yr,"CopyDataMessage");var Pr=Yr;x.CopyDataMessage=Pr;var jr=class jr{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(jr,"CopyResponse");var Lr=jr;x.CopyResponse=Lr;var zr=class zr{constructor(e,r,n,s,a,o,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(zr,"Field");var Mr=zr;x.Field=Mr;var Xr=class Xr{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(Xr,"RowDescriptionMessage");var Fr=Xr;x.RowDescriptionMessage=Fr;var Zr=class Zr{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(Zr,"ParameterDescriptionMessage");var Ur=Zr;x.ParameterDescriptionMessage=Ur;var Jr=class Jr{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(Jr,"ParameterStatusMessage");var kr=Jr;x.ParameterStatusMessage=kr;var en=class en{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(en,"AuthenticationMD5Password");var $r=en;x.AuthenticationMD5Password=$r;var tn=class tn{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(tn,"BackendKeyDataMessage");var Br=tn;x.BackendKeyDataMessage=Br;var rn=class rn{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(rn,"NotificationResponseMessage");var Kr=rn;x.NotificationResponseMessage=Kr;var nn=class nn{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(nn,"ReadyForQueryMessage");var Gr=nn;x.ReadyForQueryMessage=Gr;var sn=class sn{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(sn,"CommandCompleteMessage");var Vr=sn;x.CommandCompleteMessage=Vr;var an=class an{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(an,"DataRowMessage");var Hr=an;x.DataRowMessage=Hr;var on=class on{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(on,"NoticeMessage");var Wr=on;x.NoticeMessage=Wr});var ba=C(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.Writer=void 0;var ln=class ln{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(ln,"Writer");var un=ln;Rt.Writer=un});var va=C(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.serialize=void 0;var pn=ba(),V=new pn.Writer,fm=i(t=>{V.addInt16(3).addInt16(0);for(let n of Object.keys(t))V.addCString(n).addCString(t[n]);V.addCString("client_encoding").addCString("UTF8");var e=V.addCString("").flush(),r=e.length+4;return new pn.Writer().addInt32(r).add(e).flush()},"startup"),hm=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),gm=i(t=>V.addCString(t).flush(112),"password"),ym=i(function(t,e){return V.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),V.flush(112)},"sendSASLInitialResponseMessage"),_m=i(function(t){return V.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Em=i(t=>V.addCString(t).flush(81),"query"),Ia=[],Tm=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Ia;for(var n=r.length,s=V.addCString(e).addCString(t.text).addInt16(n),a=0;a<n;a++)s.addInt32(r[a]);return V.flush(80)},"parse"),We=new pn.Writer,Sm=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(V.addInt16(0),We.addInt32(-1)):n instanceof Buffer?(V.addInt16(1),We.addInt32(n.length),We.add(n)):(V.addInt16(0),We.addInt32(Buffer.byteLength(n)),We.addString(n))}},"writeValues"),Cm=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||Ia,a=s.length;return V.addCString(e).addCString(r),V.addInt16(a),Sm(s,t.valueMapper),V.addInt16(a),V.add(We.flush()),V.addInt16(n?1:0),V.flush(66)},"bind"),Am=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Nm=i(t=>{if(!t||!t.portal&&!t.rows)return Am;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,a=Buffer.allocUnsafe(1+s);return a[0]=69,a.writeInt32BE(s,1),a.write(e,5,"utf-8"),a[n+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),bm=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),mn=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),Im=V.addCString("P").flush(68),vm=V.addCString("S").flush(68),Om=i(t=>t.name?mn(68,`${t.type}${t.name||""}`):t.type==="P"?Im:vm,"describe"),Rm=i(t=>{let e=`${t.type}${t.name||""}`;return mn(67,e)},"close"),wm=i(t=>V.add(t).flush(100),"copyData"),Dm=i(t=>mn(102,t),"copyFail"),wt=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),qm=wt(72),xm=wt(83),Pm=wt(88),Lm=wt(99),Mm={startup:fm,password:gm,requestSsl:hm,sendSASLInitialResponseMessage:ym,sendSCRAMClientFinalMessage:_m,query:Em,parse:Tm,bind:Cm,execute:Nm,describe:Om,close:Rm,flush:()=>qm,sync:()=>xm,end:()=>Pm,copyData:wm,copyDone:()=>Lm,copyFail:Dm,cancel:bm};Dt.serialize=Mm});var Oa=C(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.BufferReader=void 0;var Fm=Buffer.allocUnsafe(0),fn=class fn{constructor(e=0){this.offset=e,this.buffer=Fm,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(fn,"BufferReader");var dn=fn;qt.BufferReader=dn});var Da=C(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.Parser=void 0;var H=cn(),Um=Oa(),hn=1,km=4,Ra=hn+km,wa=Buffer.allocUnsafe(0),yn=class yn{constructor(e){if(this.buffer=wa,this.bufferLength=0,this.bufferOffset=0,this.reader=new Um.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+Ra<=n;){let a=this.buffer[s],o=this.buffer.readUInt32BE(s+hn),c=hn+o;if(c+s<=n){let u=this.handlePacket(s+Ra,a,o,this.buffer);r(u),s+=c}else break}s===n?(this.buffer=wa,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;s=Buffer.allocUnsafe(a)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return H.bindComplete;case 49:return H.parseComplete;case 51:return H.closeComplete;case 110:return H.noData;case 115:return H.portalSuspended;case 99:return H.copyDone;case 87:return H.replicationStart;case 73:return H.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new H.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new H.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new H.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new H.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new H.CopyResponse(r,s,a,o);for(let u=0;u<o;u++)c.columnTypes[u]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new H.NotificationResponseMessage(r,s,a,o)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new H.RowDescriptionMessage(r,s);for(let o=0;o<s;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new H.Field(e,r,n,s,a,o,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new H.ParameterDescriptionMessage(r,s);for(let o=0;o<s;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new Array(s);for(let o=0;o<s;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new H.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),a=this.reader.cstring();return new H.ParameterStatusMessage(r,s,a)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.int32();return new H.BackendKeyDataMessage(r,s,a)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new H.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return a}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,u=s==="notice"?new H.NoticeMessage(r,c):new H.DatabaseError(c,r,s);return u.severity=a.S,u.code=a.C,u.detail=a.D,u.hint=a.H,u.position=a.P,u.internalPosition=a.p,u.internalQuery=a.q,u.where=a.W,u.schema=a.s,u.table=a.t,u.column=a.c,u.dataType=a.d,u.constraint=a.n,u.file=a.F,u.line=a.L,u.routine=a.R,u}};i(yn,"Parser");var gn=yn;xt.Parser=gn});var _n=C(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.DatabaseError=qe.serialize=qe.parse=void 0;var $m=cn();Object.defineProperty(qe,"DatabaseError",{enumerable:!0,get:function(){return $m.DatabaseError}});var Bm=va();Object.defineProperty(qe,"serialize",{enumerable:!0,get:function(){return Bm.serialize}});var Km=Da();function Gm(t,e){let r=new Km.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(Gm,"parse");qe.parse=Gm});var qa={};kl(qa,{default:()=>Vm});var Vm,xa=Ul(()=>{Vm={}});var Pa=C((PT,En)=>{En.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(xa(),Bl(qa));return new n(e)}},"getStream");En.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var Cn=C((FT,La)=>{"use strict";var MT=require("net"),Hm=require("events").EventEmitter,{parse:Wm,serialize:re}=_n(),{getStream:Qm,getSecureStream:Ym}=Pa(),jm=re.flush(),zm=re.sync(),Xm=re.end(),Sn=class Sn extends Hm{constructor(e){super(),e=e||{},this.stream=e.stream||Qm(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(a){n._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||n.emit("error",a)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var u=require("net");u.isIP&&u.isIP(r)===0&&(c.servername=r);try{n.stream=Ym(c)}catch(l){return n.emit("error",l)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){Wm(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(re.requestSsl())}startup(e){this.stream.write(re.startup(e))}cancel(e,r){this._send(re.cancel(e,r))}password(e){this._send(re.password(e))}sendSASLInitialResponseMessage(e,r){this._send(re.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(re.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(re.query(e))}parse(e){this._send(re.parse(e))}bind(e){this._send(re.bind(e))}execute(e){this._send(re.execute(e))}flush(){this.stream.writable&&this.stream.write(jm)}sync(){this._ending=!0,this._send(zm)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(Xm,()=>{this.stream.end()})}close(e){this._send(re.close(e))}describe(e){this._send(re.describe(e))}sendCopyFromChunk(e){this._send(re.copyData(e))}endCopyFrom(){this._send(re.copyDone())}sendCopyFail(e){this._send(re.copyFail(e))}};i(Sn,"Connection");var Tn=Sn;La.exports=Tn});var ka=C((kT,Ua)=>{"use strict";var{Transform:Zm}=require("stream"),{StringDecoder:Jm}=require("string_decoder"),xe=Symbol("last"),Pt=Symbol("decoder");function ed(t,e,r){let n;if(this.overflow){if(n=this[Pt].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[xe]+=this[Pt].write(t),n=this[xe].split(this.matcher);this[xe]=n.pop();for(let s=0;s<n.length;s++)try{Fa(this,this.mapper(n[s]))}catch(a){return r(a)}if(this.overflow=this[xe].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(ed,"transform");function td(t){if(this[xe]+=this[Pt].end(),this[xe])try{Fa(this,this.mapper(this[xe]))}catch(e){return t(e)}t()}i(td,"flush");function Fa(t,e){e!==void 0&&t.push(e)}i(Fa,"push");function Ma(t){return t}i(Ma,"noop");function rd(t,e,r){switch(t=t||/\r?\n/,e=e||Ma,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Ma)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=ed,r.flush=td,r.readableObjectMode=!0;let n=new Zm(r);return n[xe]="",n[Pt]=new Jm("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,a){this._writableState.errorEmitted=!1,a(s)},n}i(rd,"split");Ua.exports=rd});var Ka=C((BT,we)=>{"use strict";var $a=require("path"),nd=require("stream").Stream,sd=ka(),Ba=require("util"),id=5432,Lt=process.platform==="win32",ft=process.stderr,ad=56,od=7,cd=61440,ud=32768;function ld(t){return(t&cd)==ud}i(ld,"isRegFile");var Qe=["host","port","database","user","password"],An=Qe.length,pd=Qe[An-1];function Nn(){var t=ft instanceof nd&&ft.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);ft.write(Ba.format.apply(Ba,e))}}i(Nn,"warn");Object.defineProperty(we.exports,"isWin",{get:function(){return Lt},set:function(t){Lt=t}});we.exports.warnTo=function(t){var e=ft;return ft=t,e};we.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Lt?$a.join(e.APPDATA||"./","postgresql","pgpass.conf"):$a.join(e.HOME||"./",".pgpass"));return r};we.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Lt?!0:(e=e||"<unkn>",ld(t.mode)?t.mode&(ad|od)?(Nn('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Nn('WARNING: password file "%s" is not a plain file',e),!1))};var md=we.exports.match=function(t,e){return Qe.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||id)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};we.exports.getPassword=function(t,e,r){var n,s=e.pipe(sd());function a(u){var l=dd(u);l&&fd(l)&&md(t,l)&&(n=l[pd],s.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(u){e.destroy(),Nn("WARNING: error on reading file: %s",u),r(void 0)},"onErr");e.on("error",c),s.on("data",a).on("end",o).on("error",c)};var dd=we.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,a=0,o={},c=!1,u=i(function(d,p,m){var f=t.substring(p,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),o[Qe[d]]=f},"addToObj"),l=0;l<t.length-1;l+=1){if(e=t.charAt(l+1),r=t.charAt(l),c=n==An-1,c){u(n,s);break}l>=0&&e==":"&&r!=="\\"&&(u(n,s,l+1),s=l+2,n+=1)}return o=Object.keys(o).length===An?o:null,o},fd=we.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<Qe.length;r+=1){var n=e[r],s=t[Qe[r]]||"",a=n(s);if(!a)return!1}return!0}});var Va=C((VT,bn)=>{"use strict";var GT=require("path"),Ga=require("fs"),Mt=Ka();bn.exports=function(t,e){var r=Mt.getFileName();Ga.stat(r,function(n,s){if(n||!Mt.usePgPass(s,r))return e(void 0);var a=Ga.createReadStream(r);Mt.getPassword(t,a,e)})};bn.exports.warnTo=Mt.warnTo});var Ya=C((HT,Qa)=>{"use strict";var hd=require("events").EventEmitter,Ha=mt(),In=pa(),gd=Nr(),yd=Or(),Wa=Na(),_d=pt(),Ed=Cn(),Td=Ar(),vn=class vn extends hd{constructor(e){super(),this.connectionParameters=new yd(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new gd(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Ed({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||_d.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{Va()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await Td.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=In.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await In.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{In.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Ha.escapeIdentifier(e)}escapeLiteral(e){return Ha.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,a,o,c,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(o=this.connectionParameters.query_timeout,s=new Wa(e,r,n),s.callback||(a=new this._Promise((l,d)=>{s.callback=(p,m)=>p?d(p):l(m)}).catch(l=>{throw Error.captureStackTrace(l),l}))),o&&(u=s.callback,c=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),u(l),s.callback=()=>{};var d=this.queryQueue.indexOf(s);d>-1&&this.queryQueue.splice(d,1),this._pulseQueryQueue()},o),s.callback=(l,d)=>{clearTimeout(c),u(l,d)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(s),this._pulseQueryQueue(),a):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(vn,"Client");var Ft=vn;Ft.Query=Wa;Qa.exports=Ft});var Za=C((QT,Xa)=>{"use strict";var Sd=require("events").EventEmitter,ja=i(function(){},"NOOP"),za=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),wn=class wn{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(wn,"IdleItem");var On=wn,Dn=class Dn{constructor(e){this.callback=e}};i(Dn,"PendingItem");var Ye=Dn;function Cd(){throw new Error("Release called on client which has already been released to the pool.")}i(Cd,"throwOnDoubleRelease");function Ut(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(o,c){o?r(o):n(c)},"cb"),a=new t(function(o,c){n=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:s,result:a}}i(Ut,"promisify");function Ad(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(Ad,"makeIdleListener");var qn=class qn extends Sd{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||xn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=za(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=Ut(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Ye(r.callback)),n;let s=i((c,u,l)=>{clearTimeout(o),r.callback(c,u,l)},"queueCallback"),a=new Ye(s),o=setTimeout(()=>{za(this._pendingQueue,c=>c.callback===s),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),n}return this.newClient(new Ye(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=Ad(this,r);this.log("checking client timeout");let s,a=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(s&&clearTimeout(s),r.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,ja);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(l=>l.client===r)!==-1&&this._acquireClient(r,new Ye((l,d,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,ja);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&Cd(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new On(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Ut(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let s=Ut(this.Promise,n);return n=s.callback,this.connect((a,o)=>{if(a)return n(a);let c=!1,u=i(l=>{c||(c=!0,o.release(l),n(l))},"onError");o.once("error",u),this.log("dispatching query");try{o.query(e,r,(l,d)=>{if(this.log("query dispatched"),o.removeListener("error",u),!c)return c=!0,o.release(l),l?n(l):n(void 0,d)})}catch(l){return o.release(l),n(l)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Ut(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(qn,"Pool");var Rn=qn;Xa.exports=Rn});var to=C((jT,eo)=>{"use strict";var Ja=require("events").EventEmitter,Nd=require("util"),Pn=mt(),je=eo.exports=function(t,e,r){Ja.call(this),t=Pn.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};Nd.inherits(je,Ja);var bd={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};je.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=bd[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};je.prototype.then=function(t,e){return this._getPromise().then(t,e)};je.prototype.catch=function(t){return this._getPromise().catch(t)};je.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};je.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((u,l)=>{u.forEach(d=>{e.emit("row",d,c[l])})}):o.forEach(function(u){e.emit("row",u,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(Pn.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var s=this.values.map(Pn.prepareValue);t.native.query(this.text,s,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var ao=C((XT,io)=>{"use strict";var ro;try{ro=require("pg-native")}catch(t){throw t}var Id=Nr(),no=require("events").EventEmitter,vd=require("util"),Od=Or(),so=to(),ue=io.exports=function(t){no.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new Id(t.types),this.native=new ro({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new Od(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ue.Query=so;vd.inherits(ue,no);ue.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ue.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ue.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ue.prototype.query=function(t,e,r){var n,s,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,n=new so(t,e,r),!n.callback){let u,l;s=new this._Promise((d,p)=>{u=d,l=p}).catch(d=>{throw Error.captureStackTrace(d),d}),n.callback=(d,p)=>d?l(d):u(p)}return a&&(c=n.callback,o=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),c(u),n.callback=()=>{};var l=this._queryQueue.indexOf(n);l>-1&&this._queryQueue.splice(l,1),this._pulseQueryQueue()},a),n.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};ue.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(a=>a?s(a):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ue.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ue.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};ue.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ue.prototype.ref=function(){};ue.prototype.unref=function(){};ue.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ue.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Ln=C((JT,oo)=>{"use strict";oo.exports=ao()});var xn=C((eS,ht)=>{"use strict";var Rd=Ya(),wd=pt(),Dd=Cn(),qd=Za(),{DatabaseError:xd}=_n(),{escapeIdentifier:Pd,escapeLiteral:Ld}=mt(),Md=i(t=>{var e;return e=class extends qd{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),Mn=i(function(t){this.defaults=wd,this.Client=t,this.Query=this.Client.Query,this.Pool=Md(this.Client),this._pools=[],this.Connection=Dd,this.types=lt(),this.DatabaseError=xd,this.escapeIdentifier=Pd,this.escapeLiteral=Ld},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ht.exports=new Mn(Ln()):(ht.exports=new Mn(Rd),Object.defineProperty(ht.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new Mn(Ln())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ht.exports,"native",{value:t}),t}}))});var uo=C((rS,co)=>{"use strict";var ze=require("fs"),Fd=xn(),Ud="The server does not support SSL connections",kd="28000",$d=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,a){e.info("Certificate",{hostname:s,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return ze.existsSync(t.certAuthority)&&(n.ca=ze.readFileSync(t.certAuthority).toString()),ze.existsSync(t.clientCert)&&(n.cert=ze.readFileSync(t.clientCert).toString()),ze.existsSync(t.clientPrivateKey)&&(n.key=ze.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),Bd=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),Kd=i(async(t,e,r)=>{let n=!1;if(t.ssh){let{options:o}=await e.openTunnel({sshAuthMethod:t.ssh_method==="privateKey"?"IDENTITY_FILE":"USER_PASSWORD",sshTunnelHostname:t.ssh_host,sshTunnelPort:t.ssh_port,sshTunnelUsername:t.ssh_user,sshTunnelPassword:t.ssh_password,sshTunnelIdentityFile:t.ssh_key_file,sshTunnelPassphrase:t.ssh_key_passphrase,host:t.host,port:t.port});t={...t,...o},n=!0}t=Object.assign({},t,{sslType:Bd(t.sslType)});let s={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:$d(t,r),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await Fn(s,r),isSshTunnel:n}},"createClient"),Gd=i((t,e,r)=>{var n;if(r.message===Ud&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),Fn({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===kd&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),Fn({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),Fn=i((t,e)=>{let r=new Fd.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return Gd(t,e,n)})},"createConnectionPool");co.exports={createClient:Kd}});var kn=C((sS,mo)=>{"use strict";var Un=i(t=>`
        SELECT indexname,
               index_method,
               index_unique,
               index_indnullsnotdistinct,
               number_of_keys,
               where_expression,
               array_agg(attname
                         ORDER BY ord)::text[] AS columns,
               array_agg(coll
                         ORDER BY ord) AS collations,
               array_agg(opclass
                         ORDER BY ord) AS opclasses,
               array_agg(expression
                         ORDER BY ord) AS expressions,
               array_agg(ascending
                         ORDER BY ord) AS ascendings,
               array_agg(nulls_first
                         ORDER BY ord) AS nulls_first,
                reloptions AS storage_parameters,
                tablespace_name
        FROM
            (SELECT ct.oid AS table_oid,
                    c.relname AS indexname,
                    m.amname AS index_method,
                    indexes.indisunique AS index_unique,
                    ${t===15?"indexes.indnullsnotdistinct":"FALSE"} AS index_indnullsnotdistinct,
                    indexes.ord,
                    attribute.attname,
                     c.reloptions,
                     tablespace_t.spcname AS tablespace_name,
                    indexes.${t===10?"indnatts":"indnkeyatts"} AS number_of_keys,
                    pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
                    CASE
                        WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
                    END AS coll,
                    CASE
                        WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
                    END AS opclass,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'asc')
                    END AS ascending,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'nulls_first')
                    END AS nulls_first,
                    pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
             FROM
                 (SELECT *,
                         generate_series(1,array_length(i.indkey,1)) AS ord,
                         unnest(i.indkey) AS key,
                         unnest(i.indcollation) AS coll,
                         unnest(i.indclass) AS class,
                         unnest(i.indoption) AS option
                  FROM pg_catalog.pg_index i) indexes
             JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
             JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
             JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
             LEFT JOIN pg_catalog.pg_attribute attribute ON (attribute.attrelid=indexes.indrelid
                                                  AND attribute.attnum=indexes.key)
             LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
             LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
             LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
             LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
             LEFT JOIN pg_catalog.pg_tablespace tablespace_t ON (tablespace_t.oid = c.reltablespace)) s2
        WHERE table_oid = $1
        GROUP BY indexname,
                 index_method,
                 index_unique,
                 index_indnullsnotdistinct,
                 reloptions,
                 number_of_keys,
                 where_expression,
                 tablespace_name;
        `,"getGET_TABLE_INDEXES"),lo=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),po={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
        SELECT tables.table_name, tables.table_type FROM information_schema.tables AS tables
        INNER JOIN 
        (SELECT
                pg_class.relname AS table_name,
                 pg_namespace.nspname AS table_schema
        FROM pg_catalog.pg_class AS pg_class
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace 
                ON (pg_namespace.oid = pg_class.relnamespace)
        WHERE pg_class.relispartition = false
                AND pg_class.relkind = ANY('{"r","v","t","m","p"}'))
        AS catalog_table_data
        ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
	LEFT JOIN (SELECT relname AS child_name FROM pg_catalog.pg_inherits AS inherit
		LEFT JOIN pg_catalog.pg_class AS child ON (child.oid = inherit.inhrelid)) AS inherited_tables
	ON (inherited_tables.child_name = tables.table_name)
	WHERE inherited_tables.child_name IS NULL
        AND tables.table_schema = $1;`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pt.spcname, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc 
            LEFT JOIN pg_catalog.pg_tablespace AS pt 
            ON pc.reltablespace = pt.oid
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_PARTITION_DATA:`
        SELECT partstrat as partition_method,
	            partattrs::int2[] as partition_attributes_positions,
	            pg_catalog.pg_get_expr(partexprs, partrelid) AS expressions
            FROM pg_catalog.pg_partitioned_table
            WHERE partrelid = $1;`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_SAMPLED_DATA_SIZE:(t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,GET_INHERITS_PARENT_TABLE_NAME:`
        SELECT pc.relname AS parent_table_name FROM pg_catalog.pg_inherits AS pi
	        INNER JOIN pg_catalog.pg_class AS pc
	        ON pc.oid = pi.inhparent
	        WHERE pi.inhrelid = $1;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.connoinherit AS no_inherit,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters,
	            pt.spcname AS tablespace
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        LEFT JOIN pg_catalog.pg_tablespace AS pt
	        ON pc.reltablespace = pt.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:Un(),GET_TABLE_INDEXES_V_10:Un(10),GET_TABLE_INDEXES_V_15:Un(15),GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_tablespace AS pt ON pc.reltablespace = pt.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:lo(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:lo(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND ((pg_type.typtype = 'c'
               AND pg_class.relkind = 'c')
              OR pg_type.typtype = 'e'
              OR pg_type.typtype = 'r')
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DOMAIN_TYPES:"SELECT * FROM information_schema.domains WHERE domain_schema = $1",GET_DOMAIN_TYPES_CONSTRAINTS:`
        SELECT pg_type.typname AS type_name,
        	pg_type.typnotnull AS not_null,
        	pg_constraint.conname AS constraint_name,
        	pg_catalog.pg_get_expr(pg_constraint.conbin, pg_constraint.conrelid) AS expression
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_constraint AS pg_constraint ON (pg_constraint.contypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        WHERE pg_type.typname = $1 AND pg_namespace.nspname = $2 AND pg_constraint.contype = 'c';`,GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;",GET_TRIGGERS:`
        SELECT trigger_name,
                array_agg(event_manipulation::text) AS trigger_events,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement
        FROM
            -- This is information_schema.triggers view but without permitions
            (SELECT (current_database())::information_schema.sql_identifier AS trigger_catalog,
                    (n.nspname)::information_schema.sql_identifier AS trigger_schema,
                    (t.tgname)::information_schema.sql_identifier AS trigger_name,
                    (em.text)::information_schema.character_data AS event_manipulation,
                    (current_database())::information_schema.sql_identifier AS event_object_catalog,
                    (n.nspname)::information_schema.sql_identifier AS event_object_schema,
                    (c.relname)::information_schema.sql_identifier AS event_object_table,
                    (rank() OVER (PARTITION BY (n.nspname)::information_schema.sql_identifier,
                                               (c.relname)::information_schema.sql_identifier,
                                               em.num, ((t.tgtype)::integer & 1), ((t.tgtype)::integer & 66)
                                  ORDER BY t.tgname))::information_schema.cardinal_number AS action_order,
                    (regexp_match(pg_get_triggerdef(t.oid), '.{35,} WHEN ((.+)) EXECUTE FUNCTION'::text))[1]::information_schema.character_data AS action_condition,
                    (SUBSTRING(pg_get_triggerdef(t.oid)
                               FROM (POSITION(('EXECUTE FUNCTION'::text) IN (SUBSTRING(pg_get_triggerdef(t.oid)
                                                                                       FROM 48))) + 47)))::information_schema.character_data AS action_statement,
                    (CASE ((t.tgtype)::integer & 1)
                         WHEN 1 THEN 'ROW'::text
                         ELSE 'STATEMENT'::text
                     END)::information_schema.character_data AS action_orientation,
                    (CASE ((t.tgtype)::integer & 66)
                         WHEN 2 THEN 'BEFORE'::text
                         WHEN 64 THEN 'INSTEAD OF'::text
                         ELSE 'AFTER'::text
                     END)::information_schema.character_data AS action_timing,
                    (t.tgoldtable)::information_schema.sql_identifier AS action_reference_old_table,
                    (t.tgnewtable)::information_schema.sql_identifier AS action_reference_new_table,
                    (NULL::timestamp with time zone)::information_schema.time_stamp AS created
                FROM pg_namespace n,
                        pg_class c,
                        pg_trigger t, (VALUES (4,'INSERT'::text), (8,'DELETE'::text), (16,'UPDATE'::text)) em(num, text)
                WHERE ((n.oid = c.relnamespace)
                        AND (c.oid = t.tgrelid)
                        AND (((t.tgtype)::integer & em.num) <> 0)
                        AND (NOT t.tgisinternal)
                        AND (NOT pg_is_other_temp_schema(n.oid)))) AS tmp_views
        WHERE event_object_schema = $1 AND event_object_table = $2
        GROUP BY
                trigger_schema,
                trigger_name,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement;`,GET_TRIGGERS_ADDITIONAL_DATA:`
        SELECT
                pg_catalog.obj_description(pg_trigger.oid, 'pg_trigger') AS description,
        	pg_trigger.tgname AS trigger_name,
        	pg_proc.proname AS function_name,
        	CASE WHEN pg_trigger.tgconstraint != 0 THEN true ELSE false END AS "constraint",
        	array_agg(pg_attribute.attname)::text[] AS update_attributes,
        	tgdeferrable AS "deferrable",
        	tginitdeferred AS deferred,
                pg_class_referenced.relname AS referenced_table_name,
                pg_namespace_referenced.nspname AS referenced_table_schema
        FROM pg_catalog.pg_trigger as pg_trigger
        LEFT JOIN pg_catalog.pg_proc AS pg_proc 
        	ON (pg_trigger.tgfoid = pg_proc.oid)
        LEFT JOIN pg_catalog.pg_attribute AS pg_attribute
        	ON (pg_attribute.attnum = ANY(pg_trigger.tgattr::int2[]) AND pg_trigger.tgrelid = pg_attribute.attrelid)
        INNER JOIN pg_catalog.pg_class AS pg_class
        	ON (pg_class.oid = pg_trigger.tgrelid)
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace
        	ON (pg_class.relnamespace = pg_namespace.oid)
        LEFT JOIN pg_catalog.pg_class AS pg_class_referenced
                ON(pg_class_referenced.oid = pg_trigger.tgconstrrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace_referenced
                ON(pg_namespace_referenced.oid = pg_class_referenced.relnamespace)
        WHERE pg_class.relnamespace = $1 AND pg_class.oid = $2
        GROUP BY 
        	trigger_name,
        	function_name,
        	"constraint",
        	"deferrable",
        	deferred,
                description,
                referenced_table_name,
                referenced_table_schema;`,GET_PARTITIONS:`
        SELECT
        	inher_child.relname AS child_name,
        	inher_parent.relname AS parent_name,
                CASE WHEN inher_parent.relkind = 'p' THEN TRUE ELSE FALSE END AS is_parent_partitioned
        FROM pg_inherits
        LEFT JOIN pg_class AS inher_child ON (inher_child.oid = pg_inherits.inhrelid)
        LEFT JOIN pg_class AS inher_parent ON (inher_parent.oid = pg_inherits.inhparent)
        WHERE inher_parent.relnamespace = $1;`,GET_SEQUENCES:`
        SELECT DISTINCT ON (sequence_name)
                information_schema."sequences".sequence_name,
                information_schema."sequences".data_type,
                information_schema."sequences".start_value,
                information_schema."sequences".minimum_value,
                information_schema."sequences".maximum_value,
                information_schema."sequences"."increment",
                information_schema."sequences".cycle_option,
                pg_catalog.pg_sequences.cache_size,
                pg_class.relpersistence as rel_persistance,
                inner_pg_class.relname AS table_name,
                pg_attribute.attname AS column_name
        FROM information_schema."sequences"
        JOIN pg_class ON pg_class.relname = information_schema."sequences".sequence_name
        JOIN pg_depend ON pg_depend.objid = pg_class.oid
        LEFT JOIN pg_catalog.pg_sequences ON (pg_catalog.pg_sequences.schemaname, pg_catalog.pg_sequences.sequencename) = (information_schema."sequences".sequence_schema, information_schema."sequences".sequence_name)
        LEFT JOIN pg_class AS inner_pg_class ON pg_depend.refobjid = inner_pg_class.oid
        LEFT JOIN pg_attribute ON (pg_depend.refobjid, pg_depend.refobjsubid) = (pg_attribute.attrelid, pg_attribute.attnum)
        WHERE pg_class.relkind = 'S'
        AND information_schema."sequences".sequence_schema = $1
        ORDER BY sequence_name, column_name;
        `},Vd=i(t=>(Object.entries(po).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");mo.exports={getQueryName:Vd,...po}});var ho=C((aS,fo)=>{"use strict";var Hd=kn(),ke=null,kt=null;fo.exports={initializeClient(t,e){ke=t,kt=e,ke.on("error",r=>e.error(r))},isClientInitialized(){return!!ke},releaseClient(){return ke?new Promise(t=>{ke.end(()=>{ke=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=Hd.getQueryName(t);kt.info("Execute query",{queryName:n,params:e});let s=Date.now(),a=await ke.query(t,e),o=Date.now()-s;kt.info("Query executed",{queryName:n,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,kt.error(n),null}}}});var _o=C((oS,yo)=>{"use strict";var go=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...go(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");yo.exports={getJsonSchema:go}});var $n=C((uS,Eo)=>{"use strict";var Pe=null,Wd=i(t=>{Pe=t.require("lodash")},"setDependencies"),gt={column_default:"default",is_nullable:{keyword:"required",values:{YES:!1,NO:!0}},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e)=>e!==-1&&tf(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:"length",description:"description",domain_name:"domain_name"},Qd=i((t,e,r)=>{var n;return(n=gt[e])!=null&&n.check?gt[e].check(t,r)?r:"":Pe.get(gt,`${e}.values.${r}`,r)},"getColumnValue"),Yd=i(t=>e=>Pe.chain(e).toPairs().map(([r,n])=>{var s;return[((s=gt[r])==null?void 0:s.keyword)||gt[r],Qd(e,r,n)]}).filter(([r,n])=>r&&!Pe.isNil(n)).fromPairs().thru(jd(t)).value(),"mapColumnData"),jd=i(t=>e=>({...e,...zd(t,e)}),"setColumnType"),zd=i((t,e)=>e.type==="ARRAY"?Xd(t,e):e.type==="USER-DEFINED"?$t(t,e.udt_name):e.domain_name?$t(t,e.domain_name):$t(t,e.type),"getType"),Xd=i((t,e)=>({...$t(t,e.udt_name.slice(1)),array_type:Pe.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),$t=i((t,e)=>{switch(e){case"bigint":case"bigserial":case"smallint":case"integer":case"numeric":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"int8":return{type:"numeric",mode:"bigint"};case"int2":return{type:"numeric",mode:"smallint"};case"int4":return{type:"numeric",mode:"integer"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return Pe.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Zd=i((t,e)=>{let r=Pe.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],a=Jd(s),o=ef(a);return{...n,subtype:o}})},"setSubtypeFromSampledJsonValues"),Jd=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),ef=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),tf=i(t=>Pe.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");Eo.exports={setDependencies:Wd,mapColumnData:Yd,setSubtypeFromSampledJsonValues:Zd}});var yt=C((pS,To)=>{"use strict";var rf=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],Xe=null,nf=i(t=>{Xe=t.require("lodash")},"setDependencies"),sf=i(t=>Xe.chain(t).toPairs().reject(([e,r])=>Xe.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),af=i(t=>e=>{var r;return(r=Xe.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),of=i(t=>/\s|\W/.test(t)||Xe.includes(rf,Xe.toUpper(t))?`"${t}"`:t,"wrapInQuotes");To.exports={clearEmptyPropertiesInObject:sf,setDependencies:nf,getColumnNameByPosition:af,wrapInQuotes:of}});var Ao=C((dS,Co)=>{"use strict";var{getColumnNameByPosition:cf}=yt(),Bn=null,uf=i(t=>{Bn=t.require("lodash")},"setDependencies"),So=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),lf=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";case"p":return"PARTIAL";default:return""}},"prepareMatch"),pf=i((t,e,r,n)=>Bn.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:Bn.map(s.table_columns_positions,cf(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:So(s.relationship_on_delete),relationshipOnUpdate:So(s.relationship_on_update),relationshipMatch:lf(s.relationship_match)}})),"prepareForeignKeys");Co.exports={setDependencies:uf,prepareForeignKeys:pf}});var Io=C((hS,bo)=>{"use strict";var Bt=null,mf=i(t=>{Bt=t.require("lodash")},"setDependencies"),No=i(t=>Bt.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:df(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),df=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),ff=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),hf=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),gf=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),yf=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:No(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:Bt.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:ff(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:gf(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:hf(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),_f=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:Bt.toLower(t.external_language),inputArgs:No(e),body:t.routine_definition}),"mapProcedureData");bo.exports={setDependencies:mf,mapFunctionData:yf,mapProcedureData:_f}});var Do=C((yS,wo)=>{"use strict";var{clearEmptyPropertiesInObject:_t,getColumnNameByPosition:Kt}=yt(),$=null,Ef=i(t=>{$=t.require("lodash")},"setDependencies"),Oo=i((t,e)=>{if(!t&&!e)return null;let r=vo(t),n=vo(e==null?void 0:e.toast_options),s=r.fillfactor,a=r.parallel_workers,o=r.autovacuum_enabled,c=_t({vacuum_index_cleanup:r.vacuum_index_cleanup,vacuum_truncate:r.vacuum_truncate,autovacuum_vacuum_threshold:r.autovacuum_vacuum_threshold,autovacuum_vacuum_scale_factor:r.autovacuum_vacuum_scale_factor,autovacuum_vacuum_insert_threshold:r.autovacuum_vacuum_insert_threshold,autovacuum_vacuum_insert_scale_factor:r.autovacuum_vacuum_insert_scale_factor,autovacuum_analyze_threshold:r.autovacuum_analyze_threshold,autovacuum_analyze_scale_factor:r.autovacuum_analyze_scale_factor,autovacuum_vacuum_cost_delay:r.autovacuum_vacuum_cost_delay,autovacuum_vacuum_cost_limit:r.autovacuum_vacuum_cost_limit,autovacuum_freeze_min_age:r.autovacuum_freeze_min_age,autovacuum_freeze_max_age:r.autovacuum_freeze_max_age,autovacuum_freeze_table_age:r.autovacuum_freeze_table_age,autovacuum_multixact_freeze_min_age:r.autovacuum_multixact_freeze_min_age,autovacuum_multixact_freeze_max_age:r.autovacuum_multixact_freeze_max_age,autovacuum_multixact_freeze_table_age:r.autovacuum_multixact_freeze_table_age,log_autovacuum_min_duration:r.log_autovacuum_min_duration}),u=r.user_catalog_table,l=n.autovacuum_enabled,d=_t({toast_tuple_target:r.toast_tuple_target,toast_vacuum_index_cleanup:n.vacuum_index_cleanup,toast_vacuum_truncate:n.vacuum_truncate,toast_autovacuum_vacuum_threshold:n.autovacuum_vacuum_threshold,toast_autovacuum_vacuum_scale_factor:n.autovacuum_vacuum_scale_factor,toast_autovacuum_vacuum_insert_threshold:n.autovacuum_vacuum_insert_threshold,toast_autovacuum_vacuum_insert_scale_factor:n.autovacuum_vacuum_insert_scale_factor,toast_autovacuum_vacuum_cost_delay:n.autovacuum_vacuum_cost_delay,toast_autovacuum_vacuum_cost_limit:n.autovacuum_vacuum_cost_limit,toast_autovacuum_freeze_min_age:n.autovacuum_freeze_min_age,toast_autovacuum_freeze_max_age:n.autovacuum_freeze_max_age,toast_autovacuum_freeze_table_age:n.autovacuum_freeze_table_age,toast_autovacuum_multixact_freeze_min_age:n.autovacuum_multixact_freeze_min_age,toast_autovacuum_multixact_freeze_max_age:n.autovacuum_multixact_freeze_max_age,toast_autovacuum_multixact_freeze_table_age:n.autovacuum_multixact_freeze_table_age,toast_log_autovacuum_min_duration:n.log_autovacuum_min_duration}),p={fillfactor:s,parallel_workers:a,autovacuum_enabled:o,autovacuum:$.isEmpty(c)?null:c,toast_autovacuum_enabled:l,toast:$.isEmpty(d)?null:d,user_catalog_table:u};return _t(p)},"prepareStorageParameters"),Tf=i((t,e)=>{if(!t)return null;let r=Sf(t),n=$.some(t.partition_attributes_positions,o=>o===0),s=n?"partitioning_expression":"compositePartitionKey",a=n?Cf(t,e):$.map(t.partition_attributes_positions,Kt(e));return[{partitionMethod:r,partitionBy:n?"expression":"keys",[s]:a}]},"prepareTablePartition"),Sf=i(t=>{switch(t.partition_method){case"h":return"HASH";case"l":return"LIST";case"r":return"RANGE";default:return""}},"getPartitionMethod"),Cf=i((t,e)=>{let r=0,n=$.split(t.expressions,",");return $.chain(t.partition_attributes_positions).map(s=>{if(s===0){let a=n[r];return r++,a}return Kt(e)(s)}).join(",").value()},"getPartitionExpression"),Ro=i(t=>$.split(t,"="),"splitByEqualitySymbol"),Af=i(t=>$.find(t,{type:"json"}),"checkHaveJsonTypes"),Nf=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),bf=i((t,e,r)=>$.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,Of(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,If(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,vf(s,e,r)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),If=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:$.map(t.constraint_keys,Kt(e)),indexStorageParameters:$.join(t.storage_parameters,","),indexTablespace:t.tablespace}),"getPrimaryKeyConstraint"),vf=i((t,e,r)=>{let n=$.find(r,a=>a.indexname===t.constraint_name),s=n!=null&&n.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"";return{constraintName:t.constraint_name,compositeUniqueKey:$.map(t.constraint_keys,Kt(e)),indexStorageParameters:$.join(t.storage_parameters,","),indexTablespace:t.tablespace,indexComment:t.description,...s&&{nullsDistinct:s}}},"getUniqueKeyConstraint"),Of=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,noInherit:t.no_inherit,constrDescription:t.description}),"getCheckConstraint"),Rf=i(t=>$.map(t,e=>{let r=wf(e),n=$.slice(r,0,e.number_of_keys),s=$.chain(r).slice(e.number_of_keys).map(c=>$.pick(c,"name")).value(),a=e.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"",o={indxName:e.indexname,index_method:e.index_method,unique:e.index_unique??!1,index_tablespace_name:e.tablespace_name||"",index_storage_parameter:qf(e.storage_parameters),where:e.where_expression||"",include:s,columns:e.index_method==="btree"?n:$.map(n,c=>$.omit(c,"sortOrder","nullsOrder")),...a&&{nullsDistinct:a}};return _t(o)}),"prepareTableIndexes"),wf=i(t=>$.chain(t.columns).map((e,r)=>{if(!e)return;let n=$.get(t,`ascendings.${r}`,!1)?"ASC":"DESC",s=Df($.get(t,`nulls_first.${r}`)),a=$.get(t,`opclasses.${r}`,""),o=$.get(t,`collations.${r}`,"");return{name:e,sortOrder:n,nullsOrder:s,opclass:a,collation:o}}).compact().value(),"mapIndexColumns"),Df=i(t=>$.isNil(t)?"":t?"NULLS FIRST":"NULLS LAST","getNullsOrder"),qf=i(t=>{if(!t)return null;let e=$.fromPairs($.map(t,n=>Ro(n))),r={index_fillfactor:e.fillfactor,deduplicate_items:e.deduplicate_items,index_buffering:e.index_buffering,fastupdate:e.fastupdate,gin_pending_list_limit:e.gin_pending_list_limit,pages_per_range:e.pages_per_range,autosummarize:e.autosummarize};return _t(r)},"getIndexStorageParameters"),xf=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Oo(t==null?void 0:t.reloptions,e),a=t==null?void 0:t.spcname,o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,table_tablespace_name:a,partitionBounds:o}},"prepareTableLevelData"),Pf=i(t=>{switch(Lf(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),Lf=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),vo=i(t=>$.chain(t).map(Ro).map(([e,r])=>[e,Pf(r)]).fromPairs().value()||{},"prepareOptions"),Mf=i((t,e)=>$.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");wo.exports={prepareStorageParameters:Oo,prepareTablePartition:Tf,setDependencies:Ef,checkHaveJsonTypes:Af,prepareTableConstraints:bf,prepareTableLevelData:xf,prepareTableIndexes:Rf,getSampleDocSize:Nf,prepareTableInheritance:Mf}});var xo=C((ES,qo)=>{"use strict";var{mapColumnData:Ff}=$n(),Ce=null,Uf=i(t=>{Ce=t.require("lodash")},"setDependencies"),kf=i((t,e)=>Ce.chain(t).map(r=>{switch(r.type){case"e":return $f(r);case"r":return Bf(r);case"c":return Kf(r);default:return null}}).compact().concat(Ce.map(e,Vf)).value(),"getUserDefinedTypes"),$f=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Bf=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Kf=i(t=>{let e=Ce.map(t.columns,Ff([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Gf=i(t=>t.type==="c","isTypeComposite"),Vf=i(t=>{var e;return{name:t.domain_name,type:"domain",underlyingType:Ce.flow(Wf(t),Qf(t),Yf(t),jf(t))(Hf(t)),collation:t.collation_name||"",default:t.domain_default||"",required:(e=Ce.first(t.constraints))==null?void 0:e.not_null,checkConstraints:Ce.map(t.constraints,zf)}},"mapDomainType"),Hf=i(t=>t.data_type==="USER-DEFINED"?t.udt_name:t.data_type,"getUnderlyingType"),Wf=i(t=>e=>t.character_maximum_length?`${e}(${t.character_maximum_length})`:e,"setLength"),Qf=i(t=>e=>e!=="numeric"?e:Ce.isNumber(t.numeric_precision)&&Ce.isNumber(t.numeric_scale)?`${e}(${t.numeric_precision},${t.numeric_scale})`:Ce.isNumber(t.numeric_precision)?`${e}(${t.numeric_precision})`:e,"setPrecisionAndScale"),Yf=i(t=>e=>t.interval_type?`${e} ${t.interval_type}`:e,"setIntervalType"),jf=i(t=>e=>Ce.isNumber(t.interval_precision)?`${e}(${t.interval_precision})`:e,"setIntervalPrecision"),zf=i(t=>({name:t.constraint_name,expression:t.expression}),"mapDomainConstraint");qo.exports={setDependencies:Uf,getUserDefinedTypes:kf,isTypeComposite:Gf}});var Lo=C((SS,Po)=>{"use strict";var{clearEmptyPropertiesInObject:Xf,wrapInQuotes:Zf}=yt(),De=null,Jf=i(t=>{De=t.require("lodash")},"setDependencies"),Kn=" (v)",eh=i(t=>t==="VIEW","isViewByTableType"),th=i(t=>De.endsWith(t,Kn),"isViewByName"),rh=i(t=>t.slice(0,-Kn.length),"removeViewNameSuffix"),nh=i(t=>`${t}${Kn}`,"setViewSuffix"),sh=i((t,e,r={})=>{let n=De.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${Zf(t)} AS ${n}`:""},"generateCreateViewScript"),ih=i((t,e,r)=>{let n={withCheckOption:t.check_option!=="NONE"||De.isNil(t.check_option),checkTestingScope:ah(t.check_option),viewOptions:De.fromPairs(De.map(e==null?void 0:e.view_options,ch)),temporary:(e==null?void 0:e.persistence)==="t",recursive:oh(t),description:e==null?void 0:e.description,triggers:r};return Xf(n)},"prepareViewData"),ah=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),oh=i(t=>De.startsWith(De.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),ch=i(t=>De.split(t,"="),"splitByEqualitySymbol");Po.exports={setDependencies:Jf,isViewByTableType:eh,isViewByName:th,removeViewNameSuffix:rh,generateCreateViewScript:sh,setViewSuffix:nh,prepareViewData:ih}});var Fo=C((AS,Mo)=>{"use strict";var Gt=null,uh=i(t=>{Gt=t.require("lodash")},"setDependencies"),lh=i((t,e)=>Gt.chain(t).map(r=>({...r,...Gt.find(e,{trigger_name:r.trigger_name})||{}})).map(ph).value(),"getTriggers"),ph=i(t=>{var e;return{name:t.trigger_name,triggerDescription:t.description,triggerConstraint:t.constraint,triggerTable:`${t.event_object_schema}.${t.event_object_table}`,triggerReferencedTable:t.referenced_table_name?[t.referenced_table_schema,t.referenced_table_name]:[],triggerType:t.action_timing,triggerEvents:mh(t),triggerUpdateColumns:(e=t.update_attributes)==null?void 0:e.filter(Boolean),triggerDeferrable:t.deferrable,triggerTimeConstraintCheck:t.deferred?"INITIALLY DEFERRED":"INITIALLY IMMEDIATE",triggerReferencing:!!t.action_reference_old_table||!!t.action_reference_new_table,triggerBeforeImageTransitionRelation:t.action_reference_old_table||"",triggerAfterImageTransitionRelation:t.action_reference_new_table||"",triggerEachRowStatement:t.action_orientation==="ROW"?"FOR EACH ROW":"FOR EACH STATEMENT",triggerCondition:t.action_condition,triggerFunction:dh(t.action_statement)}},"getTrigger"),mh=i(t=>Gt.map(t.trigger_events,e=>({triggerEvent:e})),"getTriggerEvents"),dh=i(t=>{var e,r,n;return((n=(r=(e=/EXECUTE (?:FUNCTION|PROCEDURE)(?<function>[\s\S]*)/.exec(t))==null?void 0:e.groups)==null?void 0:r.function)==null?void 0:n.trim())||""},"getFunctionFromTrigger");Mo.exports={setDependencies:uh,getTriggers:lh}});var $o=C((bS,ko)=>{"use strict";var fh=i((t,e)=>[hh,gh].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),hh=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:yh(t,s,n),entityLevel:Sh(e)}},"reorganizePrimaryKeys"),gh=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let o=s.compositeUniqueKey[0];return{attributes:Eh(r,o,s),entityLevel:Ch(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),yh=i((t,e,r)=>t.map(n=>n.name!==e?n:_h(n,r)),"setAttributesPrimaryKeyData"),_h=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:Uo(e)}),"setPrimaryKeyData"),Eh=i((t,e,r)=>t.map(n=>n.name!==e?n:Th(n,r)),"setAttributesUniqueKeyData"),Th=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:Uo(e)}),"setUniqueKeyData"),Uo=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexComment:t.indexComment}],"getOptions"),Sh=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Ch=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");ko.exports={reorganizeConstraints:fh}});var Vt=C((vS,Bo)=>{"use strict";var Hn=class Hn{cache;cycle;dataType;ifNotExist;increment;maxValue;minValue;ownedByColumn;ownedByNone;sequenceName;start;temporary;unlogged};i(Hn,"Sequence");var Gn=Hn,Wn=class Wn{sequence_name;increment;start;data_type;maximum_value;minimum_value;cycle_option;cache_size;rel_persistance;column_name;table_name};i(Wn,"SequenceDto");var Vn=Wn;Bo.exports={Sequence:Gn,SequenceDto:Vn}});var Go=C((DS,Ko)=>{"use strict";var{Sequence:RS,SequenceDto:wS}=Vt(),Ah=i(({sequence:t})=>t.column_name?[{entity:t.table_name,name:t.column_name}]:[],"getOwnedByColumn"),Nh=i(({sequence:t})=>({sequenceName:t.sequence_name,increment:Number(t.increment),start:Number(t.start_value),dataType:t.data_type,maxValue:Number(t.maximum_value),minValue:Number(t.minimum_value),cache:Number(t.cache_size),temporary:t.rel_persistance==="t",unlogged:t.rel_persistance==="u",cycle:t.cycle_option==="YES",ownedByColumn:Ah({sequence:t}),ownedByNone:!t.column_name}),"mapSequenceData");Ko.exports={mapSequenceData:Nh}});var jn=C((xS,Wo)=>{"use strict";var{createClient:bh}=uo(),L=ho(),{getJsonSchema:Vo}=_o(),{setDependencies:Ih,mapColumnData:vh,setSubtypeFromSampledJsonValues:Oh}=$n(),{setDependencies:Rh,clearEmptyPropertiesInObject:Ho}=yt(),{setDependencies:wh,prepareForeignKeys:Dh}=Ao(),{setDependencies:qh,mapFunctionData:xh,mapProcedureData:Ph}=Io(),{setDependencies:Lh,prepareTablePartition:Mh,checkHaveJsonTypes:Fh,prepareTableConstraints:Uh,getSampleDocSize:kh,prepareTableLevelData:$h,prepareTableIndexes:Bh,prepareTableInheritance:Kh}=Do(),{setDependencies:Gh,getUserDefinedTypes:Vh,isTypeComposite:Hh}=xo(),{setDependencies:Wh,isViewByTableType:Qh,isViewByName:Yh,removeViewNameSuffix:jh,generateCreateViewScript:zh,setViewSuffix:Xh,prepareViewData:Zh}=Lo(),{setDependencies:Jh,getTriggers:eg}=Fo(),M=kn(),{reorganizeConstraints:tg}=$o(),{mapSequenceData:rg}=Go(),Qn=!1,Y=null,le=null,Yn=16;Wo.exports={setDependencies(t){Y=t.require("lodash"),Rh(t),Lh(t),Ih(t),wh(t),Wh(t),qh(t),Gh(t),Jh(t)},async connect(t,e,r){L.isClientInitialized()&&await this.disconnect(e);let{client:n,isSshTunnel:s}=await bh(t,e,r);L.initializeClient(n,r),Qn=s,le=r,Yn=await this._getServerVersion()},async disconnect(t){Qn&&(Qn=!1,await t.closeConsumer()),await L.releaseClient()},pingDb(){return L.query(M.PING)},applyScript(t){return L.query(t)},async getDatabaseNames(){return Y.map(await L.query(M.GET_DATABASES),"database_name")},async logVersion(){let t=await L.queryTolerant(M.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved";le.info(`PostgreSQL version: ${e}`)},async getAllSchemasNames(){return(await L.query(M.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!ng(e))},async getTablesNames(t){let e=await L.query(M.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!Y.includes(r,n)).map(({table_name:n,table_type:s})=>Qh(s)?Xh(n):n)},async getDbLevelData(){var s,a,o;le.progress("Get database data");let t=(s=await L.queryTolerant(M.GET_DB_NAME,[],!0))==null?void 0:s.current_database,e=(a=await L.queryTolerant(M.GET_DB_ENCODING,[],!0))==null?void 0:a.server_encoding,r=(o=await L.queryTolerant(M.GET_DB_COLLATE_NAME,[],!0))==null?void 0:o.default_collate_name,n=`v${await this._getServerVersion()}.x`;return Ho({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r,dbVersion:n})},async retrieveEntitiesData(t,e,r,n=!1,s=!1){let a=await this._retrieveUserDefinedTypes(t),o=await L.queryTolerant(M.GET_NAMESPACE_OID,[t],!0),c=o==null?void 0:o.oid,u=n?await L.queryTolerant(M.GET_PARTITIONS,[c]):[],[l,d]=Y.partition(e,Yh),p=d.flatMap(g=>[{tableName:g},...Y.filter(u,{parent_name:g}).map(({child_name:T,is_parent_partitioned:_})=>({isParentPartitioned:_,tableName:T}))]),m=await Ze(Y.uniq(p),Y.bind(this._retrieveSingleTableData,this,r,c,t,a,s));return{views:await Ze(l,Y.bind(this._retrieveSingleViewData,this,c,t,s)),tables:m,modelDefinitions:Vo(a)}},async retrieveSchemaLevelData(t,e){var p;if(e)return le.info("Functions and procedures ignored"),{functions:[],procedures:[]};le.progress("Get Functions and Procedures",t);let r=(p=await L.queryTolerant(M.GET_NAMESPACE_OID,[t],!0))==null?void 0:p.oid,n=await L.queryTolerant(M.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await L.queryTolerant(ig(Yn),[r]),[a,o]=Y.partition(Y.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await Ze(a,async m=>{let f=await L.queryTolerant(M.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[m.specific_name]),g=Y.find(s,{function_name:m.name});return xh(m,f,g)}),u=await Ze(o,async m=>{let f=await L.queryTolerant(M.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[m.specific_name]),g=Y.find(s,{function_name:m.name});return Ph(m,f,g)}),d=(await L.queryTolerant(M.GET_SEQUENCES,[t])).map(m=>rg({sequence:m}));return{functions:c,procedures:u,sequences:d}},async _retrieveUserDefinedTypes(t){le.progress("Get User-Defined Types",t);let e=await L.queryTolerant(M.GET_USER_DEFINED_TYPES,[t]),r=await L.queryTolerant(M.GET_DOMAIN_TYPES,[t]),n=await Ze(e,async a=>Hh(a)?{...a,columns:await L.queryTolerant(M.GET_COMPOSITE_TYPE_COLUMNS,[a.pg_class_oid])}:a),s=await Ze(r,async a=>({...a,constraints:await L.queryTolerant(M.GET_DOMAIN_TYPES_CONSTRAINTS,[a.domain_name,t])}));return Vh(n,s)},async _retrieveSingleTableData(t,e,r,n,s,{tableName:a,isParentPartitioned:o}){var Ne;le.progress("Get table data",r,a);let c=await L.queryTolerant(M.GET_TABLE_LEVEL_DATA,[a,e],!0),u=c==null?void 0:c.oid,l=await L.queryTolerant(M.GET_TABLE_TOAST_OPTIONS,[a,e],!0),d=await L.queryTolerant(M.GET_TABLE_PARTITION_DATA,[u],!0),p=await this._getTableColumns(a,r,u),m=await L.queryTolerant(M.GET_DESCRIPTION_BY_OID,[u],!0),f=await L.queryTolerant(M.GET_INHERITS_PARENT_TABLE_NAME,[u]),g=await L.queryTolerant(M.GET_TABLE_CONSTRAINTS,[u]),T=await L.queryTolerant(sg(Yn),[u]),_=await L.queryTolerant(M.GET_TABLE_FOREIGN_KEYS,[u]),y=await this._getTriggers(r,a,e,u,s);le.info("Table data retrieved",{schemaName:r,tableName:a,columnTypes:p.map(sr=>sr.data_type)});let A=Mh(d,p),S=$h(c,l),b=ag(m),I=Kh(r,f),R=Uh(g,p,T),U=Bh(T),N=Dh(_,a,r,p),D={partitioning:A,description:b,triggers:y,Indxs:U,...S,...R,...o?{partitionOf:(Ne=Y.first(I))==null?void 0:Ne.parentTable}:{inherits:I}},B=Ho(D),F=p.map(vh(n)),X=Fh(F),Ie=[];X&&(Ie=await this._getDocuments(r,a,F,t),F=Oh(F,Ie));let{attributes:fe,entityLevel:P}=tg(F,B);return{name:a,entityLevel:P,jsonSchema:Vo(fe),documents:Ie,relationships:N}},async _getTriggers(t,e,r,n,s){if(s)return le.info("Triggers ignored"),[];let a=await L.queryTolerant(M.GET_TRIGGERS,[t,e]),o=await L.queryTolerant(M.GET_TRIGGERS_ADDITIONAL_DATA,[r,n]);return eg(a,o)},async _getTableColumns(t,e,r){le.progress("Get columns",e,t);let n=await L.query(M.GET_TABLE_COLUMNS,[t,e]),s=await L.queryTolerant(M.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return Y.map(n,a=>({...a,...Y.find(s,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,n){var d;le.progress("Sampling table",t,e);let s=`${t}.${e}`,a=((d=await L.queryTolerant(M.GET_ROWS_COUNT(s),[],!0))==null?void 0:d.quantity)||0,o=kh(a,n),c=r.filter(({type:p})=>Y.includes(["json","jsonb"],p)),u=Y.map(c,"name").join(", "),l=await L.queryTolerant(M.GET_SAMPLED_DATA_SIZE(s,u),[o],!0);return le.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:l==null?void 0:l._hackolade_tmp_sampling_tbl_size}),await L.queryTolerant(M.GET_SAMPLED_DATA(s,u),[o])},async _retrieveSingleViewData(t,e,r,n){le.progress("Get view data",e,n),n=jh(n);let s=await L.query(M.GET_VIEW_DATA,[n,e],!0),a=!s.view_definition&&await L.queryTolerant(M.GET_VIEW_SELECT_STMT_FALLBACK,[n,e],!0),o=await L.queryTolerant(M.GET_VIEW_OPTIONS,[n,t],!0),c=await this._getTriggers(e,n,t,o==null?void 0:o.oid,r),u=zh(n,s,a),l=Zh(s,o,c);return u?{name:n,data:l,ddl:{script:u,type:"postgres"}}:(le.info("View select statement was not retrieved",{schemaName:e,viewName:n}),{name:n,data:l,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await L.queryTolerant(M.GET_VERSION_AS_NUM,[],!0),e=Y.toNumber(t==null?void 0:t.server_version_num),r=16;return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:e>=14e4&&e<15e4?14:e>=15e4&&e<16e4?15:e>=16e4&&e<17e4?16:r}};var ng=i(t=>!!(Y.startsWith(t,"pg_")||Y.includes(["information_schema"],t)),"isSystemSchema"),sg=i(t=>t===10?M.GET_TABLE_INDEXES_V_10:t>15?M.GET_TABLE_INDEXES_V_15:M.GET_TABLE_INDEXES,"getGetIndexesQuery"),ig=i(t=>t===10?M.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:M.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),ag=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),Ze=i((t,e)=>Promise.all(Y.map(t,e)),"mapPromises")});var Yo=C((LS,Qo)=>{"use strict";var{createLogger:Ht}=or(),j=jn();Qo.exports={async disconnect(t,e,r,n){let s=n.require("@hackolade/ssh-service");await j.disconnect(s),r()},async testConnection(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{zn("Test connection",t,e);let a=Ht({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});j.setDependencies(n),await j.connect(t,s,a),await j.pingDb(),await j.logVersion(),r()}catch(a){e.log("error",$e(a),"Test connection instance log"),r($e(a))}finally{await j.disconnect(s)}},async getDatabases(t,e,r,n){let s=n.require("@hackolade/ssh-service");await j.disconnect(s);try{zn("Get databases",t,e);let a=Ht({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});j.setDependencies(n),await j.connect(t,s,a),await j.logVersion();let o=await j.getDatabaseNames();return e.log("info",o,"All databases list",t.hiddenKeys),r(null,o)}catch(a){return e.log("error",a),r($e(a))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{zn("Get DB table names",t,e);let a=Ht({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});j.setDependencies(n),t.ssh||await j.connect(t,s,a),await j.logVersion();let c=await(await j.getAllSchemasNames()).reduce(async(u,l)=>{let d=await u;try{let p=await j.getTablesNames(l);return d.concat({dbName:l,dbCollections:p,isEmpty:p.length===0})}catch(p){return a.info(`Error reading database "${l}"`),a.error(p),d.concat({dbName:l,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,c)}catch(a){e.log("error",$e(a),"Get DB collections names"),r($e(a)),await j.disconnect(s)}},async getDbCollectionsData(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let a=Ht({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});a.progress("Start reverse engineering...");let o=t.collectionData.collections,c=t.collectionData.dataBaseNames,u=await j.getDbLevelData(),{packages:l,relationships:d}=await Promise.all(c.map(async p=>{let{tables:m,views:f,modelDefinitions:g}=await j.retrieveEntitiesData(p,o[p],t.recordSamplingSettings,t.includePartitions,t.ignoreUdfUdpTriggers),{functions:T,procedures:_,triggers:y,sequences:A}=await j.retrieveSchemaLevelData(p,t.ignoreUdfUdpTriggers);return a.progress("Schema data fetched successfully",p),{schemaName:p,tables:m,views:f,functions:T,procedures:_,modelDefinitions:g,triggers:y,sequences:A}})).then(p=>{let m=p.flatMap(({tables:g})=>g.map(T=>T.relationships)).flat();return{packages:p.flatMap(({schemaName:g,tables:T,views:_,functions:y,procedures:A,triggers:S,modelDefinitions:b,sequences:I})=>{let R={UDFs:y,Procedures:A,triggers:S,sequences:I},U=T.map(N=>({dbName:g,collectionName:N.name,documents:N.documents,views:[],emptyBucket:!1,entityLevel:N.entityLevel,validation:{jsonSchema:N.jsonSchema},bucketInfo:R,modelDefinitions:b})).sort(N=>n.require("lodash").isEmpty(N.entityLevel.inherits)?-1:1);if(_!=null&&_.length){let N={dbName:g,views:_,emptyBucket:!1};return[...U,N]}return U}),relationships:m}}).then(({packages:p,relationships:m})=>({packages:og(p),relationships:m}));a.info("The data is processed and sent to the application",{packagesLength:l==null?void 0:l.length,relationshipsLength:d==null?void 0:d.length}),r(null,l,u,d)}catch(a){e.log("error",$e(a),"Retrieve tables data"),r($e(a))}finally{await j.disconnect(s)}}};var $e=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),zn=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),og=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages")});var zo=C((FS,jo)=>{"use strict";var Wt=jn(),cg=i(async(t,e,r)=>{try{let n=r.require("@hackolade/ssh-service");Wt.setDependencies(r),await Wt.connect(t,n,e),await Wt.logVersion(),await Wt.applyScript(ug(t.script))}catch(n){throw e.error(n),lg(n)}},"applyToInstance"),ug=i(t=>{let e=/CREATE DATABASE[^;]*;/gi;return t.replace(e,"")},"removeCreateDbScript"),lg=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");jo.exports={applyToInstance:cg}});var z=C((kS,Xo)=>{"use strict";var Jn=class Jn{script;isDropScript};i(Jn,"ModificationScript");var Xn=Jn,es=class es{isActivated;scripts;static getInstances(e,r,n){return(e||[]).filter(Boolean).map(s=>({isActivated:r,scripts:[{isDropScript:n,script:s}]}))}static getInstance(e,r,n){var s;if((s=e==null?void 0:e.filter(Boolean))!=null&&s.length)return{isActivated:r,scripts:e.filter(Boolean).map(a=>({isDropScript:n,script:a}))}}static getDropAndRecreateInstance(e,r,n){let s=[];if(e&&s.push({isDropScript:!0,script:e}),r&&s.push({isDropScript:!1,script:r}),!!(s!=null&&s.length))return{isActivated:n,scripts:s}}};i(es,"AlterScriptDto");var Zn=es;Xo.exports={ModificationScript:Xn,AlterScriptDto:Zn}});var os=C((BS,Zo)=>{"use strict";var ss=class ss{sortOrder;nullsOrder;isActivated;keyId;collation;opclass};i(ss,"AlterIndexColumnDto");var ts=ss,is=class is{keyId};i(is,"AlterIndexIncludeColumnDto");var rs=is,as=class as{id;isActivated;index_method;ifNotExist;only;index_tablespace_name;indxName;columns;include;index_storage_parameter};i(as,"AlterIndexDto");var ns=as;Zo.exports={AlterIndexDto:ns,AlterIndexColumnDto:ts,AlterIndexIncludeColumnDto:rs}});var Le=C((VS,Jo)=>{"use strict";var{AlterIndexDto:GS}=os(),hs=class hs{id;constraintName;indexStorageParameters;indexTablespace;indexInclude};i(hs,"AlterCollectionColumnKeyOptionDto");var Et=hs,gs=class gs{type;isActivated;primaryKey;unique;mode;length;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;primaryKeyOptions;triggerUpdateColumns;compMod;GUID};i(gs,"AlterCollectionColumnDto");var cs=gs,ys=class ys extends Et{compositePrimaryKey};i(ys,"AlterCollectionRoleCompModPKDto");var us=ys,_s=class _s extends Et{compositeUniqueKey};i(_s,"AlterCollectionRoleCompModUniqueKeyDto");var ls=_s,Es=class Es{new;old};i(Es,"AlterCollectionRoleCompModPrimaryKey");var ps=Es,Ts=class Ts{new;old};i(Ts,"AlterCollectionRoleCompModUniqueKey");var ms=Ts,Ss=class Ss{id;type;collectionName;properties;definitions;isActivated;additionalProperties;memory_optimized;collectionUsers;ifNotExist;on_commit;table_tablespace_name;bucketId;compMod;name;roleType;patternProperties};i(Ss,"AlterCollectionRoleDto");var ds=Ss,Cs=class Cs{type;isActivated;unique;subtype;properties;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(Cs,"AlterCollectionDto");var fs=Cs;Jo.exports={AlterCollectionDto:fs,AlterCollectionRoleDto:ds,AlterCollectionColumnDto:cs,AlterCollectionColumnKeyOptionDto:Et,AlterCollectionRoleCompModPrimaryKey:ps,AlterCollectionRoleCompModPKDto:us,AlterCollectionRoleCompModUniqueKeyDto:ls,AlterCollectionRoleCompModUniqueKey:ms}});var tc=C((WS,ec)=>{"use strict";var pg=Object.freeze({ALL:"ALL",ANALYSE:"ANALYSE",ANALYZE:"ANALYZE",AND:"AND",ANY:"ANY",ARRAY:"ARRAY",ASC:"ASC",ASYMMETRIC:"ASYMMETRIC",AUTHORIZATION:"AUTHORIZATION",BINARY:"BINARY",BOTH:"BOTH",CASE:"CASE",CAST:"CAST",CHECK:"CHECK",COLLATE:"COLLATE",COLUMN:"COLUMN",CONCURRENTLY:"CONCURRENTLY",CONSTRAINT:"CONSTRAINT",CREATE:"CREATE",CROSS:"CROSS",CURRENT_CATALOG:"CURRENT_CATALOG",CURRENT_DATE:"CURRENT_DATE",CURRENT_ROLE:"CURRENT_ROLE",CURRENT_SCHEMA:"CURRENT_SCHEMA",CURRENT_TIME:"CURRENT_TIME",CURRENT_TIMESTAMP:"CURRENT_TIMESTAMP",CURRENT_USER:"CURRENT_USER",DEFAULT:"DEFAULT",DEFERRABLE:"DEFERRABLE",DESC:"DESC",DISTINCT:"DISTINCT",DO:"DO",ELSE:"ELSE",END:"END",EXCEPT:"EXCEPT",FALSE:"FALSE",FOR:"FOR",FOREIGN:"FOREIGN",FREEZE:"FREEZE",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",GROUP:"GROUP",HAVING:"HAVING",ILIKE:"ILIKE",IN:"IN",INITIALLY:"INITIALLY",INTERSECT:"INTERSECT",INTO:"INTO",IS:"IS",ISNULL:"ISNULL",JOIN:"JOIN",LATERAL:"LATERAL",LEADING:"LEADING",LEFT:"LEFT",LIKE:"LIKE",LIMIT:"LIMIT",LOCALTIME:"LOCALTIME",LOCALTIMESTAMP:"LOCALTIMESTAMP",NATURAL:"NATURAL",NOT:"NOT",NULL:"NULL",OFFSET:"OFFSET",ON:"ON",ONLY:"ONLY",OR:"OR",ORDER:"ORDER",OUTER:"OUTER",OVERLAPS:"OVERLAPS",PLACING:"PLACING",PRIMARY:"PRIMARY",REFERENCES:"REFERENCES",RETURNING:"RETURNING",RIGHT:"RIGHT",SELECT:"SELECT",SESSION_USER:"SESSION_USER",SIMILAR:"SIMILAR",SOME:"SOME",SYMMETRIC:"SYMMETRIC",TABLE:"TABLE",TABLESAMPLE:"TABLESAMPLE",THEN:"THEN",TO:"TO",TRAILING:"TRAILING",TRUE:"TRUE",UNION:"UNION",UNIQUE:"UNIQUE",USER:"USER",USING:"USING",VARIADIC:"VARIADIC",VERBOSE:"VERBOSE",WHEN:"WHEN",WHERE:"WHERE",WINDOW:"WINDOW",WITH:"WITH"}),mg=Object.values(pg);ec.exports={ReservedWordsAsArray:mg}});var q=C((jS,lc)=>{"use strict";var J=require("lodash"),{AlterCollectionDto:QS,AlterCollectionRoleDto:YS}=Le(),{ReservedWordsAsArray:dg}=tc(),fg=/\t|\n|'|\f|\r/gm,nc=i(t=>J.get(t,"[0].code")||J.get(t,"[0].name",""),"getDbName"),As=i(t=>t&&(t.code||t.collectionName)||"","getEntityName"),sc=i(t=>t&&(t.code||t.name)||"","getViewName"),hg=i(t=>Object.assign({},J.get(t,"[0]",{}),{name:nc(t)}),"getDbData"),gg=i(t=>J.get(t,"[0].viewOn"),"getViewOn"),yg=i((t,e="	")=>t.split(`
`).map(r=>e+r).join(`
`),"tab"),_g=i((t,e)=>Object.keys(t).map(J.toLower).includes(J.toLower(e)),"hasType"),Eg=i(t=>({...t,...J.omit(t==null?void 0:t.role,"properties")||{}}),"getSchemaOfAlterCollection"),Tg=i(t=>{var n;let e=As(t),r=(n=t.compMod)==null?void 0:n.keyspaceName;return Qt(e,r)},"getFullCollectionName"),Sg=i(t=>Object.entries(t).filter(([e,r])=>!J.isNil(r)).reduce((e,[r,n])=>({...e,[r]:n}),{}),"clean"),Cg=i(t=>t.every(e=>J.get(e,"isActivated",!0)),"checkAllKeysActivated"),Ag=i(t=>t.length?t.every(e=>!J.get(e,"isActivated",!0)):!1,"checkAllKeysDeactivated"),ic=i((t,e)=>{let r=t.filter(s=>J.get(s,"isActivated",!0)).map(e),n=t.filter(s=>!J.get(s,"isActivated",!0)).map(e);return{activatedItems:r,deactivatedItems:n}},"divideIntoActivatedAndDeactivated"),ac=i((t,{isActivated:e,isPartOfLine:r,inlineComment:n="--"})=>t?e!==!1?t:r?"/* "+t+" */":t.includes(`
`)?`/*
`+t+` */
`:n+" "+t:"","commentIfDeactivated"),Ng=i((t,e="'",r="'")=>{let n=t[0];return t[t.length-1]===e&&n===r?t:`${e}${t}${r}`},"wrap"),bg=i((t,e)=>e.some(r=>(t==null?void 0:t.oldField[r])!==(t==null?void 0:t.newField[r])),"checkFieldPropertiesChanged"),oc=i(t=>{let e={...t,...J.omit(t==null?void 0:t.role,"properties")||{}},r=As(e),n=cc({collection:e});return Qt(r,n)},"getFullTableName"),cc=i(({collection:t})=>{var e;return(e=t.compMod)==null?void 0:e.keyspaceName},"getSchemaNameFromCollection"),Ig=i((t,e)=>`${oc(t)}.${Ae(e)}`,"getFullColumnName"),vg=i(t=>{var s;let e={...t,...J.omit(t==null?void 0:t.role,"properties")||{}},r=sc(e),n=(s=e.compMod)==null?void 0:s.keyspaceName;return Qt(r,n)},"getFullViewName"),Og=i(t=>t.code||t.name,"getUdtName"),Rg=i((t="")=>{let e=t.match(/\d+/);return Number(J.get(e,[0],0))},"getDbVersion"),wg=i((t="")=>t.replace(fg,e=>`\\${e}`),"prepareComment"),Dg=i(t=>`E'${wg(JSON.stringify(t)).slice(1,-1)}'`,"wrapComment"),qg=i(t=>J.map(t,e=>{let r=e.defaultExpression?`DEFAULT ${e.defaultExpression}`:"";return J.trim(`${e.argumentMode} ${e.argumentName||""} ${e.argumentType} ${r}`)}).join(", "),"getFunctionArguments"),Qt=i((t,e)=>e?`${Ae(e)}.${Ae(t)}`:Ae(t),"getNamePrefixedWithSchemaName"),uc=i(({name:t})=>/\s|\W/.test(t)||J.includes(dg,J.toUpper(t)),"shouldNameBeEscaped"),Ae=i(t=>uc({name:t})?`"${t}"`:t,"wrapInQuotes"),xg=i(({name:t})=>uc({name:t})?`'${t}'`:t,"wrapInSingleQuotes"),Pg=i(({name:t})=>Ae(t),"columnMapToString"),Lg=i((t,e,r,n=Pg)=>{var o;let s=ic(t,n),a=(o=s==null?void 0:s.deactivatedItems)!=null&&o.length?ac(s.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!e&&r?" ("+s.activatedItems.join(", ")+a+")":" ("+t.map(n).join(", ")+")"},"getColumnsList"),rc=i(t=>t?t.alias?`${Ae(t.name)} as ${Ae(t.alias)}`:Ae(t.name):"","getKeyWithAlias"),Mg=i(t=>Array.isArray(t)?t.reduce((e,r)=>{if(!r.tableName)return e.columns.push(rc(r)),e;let n=`${Ae(r.dbName)}.${Ae(r.tableName)}`;return e.tables.includes(n)||e.tables.push(n),e.columns.push({statement:`${n}.${rc(r)}`,isActivated:r.isActivated}),e},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),Fg=i(({newItems:t=[],oldItems:e=[]})=>{let r=t.filter(a=>!e.some(o=>o.id===a.id)),n=[],s=[];return e.forEach(a=>{let o=t.find(c=>c.id===a.id);o?J.isEqual(o,a)||s.push(o):n.push(a)}),{added:r,removed:n,modified:s}},"getGroupItemsByCompMode");lc.exports={getDbName:nc,getDbData:hg,getEntityName:As,getViewName:sc,getViewOn:gg,tab:yg,hasType:_g,clean:Sg,checkAllKeysActivated:Cg,checkAllKeysDeactivated:Ag,divideIntoActivatedAndDeactivated:ic,commentIfDeactivated:ac,wrap:Ng,checkFieldPropertiesChanged:bg,getFullTableName:oc,getFullColumnName:Ig,getFullViewName:vg,getUdtName:Og,getDbVersion:Rg,wrapComment:Dg,getFunctionArguments:qg,getNamePrefixedWithSchemaName:Qt,wrapInQuotes:Ae,getColumnsList:Lg,getViewData:Mg,getSchemaOfAlterCollection:Eg,getFullCollectionName:Tg,getSchemaNameFromCollection:cc,getGroupItemsByCompMode:Fg,wrapInSingleQuotes:xg}});var fc=C((XS,dc)=>{"use strict";var{AlterScriptDto:pc}=z(),mc=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),Ug=i((t,e)=>r=>{let{wrapComment:n,wrapInQuotes:s}=q(),a=mc(r);if(a.new&&a.new!==a.old){let o=n(a.new),c=s(r.role.name),u=e.updateSchemaComment(c,o);return pc.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),kg=i((t,e)=>r=>{let{wrapInQuotes:n}=q(),s=mc(r);if(s.old&&!s.new){let a=n(r.role.name),o=e.dropSchemaComment(a);return pc.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),$g=i((t,e)=>r=>{let n=Ug(t,e)(r),s=kg(t,e)(r);return[n,s].filter(Boolean)},"getModifySchemaCommentsScriptDtos");dc.exports={getModifySchemaCommentsScriptDtos:$g}});var gc=C((JS,hc)=>{"use strict";hc.exports={number:"numeric",string:"text",date:"date",timestamp:"timestamp",binary:"bytea",boolean:"boolean",document:"jsonb",array:"jsonb",objectId:"uuid",default:"char"}});var _c=C((eC,yc)=>{"use strict";yc.exports={char:{size:1},varchar:{mode:"varying"},text:{mode:"text"},bit:{size:1,mode:"bit"},varbit:{size:1,mode:"varying"},tsvector:{mode:"text"},tsquery:{mode:"text"},smallint:{capacity:2},integer:{capacity:4},bigint:{capacity:8},numeric:{capacity:12,mode:"decimal"},real:{capacity:4,mode:"floating"},"double precision":{capacity:8,mode:"floating"},smallserial:{capacity:2},serial:{capacity:4},bigserial:{capacity:8},money:{capacity:8,mode:"decimal"},bytea:{size:4,mode:"binary"},date:{format:"YYYY-MM-DD"},time:{format:"hh:mm:ss.nnnnnn"},timestamp:{format:"YYYY-MM-DD hh:mm:ss"},interval:{format:"PnYnMnDTnHnMnS"},boolean:{mode:"boolean"},int4range:{mode:"range",modeType:"integer",capacity:4},int8range:{mode:"range",modeType:"integer",capacity:8},numrange:{mode:"range",modeType:"decimal",capacity:12},daterange:{mode:"range",modeType:"date",format:"YYYY-MM-DD"},tsrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},int4multirange:{mode:"multirange",modeType:"integer",capacity:4},int8multirange:{mode:"multirange",modeType:"integer",capacity:8},nummultirange:{mode:"multirange",modeType:"decimal",capacity:12},datemultirange:{mode:"multirange",modeType:"date",format:"YYYY-MM-DD"},tsmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},geometry:{format:"euclidian",mode:"geospatial"},geography:{format:"euclidian",mode:"geospatial"},box2d:{format:"euclidian",mode:"geospatial"},box3d:{format:"euclidian",mode:"geospatial"},geometry_dump:{format:"euclidian",mode:"geospatial"},point:{format:"euclidian",mode:"geospatial"},line:{format:"euclidian",mode:"geospatial"},lseg:{format:"euclidian",mode:"geospatial"},box:{format:"euclidian",mode:"geospatial"},path:{format:"euclidian",mode:"geospatial"},polygon:{format:"euclidian",mode:"geospatial"},circle:{format:"euclidian",mode:"geospatial"},inet:{mode:"ip"},cidr:{mode:"ip"},macaddr:{},macaddr8:{},uuid:{mode:"uuid"},oid:{mode:"uuid"},regclass:{},regcollation:{},regconfig:{},regdictionary:{},regnamespace:{},regoper:{},regoperator:{},regproc:{},regprocedure:{},regrole:{},regtype:{},xml:{mode:"xml"},json:{format:"semi-structured"},jsonb:{format:"semi-structured"},composite:{format:"semi-structured",mode:"object"},enum:{mode:"enum"},range_udt:{mode:"range"},domain:{mode:"domain"}}});var Tc=C((tC,Ec)=>{"use strict";Ec.exports={createDatabase:"CREATE DATABASE ${name}${template}${encoding}${locale}${collate}${characterClassification}${tablespace};\n",createSchema:"CREATE SCHEMA${ifNotExist} ${name};\nSET search_path TO ${name};\n\n${comment}\n",comment:"COMMENT ON ${object} ${objectName} IS ${comment};\n",createTable:"CREATE${temporary} TABLE${ifNotExist} ${name} (\n${columnDefinitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options};\n\n${comment}${columnDescriptions}",createTablePartitionOf:"CREATE${temporary} TABLE${ifNotExist} ${name}\n${partitionOf} ${openParenthesis}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n${closeParenthesis}${options};\n\n${comment}${columnDescriptions}",generatedColumnClause:" GENERATED ALWAYS AS (${generationExpression}) STORED",columnDefinition:"${name} ${type}${collation}${generatedColumnClause}${primaryKey}${uniqueKey}${defaultValue}${notNull}",checkConstraint:"${name} CHECK (${expression})${noInherit}",createForeignKeyConstraint:"${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable} (${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime}",createKeyConstraint:"${constraintName}${keyType}${columns}${includeNonKey}${storageParameters}${tablespace}${deferrable}${deferrableConstraintCheckTime}",alterColumnType:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DATA TYPE ${dataType};",addNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET NOT NULL;",dropNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP NOT NULL;",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldColumnName} TO ${newColumnName};",addCheckConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",dropConstraint:"ALTER TABLE IF EXISTS ${tableName} DROP CONSTRAINT IF EXISTS ${constraintName};",createForeignKey:"ALTER TABLE IF EXISTS ${foreignTable} ADD CONSTRAINT ${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime};",dropForeignKey:"ALTER TABLE ${tableName} DROP CONSTRAINT ${fkConstraintName};",addPkConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD ${constraintStatement};",dropTable:"DROP TABLE IF EXISTS ${tableName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",dropDomain:"DROP DOMAIN IF EXISTS ${udtName};",dropType:"DROP TYPE IF EXISTS ${udtName};",alterTypeAddAttribute:"ALTER TYPE ${udtName} ADD ATTRIBUTE ${columnDefinition};",alterTypeDropAttribute:"ALTER TYPE ${udtName} DROP ATTRIBUTE IF EXISTS ${attributeName};",alterTypeRenameAttribute:"ALTER TYPE ${udtName} RENAME ATTRIBUTE ${oldAttributeName} TO ${newAttributeName};",alterTypeChangeAttributeType:"ALTER TYPE ${udtName} ALTER ATTRIBUTE ${attributeName} SET DATA TYPE ${newDataType};",updateCommentOnTable:"COMMENT ON TABLE ${tableName} IS ${comment};",updateCommentOnColumn:"COMMENT ON COLUMN ${columnName} IS ${comment};",updateCommentOnSchema:"COMMENT ON SCHEMA ${schemaName} IS ${comment};",updateCommentOnView:"COMMENT ON VIEW ${viewName} IS ${comment};",createSchemaOnly:"CREATE SCHEMA IF NOT EXISTS ${schemaName};",dropSchema:"DROP SCHEMA IF EXISTS ${schemaName};",index:"CREATE${unique} INDEX${concurrently}${ifNotExist} ${name}\n ON${only} ${tableName}${using}${keys}${nullsDistinct}${options};\n",dropIndex:"DROP INDEX IF EXISTS ${indexName};\n",alterIndexRename:"ALTER INDEX IF EXISTS ${oldIndexName} RENAME TO ${newIndexName};\n",alterIndexTablespace:"ALTER INDEX IF EXISTS ${indexName} SET TABLESPACE ${tablespaceName};\n",alterIndexStorageParams:`ALTER INDEX IF EXISTS \${indexName} SET (
	\${options}
);
`,reindexIndex:"REINDEX INDEX ${indexName};\n",createView:"CREATE${orReplace}${temporary} VIEW ${name}${withOptions}\nAS ${selectStatement}${checkOption};\n\n${comment}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",dropView:"DROP VIEW IF EXISTS ${viewName};",createFunction:"CREATE${orReplace} FUNCTION ${name}\n	(${parameters})\n	RETURNS ${returnType}\n	LANGUAGE ${language}\n${properties}AS $BODY$\n${definition}\n$BODY$;\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name} (${parameters})\n	LANGUAGE ${language}\nAS $BODY$\n${body}\n$BODY$;\n",createCompositeType:`CREATE TYPE \${name} AS (
	\${columnDefinitions}
);

\${comment}`,createEnumType:"CREATE TYPE ${name} AS ENUM (${values});\n\n${comment}",createRangeType:"CREATE TYPE ${name} AS RANGE (\n	SUBTYPE=${subtype}${options}\n);\n\n${comment}",createDomainType:"CREATE DOMAIN ${name} AS ${underlyingType}${notNull}${collate}${default}${constraints};\n\n${comment}",createTrigger:"CREATE${orReplace}${constraint} TRIGGER ${name} ${actionTiming} ${events}\n	ON ${tableName}\n${options}	EXECUTE ${functionKey} ${functionName};\n",createSequence:"CREATE${sequenceType} SEQUENCE${ifNotExists} ${name}${options};\n",dropSequence:"DROP SEQUENCE IF EXISTS ${name};\n",renameSequence:"ALTER SEQUENCE IF EXISTS ${name} RENAME TO ${newName};\n",setSequenceType:"ALTER SEQUENCE IF EXISTS ${name} SET ${sequenceType};\n",alterSequence:"ALTER SEQUENCE IF EXISTS ${name}${options};\n",updateColumnDefaultValue:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DEFAULT ${defaultValue};",dropColumnDefaultValue:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP DEFAULT;"}});var Ac=C((rC,Cc)=>{"use strict";var Sc=i((t="")=>new RegExp("\\$\\{(.*?)\\}",t),"template"),Bg=i(t=>t.match(Sc("gi"))||[],"getAllTemplates"),Kg=i(t=>(t.match(Sc("i"))||[])[1],"parseTemplate"),Gg=i((t,e)=>Bg(t).reduce((r,n)=>{let s=Kg(n);return r.replace(n,()=>e[s]||e[s]===0?e[s]:"")},t),"assignTemplates");Cc.exports=Gg});var bc=C((sC,Nc)=>{"use strict";Nc.exports=({_:t,commentIfDeactivated:e,checkAllKeysDeactivated:r,assignTemplates:n,wrapInQuotes:s,getColumnsList:a})=>({generateConstraintsString:i((m,f)=>{var y,A;let g=e(((m==null?void 0:m.deactivatedItems)||[]).join(`,
	`),{isActivated:!f,isPartOfLine:!0}),T=(y=m==null?void 0:m.activatedItems)!=null&&y.length?`,
	`+m.activatedItems.join(`,
	`):"",_=(A=m==null?void 0:m.deactivatedItems)!=null&&A.length?`
	`+g:"";return T+_},"generateConstraintsString"),foreignKeysToString:i(m=>{if(Array.isArray(m)){let f=m.filter(_=>t.get(_,"isActivated",!0)).map(_=>s(t.trim(_.name))),g=m.filter(_=>!t.get(_,"isActivated",!0)).map(_=>s(t.trim(_.name))),T=g.length?e(g,{isActivated:!1,isPartOfLine:!0}):"";return f.join(", ")+T}return m},"foreignKeysToString"),foreignActiveKeysToString:i(m=>m.map(f=>t.trim(f.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:i((m,f)=>g=>{let T=s(t.trim(g.name)),_=r(g.columns||[]),y=t.isEmpty(g.columns)?"":a(g.columns,_,f),A=g.include.length?` INCLUDE${a(g.include,_,f)}`:"",S=g.storageParameters?` WITH (${g.storageParameters})`:"",b=g.tablespace?` USING INDEX TABLESPACE ${s(g.tablespace)}`:"",I=g!=null&&g.deferrable?` ${g.deferrable}`:"",R=(g==null?void 0:g.deferrable)==="DEFERRABLE"&&(g!=null&&g.deferrableConstraintCheckTime)?` ${g==null?void 0:g.deferrableConstraintCheckTime}`:"";return{statement:n(m.createKeyConstraint,{constraintName:g.name?`CONSTRAINT ${T} `:"",keyType:g.keyType,columns:y,includeNonKey:A,storageParameters:S,tablespace:b,deferrable:I,deferrableConstraintCheckTime:R}),isActivated:!_}},"createKeyConstraint"),getConstraintsWarnings:i((m=[])=>t.isEmpty(m)?"":`
	`+m.map(f=>{let g=f.name?` [constraint name: ${f.name}]`:"";return`-- ${f.errorMessage}${g}`}).join(`
	`),"getConstraintsWarnings"),additionalPropertiesForForeignKey:i(m=>{let f=t.get(m,"relationshipOnDelete",""),g=t.get(m,"relationshipOnUpdate",""),T=t.get(m,"relationshipMatch",""),_=t.get(m,"deferrable",""),y=t.get(m,"deferrableConstraintCheckTime","");return{foreignOnDelete:f,foreignOnUpdate:g,foreignMatch:T,deferrable:_,deferrableConstraintCheckTime:y}},"additionalPropertiesForForeignKey")})});var Yt=C((aC,Ic)=>{"use strict";Ic.exports=(t,e)=>{let r=i((_,y)=>Object.entries(_.properties).map(y),"mapProperties"),n=i(_=>_.compositeUniqueKey?!1:!!_.unique,"isUniqueKey"),s=i(_=>{var y,A;return n(_)&&(((y=_.uniqueKeyOptions)==null?void 0:y.length)===1&&!((A=t.first(_.uniqueKeyOptions))!=null&&A.constraintName)||t.isEmpty(_.uniqueKeyOptions))},"isInlineUnique"),a=i(_=>_.compositeUniqueKey||_.compositePrimaryKey?!1:!!_.primaryKey,"isPrimaryKey"),o=i(_=>{var y;return a(_)&&!((y=t.first(_.primaryKeyOptions))!=null&&y.constraintName)},"isInlinePrimaryKey"),c=i((_,y)=>{let A=_.nullsDistinct;return`UNIQUE${y>=15&&A?` ${A}`:""}`},"getUniqueKeyType"),u=i(({options:_,columnName:y,isActivated:A,jsonSchema:S,dbVersion:b})=>e({keyType:c(_,b),name:_.constraintName,columns:[{name:y,isActivated:A}],include:m(_.indexInclude||[],S),storageParameters:_.indexStorageParameters,comment:_.indexComment,tablespace:_.indexTablespace,nullsDistinct:_.nullsDistinct,deferrable:_.deferrable,deferrableConstraintCheckTime:_.deferrableConstraintCheckTime}),"hydrateUniqueOptions"),l=i((_,y,A,S)=>e({keyType:"PRIMARY KEY",name:_.constraintName,columns:[{name:y,isActivated:A}],include:m(_.indexInclude||[],S),storageParameters:_.indexStorageParameters,comment:_.indexComment,tablespace:_.indexTablespace,deferrable:_.deferrable,deferrableConstraintCheckTime:_.deferrableConstraintCheckTime}),"hydratePrimaryKeyOptions"),d=i((_,y)=>Object.keys(y).find(A=>y[A].GUID===_),"findName"),p=i((_,y)=>t.get(Object.values(y).find(A=>A.GUID===_),"isActivated",!0),"checkIfActivated"),m=i((_,y)=>t.map(_,A=>({name:d(A.keyId,y.properties),isActivated:p(A.keyId,y.properties)})),"getKeys"),f=i(_=>Array.isArray(_.primaryKey)?_.primaryKey.map(y=>t.isEmpty(y.compositePrimaryKey)?{name:y.constraintName,errorMessage:"A primary key constraint cannot be created without any primary key selected"}:{...l(y,null,null,_),columns:m(y.compositePrimaryKey,_)}):[],"getCompositePrimaryKeys"),g=i((_,y)=>Array.isArray(_.uniqueKey)?_.uniqueKey.map(A=>t.isEmpty(A.compositeUniqueKey)?{name:A.constraintName,errorMessage:"A unique key constraint cannot be created without any unique key selected"}:{...u({options:A,columnName:null,isActivated:null,jsonSchema:_,dbVersion:y}),columns:m(A.compositeUniqueKey,_)}):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i((_,y)=>{if(!_.properties)return[];let A=r(_,([b,I])=>{if(!(!a(I)||o(I)))return l(t.first(I.primaryKeyOptions),b,I.isActivated,_)}).filter(Boolean),S=t.flatten(r(_,([b,I])=>!n(I)||s(I)?[]:(I.uniqueKeyOptions||[]).map(R=>u({options:R,columnName:b,isActivated:I.isActivated,jsonSchema:_,dbVersion:y})))).filter(Boolean);return[...A,...f(_),...S,...g(_,y)]},"getTableKeyConstraints"),isInlineUnique:s,isInlinePrimaryKey:o,getKeys:m,hydratePrimaryKeyOptions:l,hydrateUniqueOptions:u,getUniqueKeyType:c}}});var Oc=C((cC,vc)=>{"use strict";vc.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=i((S,b)=>t.map(b,I=>{let R=I.functionOrReplace?" OR REPLACE":"",U=r(e.createFunction,{name:s(I.name,S),orReplace:R,parameters:n(I.functionArguments),returnType:I.functionReturnsSetOf?`SETOF ${I.functionReturnType}`:I.functionReturnType,language:I.functionLanguage,properties:c(I),definition:I.functionBody}),N=I.functionDescription?r(e.comment,{object:"FUNCTION",objectName:s(I.name,S),comment:a(I.functionDescription)}):"";return[U,N].filter(Boolean).join(`
`)}).join(`
`),"getFunctionsScript"),c=i(S=>{let b=i(I=>I?`	${I}
`:"","wrap");return[{key:"functionWindow",getValue:u},{key:"functionVolatility",getValue:l},{key:"functionLeakProof",getValue:d},{key:"functionNullArgs",getValue:p},{key:"functionSqlSecurity",getValue:m},{key:"functionParallel",getValue:f},{key:"functionExecutionCost",getValue:g},{key:"functionExecutionRows",getValue:T},{key:"functionSupportFunction",getValue:_},{key:"functionConfigurationParameters",getValue:y}].map(I=>b(I.getValue(S[I.key],S))).filter(Boolean).join("")},"getProperties"),u=i((S,b)=>b.language!=="c"||!S?"":"WINDOW","getWindow"),l=i(S=>S,"getVolatility"),d=i(S=>S?"LEAKPROOF":"NOT LEAKPROOF","getLeakProof"),p=i(S=>S,"getNullArgs"),m=i(S=>{if(S)return`SECURITY ${S}`},"getSqlSecurity"),f=i(S=>{if(S)return`PARALLEL ${S}`},"getParallel"),g=i(S=>{if(S)return`COST ${S}`},"getExecutionCost"),T=i((S,b)=>!S||!b.functionReturnsSetOf&&!A(b)?"":`ROWS ${S}`,"getExecutionRows"),_=i(S=>{if(S)return`SUPPORT ${S}`},"getSupportFunction"),y=i(S=>{if(S)return`SET ${S}`},"getConfigurationParameters"),A=i(S=>(S.functionReturnType||"").trim().toUpperCase().startsWith("TABLE"),"isFunctionReturnsTable");return{getFunctionsScript:o}}});var wc=C((lC,Rc)=>{"use strict";Rc.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s})=>({getProceduresScript:i((o,c)=>t.map(c,u=>{let l=u.orReplace?" OR REPLACE":"";return r(e.createProcedure,{name:s(u.name,o),orReplace:l,parameters:n(u.inputArgs),language:u.language,body:u.body})}).join(`
`),"getProceduresScript")})});var qc=C((dC,Dc)=>{"use strict";var{Sequence:mC}=Vt();Dc.exports=({_:t,templates:e,assignTemplates:r,getNamePrefixedWithSchemaName:n,wrapInQuotes:s})=>{let a=i(({schemaName:S,sequences:b})=>t.map(b,I=>o({schemaName:S,sequence:I})).join(`
`),"getSequencesScript"),o=i(({schemaName:S,sequence:b})=>{let I=b.temporary?"":S,R=n(b.sequenceName,I),U=f({sequence:b}),N=g({sequence:b}),D=l({sequence:b,schemaName:S});return r(e.createSequence,{name:R,ifNotExists:U,sequenceType:N,options:D})},"createSequenceScript"),c=i(({schemaName:S,sequence:b,oldSequence:I})=>{let R=b.temporary?"":S,U=I.sequenceName||b.sequenceName,N=n(U,R),D=A({sequence:b,oldSequence:I}),B=l({schemaName:S,sequence:D}),F=T({sequence:D}),X=D.sequenceName;return[{key:"options",value:B,template:e.alterSequence},{key:"sequenceType",value:F,template:e.setSequenceType},{key:"newName",value:X,template:e.renameSequence}].filter(fe=>fe.value).map(fe=>r(fe.template,{[fe.key]:fe.value,name:N})).join(`
`)},"alterSequenceScript"),u=i(({schemaName:S,sequence:b})=>{let I=b.temporary?"":S,R=n(b.sequenceName,I);return r(e.dropSequence,{name:R})},"dropSequenceScript"),l=i(({schemaName:S,sequence:b})=>{let R=[{getOption:d,key:"dataType",clause:"AS"},{getOption:d,key:"increment",clause:"INCREMENT BY"},{getOption:d,key:"start",clause:"START WITH"},{getOption:d,key:"restart",clause:"RESTART WITH"},{getOption:d,key:"minValue",clause:"MINVALUE"},{getOption:d,key:"maxValue",clause:"MAXVALUE"},{getOption:d,key:"cache",clause:"CACHE"},{getOption:_,key:"cycle"},{getOption:y,key:"ownedByColumn"}].map(U=>{let N=U.getOption({sequence:b,schemaName:S,config:U});return p({option:N})}).filter(Boolean).join("");return R&&m({options:R})},"getSequenceOptions"),d=i(({sequence:S,config:b})=>{let I=S[b.key];return I||I===0?`${b.clause} ${I}`:""},"getOption"),p=i(({option:S})=>S?`	${S}
`:"","wrapOption"),m=i(({options:S})=>`
`+S.replace(/\n$/,""),"wrapOptionsBlock"),f=i(({sequence:S})=>S.ifNotExist?" IF NOT EXISTS":"","getIfNotExists"),g=i(({sequence:S})=>S.temporary?" TEMPORARY":S.unlogged?" UNLOGGED":"","getSequenceType"),T=i(({sequence:S})=>S.temporary?"":S.unlogged===!0?"UNLOGGED":S.unlogged===!1?"LOGGED":"","getAlterSequenceType"),_=i(({sequence:S})=>S.cycle===!0?"CYCLE":S.cycle===!1?"NO CYCLE":"","getCycle"),y=i(({sequence:S,schemaName:b})=>{var R,U;if(S.ownedByNone)return"OWNED BY NONE";let I=(R=S.ownedByColumn)==null?void 0:R[0];if(I){let[N,D]=((U=I.name)==null?void 0:U.split("."))||[];return`OWNED BY ${[b,N,D].filter(Boolean).map(s).join(".")}`}return""},"getOwnedBy"),A=i(({sequence:S,oldSequence:b})=>{let I=t.omitBy(S,(R,U)=>t.isEqual(R,b[U]));return S.minValue>b.minValue?{...I,restart:S.start}:I},"getModifiedSequence");return{getSequencesScript:a,createSequenceScript:o,dropSequenceScript:u,alterSequenceScript:c}}});var Pc=C((hC,xc)=>{"use strict";xc.exports=({_:t,getColumnsList:e,checkAllKeysDeactivated:r})=>{let n=i((p,m)=>p?" TEMPORARY":m?" UNLOGGED":"","getTableTemporaryValue"),s=i(p=>{let m=i(g=>g?`${g}
`:"","wrap"),f=[{key:"inherits",getValue:u("INHERITS")},{key:"partitionBounds",getValue:u("")},{key:"partitioning",getValue:a},{key:"usingMethod",getValue:u("USING")},{key:"storage_parameter",getValue:d},{key:"on_commit",getValue:c},{key:"table_tablespace_name",getValue:u("TABLESPACE")},{key:"selectStatement",getValue:u("AS")}].map(g=>m(g.getValue(p[g.key],p))).filter(Boolean).join("");return t.trim(f)?` ${t.trim(f)}`:""},"getTableOptions"),a=i((p,{isActivated:m})=>{if(p&&p.partitionMethod){let f=p.partitionBy==="keys"?o(p,m):` (${p.partitioning_expression})`;return`PARTITION BY ${p.partitionMethod}${f}`}},"getPartitioning"),o=i((p,m)=>{let f=r(p.compositePartitionKey);return e(p.compositePartitionKey,f,m)},"getPartitionKeys"),c=i((p,m)=>{if(p&&m.temporary)return`ON COMMIT ${p}`},"getOnCommit"),u=i(p=>m=>{if(m)return`${p} ${m}`},"getBasicValue"),l=["toast_autovacuum_enabled","toast_vacuum_index_cleanup","toast_vacuum_truncate","toast_autovacuum_vacuum_threshold","toast_autovacuum_vacuum_scale_factor","toast_autovacuum_vacuum_insert_threshold","toast_autovacuum_vacuum_insert_scale_factor","toast_autovacuum_vacuum_cost_delay","toast_autovacuum_vacuum_cost_limit","toast_autovacuum_freeze_min_age","toast_autovacuum_freeze_max_age","toast_autovacuum_freeze_table_age","toast_autovacuum_multixact_freeze_min_age","toast_autovacuum_multixact_freeze_max_age","toast_autovacuum_multixact_freeze_table_age","toast_log_autovacuum_min_duration"],d=i(p=>{if(t.isEmpty(p))return"";let m=["autovacuum","toast","id"];return t.chain(p).toPairs().flatMap(([f,g])=>f==="autovacuum"||f==="toast"?t.toPairs(g):[[f,g]]).reject(([f])=>t.includes(m,f)).map(([f,g])=>{if(!(!g&&g!==0))return t.includes(l,f)?`toast.${f.slice(6)}=${g}`:`${f}=${g}`}).compact().join(`,
	`).trim().thru(f=>{if(f)return`WITH (
	${f}
)`}).value()},"getStorageParameters");return{getTableTemporaryValue:n,getTableOptions:s}}});var Mc=C((yC,Lc)=>{"use strict";Lc.exports=({_:t,commentIfDeactivated:e,assignTemplates:r,templates:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=["composite","enum","range_udt","domain"],c=i((f,g)=>{let T=s(f.name,f.schemaName),_=r(n.comment,{object:"TYPE",objectName:T,comment:a(f.comment)});switch(f.type){case"composite":return r(n.createCompositeType,{name:T,columnDefinitions:t.join(g,`,
	`),comment:f.comment?_:""});case"enum":return r(n.createEnumType,{name:T,values:t.map(f.enum,y=>`'${y}'`).join(", "),comment:f.comment?_:""});case"range_udt":return r(n.createRangeType,{name:T,subtype:f.rangeSubtype,options:l(f),comment:f.comment?_:""});case"domain":{let y=r(n.comment,{object:"DOMAIN",objectName:T,comment:a(f.comment)});return r(n.createDomainType,{name:T,underlyingType:f.underlyingType,notNull:f.nullable?"":" NOT NULL",collate:f.collation?`
	COLLATE ${f.collation}`:"",default:f.default?`
	DEFAULT ${f.default}`:"",constraints:d(f),comment:f.comment?y:""})}default:return""}},"getPlainUdt"),u=i(f=>o.includes(f.type),"isNotPlainType"),l=i(f=>{let g=i(_=>_?`	${_}`:"","wrap"),T=[{key:"operatorClass",getValue:p("SUBTYPE_OPCLASS")},{key:"collation",getValue:p("COLLATION")},{key:"canonicalFunction",getValue:p("CANONICAL")},{key:"subtypeDiffFunction",getValue:p("SUBTYPE_DIFF")},{key:"multiRangeType",getValue:p("MULTIRANGE_TYPE_NAME")}].map(_=>g(_.getValue(f[_.key]))).filter(Boolean).join(`,
`);return t.trim(T)?`,
	`+t.trim(T):""},"getRangeOptions"),d=i(f=>t.map(f.checkConstraints,g=>g.name?`
	CONSTRAINT ${g.name} CHECK (${g.expression})`:`
	CHECK (${g.expression})`).join(""),"getDomainConstraints"),p=i(f=>g=>{if(g)return`${f}=${g}`},"getBasicValue");return{getUserDefinedType:i((f,g)=>e(c(f,g),{isActivated:f.isActivated}),"getUserDefinedType"),isNotPlainType:u}}});var Uc=C((EC,Fc)=>{"use strict";Fc.exports=({_:t,wrapInQuotes:e,checkAllKeysDeactivated:r,getColumnsList:n})=>{let s=i(({name:d,sortOrder:p,nullsOrder:m,collation:f,opclass:g})=>{let T=p?` ${p}`:"",_=m?` ${m}`:"",y=t.includes(f,'"')?f:`"${f}"`,A=f?` COLLATE ${y}`:"",S=g?` ${g}`:"";return`${e(d)}${A}${S}${T}${_}`},"mapIndexKey"),a=i((d=[],p)=>{let m=r(d);return n(d,m,p,s)},"getIndexKeys"),o=i((d,p)=>{var A;let m=n(d.include||[],r(d.include||[]),p),f=(A=d.include)!=null&&A.length?` INCLUDE ${t.trim(m)}`:"",g=u(d),T=g?` WITH (
	${g})`:"",_=d.index_tablespace_name?` TABLESPACE ${d.index_tablespace_name}`:"",y=d.where?` WHERE ${d.where}`:"";return t.compact([" ",f,T,_,y]).join(`
`)},"getIndexOptions"),c={btree:{index_fillfactor:"fillfactor",deduplicate_items:"deduplicate_items"},hash:{index_fillfactor:"fillfactor"},spgist:{index_fillfactor:"fillfactor"},gist:{index_fillfactor:"fillfactor",index_buffering:"buffering"},gin:{fastupdate:"fastupdate",gin_pending_list_limit:"gin_pending_list_limit"},brin:{pages_per_range:"pages_per_range",autosummarize:"autosummarize"}},u=i(d=>{let p=c[d.index_method];return t.chain(p).toPairs().map(([m,f])=>{let g=(d.index_storage_parameter||{})[m];if(!(t.isNil(g)||g===""))return`${f}=${l(g)}`}).compact().join(`,
	`).value()},"getWithOptions"),l=i(d=>t.isBoolean(d)?d?"ON":"OFF":d,"getValue");return{getIndexKeys:a,getIndexOptions:o,getWithOptions:u}}});var $c=C((SC,kc)=>{"use strict";kc.exports=({_:t,assignTemplates:e,templates:r,commentIfDeactivated:n,wrapComment:s,wrapInQuotes:a})=>{let o=i((N,D)=>`${N}(${D})`,"addLength"),c=i((N,D,B)=>t.isNumber(B)?`${N}(${D},${B})`:`${N}(${D})`,"addScalePrecision"),u=i((N,D)=>t.isNumber(D)?`${N}(${D})`:N,"addPrecision"),l=i((N,D)=>D?`${N} ${D}`:N,"addWithTimezone"),d=i(({type:N,typeModifier:D,srid:B})=>{let F=B?`, ${B}`:"";return D&&D!==""?`${N}(${D}${F})`:N},"addTypeModifier"),p=i((N,D)=>{let B=(D==null?void 0:D.map(F=>`[${(F==null?void 0:F.array_size_limit)??""}]`).join("").trim())||"";return`${N}${B}`},"addArrayDecorator"),m=i(N=>["char","varchar","bit","varbit"].includes(N),"canHaveLength"),f=i(N=>N==="numeric","canHavePrecision"),g=i(N=>["time","timestamp"].includes(N),"canHaveTimePrecision"),T=i(N=>N==="numeric","canHaveScale"),_=i(N=>["geography","geometry"].includes(N),"canHaveTypeModifier"),y=i((N,D)=>(m(N)&&t.isNumber(D.length)?N=o(N,D.length):f(N)&&T(N)&&t.isNumber(D.precision)?N=c(N,D.precision,D.scale):f(N)&&t.isNumber(D.precision)?N=u(N,D.precision):_(N)?N=d({type:N,typeModifier:D.typeModifier,srid:D.srid}):g(N)&&(t.isNumber(D.timePrecision)||D.timezone)&&(N=l(u(N,D.timePrecision),D.timezone)),p(N,D.array_type)),"decorateType"),A=i(N=>["char","varchar","text","bit","varbit"].includes(N),"isString"),S=i(N=>["date","time","timestamp","interval"].includes(N),"isDateTime"),b=i((N,D,B)=>{let F=["current_timestamp","current_user","null"];return(A(N)||S(N))&&!F.includes(t.toLower(D))&&!B?s(D):D},"decorateDefault"),I=i((N,D)=>t.chain(D).filter("comment").map(B=>{let F=e(r.comment,{object:"COLUMN",objectName:`${N}.${a(B.name)}`,comment:s(B.comment)});return n(F,B)}).join(`
`).value(),"getColumnComments"),R={"v13.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v12.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v11.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v10.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"}};return{decorateType:y,decorateDefault:b,getColumnComments:I,replaceTypeByVersion:i((N,D)=>{let B=R[D];return t.get(B,N)||N},"replaceTypeByVersion")}}});var Kc=C((AC,Bc)=>{"use strict";Bc.exports=({_:t,assignTemplates:e,templates:r,getNamePrefixedWithSchemaName:n,wrap:s,commentIfDeactivated:a})=>{let o=i(({dbVersion:p,triggers:m,tableName:f})=>t.map(m,c(p,f)).join(`
`).trim(),"getTriggersScript"),c=i((p,m)=>f=>{let g=u(f),T=l(f);return e(r.createTrigger,{orReplace:f.triggerOrReplace?" OR REPLACE":"",constraint:f.triggerConstraint?" CONSTRAINT":"",actionTiming:f.triggerType??"",functionKey:p==="v10.x"?"PROCEDURE":"FUNCTION",functionName:f.triggerFunction,name:f.name,tableName:m,events:g,options:T})},"getTriggerScript"),u=i(p=>{var m;return(m=p.triggerEvents)==null?void 0:m.map(f=>{if(f.triggerEvent!=="UPDATE"||t.isEmpty(p.triggerUpdateColumns))return f.triggerEvent;let g=t.chain(p.triggerUpdateColumns).filter("isActivated").map(({name:y})=>y).join(", ").thru(y=>y&&`OF ${y}`).value(),T=t.chain(p.triggerUpdateColumns).reject("isActivated").map(({name:y})=>y).join(", ").thru(y=>!g&&y?`OF ${y}`:y).value(),_=T&&a(T,{isActivated:!1,isPartOfLine:!0});return`UPDATE ${g} ${_}`}).join(" OR ")},"getTriggerEvents"),l=i(p=>{let m="";if(p.triggerConstraint&&(p.triggerReferencedTable&&(m+=s(`FROM ${p.triggerReferencedTable}`,"	",`
`)),m+=s(p.triggerDeferrable?"DEFERRABLE":"NOT DEFERRABLE","	",`
`),p.triggerDeferrable&&p.triggerTimeConstraintCheck&&(m+=s(p.triggerTimeConstraintCheck,"	",`
`))),p.triggerReferencing){let f="REFERENCING";p.triggerBeforeImageTransitionRelation&&(f+=` OLD TABLE ${p.triggerBeforeImageTransitionRelation}`),p.triggerAfterImageTransitionRelation&&(f+=` NEW TABLE ${p.triggerAfterImageTransitionRelation}`),m+=s(f,"	",`
`)}return m+=s(p.triggerConstraint||p.triggerType==="INSTEAD OF"?"FOR EACH ROW":p.triggerEachRowStatement||"FOR EACH STATEMENT","	",`
`),p.triggerCondition&&(m+=s(`WHEN ${p.triggerCondition}`,"	",`
`)),m},"getTriggerOptions");return{getTriggersScript:o,hydrateTriggers:i((p,m={})=>{var f;return(((f=t.find(p,"triggers"))==null?void 0:f.triggers)||[]).map(g=>{let T=m[g.triggerReferencedTable];if(!T)return{...g,triggerReferencedTable:""};let _=n(T.code||T.collectionName,T.bucketName);return{...g,triggerReferencedTable:_}})},"hydrateTriggers")}}});var Vc=C((bC,Gc)=>{"use strict";Gc.exports=()=>({getLocaleProperties:i(e=>{let r=["v13.x","v14.x","v15.x"].includes(e.dbVersion);return r&&e.locale?{locale:e.locale}:!r&&e.locale?{collate:e.locale,characterClassification:e.locale}:{collate:e.collate,characterClassification:e.characterClassification}},"getLocaleProperties")})});var ee=C((OC,Wc)=>{"use strict";var Vg=gc(),Hc=_c(),w=Tc(),{Sequence:vC}=Vt();Wc.exports=(t,e,r)=>{let n=r.require("lodash"),{tab:s,commentIfDeactivated:a,checkAllKeysDeactivated:o,divideIntoActivatedAndDeactivated:c,hasType:u,wrap:l,clean:d,wrapComment:p,getFunctionArguments:m,wrapInQuotes:f,getNamePrefixedWithSchemaName:g,getColumnsList:T,getViewData:_}=q(),y=Ac(),{generateConstraintsString:A,foreignKeysToString:S,foreignActiveKeysToString:b,createKeyConstraint:I,getConstraintsWarnings:R,additionalPropertiesForForeignKey:U}=bc()({_:n,commentIfDeactivated:a,checkAllKeysDeactivated:o,assignTemplates:y,getColumnsList:T,wrapInQuotes:f}),N=Yt()(n,d),{getFunctionsScript:D}=Oc()({_:n,templates:w,assignTemplates:y,getFunctionArguments:m,getNamePrefixedWithSchemaName:g,wrapComment:p}),{getProceduresScript:B}=wc()({_:n,templates:w,assignTemplates:y,getFunctionArguments:m,getNamePrefixedWithSchemaName:g}),{getSequencesScript:F,createSequenceScript:X,dropSequenceScript:Ie,alterSequenceScript:fe}=qc()({_:n,templates:w,assignTemplates:y,getNamePrefixedWithSchemaName:g,wrapInQuotes:f}),{getTableTemporaryValue:P,getTableOptions:Ne}=Pc()({_:n,checkAllKeysDeactivated:o,getColumnsList:T}),{getUserDefinedType:sr,isNotPlainType:_l}=Mc()({_:n,commentIfDeactivated:a,assignTemplates:y,templates:w,getNamePrefixedWithSchemaName:g,wrapComment:p}),{getIndexKeys:El,getIndexOptions:Tl,getWithOptions:Sl}=Uc()({_:n,wrapInQuotes:f,checkAllKeysDeactivated:o,getColumnsList:T}),{decorateType:Cl,decorateDefault:Al,getColumnComments:Nl,replaceTypeByVersion:bl}=$c()({_:n,wrap:l,assignTemplates:y,templates:w,commentIfDeactivated:a,wrapInQuotes:f,wrapComment:p}),{getTriggersScript:_i,hydrateTriggers:Ei}=Kc()({_:n,wrap:l,assignTemplates:y,templates:w,getNamePrefixedWithSchemaName:g,commentIfDeactivated:a}),{getLocaleProperties:Il}=Vc()();return{createDatabase(h){if(!h.databaseName)return"";let{locale:E,collate:v,characterClassification:O}=Il(h);return y(w.createDatabase,{name:f(h.databaseName),template:h.template?`
	TEMPLATE ${h.template}`:"",encoding:h.encoding?`
	ENCODING ${h.encoding}`:"",locale:E?`
	LOCALE '${h.locale}'`:"",collate:v?`
	LC_COLLATE '${h.collate}'`:"",characterClassification:O?`
	LC_CTYPE '${O}'`:"",tablespace:h.tablespace?`
	TABLESPACE '${h.tablespace}'`:""})},createSchema({schemaName:h,ifNotExist:E,comments:v,udfs:O,procedures:k,sequences:W}){let K=y(w.comment,{object:"SCHEMA",objectName:f(h),comment:p(v)}),Z=y(w.createSchema,{name:f(h),ifNotExist:E?" IF NOT EXISTS":"",comment:v?K:""}),te=D(h,O),ne=B(h,k);return n.chain([Z,te,ne]).compact().map(n.trim).join(`

`).trim().value()},createTable({name:h,columns:E,checkConstraints:v,foreignKeyConstraints:O,schemaData:k,columnDefinitions:W,keyConstraints:K,inherits:Z,description:te,ifNotExist:ne,usingMethod:he,on_commit:oe,partitioning:Q,storage_parameter:Ee,table_tablespace_name:Te,temporary:de,unlogged:Se,selectStatement:ve,triggers:be,partitionOf:se,partitionBounds:Oe},Re){let Ct=ne?" IF NOT EXISTS":"",Me=g(h,k.schemaName),ge=y(w.comment,{object:"TABLE",objectName:Me,comment:p(te)}),ir=c(K.filter(({errorMessage:Fe})=>!Fe).map(I(w,Re)),Fe=>Fe.statement),ar=R(K.filter(({errorMessage:Fe})=>Fe)),st=`${A(ir,Re)}${ar}`,Ti=se?st==null?void 0:st.slice(1):st,vl=c(O,Fe=>Fe.statement),Si=A(vl,Re),Ol=`
`+Nl(Me,W),Rl=se?w.createTablePartitionOf:w.createTable,wl=se&&!st?`
	`:`,
	`,Ci=n.isEmpty(v)?"":l(n.join(v,`,
	`),wl,""),Ai=se&&!Ti&&!Ci&&!Si,Dl=Ai?"":"(",ql=Ai?"":")",xl=y(Rl,{temporary:P(de,Se),ifNotExist:Ct,name:Me,columnDefinitions:se?"":"	"+n.join(E,`,
	`),keyConstraints:Ti,checkConstraints:Ci,foreignKeyConstraints:Si,options:Ne({inherits:Z,partitioning:Q,usingMethod:he,on_commit:oe,storage_parameter:Ee,table_tablespace_name:Te,selectStatement:ve,partitionBounds:Oe}),comment:te?ge:"",partitionOf:se?` PARTITION OF ${se} `:"",columnDescriptions:Ol,openParenthesis:Dl,closeParenthesis:ql}),Pl=_i({dbVersion:k.dbVersion,tableName:Me,triggers:be});return a([xl,Pl].map(n.trim).join(`

`).trim()+`
`,{isActivated:Re})},convertColumnDefinition(h){let E=bl(h.type,h.dbVersion),v=h.nullable?"":" NOT NULL",O=h.primaryKey?" "+I(w,!0)(h.primaryKeyOptions).statement:"",k=h.unique?" "+I(w,!0)(h.uniqueKeyOptions).statement:"",W=h.collationRule?` COLLATE "${h.collationRule}"`:"",K=Array.isArray(h.array_type)&&h.array_type.length>0,Z=n.isUndefined(h.default)?"":" DEFAULT "+Al(E,h.default,K),te=h.dbVersion>=12&&h.generatedColumn&&h.columnGenerationExpression?y(w.generatedColumnClause,{generationExpression:h.columnGenerationExpression}):"";return a(y(w.columnDefinition,{name:f(h.name),type:Cl(E,h),generatedColumnClause:te,notNull:v,primaryKey:O,uniqueKey:k,collation:W,defaultValue:Z}),{isActivated:h.isActivated})},createIndex(h,E,v,O=!0){let k=E.unique&&E.index_method==="btree",W=f(E.indxName),K=k?" UNIQUE":"",Z=E.concurrently?" CONCURRENTLY":"",te=E.ifNotExist?" IF NOT EXISTS":"",ne=E.only?" ONLY":"",he=E.index_method?` USING ${n.toUpper(E.index_method)}`:"",{getDbVersion:oe}=q(),Q=oe(n.get(v,"dbVersion","")),Ee=k&&E.nullsDistinct&&Q>=15?`
 ${E.nullsDistinct}`:"",Te=El(E.index_method==="btree"?E.columns:n.map(E.columns,Se=>n.omit(Se,"sortOrder","nullsOrder")),O),de=Tl(E,O);return a(y(w.index,{unique:K,concurrently:Z,ifNotExist:te,name:W,only:ne,using:he,keys:Te,options:de,nullsDistinct:Ee,tableName:g(h,E.schemaName)}),{isActivated:E.isActivated})},createCheckConstraint(h){return y(w.checkConstraint,{name:h.name?`CONSTRAINT ${f(h.name)}`:"",expression:n.trim(h.expression).replace(/^\(([\s\S]*)\)$/,"$1"),noInherit:h.noInherit?" NO INHERIT":""})},createForeignKeyConstraint({name:h,foreignKey:E,primaryTable:v,primaryKey:O,primaryTableActivated:k,foreignTableActivated:W,foreignSchemaName:K,primarySchemaName:Z,customProperties:te,isActivated:ne},he,oe){let Q=o(O),Ee=o(E),Te=!Q&&!Ee&&k&&W,{foreignOnDelete:de,foreignOnUpdate:Se,foreignMatch:ve,deferrable:be,deferrableConstraintCheckTime:se}=U(te),Oe=y(w.createForeignKeyConstraint,{primaryTable:g(v,Z||oe.schemaName),name:h?`CONSTRAINT ${f(h)}`:"",foreignKey:Te?S(E):b(E),primaryKey:Te?S(O):b(O),onDelete:de?` ON DELETE ${de}`:"",onUpdate:Se?` ON UPDATE ${Se}`:"",match:ve?` MATCH ${ve}`:"",deferrable:be?` ${be}`:"",deferrableConstraintCheckTime:be==="DEFERRABLE"&&se?` ${se}`:""});return{statement:n.trim(Oe),isActivated:Te&&ne}},createForeignKey({name:h,foreignTable:E,foreignKey:v,primaryTable:O,primaryKey:k,primaryTableActivated:W,foreignTableActivated:K,foreignSchemaName:Z,primarySchemaName:te,customProperties:ne,isActivated:he},oe,Q){let Ee=o(k),Te=o(v),de=!Ee&&!Te&&W&&K,{foreignOnDelete:Se,foreignOnUpdate:ve,foreignMatch:be,deferrable:se,deferrableConstraintCheckTime:Oe}=U(ne),Re=y(w.createForeignKey,{primaryTable:g(O,te||Q.schemaName),foreignTable:g(E,Z||Q.schemaName),name:h?f(h):"",foreignKey:de?S(v):b(v),primaryKey:de?S(k):b(k),onDelete:Se?` ON DELETE ${Se}`:"",onUpdate:ve?` ON UPDATE ${ve}`:"",match:be?` MATCH ${be}`:"",deferrable:se?` ${se}`:"",deferrableConstraintCheckTime:se==="DEFERRABLE"&&Oe?` ${Oe}`:""});return{statement:n.trim(Re),isActivated:de&&he}},createView(h,E,v){var Oe,Re,Ct,Me;let O=g(h.name,h.schemaName),k=y(w.comment,{object:"VIEW",objectName:O,comment:p(h.comment)}),K=o(h.keys||[])||!v,{columns:Z,tables:te}=_(h.keys),ne=Z.map(ge=>ge.statement).join(`,
		`);if(!K){let ge=c(Z,ar=>ar.statement),ir=ge.deactivatedItems.length?a(ge.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";ne=ge.activatedItems.join(`,
		`)+ir}let he=n.trim(h.selectStatement)?n.trim(s(h.selectStatement)):y(w.viewSelectStatement,{tableName:te.join(", "),keys:ne}),oe=(Oe=h.viewOptions)!=null&&Oe.check_option?`check_option=${(Re=h.viewOptions)==null?void 0:Re.check_option}`:"",Q=(Ct=h.viewOptions)!=null&&Ct.security_barrier?"security_barrier":"",Ee=15,{getDbVersion:Te}=q(),de=(Me=h.viewOptions)!=null&&Me.security_invoker&&Te(E.dbVersion)>=Ee?"security_invoker":"",Se=oe||Q||de?`
	WITH (${n.compact([oe,Q,de]).join(",")})`:"",ve=i(ge=>ge.withCheckOption&&ge.checkTestingScope?`
	WITH ${ge.checkTestingScope} CHECK OPTION`:ge.withCheckOption?`
	WITH CHECK OPTION`:"","getCheckOption"),be=a(y(w.createView,{name:O,orReplace:h.orReplace?" OR REPLACE":"",temporary:h.temporary?" TEMPORARY":"",checkOption:ve(h),comment:h.comment?k:"",withOptions:Se,selectStatement:he}),{isActivated:!K}),se=_i({dbVersion:h.dbVersion,tableName:O,triggers:h.triggers});return[be,se].map(n.trim).join(`

`).trim()+`
`},dropView(h){let E={viewName:h};return y(w.dropView,E)},createViewIndex(){return""},createUdt(h){let E=n.map(h.properties,this.convertColumnDefinition);return sr(h,E)},getDefaultType(h){return Vg[h]},getTypesDescriptors(){return Hc},hasType(h){return u(Hc,h)},hydrateDatabase({modelData:h}){return h=n.get(h,"0",{}),{databaseName:h.database_name,tablespace:h.tablespace_name,encoding:h.encoding,template:h.template,collate:h.LC_COLLATE,characterClassification:h.LC_CTYPE,dbVersion:h.dbVersion,locale:h.locale}},hydrateColumn({columnDefinition:h,jsonSchema:E,schemaData:v,definitionJsonSchema:O={},parentJsonSchema:k}){let W=n.includes(["char","varchar","text"],h.type)?E.collationRule:"",K=["time","timestamp"],Z=n.includes(K,h.type)?E.timePrecision:"",te=n.includes(K,h.type)?E.timezone:"",ne=h.type==="interval"?E.intervalOptions:"",{getDbVersion:he}=q(),oe=he(v.dbVersion),Q=n.omit(N.hydratePrimaryKeyOptions(n.first(E.primaryKeyOptions)||{},h.name,h.isActivated,k),"columns"),Ee=n.omit(N.hydrateUniqueOptions({options:n.first(E.uniqueKeyOptions)||{},columnName:h.name,isActivated:h.isActivated,jsonSchema:k,dbVersion:oe}),"columns");return{name:h.name,type:h.type,primaryKey:N.isInlinePrimaryKey(E),primaryKeyOptions:Q,unique:N.isInlineUnique(E),uniqueKeyOptions:Ee,nullable:h.nullable,default:h.default,comment:E.refDescription||E.description||O.description,isActivated:h.isActivated,scale:h.scale,precision:h.precision,length:h.length,enum:E.enum,array_type:E.array_type,unit:E.unit,rangeSubtype:E.rangeSubtype,operatorClass:E.operatorClass,collation:E.collation,canonicalFunction:E.canonicalFunction,subtypeDiffFunction:E.subtypeDiffFunction,multiRangeType:E.multiRangeType,schemaName:v.schemaName,underlyingType:E.underlyingType,checkConstraints:E.checkConstraints,typeModifier:E.typeModifier,srid:E.srid,collationRule:W,timePrecision:Z,timezone:te,intervalOptions:ne,dbVersion:oe,generatedColumn:!!E.generatedColumn,columnGenerationExpression:E.columnGenerationExpression}},hydrateJsonSchemaColumn(h,E){return!h.$ref||n.isEmpty(E)||_l(E)?h:(h=n.omit(h,"$ref"),{...E,...h})},hydrateIndex(h,E,v){return{...h,schemaName:v.schemaName}},hydrateViewIndex(h){return{}},hydrateCheckConstraint(h){return{name:h.chkConstrName,expression:h.constrExpression,noInherit:h.noInherit}},hydrateSchema(h,E){let v=n.get(E,"modelData.0.dbVersion");return{schemaName:h.name,ifNotExist:h.ifNotExist,comments:h.description,udfs:(E==null?void 0:E.udfs)||[],procedures:(E==null?void 0:E.procedures)||[],sequences:(E==null?void 0:E.sequences)||[],dbVersion:v}},hydrateTable({tableData:h,entityData:E,jsonSchema:v}){let O=E[0],k=n.chain(O.inherits).map(({parentTable:Q})=>n.get(h,`relatedSchemas[${Q}]`,"")).compact().map(Q=>Q.code||Q.collectionName).join(", ").thru(Q=>Q?`(${Q})`:"").value(),W=n.first(O.partitioning)||{},K=N.getKeys(W.compositePartitionKey,v),Z=n.get(h,`relatedSchemas[${O.partitionOf}]`),te=Z?g(Z.collectionName,Z.bucketName):"",ne=Ei(E,h.relatedSchemas),{getDbVersion:he}=q(),oe=he(n.get(h,"dbData.dbVersion",""));return{...h,triggers:ne,partitionOf:te,keyConstraints:N.getTableKeyConstraints(v,oe),inherits:k,selectStatement:n.trim(O.selectStatement),partitioning:n.assign({},W,{compositePartitionKey:K}),...n.pick(O,"temporary","unlogged","description","ifNotExist","usingMethod","on_commit","storage_parameter","table_tablespace_name","partitionBounds")}},hydrateViewColumn(h){return{name:h.name,tableName:h.entityName,alias:h.alias,isActivated:h.isActivated,dbName:h.dbName}},hydrateView({viewData:h,entityData:E,relatedSchemas:v}){let O=E[0],k=Ei(E,v);return{name:h.name,keys:h.keys,comment:O.description,orReplace:O.orReplace,temporary:O.temporary,recursive:O.recursive,viewOptions:O.viewOptions,selectStatement:O.selectStatement,withCheckOption:O.withCheckOption,checkTestingScope:O.withCheckOption?O.checkTestingScope:"",schemaName:h.schemaData.schemaName,triggers:k}},commentIfDeactivated(h,E,v){return h},alterColumnType(h,E,v,O){let k=v;return O.length?k+=`(${O.length})`:O.precision&&O.scale?k+=`(${O.precision},${O.scale})`:O.precision&&(k+=`(${O.precision})`),y(w.alterColumnType,{tableName:h,columnName:E,dataType:k})},setNotNullConstraint(h,E){return y(w.addNotNullConstraint,{tableName:h,columnName:E})},dropNotNullConstraint(h,E){return y(w.dropNotNullConstraint,{tableName:h,columnName:E})},renameColumn(h,E,v){return y(w.renameColumn,{tableName:h,oldColumnName:E,newColumnName:v})},addCheckConstraint(h,E,v){let O={tableName:h,constraintName:E,expression:v};return y(w.addCheckConstraint,O)},dropConstraint(h,E){let v={tableName:h,constraintName:E};return y(w.dropConstraint,v)},updateTableComment(h,E){let v={tableName:h,comment:E};return y(w.updateCommentOnTable,v)},dropTableComment(h){let E={tableName:h,comment:"NULL"};return y(w.updateCommentOnTable,E)},updateColumnComment(h,E){let v={columnName:h,comment:E};return y(w.updateCommentOnColumn,v)},dropColumnComment(h){let E={columnName:h,comment:"NULL"};return y(w.updateCommentOnColumn,E)},updateSchemaComment(h,E){let v={schemaName:h,comment:E};return y(w.updateCommentOnSchema,v)},dropSchemaComment(h){let E={schemaName:h,comment:"NULL"};return y(w.updateCommentOnSchema,E)},updateViewComment(h,E){let v={viewName:h,comment:E};return y(w.updateCommentOnView,v)},dropViewComment(h){let E={viewName:h,comment:"NULL"};return y(w.updateCommentOnView,E)},createSchemaOnly(h){let E={schemaName:h};return y(w.createSchemaOnly,E)},dropSchema(h){let E={schemaName:h};return y(w.dropSchema,E)},dropTable(h){let E={tableName:h};return y(w.dropTable,E)},addColumn(h,E){let v={tableName:h,columnDefinition:E};return y(w.addColumn,v)},dropColumn(h,E){let v={tableName:h,columnName:E};return y(w.dropColumn,v)},dropDomain(h){let E={udtName:h};return y(w.dropDomain,E)},dropType(h){let E={udtName:h};return y(w.dropType,E)},alterTypeAddAttribute(h,E){let v={udtName:h,columnDefinition:E};return y(w.alterTypeAddAttribute,v)},alterTypeDropAttribute(h,E){let v={udtName:h,attributeName:E};return y(w.alterTypeDropAttribute,v)},alterTypeRenameAttribute(h,E,v){let O={udtName:h,oldAttributeName:E,newAttributeName:v};return y(w.alterTypeRenameAttribute,O)},alterTypeChangeAttributeType(h,E,v){let O={udtName:h,attributeName:E,newDataType:v};return y(w.alterTypeChangeAttributeType,O)},dropForeignKey(h,E){let v={tableName:h,fkConstraintName:E};return y(w.dropForeignKey,v)},createKeyConstraint(h,E,v){let O=I(w,E)(v);return{statement:y(w.addPkConstraint,{constraintStatement:(O.statement||"").trim(),tableName:h}),isActivated:O.isActivated}},dropKeyConstraint(h,E){let v={tableName:h,constraintName:E};return y(w.dropConstraint,v)},createSchemaSequences({schemaName:h,sequences:E}){return F({schemaName:h,sequences:E})},createSchemaSequence({schemaName:h,sequence:E}){return X({schemaName:h,sequence:E})},dropSchemaSequence({schemaName:h,sequence:E}){return Ie({schemaName:h,sequence:E})},alterSchemaSequence({schemaName:h,sequence:E,oldSequence:v}){return fe({schemaName:h,sequence:E,oldSequence:v})},dropIndex({indexName:h}){let E={indexName:h};return y(w.dropIndex,E)},alterIndexRename({schemaName:h,oldIndexName:E,newIndexName:v}){let O=f(h),k=g(f(E),O),W=f(v),K={oldIndexName:k,newIndexName:W};return y(w.alterIndexRename,K)},alterIndexTablespace({schemaName:h,indexName:E,tablespaceName:v}){let O=f(h),W={indexName:g(f(E),O),tablespaceName:v};return y(w.alterIndexTablespace,W)},alterIndexStorageParams({schemaName:h,indexName:E,index:v}){let O=f(h),k=g(f(E),O),W=Sl(v),K={indexName:k,options:W};return y(w.alterIndexStorageParams,K)},reindexIndex({schemaName:h,indexName:E}){let v=f(h),k={indexName:g(f(E),v)};return y(w.reindexIndex,k)},updateColumnDefaultValue({tableName:h,columnName:E,defaultValue:v}){let O={tableName:h,columnName:E,defaultValue:v};return y(w.updateColumnDefaultValue,O)},dropColumnDefaultValue({tableName:h,columnName:E}){let v={tableName:h,columnName:E};return y(w.dropColumnDefaultValue,v)}}}});var jc=C((wC,Yc)=>{"use strict";var{getModifySchemaCommentsScriptDtos:Hg}=fc(),{AlterScriptDto:Qc}=z(),Wg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q(),a=n.createSchemaOnly(s(e));return Qc.getInstance([a],!0,!1)},"getAddContainerScriptDto"),Qg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q(),a=n.dropSchema(s(e));return Qc.getInstance([a],!0,!0)},"getDeleteContainerScriptDto"),Yg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...Hg(r,n)(e)]},"getModifyContainerScriptDtos");Yc.exports={getAddContainerScriptDto:Wg,getDeleteContainerScriptDto:Qg,getModifyContainerScriptDtos:Yg}});var Xc=C((xC,zc)=>{"use strict";var{AlterCollectionDto:qC}=Le(),{AlterScriptDto:jt}=z(),jg=i(t=>e=>{var o;let r=(o=e==null?void 0:e.compMod)==null?void 0:o.chkConstr;if(!r)return[];let n=r.new||[],s=r.old||[];return t.chain([...n,...s]).map(c=>c.chkConstrName).uniq().value().map(c=>({old:t.find(s,{chkConstrName:c}),new:t.find(n,{chkConstrName:c})}))},"mapCheckConstraintNamesToChangeHistory"),zg=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q();return r.filter(a=>a.old&&!a.new).map(a=>{let o=s(a.old.chkConstrName);return e.dropConstraint(n,o)}).map(a=>jt.getInstance([a],!0,!0))},"getDropCheckConstraintScriptDtos"),Xg=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q();return r.filter(a=>a.new&&!a.old).map(a=>{let{chkConstrName:o,constrExpression:c}=a.new;return e.addCheckConstraint(n,s(o),c)}).map(a=>jt.getInstance([a],!0,!1))},"getAddCheckConstraintScriptDtos"),Zg=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q();return r.filter(a=>{if(a.old&&a.new){let o=a.old.constrExpression,c=a.new.constrExpression;return o!==c}return!1}).map(a=>{let{chkConstrName:o}=a.old,c=e.dropConstraint(n,s(o)),{chkConstrName:u,constrExpression:l}=a.new,d=e.addCheckConstraint(n,s(u),l);return[jt.getInstance([c],!0,!0),jt.getInstance([d],!0,!1)]}).flat()},"getUpdateCheckConstraintScriptDtos"),Jg=i((t,e)=>r=>{let{getFullTableName:n}=q(),s=n(r),a=jg(t)(r),o=Xg(t,e)(a,s),c=zg(t,e)(a,s),u=Zg(t,e)(a,s);return[...o,...c,...u]},"getModifyCheckConstraintScriptDtos");zc.exports={getModifyCheckConstraintScriptDtos:Jg}});var eu=C((MC,Jc)=>{"use strict";var{AlterScriptDto:Zc}=z(),{AlterCollectionDto:LC}=Le(),ey=i((t,e)=>r=>{var p;let{getFullTableName:n,wrapComment:s}=q(),a=(p=r==null?void 0:r.role.compMod)==null?void 0:p.description;if(!a)return;let{old:o,new:c}=a;if(!c||c===o)return;let u=n(r),l=s(c),d=e.updateTableComment(u,l);return Zc.getInstance([d],!0,!1)},"getUpdatedCommentOnCollectionScriptDto"),ty=i((t,e)=>r=>{var l;let{getFullTableName:n}=q(),s=(l=r==null?void 0:r.role.compMod)==null?void 0:l.description;if(!s)return;let{old:a,new:o}=s;if(!a||o)return;let c=n(r),u=e.dropTableComment(c);return Zc.getInstance([u],!0,!0)},"getDeletedCommentOnCollectionScriptDto"),ry=i((t,e)=>r=>{let n=ey(t,e)(r),s=ty(t,e)(r);return[n,s].filter(Boolean)},"getModifyEntityCommentsScriptDtos");Jc.exports={getModifyEntityCommentsScriptDtos:ry}});var ru=C((UC,tu)=>{"use strict";var{AlterScriptDto:ny}=z(),sy=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.length,a=r==null?void 0:r.length;return s!==a},"hasLengthChanged"),iy=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.precision,a=r==null?void 0:r.precision,o=n==null?void 0:n.scale,c=r==null?void 0:r.scale;return s!==a||o!==c},"hasPrecisionOrScaleChanged"),ay=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:a}=q(),o=s(r);return t.toPairs(r.properties).filter(([c,u])=>{let l=n(u.compMod,["type","mode"]);if(!l){let d=u.compMod.oldField.name,p=sy(r,d,u),m=iy(r,d,u);return p||m}return l}).map(([c,u])=>{let l=u.compMod.newField.mode||u.compMod.newField.type,d=a(c),p=t.pick(u,["length","precision","scale"]);return e.alterColumnType(o,d,l,p)}).map(c=>ny.getInstance([c],!0,!1))},"getUpdateTypesScriptDtos");tu.exports={getUpdateTypesScriptDtos:ay}});var iu=C(($C,su)=>{"use strict";var{AlterScriptDto:nu}=z(),oy=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s}=q(),a=n(r),o=r.required||[],c=r.role.required||[],u=t.difference(o,c),l=t.difference(c,o),d=t.toPairs(r.properties).filter(([m,f])=>{let g=f.compMod.oldField.name,T=l.includes(g);return u.includes(m)&&!T}).map(([m])=>e.setNotNullConstraint(a,s(m))).map(m=>nu.getInstance([m],!0,!1)),p=t.toPairs(r.properties).filter(([m,f])=>{let g=f.compMod.oldField.name,T=l.includes(g),_=u.includes(m);return T&&!_}).map(([m])=>e.dropNotNullConstraint(a,s(m))).map(m=>nu.getInstance([m],!0,!0));return[...d,...p]},"getModifyNonNullColumnsScriptDtos");su.exports={getModifyNonNullColumnsScriptDtos:oy}});var cu=C((KC,ou)=>{"use strict";var{AlterScriptDto:au}=z(),cy=i((t,e)=>r=>{let{getFullColumnName:n,wrapComment:s}=q();return t.toPairs(r.properties).filter(([a,o])=>{var d;let c=o.description,u=o.compMod.oldField.name,l=(d=r.role.properties[u])==null?void 0:d.description;return c&&(!l||c!==l)}).map(([a,o])=>{let c=o.description,u=s(c),l=n(r,a);return e.updateColumnComment(l,u)}).map(a=>au.getInstance([a],!0,!1))},"getUpdatedCommentOnColumnScriptDtos"),uy=i((t,e)=>r=>{let{getFullColumnName:n}=q();return t.toPairs(r.properties).filter(([s,a])=>{var l;let o=a.description,c=a.compMod.oldField.name;return((l=r.role.properties[c])==null?void 0:l.description)&&!o}).map(([s,a])=>{let o=n(r,s);return e.dropColumnComment(o)}).map(s=>au.getInstance([s],!0,!0))},"getDeletedCommentOnColumnScriptDtos"),ly=i((t,e)=>r=>{let n=cy(t,e)(r),s=uy(t,e)(r);return[...n,...s]},"getModifiedCommentOnColumnScriptDtos");ou.exports={getModifiedCommentOnColumnScriptDtos:ly}});var lu=C((VC,uu)=>{"use strict";var{AlterScriptDto:py}=z(),my=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:a}=q(),o=s(r);return t.values(r.properties).filter(c=>n(c.compMod,["name"])).map(c=>{let u=a(c.compMod.oldField.name),l=a(c.compMod.newField.name);return e.renameColumn(o,u,l)}).map(c=>py.getInstance([c],!0,!1))},"getRenameColumnScriptDtos");uu.exports={getRenameColumnScriptDtos:my}});var Os=C((WC,pu)=>{"use strict";var Is=class Is{didTransitionHappen;wasPkChangedInTransition;static noTransition(){return{didTransitionHappen:!1}}static transition(e){return{didTransitionHappen:!0,wasPkChangedInTransition:e}}};i(Is,"KeyTransitionDto");var Ns=Is,vs=class vs{script;isDropScript;fullTableName;isActivated;constructor(e,r,n,s){this.script=e,this.isDropScript=n,this.fullTableName=r,this.isActivated=s}};i(vs,"KeyScriptModificationDto");var bs=vs;pu.exports={KeyScriptModificationDto:bs,KeyTransitionDto:Ns}});var gu=C((JC,hu)=>{"use strict";var{AlterScriptDto:dy}=z(),{AlterCollectionDto:YC,AlterCollectionColumnDto:jC,AlterCollectionRoleCompModPKDto:zC,AlterCollectionColumnKeyOptionDto:XC,AlterCollectionRoleCompModPrimaryKey:ZC}=Le(),{KeyTransitionDto:pe,KeyScriptModificationDto:zt}=Os(),Je=1,Rs=i(t=>`${t}_pkey`,"getDefaultConstraintName"),mu=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularPkOptions"),et=i(t=>(t.primaryKeyOptions||[]).map(r=>mu(r)),"getCustomPropertiesOfRegularPkForComparisonWithRegularPkOptions"),Xt=i(t=>[mu(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositePkForComparisonWithRegularPkOptions"),fy=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.primaryKey)||{}).old||[],s=n.flatMap(m=>m.compositePrimaryKey.map(f=>f.keyId));if(s.length!==Je)return pe.noTransition();let a=s[0],o=Object.values(e.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return pe.noTransition();let u=et(o),l=n.some(m=>{if(m.compositePrimaryKey.length!==Je)return!1;let f=Xt(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return pe.transition(!l)},"wasCompositePkChangedInTransitionFromCompositeToRegular"),hy=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.primaryKey)||{}).new||[],s=n.flatMap(m=>m.compositePrimaryKey.map(f=>f.keyId));if(s.length!==Je)return pe.noTransition();let a=s[0],o=Object.values(e.role.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return pe.noTransition();let u=et(o),l=n.some(m=>{if(m.compositePrimaryKey.length!==Je)return!1;let f=Xt(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return pe.transition(!l)},"wasCompositePkChangedInTransitionFromRegularToComposite"),gy=i((t,e)=>t.constraintName?t.constraintName:Rs(e),"getConstraintNameForCompositePk"),yy=i(t=>(e,r,n)=>{let s=gy(e,r),a=t.toPairs(n.role.properties).filter(([l,d])=>!!e.compositePrimaryKey.find(p=>p.keyId===d.GUID)).map(([l,d])=>({name:l,isActivated:d.isActivated})),o="",c="",u=[];return e.indexStorageParameters&&(o=e.indexStorageParameters),e.indexTablespace&&(c=e.indexTablespace),e.indexInclude&&(u=t.toPairs(n.role.properties).filter(([l,d])=>!!e.indexInclude.find(p=>p.keyId===d.GUID)).map(([l,d])=>({name:l,isActivated:d.isActivated}))),{name:s,keyType:"PRIMARY KEY",columns:a,include:u,storageParameters:o,tablespace:c}},"getCreateCompositePKDDLProviderConfig"),_y=i((t,e)=>r=>{var f,g;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=q(),o=((g=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:g.primaryKey)||{},c=o.new||[],u=o.old||[];if(c.length===0&&u.length===0)return[];let l=hy(t)(r);if(l.didTransitionHappen&&!l.wasPkChangedInTransition)return[];if(c.length===u.length&&t(u).differenceWith(c,t.isEqual).isEmpty())return[];let d=s(r),p=n(d),m=a(d);return c.map(T=>{let _=yy(t)(T,m,r),y=e.createKeyConstraint(p,r.isActivated,_);return new zt(y.statement,p,!1,y.isActivated)}).filter(T=>!!T.script)},"getAddCompositePkScriptDtos"),Ey=i((t,e)=>r=>{var g,T;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=q(),c=((T=(g=r==null?void 0:r.role)==null?void 0:g.compMod)==null?void 0:T.primaryKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let d=fy(t)(r);if(d.didTransitionHappen&&!d.wasPkChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let p=s(r),m=n(p),f=a(p);return l.map(_=>{let y=Rs(f);_.constraintName&&(y=_.constraintName);let A=o(y),S=e.dropKeyConstraint(m,A);return new zt(S,m,!0,r.isActivated)}).filter(_=>!!_.script)},"getDropCompositePkScriptDtos"),Ty=i((t,e)=>r=>{let n=Ey(t,e)(r),s=_y(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyCompositePkScriptDtos"),du=i((t,e)=>{let r=t.primaryKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return Rs(e)},"getConstraintNameForRegularPk"),Sy=i(t=>(e,r,n,s)=>{let a=du(r,n),o=[{name:e,isActivated:r.isActivated}],c="",u="",l=[],d=r.primaryKeyOptions;if(d!=null&&d.length&&(d==null?void 0:d.length)>0){let p=d[0];p.indexStorageParameters&&(c=p.indexStorageParameters),p.indexTablespace&&(u=p.indexTablespace),p.indexInclude&&(l=t.toPairs(s.role.properties).filter(([m,f])=>!!p.indexInclude.find(g=>g.keyId===f.GUID)).map(([m,f])=>({name:m,isActivated:f.isActivated})))}return{name:a,keyType:"PRIMARY KEY",columns:o,include:l,storageParameters:c,tablespace:u}},"getCreateRegularPKDDLProviderConfig"),Cy=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);return a&&!o},"wasFieldChangedToBeARegularPk"),Ay=i(t=>(e,r)=>{var f,g;let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);if(!(a&&o))return pe.noTransition();let c=((g=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:g.primaryKey)||{},u=c.new||[],l=c.old||[],d=l.some(T=>T.compositePrimaryKey.some(_=>_.keyId===s.GUID)),p=u.some(T=>T.compositePrimaryKey.some(_=>_.keyId===e.GUID));if(a&&(d&&!p)){let T=et(e),_=l.some(y=>{if(y.compositePrimaryKey.length!==Je)return!1;let A=Xt(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return pe.transition(!_)}return pe.noTransition()},"wasRegularPkChangedInTransitionFromCompositeToRegular"),Ny=i(t=>(e,r)=>{var f,g;let n=e.compMod.oldField.name,s=r.role.properties[n],a=s.primaryKey&&!s.compositePrimaryKey,o=!!(e!=null&&e.primaryKey);if(!(a&&o))return pe.noTransition();let c=((g=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:g.primaryKey)||{},u=c.new||[],d=(c.old||[]).some(T=>T.compositePrimaryKey.some(_=>_.keyId===s.GUID)),m=u.some(T=>T.compositePrimaryKey.some(_=>_.keyId===e.GUID))&&!d;if(a&&m){let T=et(s),_=u.some(y=>{if(y.compositePrimaryKey.length!==Je)return!1;let A=Xt(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return pe.transition(!_)}return pe.noTransition()},"wasRegularPkChangedInTransitionFromRegularToComposite"),by=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey),o=!e.primaryKey&&!e.compositePrimaryKey;return a&&o},"isFieldNoLongerARegularPk"),fu=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},a=e.primaryKey&&!e.compositePrimaryKey,o=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey);if(!(a&&o))return!1;let c=et(e),u=et(s);return!t(u).differenceWith(c,t.isEqual).isEmpty()},"wasRegularPkModified"),Iy=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=q(),o=s(r),c=n(o),u=a(o);return t.toPairs(r.properties).filter(([l,d])=>{if(Cy(t)(d,r))return!0;let p=Ay(t)(d,r);return p.didTransitionHappen?p.wasPkChangedInTransition:fu(t)(d,r)}).map(([l,d])=>{let p=Sy(t)(l,d,u,r),m=e.createKeyConstraint(c,r.isActivated,p);return new zt(m.statement,c,!1,m.isActivated)}).filter(l=>!!l.script)},"getAddPkScriptDtos"),vy=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=q(),c=s(r),u=n(c),l=a(c);return t.toPairs(r.properties).filter(([d,p])=>{if(by(t)(p,r))return!0;let m=Ny(t)(p,r);return m.didTransitionHappen?m.wasPkChangedInTransition:fu(t)(p,r)}).map(([d,p])=>{let m=p.compMod.oldField.name,f=r.role.properties[m],g=o(du(f,l)),T=e.dropKeyConstraint(u,g);return new zt(T,u,!0,r.isActivated)}).filter(d=>!!d.script)},"getDropPkScriptDto"),Oy=i((t,e)=>r=>{let n=vy(t,e)(r),s=Iy(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyPkScriptDtos"),Ry=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyPkConstraints"),wy=i((t,e)=>r=>{let n=Ty(t,e)(r),s=Oy(t,e)(r),a=[...n,...s];return Ry(a).map(c=>dy.getInstance([c.script],c.isActivated,c.isDropScript)).filter(Boolean)},"getModifyPkConstraintsScriptDtos");hu.exports={getModifyPkConstraintsScriptDtos:wy}});var Su=C((aA,Tu)=>{"use strict";var{AlterScriptDto:Dy}=z(),{AlterCollectionDto:tA,AlterCollectionColumnDto:rA,AlterCollectionRoleCompModUniqueKeyDto:nA,AlterCollectionColumnKeyOptionDto:sA,AlterCollectionRoleCompModUniqueKey:iA}=Le(),{KeyTransitionDto:me,KeyScriptModificationDto:Zt}=Os(),tt=1,ws=i(t=>`${t}_ukey`,"getDefaultConstraintName"),yu=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularUniqueKeyOptions"),rt=i(t=>(t.uniqueKeyOptions||[]).map(r=>yu(r)),"getCustomPropertiesOfRegularUniqueKeyForComparisonWithRegularUniqueKeyOptions"),Jt=i(t=>[yu(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositeUniqueKeyForComparisonWithRegularUniqueKeyOptions"),qy=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.uniqueKey)||{}).old||[],s=n.flatMap(m=>m.compositeUniqueKey.map(f=>f.keyId));if(s.length!==tt)return me.noTransition();let a=s[0],o=Object.values(e.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.unique)&&!(o!=null&&o.compositeUniqueKey)))return me.noTransition();let u=rt(o),l=n.some(m=>{if(m.compositeUniqueKey.length!==tt)return!1;let f=Jt(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return me.transition(!l)},"wasCompositeUniqueKeyChangedInTransitionFromCompositeToRegular"),xy=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.uniqueKey)||{}).new||[],s=n.flatMap(m=>m.compositeUniqueKey.map(f=>f.keyId));if(s.length!==tt)return me.noTransition();let a=s[0],o=Object.values(e.role.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.unique)&&!(o!=null&&o.compositeUniqueKey)))return me.noTransition();let u=rt(o),l=n.some(m=>{if(m.compositeUniqueKey.length!==tt)return!1;let f=Jt(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return me.transition(!l)},"wasCompositeUniqueKeyChangedInTransitionFromRegularToComposite"),Py=i((t,e)=>t.constraintName?t.constraintName:ws(e),"getConstraintNameForCompositeUniqueKey"),Ly=i(t=>(e,r,n,s)=>{let{clean:a,getDbVersion:o}=q(),c=Yt()(t,a),u=Py(e,r),l=t.toPairs(n.role.properties).filter(([_,y])=>!!e.compositeUniqueKey.find(A=>A.keyId===y.GUID)).map(([_,y])=>({name:_,isActivated:y.isActivated})),d="",p="",m=[],f=e.deferrable,g=e.deferrableConstraintCheckTime;e.indexStorageParameters&&(d=e.indexStorageParameters),e.indexTablespace&&(p=e.indexTablespace),e.indexInclude&&(m=t.toPairs(n.role.properties).filter(([_,y])=>!!e.indexInclude.find(A=>A.keyId===y.GUID)).map(([_,y])=>({name:_,isActivated:y.isActivated})));let T=c.getUniqueKeyType(e,o(s));return{name:u,keyType:T,columns:l,include:m,storageParameters:d,tablespace:p,deferrable:f,deferrableConstraintCheckTime:g}},"getCreateCompositeUniqueKeyDDLProviderConfig"),My=i((t,e)=>(r,n)=>{var g,T;let{getFullCollectionName:s,getSchemaOfAlterCollection:a,getEntityName:o}=q(),c=((T=(g=r==null?void 0:r.role)==null?void 0:g.compMod)==null?void 0:T.uniqueKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let d=xy(t)(r);if(d.didTransitionHappen&&!d.wasUniqueKeyChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let p=a(r),m=s(p),f=o(p);return u.map(_=>{let y=Ly(t)(_,f,r,n),A=e.createKeyConstraint(m,r.isActivated,y);return new Zt(A.statement,m,!1,A.isActivated)}).filter(_=>!!_.script)},"getAddCompositeUniqueKeyScriptDtos"),Fy=i((t,e)=>r=>{var g,T;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=q(),c=((T=(g=r==null?void 0:r.role)==null?void 0:g.compMod)==null?void 0:T.uniqueKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let d=qy(t)(r);if(d.didTransitionHappen&&!d.wasUniqueKeyChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let p=s(r),m=n(p),f=a(p);return l.map(_=>{let y=ws(f);_.constraintName&&(y=_.constraintName);let A=o(y),S=e.dropKeyConstraint(m,A);return new Zt(S,m,!0,r.isActivated)}).filter(_=>!!_.script)},"getDropCompositeUniqueKeyScriptDtos"),Uy=i((t,e)=>(r,n)=>{let s=Fy(t,e)(r),a=My(t,e)(r,n);return[...s,...a].filter(Boolean)},"getModifyCompositeUniqueKeyScriptDtos"),_u=i((t,e)=>{let r=t.uniqueKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return ws(e)},"getConstraintNameForRegularUniqueKey"),ky=i(t=>(e,r,n,s,a)=>{let{clean:o,getDbVersion:c}=q(),u=Yt()(t,o),l=_u(r,n),d=[{name:e,isActivated:r.isActivated}],p="",m="",f=[],g="",T="",_="",y=r.uniqueKeyOptions;if(y!=null&&y.length&&(y==null?void 0:y.length)>0){let S=y[0];S.indexStorageParameters&&(p=S.indexStorageParameters),S.indexTablespace&&(m=S.indexTablespace),S.indexInclude&&(f=t.toPairs(s.role.properties).filter(([b,I])=>!!S.indexInclude.find(R=>R.keyId===I.GUID)).map(([b,I])=>({name:b,isActivated:I.isActivated}))),g=S.deferrable,T=S.deferrableConstraintCheckTime,_=S.nullsDistinct}let A=u.getUniqueKeyType({nullsDistinct:_},c(a));return{name:l,keyType:A,columns:d,include:f,storageParameters:p,tablespace:m,deferrable:g,deferrableConstraintCheckTime:T}},"getCreateRegularUniqueKeyDDLProviderConfig"),$y=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)||s.compositeUniqueKey;return a&&!o},"wasFieldChangedToBeARegularUniqueKey"),By=i(t=>(e,r)=>{var f,g;let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)||s.compositeUniqueKey;if(!(a&&o))return me.noTransition();let c=((g=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:g.uniqueKey)||{},u=c.new||[],l=c.old||[],d=l.some(T=>T.compositeUniqueKey.some(_=>_.keyId===s.GUID)),p=u.some(T=>T.compositeUniqueKey.some(_=>_.keyId===e.GUID));if(a&&(d&&!p)){let T=rt(e),_=l.some(y=>{if(y.compositeUniqueKey.length!==tt)return!1;let A=Jt(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return me.transition(!_)}return me.noTransition()},"wasRegularUniqueKeyChangedInTransitionFromCompositeToRegular"),Ky=i(t=>(e,r)=>{var f,g;let n=e.compMod.oldField.name,s=r.role.properties[n],a=s.unique&&!s.compositeUniqueKey,o=!!(e!=null&&e.unique);if(!(a&&o))return me.noTransition();let c=((g=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:g.uniqueKey)||{},u=c.new||[],d=(c.old||[]).some(T=>T.compositeUniqueKey.some(_=>_.keyId===s.GUID)),m=u.some(T=>T.compositeUniqueKey.some(_=>_.keyId===e.GUID))&&!d;if(a&&m){let T=rt(s),_=u.some(y=>{if(y.compositeUniqueKey.length!==tt)return!1;let A=Jt(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return me.transition(!_)}return me.noTransition()},"wasRegularUniqueKeyChangedInTransitionFromRegularToComposite"),Gy=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=(s==null?void 0:s.unique)&&!(s!=null&&s.compositeUniqueKey),o=!e.unique&&!e.compositeUniqueKey;return a&&o},"isFieldNoLongerARegularUniqueKey"),Eu=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)&&!(s!=null&&s.compositeUniqueKey);if(!(a&&o))return!1;let c=rt(e),u=rt(s);return!t(u).differenceWith(c,t.isEqual).isEmpty()},"wasRegularUniqueKeyModified"),Vy=i((t,e)=>(r,n)=>{let{getFullCollectionName:s,getSchemaOfAlterCollection:a,getEntityName:o}=q(),c=a(r),u=s(c),l=o(c);return t.toPairs(r.properties).filter(([d,p])=>{if($y(t)(p,r))return!0;let m=By(t)(p,r);return m.didTransitionHappen?m.wasUniqueKeyChangedInTransition:Eu(t)(p,r)}).map(([d,p])=>{let m=ky(t)(d,p,l,r,n),f=e.createKeyConstraint(u,r.isActivated,m);return new Zt(f.statement,u,!1,f.isActivated)}).filter(d=>!!d.script)},"getAddUniqueKeyScriptDtos"),Hy=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=q(),c=s(r),u=n(c),l=a(c);return t.toPairs(r.properties).filter(([d,p])=>{if(Gy(t)(p,r))return!0;let m=Ky(t)(p,r);return m.didTransitionHappen?m.wasUniqueKeyChangedInTransition:Eu(t)(p,r)}).map(([d,p])=>{let m=p.compMod.oldField.name,f=r.role.properties[m],g=o(_u(f,l)),T=e.dropKeyConstraint(u,g);return new Zt(T,u,!0,r.isActivated)}).filter(d=>!!d.script)},"getDropUniqueKeyScriptDto"),Wy=i((t,e)=>(r,n)=>{let s=Hy(t,e)(r),a=Vy(t,e)(r,n);return[...s,...a].filter(Boolean)},"getModifyUniqueKeyScriptDtos"),Qy=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyUniqueKeyConstraints"),Yy=i(({_:t,ddlProvider:e})=>({collection:r,dbVersion:n})=>{let s=Uy(t,e)(r,n),a=Wy(t,e)(r,n),o=[...s,...a];return Qy(o).map(u=>Dy.getInstance([u.script],u.isActivated,u.isDropScript)).filter(Boolean)},"getModifyUniqueKeyConstraintsScriptDtos");Tu.exports={getModifyUniqueKeyConstraintsScriptDtos:Yy}});var Ru=C((lA,Ou)=>{"use strict";var{AlterCollectionDto:cA}=Le(),{AlterIndexDto:uA}=os(),{AlterScriptDto:nt}=z(),jy=i(({_:t})=>({columnId:e,collection:r})=>{var c,u,l;let n=t.toPairs(((c=r==null?void 0:r.role)==null?void 0:c.properties)||(r==null?void 0:r.properties)||{}).map(([d,p])=>({...p,name:d})),s=(((l=(u=r==null?void 0:r.role)==null?void 0:u.compMod)==null?void 0:l.oldProperties)||[]).map(d=>({...d,GUID:d.id})),o=(n.length>0?n:s).find(d=>d.GUID===e);if(o)return o.name},"getColumnNameById"),Cu=i(({_:t})=>({columns:e,collection:r})=>(e||[]).map(n=>({...n,name:jy({_:t})({columnId:n.keyId,collection:r})})).filter(n=>!!n.name),"setNamesToColumns"),zy=i(({_:t})=>({index:e,collection:r})=>{let{getSchemaNameFromCollection:n}=q(),s=n({collection:r}),a=Cu({_:t})({columns:e.columns,collection:r}),o=Cu({_:t})({columns:e.include,collection:r});return{...e,schemaName:s,columns:a,include:o}},"mapIndexToFeIndexDto"),Au=i(({_:t})=>({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})=>{let s=t.pick(r,n),a=t.pick(e,n);return!t.isEqual(s,a)},"areIndexesDifferent"),Xy=i(({_:t})=>({oldIndex:e,newIndex:r})=>{let n=["index_method","columns","include","nullsDistinct","where"];return Au({_:t})({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})},"shouldDropAndRecreateIndex"),Zy=i(({_:t})=>({oldIndex:e,newIndex:r})=>{let n=["indxName","index_tablespace_name","index_storage_parameter"];return Au({_:t})({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})},"shouldAlterIndex"),Ds=i(({oldIndex:t,newIndex:e})=>t.id===e.id||t.indxName===e.indxName,"areOldIndexDtoAndNewIndexDtoDescribingSameDatabaseIndex"),Nu=i(({_:t,ddlProvider:e})=>({index:r,collection:n,additionalDataForDdlProvider:s})=>{let{dbData:a,tableName:o,isParentActivated:c}=s,u=zy({_:t})({index:r,collection:n}),l=e.createIndex(o,u,a,c),d=u.isActivated&&c;return nt.getInstance([l],d,!1)},"getCreateIndexScriptDto"),bu=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l;let s=((o=r==null?void 0:r.role)==null?void 0:o.Indxs)||[],a=((l=(u=(c=r==null?void 0:r.role)==null?void 0:c.compMod)==null?void 0:u.Indxs)==null?void 0:l.old)||[];return s.filter(d=>!a.find(m=>Ds({oldIndex:m,newIndex:d}))).map(d=>Nu({_:t,ddlProvider:e})({index:d,collection:r,additionalDataForDdlProvider:n})).filter(Boolean)},"getAddedIndexesScriptDtos"),Iu=i(({_:t,ddlProvider:e})=>({index:r,additionalDataForDdlProvider:n})=>{let{getNamePrefixedWithSchemaName:s}=q(),{isParentActivated:a,schemaName:o}=n,c=s(r.indxName,o),u=e.dropIndex({indexName:c}),l=r.isActivated&&a;return nt.getInstance([u],l,!0)},"getDeleteIndexScriptDto"),Jy=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l,d,p;let s=((u=(c=(o=r==null?void 0:r.role)==null?void 0:o.compMod)==null?void 0:c.Indxs)==null?void 0:u.new)||[];return(((p=(d=(l=r==null?void 0:r.role)==null?void 0:l.compMod)==null?void 0:d.Indxs)==null?void 0:p.old)||[]).filter(m=>!s.find(g=>Ds({oldIndex:m,newIndex:g}))).map(m=>Iu({_:t,ddlProvider:e})({index:m,additionalDataForDdlProvider:n})).filter(Boolean)},"getDeletedIndexesScriptDtos"),e_=i(({_:t,ddlProvider:e})=>({newIndex:r,oldIndex:n,additionalDataForDdlProvider:s})=>{let a=[],{isParentActivated:o,schemaName:c}=s,u=r.isActivated&&o;if(!t.isEqual(r.indxName,n.indxName)){let m=e.alterIndexRename({schemaName:c,oldIndexName:n.indxName,newIndexName:r.indxName}),f=nt.getInstance([m],u,!1);a.push(f)}if(!t.isEqual(r.index_tablespace_name,n.index_tablespace_name)){let m=e.alterIndexTablespace({schemaName:c,indexName:r.indxName,tablespaceName:r.index_tablespace_name}),f=nt.getInstance([m],u,!1);a.push(f)}if(!t.isEqual(r.index_storage_parameter,n.index_storage_parameter)){let m=e.alterIndexStorageParams({schemaName:c,indexName:r.indxName,index:r}),f=nt.getInstance([m],u,!1);a.push(f);let g=e.reindexIndex({schemaName:c,indexName:r.indxName}),T=nt.getInstance([g],u,!1);a.push(T)}return a.filter(Boolean)},"getAlterIndexScriptDtos"),t_=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l,d,p;let s=((u=(c=(o=r==null?void 0:r.role)==null?void 0:o.compMod)==null?void 0:c.Indxs)==null?void 0:u.new)||[],a=((p=(d=(l=r==null?void 0:r.role)==null?void 0:l.compMod)==null?void 0:d.Indxs)==null?void 0:p.old)||[];return s.map(m=>{let f=a.find(g=>Ds({oldIndex:g,newIndex:m}));if(f)return{newIndex:m,oldIndex:f}}).filter(Boolean).flatMap(({newIndex:m,oldIndex:f})=>{if(Xy({_:t})({newIndex:m,oldIndex:f})){let _=Iu({_:t,ddlProvider:e})({index:f,additionalDataForDdlProvider:n}),y=Nu({_:t,ddlProvider:e})({index:m,collection:r,additionalDataForDdlProvider:n});return[_,y]}return Zy({_:t})({oldIndex:f,newIndex:m})?e_({_:t,ddlProvider:e})({oldIndex:f,newIndex:m,additionalDataForDdlProvider:n}):[]}).filter(Boolean)},"getModifiedIndexesScriptDtos"),r_=i(({_:t,ddlProvider:e})=>({collection:r,dbVersion:n})=>{let s=vu({_:t,dbVersion:n,collection:r}),a=Jy({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s}),o=bu({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s}),c=t_({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s});return[...a,...o,...c].filter(Boolean)},"getModifyIndexesScriptDtos"),vu=i(({_:t,dbVersion:e,collection:r})=>{var s,a,o;let{getSchemaNameFromCollection:n}=q();return{dbData:{dbVersion:e},tableName:((a=(s=r==null?void 0:r.compMod)==null?void 0:s.collectionName)==null?void 0:a.new)||((o=r==null?void 0:r.role)==null?void 0:o.name)||"",schemaName:n({collection:r})||"",isParentActivated:r.isActivated}},"getAdditionalDataForDdlProvider");Ou.exports={getModifyIndexesScriptDtos:r_,getAddedIndexesScriptDtos:bu,getAdditionalDataForDdlProvider:vu}});var Lu=C((mA,Pu)=>{"use strict";var{toPairs:wu}=require("lodash"),{AlterScriptDto:Du}=z(),{getFullTableName:qu,wrapInQuotes:xu,wrapInSingleQuotes:n_}=q(),s_=i(({ddlProvider:t,collection:e})=>wu(e.properties).filter(([r,n])=>{var c;let s=n.default,a=n.compMod.oldField.name,o=(c=e.role.properties[a])==null?void 0:c.default;return s!==void 0&&(!o||s!==o)}).map(([r,n])=>{let s=n.default,a={tableName:qu(e),columnName:xu(r),defaultValue:n_({name:s})};return t.updateColumnDefaultValue(a)}).map(r=>Du.getInstance([r],!0,!1)).filter(Boolean),"getUpdatedDefaultColumnValueScriptDtos"),i_=i(({ddlProvider:t,collection:e})=>wu(e.properties).filter(([r,n])=>{var l;let s=n.default,a=n.compMod.oldField.name;return((l=e.role.properties[a])==null?void 0:l.default)!==void 0&&!(s!==void 0)}).map(([r])=>{let n={tableName:qu(e),columnName:xu(r)};return t.dropColumnDefaultValue(n)}).map(r=>Du.getInstance([r],!0,!0)).filter(Boolean),"getDeletedDefaultColumnValueScriptDtos"),a_=i(({ddlProvider:t,collection:e})=>{let r=s_({ddlProvider:t,collection:e}),n=i_({ddlProvider:t,collection:e});return[...r,...n]},"getModifiedDefaultColumnValueScriptDtos");Pu.exports={getModifiedDefaultColumnValueScriptDtos:a_}});var Tt=C((fA,Mu)=>{"use strict";Mu.exports=t=>{let{createColumnDefinition:e}=t.require("@hackolade/ddl-fe-utils"),r=i(s=>s.$ref?s.$ref.split("/").pop():s.mode||s.childType||s.type,"getType");return{createColumnDefinitionBySchema:i(({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l})=>e({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l,getType:r}),"createColumnDefinitionBySchema")}}});var Bu=C((yA,$u)=>{"use strict";var{getModifyCheckConstraintScriptDtos:o_}=Xc(),{getModifyEntityCommentsScriptDtos:c_}=eu(),{getUpdateTypesScriptDtos:u_}=ru(),{getModifyNonNullColumnsScriptDtos:l_}=iu(),{getModifiedCommentOnColumnScriptDtos:p_}=cu(),{getRenameColumnScriptDtos:m_}=lu(),{AlterScriptDto:er}=z(),{AlterCollectionDto:gA}=Le(),{getModifyPkConstraintsScriptDtos:d_}=gu(),{getModifyUniqueKeyConstraintsScriptDtos:f_}=Su(),{getModifyIndexesScriptDtos:h_,getAddedIndexesScriptDtos:g_,getAdditionalDataForDdlProvider:y_}=Ru(),{getModifiedDefaultColumnValueScriptDtos:__}=Lu(),E_=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{getEntityName:c}=q(),{createColumnDefinitionBySchema:u}=Tt()(t),l=ee()(null,null,t),{getDefinitionByReference:d}=t.require("@hackolade/ddl-fe-utils"),m={schemaName:a.compMod.keyspaceName,dbVersion:e},f={...a,...o.omit(a==null?void 0:a.role,"properties")||{}},g=o.toPairs(f.properties).map(([b,I])=>{let R=d({propertySchema:I,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return u({name:b,jsonSchema:I,parentJsonSchema:f,ddlProvider:l,schemaData:m,definitionJsonSchema:R})}),T=(f.chkConstr||[]).map(b=>l.createCheckConstraint(l.hydrateCheckConstraint(b))),_={name:c(f),columns:g.map(l.convertColumnDefinition),checkConstraints:T,foreignKeyConstraints:[],schemaData:m,columnDefinitions:g,dbData:{dbVersion:e}},y=l.hydrateTable({tableData:_,entityData:[f],jsonSchema:f}),A=Uu({_:o,ddlProvider:l,collection:a,dbVersion:e}).flatMap(({scripts:b})=>b.map(({script:I})=>I)),S=l.createTable(y,f.isActivated);return er.getInstance([S,...A],!0,!1)},"getAddCollectionScriptDto"),T_=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{getFullTableName:s}=q(),a=s(e),o=n.dropTable(a);return er.getInstance([o],!0,!0)},"getDeleteCollectionScriptDto"),S_=i(({app:t,dbVersion:e})=>r=>{let n=t.require("lodash"),s=ee()(null,null,t),a=o_(n,s)(r),o=c_(n,s)(r),c=d_(n,s)(r),u=f_({_:n,ddlProvider:s})({collection:r,dbVersion:e}),l=h_({_:n,ddlProvider:s})({collection:r,dbVersion:e});return[...a,...o,...c,...u,...l].filter(Boolean)},"getModifyCollectionScriptDtos"),Fu=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>(a,o)=>{var b;let c=t.require("lodash"),{getEntityName:u,getNamePrefixedWithSchemaName:l}=q(),{createColumnDefinitionBySchema:d}=Tt()(t),p=ee()(null,null,t),{getDefinitionByReference:m}=t.require("@hackolade/ddl-fe-utils"),f={...a,...c.omit(a==null?void 0:a.role,"properties")||{}},g=u(f),T=(b=f.compMod)==null?void 0:b.keyspaceName,_=l(g,T),y={schemaName:T,dbVersion:e},A=c.toPairs(a.properties).filter(([I,R])=>o([I,R])).map(([I,R])=>{let U=m({propertySchema:R,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return d({name:I,jsonSchema:R,parentJsonSchema:f,ddlProvider:p,schemaData:y,definitionJsonSchema:U})}).map(p.convertColumnDefinition).map(I=>p.addColumn(_,I)).map(I=>er.getInstance([I],!0,!1)),S=Uu({_:c,ddlProvider:p,collection:a});return A.concat(S).filter(Boolean)},"getAddColumnsByConditionScriptDtos"),Uu=i(({_:t,ddlProvider:e,dbVersion:r,collection:n})=>{var l,d;let s=((l=n==null?void 0:n.role)==null?void 0:l.Indxs)||[],a={...n==null?void 0:n.properties,...(d=n==null?void 0:n.role)==null?void 0:d.properties},o=Object.values(a).map(({GUID:p})=>p);if(s.length===0||o.length===0)return[];if(!s.some(({columns:p=[]})=>p.find(({keyId:m})=>o.includes(m))))return[];let u=y_({_:t,dbVersion:r,collection:n});return g_({_:t,ddlProvider:e})({collection:n,additionalDataForDdlProvider:u})},"getNewlyCreatedIndexesScripts"),C_=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>Fu({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(a,([o,c])=>!c.compMod),"getAddColumnScriptDtos"),ku=i(t=>(e,r)=>{var m;let n=t.require("lodash"),s=ee()(null,null,t),{getEntityName:a,getNamePrefixedWithSchemaName:o,wrapInQuotes:c}=q(),u={...e,...n.omit(e==null?void 0:e.role,"properties")||{}},l=a(u),d=(m=u.compMod)==null?void 0:m.keyspaceName,p=o(l,d);return n.toPairs(e.properties).filter(([f,g])=>r([f,g])).map(([f])=>{let g=c(f);return s.dropColumn(p,g)}).map(f=>er.getInstance([f],!0,!0)).filter(Boolean)},"getDeleteColumnsByConditionScriptDtos"),A_=i(t=>e=>ku(t)(e,([r,n])=>!n.compMod),"getDeleteColumnScriptDtos"),N_=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash");return o.toPairs(a.properties).filter(([c,u])=>{let l=u.compMod.oldField.name,d=a.role.properties[l];return d.generatedColumn!==u.generatedColumn||d.columnGenerationExpression!==u.columnGenerationExpression}).flatMap(([c,u])=>{let l={...a,properties:o.fromPairs([[c,u]])},d=ku(t)(l,()=>!0),p=Fu({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(l,()=>!0);return[...d,...p]}).filter(Boolean)},"getDropAndRecreateColumnsScriptDtos"),b_=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),c=ee()(null,null,t),u=m_(o,c)(a),l=N_({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(a);if(l.length)return[...u,...l].filter(Boolean);let d=u_(o,c)(a),p=l_(o,c)(a),m=p_(o,c)(a),f=__({ddlProvider:c,collection:a});return[...u,...d,...p,...m,...f].filter(Boolean)},"getModifyColumnScriptDtos");$u.exports={getAddCollectionScriptDto:E_,getDeleteCollectionScriptDto:T_,getModifyCollectionScriptDtos:S_,getAddColumnScriptDtos:C_,getDeleteColumnScriptDtos:A_,getModifyColumnScriptDtos:b_}});var Gu=C((EA,Ku)=>{"use strict";var{AlterScriptDto:Be}=z(),I_=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=Tt()(t),u=ee()(null,null,t),{getDefinitionByReference:l}=t.require("@hackolade/ddl-fe-utils"),d={dbVersion:e},p=o.toPairs(a.properties||{}).map(([T,_])=>{let y=l({propertySchema:_,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:T,jsonSchema:_,parentJsonSchema:a,ddlProvider:u,schemaData:d,definitionJsonSchema:y})}),f={...c({name:a.code||a.name,jsonSchema:a,parentJsonSchema:{required:[]},definitionJsonSchema:{},ddlProvider:u,schemaData:d}),properties:p},g=u.createUdt(f);return Be.getInstance([g],!0,!1)},"getCreateUdtScriptDto"),v_=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{getUdtName:s,wrapInQuotes:a}=q(),o=a(s(e));if(e.type==="domain"){let c=n.dropDomain(o);return Be.getInstance([c],!0,!0)}else{let c=n.dropType(o);return Be.getInstance([c],!0,!0)}},"getDeleteUdtScriptDto"),O_=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=Tt()(t),{getUdtName:u,wrapInQuotes:l}=q(),d=ee()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),m=l(u(a)),f={dbVersion:e};return o.toPairs(a.properties).filter(([g,T])=>!T.compMod).map(([g,T])=>{let _=p({propertySchema:T,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:g,jsonSchema:T,parentJsonSchema:{required:[]},ddlProvider:d,schemaData:f,definitionJsonSchema:_})}).map(d.convertColumnDefinition).map(g=>d.alterTypeAddAttribute(m,g)).map(g=>Be.getInstance([g],!0,!1)).filter(Boolean)},"getAddColumnToTypeScriptDtos"),R_=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q(),a=s(e.code||e.name);return r.toPairs(e.properties).filter(([o,c])=>!c.compMod).map(([o])=>n.alterTypeDropAttribute(a,s(o))).map(o=>Be.getInstance([o],!0,!0)).filter(Boolean)},"getDeleteColumnFromTypeScriptDtos"),w_=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{checkFieldPropertiesChanged:s,wrapInQuotes:a}=q(),o=a(e.code||e.name),c=r.values(e.properties).filter(l=>s(l.compMod,["name"])).map(l=>{let d=a(l.compMod.oldField.name),p=a(l.compMod.newField.name);return n.alterTypeRenameAttribute(o,d,p)}).map(l=>Be.getInstance([l],!0,!1)),u=r.toPairs(e.properties).filter(([l,d])=>s(d.compMod,["type","mode"])).map(([l,d])=>{let p=a(l),m=d.compMod.newField.mode||d.compMod.newField.type;return n.alterTypeChangeAttributeType(o,p,m)}).map(l=>Be.getInstance([l],!0,!1));return[...c,...u].filter(Boolean)},"getModifyColumnOfTypeScriptDtos");Ku.exports={getCreateUdtScriptDto:I_,getDeleteUdtScriptDto:v_,getAddColumnToTypeScriptDtos:O_,getDeleteColumnFromTypeScriptDtos:R_,getModifyColumnOfTypeScriptDtos:w_}});var Qu=C((SA,Wu)=>{"use strict";var{AlterScriptDto:Vu}=z(),Hu=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),D_=i((t,e)=>r=>{let{getFullViewName:n,wrapComment:s}=q(),a=Hu(r);if(a.new&&a.new!==a.old){let o=s(a.new),c=n(r),u=e.updateViewComment(c,o);return Vu.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),q_=i((t,e)=>r=>{let n=Hu(r),{getFullViewName:s}=q();if(n.old&&!n.new){let a=s(r),o=e.dropViewComment(a);return Vu.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),x_=i((t,e)=>r=>{let n=D_(t,e)(r),s=q_(t,e)(r);return[n,s].filter(Boolean)},"getModifyViewCommentsScriptDtos");Wu.exports={getModifyViewCommentsScriptDtos:x_}});var zu=C((AA,ju)=>{"use strict";var{getModifyViewCommentsScriptDtos:P_}=Qu(),{AlterScriptDto:Yu}=z(),L_=i(t=>e=>{let r=ee()(null,null,t),n={name:e.code||e.name,keys:[],schemaData:{schemaName:""}},s=r.hydrateView({viewData:n,entityData:[e]}),a=r.createView(s,{},e.isActivated);return Yu.getInstance([a],!0,!1)},"getAddViewScriptDto"),M_=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q(),a=s(e.code||e.name),o=n.dropView(a);return Yu.getInstance([o],!0,!0)},"getDeleteViewScriptDto"),F_=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...P_(r,n)(e)].filter(Boolean)},"getModifyViewScriptDtos");ju.exports={getAddViewScriptDto:L_,getDeleteViewScriptDto:M_,getModifyViewScriptDtos:F_}});var Zu=C((bA,Xu)=>{"use strict";var ks=class ks{isActivated;name};i(ks,"AlterRelationshipFKField");var qs=ks,$s=class $s{bucket;collection};i($s,"AlterRelationshipParentDto");var xs=$s,Bs=class Bs{bucket;collection};i(Bs,"AlterRelationshipChildDto");var Ps=Bs,Ks=class Ks{relationshipOnDelete;relationshipOnUpdate;relationshipMatch};i(Ks,"AlterRelationshipCustomProperties");var Ls=Ks,Gs=class Gs{created;deleted;modified;parent;child;name;description;customProperties;isActivated};i(Gs,"AlterRelationshipRoleCompModDto");var Ms=Gs,Vs=class Vs{id;name;relationshipType;parentField;parentCardinality;childField;isActivated;childCardinality;parentCollection;childCollection;hackoladeStyles;compMod;roleType};i(Vs,"AlterRelationshipRoleDto");var Fs=Vs,Hs=class Hs{type;isActivated;unique;subtype;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(Hs,"AlterRelationshipDto");var Us=Hs;Xu.exports={AlterRelationshipRoleCompModDto:Ms,AlterRelationshipRoleDto:Fs,AlterRelationshipDto:Us,AlterRelationshipFKField:qs,AlterRelationshipParentDto:xs,AlterRelationshipChildDto:Ps,AlterRelationshipCustomProperties:Ls}});var sl=C((OA,nl)=>{"use strict";var{AlterScriptDto:Ws}=z(),{AlterRelationshipDto:vA}=Zu(),tr=i(t=>t.role.name,"getRelationshipName"),U_=i(t=>e=>{let{getNamePrefixedWithSchemaName:r}=q(),n=e.role.compMod,s=n.child.bucket.name,a=n.child.collection.name;return r(a,s)},"getFullChildTableName"),Ju=i((t,e)=>r=>{var a,o,c,u,l;let n=r.role.compMod,s=((a=n.name)==null?void 0:a.new)||tr(r)||"";return t.createForeignKey({name:s,foreignKey:n.child.collection.fkFields,primaryKey:n.parent.collection.fkFields,customProperties:(o=n.customProperties)==null?void 0:o.new,foreignTable:n.child.collection.name,foreignSchemaName:n.child.bucket.name,foreignTableActivated:n.child.collection.isActivated,primaryTable:n.parent.collection.name,primarySchemaName:n.parent.bucket.name,primaryTableActivated:n.parent.collection.isActivated,isActivated:!!((l=(u=(c=r.role)==null?void 0:c.compMod)==null?void 0:u.isActivated)!=null&&l.new)})},"getAddSingleForeignKeyStatementDto"),el=i(t=>{var r,n,s,a,o,c,u,l,d,p,m;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.new)||tr(t),(n=e.parent)==null?void 0:n.bucket,(s=e.parent)==null?void 0:s.collection,(c=(o=(a=e.parent)==null?void 0:a.collection)==null?void 0:o.fkFields)==null?void 0:c.length,(u=e.child)==null?void 0:u.bucket,(l=e.child)==null?void 0:l.collection,(m=(p=(d=e.child)==null?void 0:d.collection)==null?void 0:p.fkFields)==null?void 0:m.length].every(f=>!!f):!1},"canRelationshipBeAdded"),k_=i((t,e)=>r=>r.filter(n=>el(n)).map(n=>{let s=Ju(t,e)(n);return Ws.getInstance([s.statement],s.isActivated,!1)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getAddForeignKeyScriptDtos"),tl=i((t,e)=>r=>{var p,m,f,g;let{wrapInQuotes:n}=q(),s=r.role.compMod,a=U_(e)(r),o=((p=s.name)==null?void 0:p.old)||tr(r)||"",c=n(o),u=t.dropForeignKey(a,c),l=!!((g=(f=(m=r.role)==null?void 0:m.compMod)==null?void 0:f.isActivated)!=null&&g.new),d=s.child.collection.isActivated;return{statement:u,isActivated:l&&d}},"getDeleteSingleForeignKeyStatementDto"),rl=i(t=>{var r,n,s;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.old)||tr(t),(n=e.child)==null?void 0:n.bucket,(s=e.child)==null?void 0:s.collection].every(a=>!!a):!1},"canRelationshipBeDeleted"),$_=i((t,e)=>r=>r.filter(n=>rl(n)).map(n=>{let s=tl(t,e)(n);return Ws.getInstance([s.statement],s.isActivated,!0)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getDeleteForeignKeyScriptDtos"),B_=i((t,e)=>r=>r.filter(n=>el(n)&&rl(n)).map(n=>{let s=tl(t,e)(n),a=Ju(t,e)(n),o=a.isActivated&&s.isActivated;return Ws.getDropAndRecreateInstance(s.statement,a.statement,o)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getModifyForeignKeyScriptDtos");nl.exports={getDeleteForeignKeyScriptDtos:$_,getModifyForeignKeyScriptDtos:B_,getAddForeignKeyScriptDtos:k_}});var ti=C((wA,il)=>{"use strict";var Xs=class Xs{message;stack};i(Xs,"PluginError");var Qs=Xs,Zs=class Zs{require};i(Zs,"App");var Ys=Zs,Js=class Js{log;clear};i(Js,"Logger");var js=Js,ei=class ei{jsonSchema;modelDefinitions;internalDefinitions;externalDefinitions;containerData;entityData;entities;views;viewData;relationships;collectionRefsDefinitionsMap;isUpdateScript;level;host;clusterId;accessToken;applyToInstanceQueryRequestTimeout;script;hiddenKeys;options;modelData};i(ei,"CoreData");var zs=ei;il.exports={App:Ys,CoreData:zs,Logger:js,PluginError:Qs}});var ol=C((qA,al)=>{"use strict";var li=class li{name;isActivated};i(li,"ContainerJsonSchema");var ri=li,pi=class pi{backgroundColor};i(pi,"ContainerStyles");var ni=pi,mi=class mi{collectionName;isActivated;bucketId;additionalProperties;tableIfNotExists};i(mi,"EntityData");var si=mi,di=class di{$schema;type;GUID};i(di,"InternalDefinitions");var ii=di,fi=class fi{$schema;type;GUID};i(fi,"ModelDefinitions");var ai=fi,hi=class hi{$schema;type;GUID};i(hi,"ExternalDefinitions");var oi=hi,gi=class gi{type;isActivated;mode;subtype;compositeKey;compositePartitionKey;compositeClusteringKey;compositePrimaryKey;compositeUniqueKey;GUID};i(gi,"FieldJsonSchema");var ci=gi,yi=class yi{$schema;type;title;properties;isActivated;additionalProperties;tableIfNotExists;GUID};i(yi,"EntityJsonSchema");var ui=yi;al.exports={ContainerJsonSchema:ri,ContainerStyles:ni,EntityData:si,InternalDefinitions:ii,ModelDefinitions:ai,ExternalDefinitions:oi,FieldJsonSchema:ci,EntityJsonSchema:ui}});var rr=C((PA,cl)=>{"use strict";cl.exports=ee()});var ll=C((MA,ul)=>{"use strict";var{AlterScriptDto:St}=z(),{App:LA}=ti(),K_="sequences",G_=i(({app:t})=>({container:e})=>{var o;let r=t.require("lodash"),n=rr()(null,null,t),{getDbName:s}=q(),a=s([e.role]);return(((o=e.role)==null?void 0:o.sequences)||[]).map(c=>n.createSchemaSequence({schemaName:a,sequence:c})).map(c=>St.getInstance([c],!0,!1)).filter(Boolean)},"getAddContainerSequencesScriptDtos"),V_=i(({app:t})=>({container:e})=>{var _,y;let r=t.require("lodash"),n=rr()(null,null,t),{getDbName:s,getGroupItemsByCompMode:a}=q(),o=s([e.role]),c=((y=(_=e.role)==null?void 0:_.compMod)==null?void 0:y[K_])||{},{new:u=[],old:l=[]}=c,{removed:d,added:p,modified:m}=a({newItems:u,oldItems:l}),f=d.map(A=>n.dropSchemaSequence({schemaName:o,sequence:A})).map(A=>St.getInstance([A],!0,!0)),g=p.map(A=>n.createSchemaSequence({schemaName:o,sequence:A})).map(A=>St.getInstance([A],!0,!1));return[...m.map(A=>{let S=r.find(l,{id:A.id})||{};return n.alterSchemaSequence({schemaName:o,sequence:A,oldSequence:S})}).map(A=>St.getInstance([A],!0,!1)),...f,...g].filter(Boolean)},"getModifyContainerSequencesScriptDtos"),H_=i(({app:t})=>({container:e})=>{var o;let r=t.require("lodash"),n=rr()(null,null,t),{getDbName:s}=q(),a=s([e.role]);return(((o=e.role)==null?void 0:o.sequences)||[]).map(c=>n.dropSchemaSequence({schemaName:a,sequence:c})).map(c=>St.getInstance([c],!0,!0)).filter(Boolean)},"getDeleteContainerSequencesScriptDtos");ul.exports={getAddContainerSequencesScriptDtos:G_,getModifyContainerSequencesScriptDtos:V_,getDeleteContainerSequencesScriptDtos:H_}});var ml=C((HA,pl)=>{"use strict";var{getAddContainerScriptDto:W_,getDeleteContainerScriptDto:Q_,getModifyContainerScriptDtos:Y_}=jc(),{getAddCollectionScriptDto:j_,getDeleteCollectionScriptDto:z_,getAddColumnScriptDtos:X_,getDeleteColumnScriptDtos:Z_,getModifyColumnScriptDtos:J_,getModifyCollectionScriptDtos:eE}=Bu(),{getDeleteUdtScriptDto:tE,getCreateUdtScriptDto:rE,getAddColumnToTypeScriptDtos:nE,getDeleteColumnFromTypeScriptDtos:sE,getModifyColumnOfTypeScriptDtos:iE}=Gu(),{getAddViewScriptDto:aE,getDeleteViewScriptDto:oE,getModifyViewScriptDtos:cE}=zu(),{getModifyForeignKeyScriptDtos:uE,getDeleteForeignKeyScriptDtos:lE,getAddForeignKeyScriptDtos:pE}=sl(),{AlterScriptDto:UA,ModificationScript:kA}=z(),{App:$A,CoreData:BA}=ti(),{InternalDefinitions:KA,ModelDefinitions:GA,ExternalDefinitions:VA}=ol(),{getModifyContainerSequencesScriptDtos:mE,getDeleteContainerSequencesScriptDtos:dE,getAddContainerSequencesScriptDtos:fE}=ll(),hE=i(({collection:t,app:e})=>{var u,l,d,p,m,f,g,T,_,y,A,S;let r=(p=(d=(l=(u=t.properties)==null?void 0:u.containers)==null?void 0:l.properties)==null?void 0:d.added)==null?void 0:p.items,n=(T=(g=(f=(m=t.properties)==null?void 0:m.containers)==null?void 0:f.properties)==null?void 0:g.deleted)==null?void 0:T.items,s=(S=(A=(y=(_=t.properties)==null?void 0:_.containers)==null?void 0:y.properties)==null?void 0:A.modified)==null?void 0:S.items,a=[].concat(r).filter(Boolean).map(b=>W_(e)(Object.keys(b.properties)[0])),o=[].concat(n).filter(Boolean).map(b=>Q_(e)(Object.keys(b.properties)[0])),c=[].concat(s).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>Y_(e)(b));return[...a,...o,...c].filter(Boolean)},"getAlterContainersScriptDtos"),gE=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var T,_,y,A,S,b,I,R,U,N,D,B;let o=[].concat((A=(y=(_=(T=t.properties)==null?void 0:T.entities)==null?void 0:_.properties)==null?void 0:y.added)==null?void 0:A.items).filter(Boolean).map(F=>Object.values(F.properties)[0]),c=[].concat((R=(I=(b=(S=t.properties)==null?void 0:S.entities)==null?void 0:b.properties)==null?void 0:I.deleted)==null?void 0:R.items).filter(Boolean).map(F=>Object.values(F.properties)[0]),u=[].concat((B=(D=(N=(U=t.properties)==null?void 0:U.entities)==null?void 0:N.properties)==null?void 0:D.modified)==null?void 0:B.items).filter(Boolean).map(F=>Object.values(F.properties)[0]),l=o.filter(F=>{var X;return(X=F.compMod)==null?void 0:X.created}).map(j_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),d=c.filter(F=>{var X;return(X=F.compMod)==null?void 0:X.deleted}).map(z_(e)),p=u.flatMap(eE({app:e,dbVersion:r})),m=o.filter(F=>{var X;return!((X=F==null?void 0:F.compMod)!=null&&X.created)}).flatMap(X_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),f=c.filter(F=>{var X;return!((X=F==null?void 0:F.compMod)!=null&&X.deleted)}).flatMap(Z_(e)),g=u.flatMap(J_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}));return[...l,...d,...p,...m,...f,...g].filter(Boolean)},"getAlterCollectionsScriptDtos"),yE=i((t,e)=>{var a,o,c,u,l,d,p,m,f,g,T,_;let r=[].concat((u=(c=(o=(a=t.properties)==null?void 0:a.views)==null?void 0:o.properties)==null?void 0:c.added)==null?void 0:u.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).filter(y=>{var A;return((A=y.compMod)==null?void 0:A.created)&&y.selectStatement}).map(aE(e)),n=[].concat((m=(p=(d=(l=t.properties)==null?void 0:l.views)==null?void 0:d.properties)==null?void 0:p.deleted)==null?void 0:m.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).map(oE(e)),s=[].concat((_=(T=(g=(f=t.properties)==null?void 0:f.views)==null?void 0:g.properties)==null?void 0:T.modified)==null?void 0:_.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).flatMap(y=>cE(e)(y));return[...n,...r,...s].filter(Boolean)},"getAlterViewScriptDtos"),_E=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var p,m,f,g,T,_,y,A,S,b,I,R,U,N,D,B,F,X,Ie,fe;let o=[].concat((g=(f=(m=(p=t.properties)==null?void 0:p.modelDefinitions)==null?void 0:m.properties)==null?void 0:f.added)==null?void 0:g.items).filter(Boolean).map(P=>Object.values(P.properties)[0]).map(P=>({...P,...e.require("lodash").omit(P.role,"properties")||{}})).filter(P=>{var Ne;return(Ne=P.compMod)==null?void 0:Ne.created}).map(rE({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),c=[].concat((A=(y=(_=(T=t.properties)==null?void 0:T.modelDefinitions)==null?void 0:_.properties)==null?void 0:y.deleted)==null?void 0:A.items).filter(Boolean).map(P=>Object.values(P.properties)[0]).map(P=>({...P,...e.require("lodash").omit(P.role,"properties")||{}})).filter(P=>{var Ne;return(Ne=P.compMod)==null?void 0:Ne.deleted}).map(tE(e)),u=[].concat((R=(I=(b=(S=t.properties)==null?void 0:S.modelDefinitions)==null?void 0:b.properties)==null?void 0:I.added)==null?void 0:R.items).filter(Boolean).map(P=>Object.values(P.properties)[0]).filter(P=>!P.compMod).map(P=>({...P,...e.require("lodash").omit(P.role,"properties")||{}})).filter(P=>P.childType==="composite").flatMap(nE({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),l=[].concat((B=(D=(N=(U=t.properties)==null?void 0:U.modelDefinitions)==null?void 0:N.properties)==null?void 0:D.deleted)==null?void 0:B.items).filter(Boolean).map(P=>Object.values(P.properties)[0]).filter(P=>!P.compMod).map(P=>({...P,...e.require("lodash").omit(P.role,"properties")||{}})).filter(P=>P.childType==="composite").flatMap(sE(e)),d=[].concat((fe=(Ie=(X=(F=t.properties)==null?void 0:F.modelDefinitions)==null?void 0:X.properties)==null?void 0:Ie.modified)==null?void 0:fe.items).filter(Boolean).map(P=>Object.values(P.properties)[0]).filter(P=>!P.compMod).map(P=>({...P,...e.require("lodash").omit(P.role,"properties")||{}})).filter(P=>P.childType==="composite").flatMap(iE(e));return[...c,...o,...u,...l,...d].filter(Boolean)},"getAlterModelDefinitionsScriptDtos"),EE=i(({collection:t,app:e})=>{var d,p,m,f,g,T,_,y,A,S,b,I;let r=e.require("lodash"),n=ee()(null,null,e),s=[].concat((f=(m=(p=(d=t.properties)==null?void 0:d.relationships)==null?void 0:p.properties)==null?void 0:m.added)==null?void 0:f.items).filter(Boolean).map(R=>Object.values(R.properties)[0]).filter(R=>{var U,N;return(N=(U=R==null?void 0:R.role)==null?void 0:U.compMod)==null?void 0:N.created}),a=[].concat((y=(_=(T=(g=t.properties)==null?void 0:g.relationships)==null?void 0:T.properties)==null?void 0:_.deleted)==null?void 0:y.items).filter(Boolean).map(R=>Object.values(R.properties)[0]).filter(R=>{var U,N;return(N=(U=R==null?void 0:R.role)==null?void 0:U.compMod)==null?void 0:N.deleted}),o=[].concat((I=(b=(S=(A=t.properties)==null?void 0:A.relationships)==null?void 0:S.properties)==null?void 0:b.modified)==null?void 0:I.items).filter(Boolean).map(R=>Object.values(R.properties)[0]).filter(R=>{var U,N;return(N=(U=R==null?void 0:R.role)==null?void 0:U.compMod)==null?void 0:N.modified}),c=lE(n,r)(a),u=pE(n,r)(s),l=uE(n,r)(o);return[...c,...u,...l].filter(Boolean)},"getAlterRelationshipsScriptDtos"),TE=i(t=>{if(!t)return;let e=t.scripts.map(r=>({...r,script:(r.script||"").trim()})).filter(r=>!!r.script);if(e.length)return{...t,scripts:e}},"prettifyAlterScriptDto"),SE=i(({collection:t,app:e})=>{var u,l,d,p,m,f,g,T,_,y,A,S;let r=(p=(d=(l=(u=t.properties)==null?void 0:u.containers)==null?void 0:l.properties)==null?void 0:d.added)==null?void 0:p.items,n=(T=(g=(f=(m=t.properties)==null?void 0:m.containers)==null?void 0:f.properties)==null?void 0:g.deleted)==null?void 0:T.items,s=(S=(A=(y=(_=t.properties)==null?void 0:_.containers)==null?void 0:y.properties)==null?void 0:A.modified)==null?void 0:S.items,a=[].concat(r).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>fE({app:e})({container:b})),o=[].concat(n).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>dE({app:e})({container:b})),c=[].concat(s).filter(Boolean).map(b=>Object.values(b.properties)[0]).flatMap(b=>mE({app:e})({container:b}));return[...a,...o,...c].filter(Boolean)},"getAlterContainersSequencesScriptDtos"),CE=i((t,e)=>{var f;let r=JSON.parse(t.jsonSchema);if(!r)throw new Error('"comparisonModelCollection" is not found. Alter script can be generated only from Delta model');let n=JSON.parse(t.modelDefinitions),s=JSON.parse(t.internalDefinitions),a=JSON.parse(t.externalDefinitions),o=(f=t.modelData[0])==null?void 0:f.dbVersion,c=hE({collection:r,app:e}),u=gE({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),l=yE(r,e),d=_E({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),p=EE({collection:r,app:e}),m=SE({collection:r,app:e});return[...c,...d,...u,...m,...l,...p].filter(Boolean).map(g=>TE(g)).filter(Boolean)},"getAlterScriptDtos");pl.exports={getAlterScriptDtos:CE}});var gl=C((YA,hl)=>{"use strict";var{getAlterScriptDtos:nr}=ml(),{AlterScriptDto:QA}=z(),dl=i(t=>(e,r)=>{let{commentIfDeactivated:n}=q();return e.map(s=>s.isActivated===!1?s.scripts.map(a=>n(a.script,{isActivated:!1,isPartOfLine:!1})):r?s.scripts.map(a=>a.script):s.scripts.map(a=>n(a.script,{isActivated:!a.isDropScript,isPartOfLine:!1}))).flat().filter(Boolean).map(s=>s.trim()).filter(Boolean).join(`

`)},"joinAlterScriptDtosIntoScript"),AE=i((t,e)=>{var a,o;let r=e.require("lodash"),n=nr(t,e),s=(o=(a=t.options)==null?void 0:a.additionalOptions)==null?void 0:o.some(c=>c.id==="applyDropStatements"&&c.value);return dl(r)(n,s)},"buildEntityLevelAlterScript"),NE=i((t,e)=>nr(t,e).some(n=>n.isActivated&&n.scripts.some(s=>s.isDropScript)),"doesEntityLevelAlterScriptContainDropStatements"),fl=i(t=>({...t,jsonSchema:t.collections[0],internalDefinitions:Object.values(t.internalDefinitions)[0]}),"mapCoreDataForContainerLevelScripts"),bE=i((t,e)=>{var o,c;let r=fl(t),n=e.require("lodash"),s=nr(r,e),a=(c=(o=r.options)==null?void 0:o.additionalOptions)==null?void 0:c.some(u=>u.id==="applyDropStatements"&&u.value);return dl(n)(s,a)},"buildContainerLevelAlterScript"),IE=i((t,e)=>{let r=fl(t);return nr(r,e).some(s=>s.isActivated&&s.scripts.some(a=>a.isDropScript))},"doesContainerLevelAlterScriptContainDropStatements");hl.exports={buildEntityLevelAlterScript:AE,doesEntityLevelAlterScriptContainDropStatements:NE,buildContainerLevelAlterScript:bE,doesContainerLevelAlterScriptContainDropStatements:IE}});var yl=Yo(),{createLogger:vE}=or(),OE=zo(),{buildEntityLevelAlterScript:RE,buildContainerLevelAlterScript:wE,doesContainerLevelAlterScriptContainDropStatements:DE,doesEntityLevelAlterScriptContainDropStatements:qE}=gl();module.exports={generateScript(t,e,r,n){try{let s=RE(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"PostgreSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},generateViewScript(t,e,r,n){r(new Error("Forward-Engineering of delta model on view level is not supported"))},generateContainerScript(t,e,r,n){try{let s=wE(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"PostgreSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},getDatabases(t,e,r,n){e.progress({message:"Find all databases"}),yl.getDatabases(t,e,r,n)},applyToInstance(t,e,r,n){e.clear(),e.log("info",n.require("lodash").omit(t,"script","containerData"),"connectionInfo",t.hiddenKeys);let s=vE({title:"Apply to instance",hiddenKeys:t.hiddenKeys,logger:e});OE.applyToInstance(t,s,n).then(r,r)},testConnection(t,e,r,n){yl.testConnection(t,e,r,n).then(r,r)},isDropInStatements(t,e,r,n){try{if(t.level==="container"){let s=DE(t,n);r(null,s)}else{let s=qE(t,n);r(null,s)}}catch(s){r({message:s.message,stack:s.stack})}}};
