"use strict";var Ot=Object.defineProperty;var yl=Object.getOwnPropertyDescriptor;var _l=Object.getOwnPropertyNames;var El=Object.prototype.hasOwnProperty;var i=(t,e)=>Ot(t,"name",{value:e,configurable:!0});var Tl=(t,e)=>()=>(t&&(e=t(t=0)),e);var N=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Sl=(t,e)=>{for(var r in e)Ot(t,r,{get:e[r],enumerable:!0})},Cl=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of _l(e))!El.call(t,s)&&s!==r&&Ot(t,s,{get:()=>e[s],enumerable:!(n=yl(e,s))||n.enumerable});return t};var Al=t=>Cl(Ot({},"__esModule",{value:!0}),t);var pr=N((K_,vi)=>{"use strict";var Nl=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",a=""){e.progress({message:n,containerName:s,entityName:a})},error(n){e.log("error",bl(n),t)}}),"createLogger"),bl=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");vi.exports={createLogger:Nl}});var dr=N(Oi=>{"use strict";Oi.parse=function(t,e){return new mr(t,e).parse()};var Rt=class Rt{constructor(e,r){this.source=e,this.transform=r||Il,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new Rt(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(Rt,"ArrayParser");var mr=Rt;function Il(t){return t}i(Il,"identity")});var fr=N((W_,Ri)=>{var vl=dr();Ri.exports={create:function(t,e){return{parse:function(){return vl.parse(t,e)}}}}});var Di=N((Q_,qi)=>{"use strict";var Ol=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Rl=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,wl=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,ql=/^-?infinity$/;qi.exports=i(function(e){if(ql.test(e))return Number(e.replace("i","I"));var r=Ol.exec(e);if(!r)return Dl(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=wi(s));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),u=parseInt(r[5],10),l=parseInt(r[6],10),d=r[7];d=d?1e3*parseFloat(d):0;var p,m=xl(e);return m!=null?(p=new Date(Date.UTC(s,a,o,c,u,l,d)),hr(s)&&p.setUTCFullYear(s),m!==0&&p.setTime(p.getTime()-m)):(p=new Date(s,a,o,c,u,l,d),hr(s)&&p.setFullYear(s)),p},"parseDate");function Dl(t){var e=Rl.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=wi(r));var s=parseInt(e[2],10)-1,a=e[3],o=new Date(r,s,a);return hr(r)&&o.setFullYear(r),o}}i(Dl,"getDate");function xl(t){if(t.endsWith("+00"))return 0;var e=wl.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(xl,"timeZoneOffset");function wi(t){return-(t-1)}i(wi,"bcYearToNegativeYear");function hr(t){return t>=0&&t<100}i(hr,"is0To99")});var Pi=N((j_,xi)=>{xi.exports=Ll;var Pl=Object.prototype.hasOwnProperty;function Ll(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Pl.call(r,n)&&(t[n]=r[n])}return t}i(Ll,"extend")});var Fi=N((X_,Mi)=>{"use strict";var Ml=Pi();Mi.exports=Qe;function Qe(t){if(!(this instanceof Qe))return new Qe(t);Ml(this,Yl(t))}i(Qe,"PostgresInterval");var Fl=["seconds","minutes","hours","days","months","years"];Qe.prototype.toPostgres=function(){var t=Fl.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var Ul={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},kl=["years","months","days"],$l=["hours","minutes","seconds"];Qe.prototype.toISOString=Qe.prototype.toISO=function(){var t=kl.map(r,this).join(""),e=$l.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+Ul[n]}};var gr="([+-]?\\d+)",Bl=gr+"\\s+years?",Kl=gr+"\\s+mons?",Gl=gr+"\\s+days?",Vl="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Hl=new RegExp([Bl,Kl,Gl,Vl].map(function(t){return"("+t+")?"}).join("\\s*")),Li={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Wl=["hours","minutes","seconds","milliseconds"];function Ql(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Ql,"parseMilliseconds");function Yl(t){if(!t)return{};var e=Hl.exec(t),r=e[8]==="-";return Object.keys(Li).reduce(function(n,s){var a=Li[s],o=e[a];return!o||(o=s==="milliseconds"?Ql(o):parseInt(o,10),!o)||(r&&~Wl.indexOf(s)&&(o*=-1),n[s]=o),n},{})}i(Yl,"parse")});var ki=N((J_,Ui)=>{"use strict";Ui.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var a=0;a<Math.floor(s/2);++a)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var Wi=N((tE,Hi)=>{var lt=dr(),pt=fr(),wt=Di(),Bi=Fi(),Ki=ki();function qt(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(qt,"allowNull");function Gi(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(Gi,"parseBool");function jl(t){return t?lt.parse(t,Gi):null}i(jl,"parseBoolArray");function zl(t){return parseInt(t,10)}i(zl,"parseBaseTenInt");function yr(t){return t?lt.parse(t,qt(zl)):null}i(yr,"parseIntegerArray");function Xl(t){return t?lt.parse(t,qt(function(e){return Vi(e).trim()})):null}i(Xl,"parseBigIntegerArray");var Zl=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=Sr(r)),r});return e.parse()},"parsePointArray"),_r=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),Se=i(function(t){if(!t)return null;var e=pt.create(t);return e.parse()},"parseStringArray"),Er=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=wt(r)),r});return e.parse()},"parseDateArray"),Jl=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=Bi(r)),r});return e.parse()},"parseIntervalArray"),ep=i(function(t){return t?lt.parse(t,qt(Ki)):null},"parseByteAArray"),Tr=i(function(t){return parseInt(t,10)},"parseInteger"),Vi=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),$i=i(function(t){return t?lt.parse(t,qt(JSON.parse)):null},"parseJsonArray"),Sr=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),tp=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var a=Sr(e);return a.radius=parseFloat(r),a},"parseCircle"),rp=i(function(t){t(20,Vi),t(21,Tr),t(23,Tr),t(26,Tr),t(700,parseFloat),t(701,parseFloat),t(16,Gi),t(1082,wt),t(1114,wt),t(1184,wt),t(600,Sr),t(651,Se),t(718,tp),t(1e3,jl),t(1001,ep),t(1005,yr),t(1007,yr),t(1028,yr),t(1016,Xl),t(1017,Zl),t(1021,_r),t(1022,_r),t(1231,_r),t(1014,Se),t(1015,Se),t(1008,Se),t(1009,Se),t(1040,Se),t(1041,Se),t(1115,Er),t(1182,Er),t(1185,Er),t(1186,Bi),t(1187,Jl),t(17,Ki),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,$i),t(3807,$i),t(3907,Se),t(2951,Se),t(791,Se),t(1183,Se),t(1270,Se)},"init");Hi.exports={init:rp}});var Yi=N((nE,Qi)=>{"use strict";var de=1e6;function np(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",a,o,c,u,l,d;{if(a=e%de,e=e/de>>>0,o=4294967296*a+r,r=o/de>>>0,c=""+(o-de*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,d=0;d<l;d++)u+="0";s=u+c+s}{if(a=e%de,e=e/de>>>0,o=4294967296*a+r,r=o/de>>>0,c=""+(o-de*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,d=0;d<l;d++)u+="0";s=u+c+s}{if(a=e%de,e=e/de>>>0,o=4294967296*a+r,r=o/de>>>0,c=""+(o-de*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,d=0;d<l;d++)u+="0";s=u+c+s}return a=e%de,o=4294967296*a+r,c=""+o%de,n+c+s}i(np,"readInt8");Qi.exports=np});var Ji=N((iE,Zi)=>{var sp=Yi(),Q=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(f,h,T){return f*Math.pow(2,T)+h};var a=r>>3,o=i(function(f){return n?~f&255:f},"inv"),c=255,u=8-r%8;e<u&&(c=255<<8-e&255,u=e),r&&(c=c>>r%8);var l=0;r%8+e>=8&&(l=s(0,o(t[a])&c,u));for(var d=e+r>>3,p=a+1;p<d;p++)l=s(l,o(t[p]),8);var m=(e+r)%8;return m>0&&(l=s(l,o(t[d])>>8-m,m)),l},"parseBits"),Xi=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=Q(t,1),a=Q(t,r,1);if(a===0)return 0;var o=1,c=i(function(l,d,p){l===0&&(l=1);for(var m=1;m<=p;m++)o/=2,(d&1<<p-m)>0&&(l+=o);return l},"parsePrecisionBits"),u=Q(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?u===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,a-n)*u},"parseFloatFromBits"),ip=i(function(t){return Q(t,1)==1?-1*(Q(t,15,1,!0)+1):Q(t,15,1)},"parseInt16"),ji=i(function(t){return Q(t,1)==1?-1*(Q(t,31,1,!0)+1):Q(t,31,1)},"parseInt32"),ap=i(function(t){return Xi(t,23,8)},"parseFloat32"),op=i(function(t){return Xi(t,52,11)},"parseFloat64"),cp=i(function(t){var e=Q(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,Q(t,16,16)),n=0,s=[],a=Q(t,16),o=0;o<a;o++)n+=Q(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,Q(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),zi=i(function(t,e){var r=Q(e,1),n=Q(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(a){this.usec=a},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),mt=i(function(t){for(var e=Q(t,32),r=Q(t,32,32),n=Q(t,32,64),s=96,a=[],o=0;o<e;o++)a[o]=Q(t,32,s),s+=32,s+=32;var c=i(function(l){var d=Q(t,32,s);if(s+=32,d==4294967295)return null;var p;if(l==23||l==20)return p=Q(t,d*8,s),s+=d*8,p;if(l==25)return p=t.toString(this.encoding,s>>3,(s+=d<<3)>>3),p;console.log("ERROR: ElementType not implemented: "+l)},"parseElement"),u=i(function(l,d){var p=[],m;if(l.length>1){var f=l.shift();for(m=0;m<f;m++)p[m]=u(l,d);l.unshift(f)}else for(m=0;m<l[0];m++)p[m]=c(d);return p},"parse");return u(a,n)},"parseArray"),up=i(function(t){return t.toString("utf8")},"parseText"),lp=i(function(t){return t===null?null:Q(t,8)>0},"parseBool"),pp=i(function(t){t(20,sp),t(21,ip),t(23,ji),t(26,ji),t(1700,cp),t(700,ap),t(701,op),t(16,lp),t(1114,zi.bind(null,!1)),t(1184,zi.bind(null,!0)),t(1e3,mt),t(1007,mt),t(1016,mt),t(1008,mt),t(1009,mt),t(25,up)},"init");Zi.exports={init:pp}});var ta=N((oE,ea)=>{ea.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var ht=N(ft=>{var mp=Wi(),dp=Ji(),fp=fr(),hp=ta();ft.getTypeParser=gp;ft.setTypeParser=yp;ft.arrayParser=fp;ft.builtins=hp;var dt={text:{},binary:{}};function ra(t){return String(t)}i(ra,"noParse");function gp(t,e){return e=e||"text",dt[e]&&dt[e][t]||ra}i(gp,"getTypeParser");function yp(t,e,r){typeof e=="function"&&(r=e,e="text"),dt[e][t]=r}i(yp,"setTypeParser");mp.init(function(t,e){dt.text[t]=e});dp.init(function(t,e){dt.binary[t]=e})});var gt=N((lE,Cr)=>{"use strict";Cr.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Ye=ht(),_p=Ye.getTypeParser(20,"text"),Ep=Ye.getTypeParser(1016,"text");Cr.exports.__defineSetter__("parseInt8",function(t){Ye.setTypeParser(20,"text",t?Ye.getTypeParser(23,"text"):_p),Ye.setTypeParser(1016,"text",t?Ye.getTypeParser(1007,"text"):Ep)})});var yt=N((pE,sa)=>{"use strict";var Tp=gt();function Sp(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(Sp,"escapeElement");function na(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+na(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=Sp(Dt(t[r]));return e=e+"}",e}i(na,"arrayString");var Dt=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?Tp.parseInputDatesAsUTC?Np(t):Ap(t):Array.isArray(t)?na(t):typeof t=="object"?Cp(t,e):t.toString()},"prepareValue");function Cp(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),Dt(t.toPostgres(Dt),e)}return JSON.stringify(t)}i(Cp,"prepareObject");function ue(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(ue,"pad");function Ap(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=ue(r,4)+"-"+ue(t.getMonth()+1,2)+"-"+ue(t.getDate(),2)+"T"+ue(t.getHours(),2)+":"+ue(t.getMinutes(),2)+":"+ue(t.getSeconds(),2)+"."+ue(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=ue(Math.floor(e/60),2)+":"+ue(e%60,2),n&&(s+=" BC"),s}i(Ap,"dateToString");function Np(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=ue(e,4)+"-"+ue(t.getUTCMonth()+1,2)+"-"+ue(t.getUTCDate(),2)+"T"+ue(t.getUTCHours(),2)+":"+ue(t.getUTCMinutes(),2)+":"+ue(t.getUTCSeconds(),2)+"."+ue(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(Np,"dateToStringUTC");function bp(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(bp,"normalizeQueryConfig");var Ip=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),vp=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");sa.exports={prepareValue:i(function(e){return Dt(e)},"prepareValueWrapper"),normalizeQueryConfig:bp,escapeIdentifier:Ip,escapeLiteral:vp}});var aa=N((dE,ia)=>{"use strict";var _t=require("crypto");function Ar(t){return _t.createHash("md5").update(t,"utf-8").digest("hex")}i(Ar,"md5");function Op(t,e,r){var n=Ar(e+t),s=Ar(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Op,"postgresMd5PasswordHash");function Rp(t){return _t.createHash("sha256").update(t).digest()}i(Rp,"sha256");function wp(t,e){return _t.createHmac("sha256",t).update(e).digest()}i(wp,"hmacSha256");async function qp(t,e,r){return _t.pbkdf2Sync(t,e,r,32,"sha256")}i(qp,"deriveKey");ia.exports={postgresMd5PasswordHash:Op,randomBytes:_t.randomBytes,deriveKey:qp,sha256:Rp,hmacSha256:wp,md5:Ar}});var la=N((hE,ua)=>{var oa=require("crypto");ua.exports={postgresMd5PasswordHash:xp,randomBytes:Dp,deriveKey:Mp,sha256:Pp,hmacSha256:Lp,md5:Nr};var ca=oa.webcrypto||globalThis.crypto,je=ca.subtle,br=new TextEncoder;function Dp(t){return ca.getRandomValues(Buffer.alloc(t))}i(Dp,"randomBytes");async function Nr(t){try{return oa.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?br.encode(t):t,n=await je.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(Nr,"md5");async function xp(t,e,r){var n=await Nr(e+t),s=await Nr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(xp,"postgresMd5PasswordHash");async function Pp(t){return await je.digest("SHA-256",t)}i(Pp,"sha256");async function Lp(t,e){let r=await je.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await je.sign("HMAC",r,br.encode(e))}i(Lp,"hmacSha256");async function Mp(t,e,r){let n=await je.importKey("raw",br.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await je.deriveBits(s,n,32*8,["deriveBits"])}i(Mp,"deriveKey")});var vr=N((yE,Ir)=>{"use strict";var Fp=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Fp?Ir.exports=aa():Ir.exports=la()});var fa=N((_E,da)=>{"use strict";var Ge=vr();function Up(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=Ge.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(Up,"startSession");async function kp(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=Kp(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o="c=biws,r="+n.nonce,c=s+","+a+","+o,u=Buffer.from(n.salt,"base64"),l=await Ge.deriveKey(e,u,n.iteration),d=await Ge.hmacSha256(l,"Client Key"),p=await Ge.sha256(d),m=await Ge.hmacSha256(p,c),f=Vp(Buffer.from(d),Buffer.from(m)).toString("base64"),h=await Ge.hmacSha256(l,"Server Key"),T=await Ge.hmacSha256(h,c);t.message="SASLResponse",t.serverSignature=Buffer.from(T).toString("base64"),t.response=o+",p="+f}i(kp,"continueSession");function $p(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=Gp(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i($p,"finalizeSession");function Bp(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Bp,"isPrintableChars");function pa(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(pa,"isBase64");function ma(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(ma,"parseAttributePairs");function Kp(t){let e=ma(t),r=e.get("r");if(r){if(!Bp(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!pa(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(s,10);return{nonce:r,salt:n,iteration:a}}i(Kp,"parseServerFirstMessage");function Gp(t){let r=ma(t).get("v");if(r){if(!pa(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(Gp,"parseServerFinalMessage");function Vp(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(Vp,"xorBuffers");da.exports={startSession:Up,continueSession:kp,finalizeSession:$p}});var Or=N((TE,ha)=>{"use strict";var Hp=ht();function xt(t){this._types=t||Hp,this.text={},this.binary={}}i(xt,"TypeOverrides");xt.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};xt.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};xt.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};ha.exports=xt});var ya=N((CE,ga)=>{"use strict";function Rr(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(Rr,"parse");ga.exports=Rr;Rr.parse=Rr});var Dr=N((NE,Ta)=>{"use strict";var Wp=require("dns"),Ea=gt(),_a=ya().parse,pe=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||Ea[t]},"val"),Qp=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Ea.ssl},"readSSLConfigFromEnvironment"),ze=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),Ce=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+ze(n))},"add"),qr=class qr{constructor(e){e=typeof e=="string"?_a(e):e||{},e.connectionString&&(e=Object.assign({},e,_a(e.connectionString))),this.user=pe("user",e),this.database=pe("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(pe("port",e),10),this.host=pe("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:pe("password",e)}),this.binary=pe("binary",e),this.options=pe("options",e),this.ssl=typeof e.ssl>"u"?Qp():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=pe("client_encoding",e),this.replication=pe("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=pe("application_name",e,"PGAPPNAME"),this.fallback_application_name=pe("fallback_application_name",e,!1),this.statement_timeout=pe("statement_timeout",e,!1),this.lock_timeout=pe("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=pe("idle_in_transaction_session_timeout",e,!1),this.query_timeout=pe("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];Ce(r,this,"user"),Ce(r,this,"password"),Ce(r,this,"port"),Ce(r,this,"application_name"),Ce(r,this,"fallback_application_name"),Ce(r,this,"connect_timeout"),Ce(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(Ce(r,n,"sslmode"),Ce(r,n,"sslca"),Ce(r,n,"sslkey"),Ce(r,n,"sslcert"),Ce(r,n,"sslrootcert"),this.database&&r.push("dbname="+ze(this.database)),this.replication&&r.push("replication="+ze(this.replication)),this.host&&r.push("host="+ze(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+ze(this.client_encoding)),Wp.lookup(this.host,function(s,a){return s?e(s,null):(r.push("hostaddr="+ze(a)),e(null,r.join(" ")))})}};i(qr,"ConnectionParameters");var wr=qr;Ta.exports=wr});var Aa=N((IE,Ca)=>{"use strict";var Yp=ht(),Sa=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Pr=class Pr{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=Sa.exec(e.text):r=Sa.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var a=e[n];a!==null?r[n]=this._parsers[n](a):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var a=e[n],o=this.fields[n].name;a!==null?r[o]=this._parsers[n](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=Yp.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(Pr,"Result");var xr=Pr;Ca.exports=xr});var va=N((OE,Ia)=>{"use strict";var{EventEmitter:jp}=require("events"),Na=Aa(),ba=yt(),Mr=class Mr extends jp{constructor(e,r,n){super(),e=ba.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Na(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Na(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:ba.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(Mr,"Query");var Lr=Mr;Ia.exports=Lr});var mn=N(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.NoticeMessage=M.DataRowMessage=M.CommandCompleteMessage=M.ReadyForQueryMessage=M.NotificationResponseMessage=M.BackendKeyDataMessage=M.AuthenticationMD5Password=M.ParameterStatusMessage=M.ParameterDescriptionMessage=M.RowDescriptionMessage=M.Field=M.CopyResponse=M.CopyDataMessage=M.DatabaseError=M.copyDone=M.emptyQuery=M.replicationStart=M.portalSuspended=M.noData=M.closeComplete=M.bindComplete=M.parseComplete=void 0;M.parseComplete={name:"parseComplete",length:5};M.bindComplete={name:"bindComplete",length:5};M.closeComplete={name:"closeComplete",length:5};M.noData={name:"noData",length:5};M.portalSuspended={name:"portalSuspended",length:5};M.replicationStart={name:"replicationStart",length:4};M.emptyQuery={name:"emptyQuery",length:4};M.copyDone={name:"copyDone",length:4};var Xr=class Xr extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(Xr,"DatabaseError");var Fr=Xr;M.DatabaseError=Fr;var Zr=class Zr{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(Zr,"CopyDataMessage");var Ur=Zr;M.CopyDataMessage=Ur;var Jr=class Jr{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(Jr,"CopyResponse");var kr=Jr;M.CopyResponse=kr;var en=class en{constructor(e,r,n,s,a,o,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(en,"Field");var $r=en;M.Field=$r;var tn=class tn{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(tn,"RowDescriptionMessage");var Br=tn;M.RowDescriptionMessage=Br;var rn=class rn{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(rn,"ParameterDescriptionMessage");var Kr=rn;M.ParameterDescriptionMessage=Kr;var nn=class nn{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(nn,"ParameterStatusMessage");var Gr=nn;M.ParameterStatusMessage=Gr;var sn=class sn{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(sn,"AuthenticationMD5Password");var Vr=sn;M.AuthenticationMD5Password=Vr;var an=class an{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(an,"BackendKeyDataMessage");var Hr=an;M.BackendKeyDataMessage=Hr;var on=class on{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(on,"NotificationResponseMessage");var Wr=on;M.NotificationResponseMessage=Wr;var cn=class cn{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(cn,"ReadyForQueryMessage");var Qr=cn;M.ReadyForQueryMessage=Qr;var un=class un{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(un,"CommandCompleteMessage");var Yr=un;M.CommandCompleteMessage=Yr;var ln=class ln{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(ln,"DataRowMessage");var jr=ln;M.DataRowMessage=jr;var pn=class pn{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(pn,"NoticeMessage");var zr=pn;M.NoticeMessage=zr});var Oa=N(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.Writer=void 0;var fn=class fn{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(fn,"Writer");var dn=fn;Pt.Writer=dn});var wa=N(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.serialize=void 0;var hn=Oa(),Y=new hn.Writer,zp=i(t=>{Y.addInt16(3).addInt16(0);for(let n of Object.keys(t))Y.addCString(n).addCString(t[n]);Y.addCString("client_encoding").addCString("UTF8");var e=Y.addCString("").flush(),r=e.length+4;return new hn.Writer().addInt32(r).add(e).flush()},"startup"),Xp=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Zp=i(t=>Y.addCString(t).flush(112),"password"),Jp=i(function(t,e){return Y.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),Y.flush(112)},"sendSASLInitialResponseMessage"),em=i(function(t){return Y.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),tm=i(t=>Y.addCString(t).flush(81),"query"),Ra=[],rm=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Ra;for(var n=r.length,s=Y.addCString(e).addCString(t.text).addInt16(n),a=0;a<n;a++)s.addInt32(r[a]);return Y.flush(80)},"parse"),Xe=new hn.Writer,nm=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(Y.addInt16(0),Xe.addInt32(-1)):n instanceof Buffer?(Y.addInt16(1),Xe.addInt32(n.length),Xe.add(n)):(Y.addInt16(0),Xe.addInt32(Buffer.byteLength(n)),Xe.addString(n))}},"writeValues"),sm=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||Ra,a=s.length;return Y.addCString(e).addCString(r),Y.addInt16(a),nm(s,t.valueMapper),Y.addInt16(a),Y.add(Xe.flush()),Y.addInt16(n?1:0),Y.flush(66)},"bind"),im=Buffer.from([69,0,0,0,9,0,0,0,0,0]),am=i(t=>{if(!t||!t.portal&&!t.rows)return im;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,a=Buffer.allocUnsafe(1+s);return a[0]=69,a.writeInt32BE(s,1),a.write(e,5,"utf-8"),a[n+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),om=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),gn=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),cm=Y.addCString("P").flush(68),um=Y.addCString("S").flush(68),lm=i(t=>t.name?gn(68,`${t.type}${t.name||""}`):t.type==="P"?cm:um,"describe"),pm=i(t=>{let e=`${t.type}${t.name||""}`;return gn(67,e)},"close"),mm=i(t=>Y.add(t).flush(100),"copyData"),dm=i(t=>gn(102,t),"copyFail"),Lt=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),fm=Lt(72),hm=Lt(83),gm=Lt(88),ym=Lt(99),_m={startup:zp,password:Zp,requestSsl:Xp,sendSASLInitialResponseMessage:Jp,sendSCRAMClientFinalMessage:em,query:tm,parse:rm,bind:sm,execute:am,describe:lm,close:pm,flush:()=>fm,sync:()=>hm,end:()=>gm,copyData:mm,copyDone:()=>ym,copyFail:dm,cancel:om};Mt.serialize=_m});var qa=N(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.BufferReader=void 0;var Em=Buffer.allocUnsafe(0),_n=class _n{constructor(e=0){this.offset=e,this.buffer=Em,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(_n,"BufferReader");var yn=_n;Ft.BufferReader=yn});var Pa=N(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.Parser=void 0;var j=mn(),Tm=qa(),En=1,Sm=4,Da=En+Sm,xa=Buffer.allocUnsafe(0),Sn=class Sn{constructor(e){if(this.buffer=xa,this.bufferLength=0,this.bufferOffset=0,this.reader=new Tm.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+Da<=n;){let a=this.buffer[s],o=this.buffer.readUInt32BE(s+En),c=En+o;if(c+s<=n){let u=this.handlePacket(s+Da,a,o,this.buffer);r(u),s+=c}else break}s===n?(this.buffer=xa,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;s=Buffer.allocUnsafe(a)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return j.bindComplete;case 49:return j.parseComplete;case 51:return j.closeComplete;case 110:return j.noData;case 115:return j.portalSuspended;case 99:return j.copyDone;case 87:return j.replicationStart;case 73:return j.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new j.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new j.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new j.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new j.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new j.CopyResponse(r,s,a,o);for(let u=0;u<o;u++)c.columnTypes[u]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new j.NotificationResponseMessage(r,s,a,o)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new j.RowDescriptionMessage(r,s);for(let o=0;o<s;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new j.Field(e,r,n,s,a,o,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new j.ParameterDescriptionMessage(r,s);for(let o=0;o<s;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new Array(s);for(let o=0;o<s;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new j.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),a=this.reader.cstring();return new j.ParameterStatusMessage(r,s,a)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.int32();return new j.BackendKeyDataMessage(r,s,a)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new j.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return a}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,u=s==="notice"?new j.NoticeMessage(r,c):new j.DatabaseError(c,r,s);return u.severity=a.S,u.code=a.C,u.detail=a.D,u.hint=a.H,u.position=a.P,u.internalPosition=a.p,u.internalQuery=a.q,u.where=a.W,u.schema=a.s,u.table=a.t,u.column=a.c,u.dataType=a.d,u.constraint=a.n,u.file=a.F,u.line=a.L,u.routine=a.R,u}};i(Sn,"Parser");var Tn=Sn;Ut.Parser=Tn});var Cn=N(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.DatabaseError=Fe.serialize=Fe.parse=void 0;var Cm=mn();Object.defineProperty(Fe,"DatabaseError",{enumerable:!0,get:function(){return Cm.DatabaseError}});var Am=wa();Object.defineProperty(Fe,"serialize",{enumerable:!0,get:function(){return Am.serialize}});var Nm=Pa();function bm(t,e){let r=new Nm.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(bm,"parse");Fe.parse=bm});var La={};Sl(La,{default:()=>Im});var Im,Ma=Tl(()=>{Im={}});var Fa=N((KE,An)=>{An.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(Ma(),Al(La));return new n(e)}},"getStream");An.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var In=N((HE,Ua)=>{"use strict";var VE=require("net"),vm=require("events").EventEmitter,{parse:Om,serialize:ae}=Cn(),{getStream:Rm,getSecureStream:wm}=Fa(),qm=ae.flush(),Dm=ae.sync(),xm=ae.end(),bn=class bn extends vm{constructor(e){super(),e=e||{},this.stream=e.stream||Rm(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(a){n._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||n.emit("error",a)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var u=require("net");u.isIP&&u.isIP(r)===0&&(c.servername=r);try{n.stream=wm(c)}catch(l){return n.emit("error",l)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){Om(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(ae.requestSsl())}startup(e){this.stream.write(ae.startup(e))}cancel(e,r){this._send(ae.cancel(e,r))}password(e){this._send(ae.password(e))}sendSASLInitialResponseMessage(e,r){this._send(ae.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(ae.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(ae.query(e))}parse(e){this._send(ae.parse(e))}bind(e){this._send(ae.bind(e))}execute(e){this._send(ae.execute(e))}flush(){this.stream.writable&&this.stream.write(qm)}sync(){this._ending=!0,this._send(Dm)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(xm,()=>{this.stream.end()})}close(e){this._send(ae.close(e))}describe(e){this._send(ae.describe(e))}sendCopyFromChunk(e){this._send(ae.copyData(e))}endCopyFrom(){this._send(ae.copyDone())}sendCopyFail(e){this._send(ae.copyFail(e))}};i(bn,"Connection");var Nn=bn;Ua.exports=Nn});var Ka=N((QE,Ba)=>{"use strict";var{Transform:Pm}=require("stream"),{StringDecoder:Lm}=require("string_decoder"),Ue=Symbol("last"),kt=Symbol("decoder");function Mm(t,e,r){let n;if(this.overflow){if(n=this[kt].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[Ue]+=this[kt].write(t),n=this[Ue].split(this.matcher);this[Ue]=n.pop();for(let s=0;s<n.length;s++)try{$a(this,this.mapper(n[s]))}catch(a){return r(a)}if(this.overflow=this[Ue].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(Mm,"transform");function Fm(t){if(this[Ue]+=this[kt].end(),this[Ue])try{$a(this,this.mapper(this[Ue]))}catch(e){return t(e)}t()}i(Fm,"flush");function $a(t,e){e!==void 0&&t.push(e)}i($a,"push");function ka(t){return t}i(ka,"noop");function Um(t,e,r){switch(t=t||/\r?\n/,e=e||ka,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=ka)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=Mm,r.flush=Fm,r.readableObjectMode=!0;let n=new Pm(r);return n[Ue]="",n[kt]=new Lm("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,a){this._writableState.errorEmitted=!1,a(s)},n}i(Um,"split");Ba.exports=Um});var Ha=N((jE,Le)=>{"use strict";var Ga=require("path"),km=require("stream").Stream,$m=Ka(),Va=require("util"),Bm=5432,$t=process.platform==="win32",Et=process.stderr,Km=56,Gm=7,Vm=61440,Hm=32768;function Wm(t){return(t&Vm)==Hm}i(Wm,"isRegFile");var Ze=["host","port","database","user","password"],vn=Ze.length,Qm=Ze[vn-1];function On(){var t=Et instanceof km&&Et.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);Et.write(Va.format.apply(Va,e))}}i(On,"warn");Object.defineProperty(Le.exports,"isWin",{get:function(){return $t},set:function(t){$t=t}});Le.exports.warnTo=function(t){var e=Et;return Et=t,e};Le.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||($t?Ga.join(e.APPDATA||"./","postgresql","pgpass.conf"):Ga.join(e.HOME||"./",".pgpass"));return r};Le.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:$t?!0:(e=e||"<unkn>",Wm(t.mode)?t.mode&(Km|Gm)?(On('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(On('WARNING: password file "%s" is not a plain file',e),!1))};var Ym=Le.exports.match=function(t,e){return Ze.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||Bm)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};Le.exports.getPassword=function(t,e,r){var n,s=e.pipe($m());function a(u){var l=jm(u);l&&zm(l)&&Ym(t,l)&&(n=l[Qm],s.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(u){e.destroy(),On("WARNING: error on reading file: %s",u),r(void 0)},"onErr");e.on("error",c),s.on("data",a).on("end",o).on("error",c)};var jm=Le.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,a=0,o={},c=!1,u=i(function(d,p,m){var f=t.substring(p,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),o[Ze[d]]=f},"addToObj"),l=0;l<t.length-1;l+=1){if(e=t.charAt(l+1),r=t.charAt(l),c=n==vn-1,c){u(n,s);break}l>=0&&e==":"&&r!=="\\"&&(u(n,s,l+1),s=l+2,n+=1)}return o=Object.keys(o).length===vn?o:null,o},zm=Le.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<Ze.length;r+=1){var n=e[r],s=t[Ze[r]]||"",a=n(s);if(!a)return!1}return!0}});var Qa=N((ZE,Rn)=>{"use strict";var XE=require("path"),Wa=require("fs"),Bt=Ha();Rn.exports=function(t,e){var r=Bt.getFileName();Wa.stat(r,function(n,s){if(n||!Bt.usePgPass(s,r))return e(void 0);var a=Wa.createReadStream(r);Bt.getPassword(t,a,e)})};Rn.exports.warnTo=Bt.warnTo});var Xa=N((JE,za)=>{"use strict";var Xm=require("events").EventEmitter,Ya=yt(),wn=fa(),Zm=Or(),Jm=Dr(),ja=va(),ed=gt(),td=In(),rd=vr(),qn=class qn extends Xm{constructor(e){super(),this.connectionParameters=new Jm(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Zm(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new td({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||ed.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{Qa()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await rd.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=wn.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await wn.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{wn.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Ya.escapeIdentifier(e)}escapeLiteral(e){return Ya.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,a,o,c,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(o=this.connectionParameters.query_timeout,s=new ja(e,r,n),s.callback||(a=new this._Promise((l,d)=>{s.callback=(p,m)=>p?d(p):l(m)}).catch(l=>{throw Error.captureStackTrace(l),l}))),o&&(u=s.callback,c=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),u(l),s.callback=()=>{};var d=this.queryQueue.indexOf(s);d>-1&&this.queryQueue.splice(d,1),this._pulseQueryQueue()},o),s.callback=(l,d)=>{clearTimeout(c),u(l,d)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(s),this._pulseQueryQueue(),a):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(qn,"Client");var Kt=qn;Kt.Query=ja;za.exports=Kt});var to=N((tT,eo)=>{"use strict";var nd=require("events").EventEmitter,Za=i(function(){},"NOOP"),Ja=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),Pn=class Pn{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(Pn,"IdleItem");var Dn=Pn,Ln=class Ln{constructor(e){this.callback=e}};i(Ln,"PendingItem");var Je=Ln;function sd(){throw new Error("Release called on client which has already been released to the pool.")}i(sd,"throwOnDoubleRelease");function Gt(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(o,c){o?r(o):n(c)},"cb"),a=new t(function(o,c){n=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:s,result:a}}i(Gt,"promisify");function id(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(id,"makeIdleListener");var Mn=class Mn extends nd{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Fn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=Ja(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=Gt(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Je(r.callback)),n;let s=i((c,u,l)=>{clearTimeout(o),r.callback(c,u,l)},"queueCallback"),a=new Je(s),o=setTimeout(()=>{Ja(this._pendingQueue,c=>c.callback===s),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),n}return this.newClient(new Je(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=id(this,r);this.log("checking client timeout");let s,a=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(s&&clearTimeout(s),r.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,Za);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(l=>l.client===r)!==-1&&this._acquireClient(r,new Je((l,d,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,Za);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&sd(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Dn(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Gt(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let s=Gt(this.Promise,n);return n=s.callback,this.connect((a,o)=>{if(a)return n(a);let c=!1,u=i(l=>{c||(c=!0,o.release(l),n(l))},"onError");o.once("error",u),this.log("dispatching query");try{o.query(e,r,(l,d)=>{if(this.log("query dispatched"),o.removeListener("error",u),!c)return c=!0,o.release(l),l?n(l):n(void 0,d)})}catch(l){return o.release(l),n(l)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Gt(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(Mn,"Pool");var xn=Mn;eo.exports=xn});var so=N((nT,no)=>{"use strict";var ro=require("events").EventEmitter,ad=require("util"),Un=yt(),et=no.exports=function(t,e,r){ro.call(this),t=Un.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};ad.inherits(et,ro);var od={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};et.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=od[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};et.prototype.then=function(t,e){return this._getPromise().then(t,e)};et.prototype.catch=function(t){return this._getPromise().catch(t)};et.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};et.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((u,l)=>{u.forEach(d=>{e.emit("row",d,c[l])})}):o.forEach(function(u){e.emit("row",u,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(Un.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var s=this.values.map(Un.prepareValue);t.native.query(this.text,s,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var uo=N((iT,co)=>{"use strict";var io;try{io=require("pg-native")}catch(t){throw t}var cd=Or(),ao=require("events").EventEmitter,ud=require("util"),ld=Dr(),oo=so(),fe=co.exports=function(t){ao.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new cd(t.types),this.native=new io({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new ld(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};fe.Query=oo;ud.inherits(fe,ao);fe.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};fe.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};fe.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};fe.prototype.query=function(t,e,r){var n,s,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,n=new oo(t,e,r),!n.callback){let u,l;s=new this._Promise((d,p)=>{u=d,l=p}).catch(d=>{throw Error.captureStackTrace(d),d}),n.callback=(d,p)=>d?l(d):u(p)}return a&&(c=n.callback,o=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),c(u),n.callback=()=>{};var l=this._queryQueue.indexOf(n);l>-1&&this._queryQueue.splice(l,1),this._pulseQueryQueue()},a),n.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};fe.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(a=>a?s(a):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};fe.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};fe.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};fe.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};fe.prototype.ref=function(){};fe.prototype.unref=function(){};fe.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};fe.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var kn=N((oT,lo)=>{"use strict";lo.exports=uo()});var Fn=N((cT,Tt)=>{"use strict";var pd=Xa(),md=gt(),dd=In(),fd=to(),{DatabaseError:hd}=Cn(),{escapeIdentifier:gd,escapeLiteral:yd}=yt(),_d=i(t=>{var e;return e=class extends fd{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),$n=i(function(t){this.defaults=md,this.Client=t,this.Query=this.Client.Query,this.Pool=_d(this.Client),this._pools=[],this.Connection=dd,this.types=ht(),this.DatabaseError=hd,this.escapeIdentifier=gd,this.escapeLiteral=yd},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Tt.exports=new $n(kn()):(Tt.exports=new $n(pd),Object.defineProperty(Tt.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new $n(kn())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Tt.exports,"native",{value:t}),t}}))});var mo=N((lT,po)=>{"use strict";var tt=require("fs"),Ed=Fn(),Td="The server does not support SSL connections",Sd="28000",Cd=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,a){e.info("Certificate",{hostname:s,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return tt.existsSync(t.certAuthority)&&(n.ca=tt.readFileSync(t.certAuthority).toString()),tt.existsSync(t.clientCert)&&(n.cert=tt.readFileSync(t.clientCert).toString()),tt.existsSync(t.clientPrivateKey)&&(n.key=tt.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),Ad=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),Nd=i(async(t,e,r)=>{let n=!1;if(t.ssh){let{options:o}=await e.openTunnel({sshAuthMethod:t.ssh_method==="privateKey"?"IDENTITY_FILE":"USER_PASSWORD",sshTunnelHostname:t.ssh_host,sshTunnelPort:t.ssh_port,sshTunnelUsername:t.ssh_user,sshTunnelPassword:t.ssh_password,sshTunnelIdentityFile:t.ssh_key_file,sshTunnelPassphrase:t.ssh_key_passphrase,host:t.host,port:t.port});t={...t,...o},n=!0}t=Object.assign({},t,{sslType:Ad(t.sslType)});let s={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:Cd(t,r),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await Bn(s,r),isSshTunnel:n}},"createClient"),bd=i((t,e,r)=>{var n;if(r.message===Td&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),Bn({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===Sd&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),Bn({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),Bn=i((t,e)=>{let r=new Ed.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return bd(t,e,n)})},"createConnectionPool");po.exports={createClient:Nd}});var Gn=N((mT,go)=>{"use strict";var Kn=i(t=>`
        SELECT indexname,
               index_method,
               index_unique,
               index_indnullsnotdistinct,
               number_of_keys,
               where_expression,
               array_agg(attname
                         ORDER BY ord)::text[] AS columns,
               array_agg(coll
                         ORDER BY ord) AS collations,
               array_agg(opclass
                         ORDER BY ord) AS opclasses,
               array_agg(expression
                         ORDER BY ord) AS expressions,
               array_agg(ascending
                         ORDER BY ord) AS ascendings,
               array_agg(nulls_first
                         ORDER BY ord) AS nulls_first,
                reloptions AS storage_parameters,
                tablespace_name
        FROM
            (SELECT ct.oid AS table_oid,
                    c.relname AS indexname,
                    m.amname AS index_method,
                    indexes.indisunique AS index_unique,
                    ${t===15?"indexes.indnullsnotdistinct":"FALSE"} AS index_indnullsnotdistinct,
                    indexes.ord,
                    attribute.attname,
                     c.reloptions,
                     tablespace_t.spcname AS tablespace_name,
                    indexes.${t===10?"indnatts":"indnkeyatts"} AS number_of_keys,
                    pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
                    CASE
                        WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
                    END AS coll,
                    CASE
                        WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
                    END AS opclass,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'asc')
                    END AS ascending,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'nulls_first')
                    END AS nulls_first,
                    pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
             FROM
                 (SELECT *,
                         generate_series(1,array_length(i.indkey,1)) AS ord,
                         unnest(i.indkey) AS key,
                         unnest(i.indcollation) AS coll,
                         unnest(i.indclass) AS class,
                         unnest(i.indoption) AS option
                  FROM pg_catalog.pg_index i) indexes
             JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
             JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
             JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
             LEFT JOIN pg_catalog.pg_attribute attribute ON (attribute.attrelid=indexes.indrelid
                                                  AND attribute.attnum=indexes.key)
             LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
             LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
             LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
             LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
             LEFT JOIN pg_catalog.pg_tablespace tablespace_t ON (tablespace_t.oid = c.reltablespace)) s2
        WHERE table_oid = $1
        GROUP BY indexname,
                 index_method,
                 index_unique,
                 index_indnullsnotdistinct,
                 reloptions,
                 number_of_keys,
                 where_expression,
                 tablespace_name;
        `,"getGET_TABLE_INDEXES"),fo=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),ho={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
        SELECT tables.table_name, tables.table_type FROM information_schema.tables AS tables
        INNER JOIN 
        (SELECT
                pg_class.relname AS table_name,
                 pg_namespace.nspname AS table_schema
        FROM pg_catalog.pg_class AS pg_class
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace 
                ON (pg_namespace.oid = pg_class.relnamespace)
        WHERE pg_class.relispartition = false
                AND pg_class.relkind = ANY('{"r","v","t","m","p"}'))
        AS catalog_table_data
        ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
	LEFT JOIN (SELECT relname AS child_name FROM pg_catalog.pg_inherits AS inherit
		LEFT JOIN pg_catalog.pg_class AS child ON (child.oid = inherit.inhrelid)) AS inherited_tables
	ON (inherited_tables.child_name = tables.table_name)
	WHERE inherited_tables.child_name IS NULL
        AND tables.table_schema = $1;`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pt.spcname, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc 
            LEFT JOIN pg_catalog.pg_tablespace AS pt 
            ON pc.reltablespace = pt.oid
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_PARTITION_DATA:`
        SELECT partstrat as partition_method,
	            partattrs::int2[] as partition_attributes_positions,
	            pg_catalog.pg_get_expr(partexprs, partrelid) AS expressions
            FROM pg_catalog.pg_partitioned_table
            WHERE partrelid = $1;`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_SAMPLED_DATA_SIZE:(t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,GET_INHERITS_PARENT_TABLE_NAME:`
        SELECT pc.relname AS parent_table_name FROM pg_catalog.pg_inherits AS pi
	        INNER JOIN pg_catalog.pg_class AS pc
	        ON pc.oid = pi.inhparent
	        WHERE pi.inhrelid = $1;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.connoinherit AS no_inherit,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters,
	            pt.spcname AS tablespace
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        LEFT JOIN pg_catalog.pg_tablespace AS pt
	        ON pc.reltablespace = pt.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:Kn(),GET_TABLE_INDEXES_V_10:Kn(10),GET_TABLE_INDEXES_V_15:Kn(15),GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_tablespace AS pt ON pc.reltablespace = pt.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:fo(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:fo(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND ((pg_type.typtype = 'c'
               AND pg_class.relkind = 'c')
              OR pg_type.typtype = 'e'
              OR pg_type.typtype = 'r')
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DOMAIN_TYPES:"SELECT * FROM information_schema.domains WHERE domain_schema = $1",GET_DOMAIN_TYPES_CONSTRAINTS:`
        SELECT pg_type.typname AS type_name,
        	pg_type.typnotnull AS not_null,
        	pg_constraint.conname AS constraint_name,
        	pg_catalog.pg_get_expr(pg_constraint.conbin, pg_constraint.conrelid) AS expression
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_constraint AS pg_constraint ON (pg_constraint.contypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        WHERE pg_type.typname = $1 AND pg_namespace.nspname = $2 AND pg_constraint.contype = 'c';`,GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;",GET_TRIGGERS:`
        SELECT trigger_name,
                array_agg(event_manipulation::text) AS trigger_events,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement
        FROM
            -- This is information_schema.triggers view but without permitions
            (SELECT (current_database())::information_schema.sql_identifier AS trigger_catalog,
                    (n.nspname)::information_schema.sql_identifier AS trigger_schema,
                    (t.tgname)::information_schema.sql_identifier AS trigger_name,
                    (em.text)::information_schema.character_data AS event_manipulation,
                    (current_database())::information_schema.sql_identifier AS event_object_catalog,
                    (n.nspname)::information_schema.sql_identifier AS event_object_schema,
                    (c.relname)::information_schema.sql_identifier AS event_object_table,
                    (rank() OVER (PARTITION BY (n.nspname)::information_schema.sql_identifier,
                                               (c.relname)::information_schema.sql_identifier,
                                               em.num, ((t.tgtype)::integer & 1), ((t.tgtype)::integer & 66)
                                  ORDER BY t.tgname))::information_schema.cardinal_number AS action_order,
                    (regexp_match(pg_get_triggerdef(t.oid), '.{35,} WHEN ((.+)) EXECUTE FUNCTION'::text))[1]::information_schema.character_data AS action_condition,
                    (SUBSTRING(pg_get_triggerdef(t.oid)
                               FROM (POSITION(('EXECUTE FUNCTION'::text) IN (SUBSTRING(pg_get_triggerdef(t.oid)
                                                                                       FROM 48))) + 47)))::information_schema.character_data AS action_statement,
                    (CASE ((t.tgtype)::integer & 1)
                         WHEN 1 THEN 'ROW'::text
                         ELSE 'STATEMENT'::text
                     END)::information_schema.character_data AS action_orientation,
                    (CASE ((t.tgtype)::integer & 66)
                         WHEN 2 THEN 'BEFORE'::text
                         WHEN 64 THEN 'INSTEAD OF'::text
                         ELSE 'AFTER'::text
                     END)::information_schema.character_data AS action_timing,
                    (t.tgoldtable)::information_schema.sql_identifier AS action_reference_old_table,
                    (t.tgnewtable)::information_schema.sql_identifier AS action_reference_new_table,
                    (NULL::timestamp with time zone)::information_schema.time_stamp AS created
                FROM pg_namespace n,
                        pg_class c,
                        pg_trigger t, (VALUES (4,'INSERT'::text), (8,'DELETE'::text), (16,'UPDATE'::text)) em(num, text)
                WHERE ((n.oid = c.relnamespace)
                        AND (c.oid = t.tgrelid)
                        AND (((t.tgtype)::integer & em.num) <> 0)
                        AND (NOT t.tgisinternal)
                        AND (NOT pg_is_other_temp_schema(n.oid)))) AS tmp_views
        WHERE event_object_schema = $1 AND event_object_table = $2
        GROUP BY
                trigger_schema,
                trigger_name,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement;`,GET_TRIGGERS_ADDITIONAL_DATA:`
        SELECT
                pg_catalog.obj_description(pg_trigger.oid, 'pg_trigger') AS description,
        	pg_trigger.tgname AS trigger_name,
        	pg_proc.proname AS function_name,
        	CASE WHEN pg_trigger.tgconstraint != 0 THEN true ELSE false END AS "constraint",
        	array_agg(pg_attribute.attname)::text[] AS update_attributes,
        	tgdeferrable AS "deferrable",
        	tginitdeferred AS deferred,
                pg_class_referenced.relname AS referenced_table_name,
                pg_namespace_referenced.nspname AS referenced_table_schema
        FROM pg_catalog.pg_trigger as pg_trigger
        LEFT JOIN pg_catalog.pg_proc AS pg_proc 
        	ON (pg_trigger.tgfoid = pg_proc.oid)
        LEFT JOIN pg_catalog.pg_attribute AS pg_attribute
        	ON (pg_attribute.attnum = ANY(pg_trigger.tgattr::int2[]) AND pg_trigger.tgrelid = pg_attribute.attrelid)
        INNER JOIN pg_catalog.pg_class AS pg_class
        	ON (pg_class.oid = pg_trigger.tgrelid)
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace
        	ON (pg_class.relnamespace = pg_namespace.oid)
        LEFT JOIN pg_catalog.pg_class AS pg_class_referenced
                ON(pg_class_referenced.oid = pg_trigger.tgconstrrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace_referenced
                ON(pg_namespace_referenced.oid = pg_class_referenced.relnamespace)
        WHERE pg_class.relnamespace = $1 AND pg_class.oid = $2
        GROUP BY 
        	trigger_name,
        	function_name,
        	"constraint",
        	"deferrable",
        	deferred,
                description,
                referenced_table_name,
                referenced_table_schema;`,GET_PARTITIONS:`
        SELECT
        	inher_child.relname AS child_name,
        	inher_parent.relname AS parent_name,
                CASE WHEN inher_parent.relkind = 'p' THEN TRUE ELSE FALSE END AS is_parent_partitioned
        FROM pg_inherits
        LEFT JOIN pg_class AS inher_child ON (inher_child.oid = pg_inherits.inhrelid)
        LEFT JOIN pg_class AS inher_parent ON (inher_parent.oid = pg_inherits.inhparent)
        WHERE inher_parent.relnamespace = $1;`,GET_SEQUENCES:`
        SELECT DISTINCT ON (sequence_name)
                information_schema."sequences".sequence_name,
                information_schema."sequences".data_type,
                information_schema."sequences".start_value,
                information_schema."sequences".minimum_value,
                information_schema."sequences".maximum_value,
                information_schema."sequences"."increment",
                information_schema."sequences".cycle_option,
                pg_catalog.pg_sequences.cache_size,
                pg_class.relpersistence as rel_persistance,
                inner_pg_class.relname AS table_name,
                pg_attribute.attname AS column_name
        FROM information_schema."sequences"
        JOIN pg_class ON pg_class.relname = information_schema."sequences".sequence_name
        JOIN pg_depend ON pg_depend.objid = pg_class.oid
        LEFT JOIN pg_catalog.pg_sequences ON (pg_catalog.pg_sequences.schemaname, pg_catalog.pg_sequences.sequencename) = (information_schema."sequences".sequence_schema, information_schema."sequences".sequence_name)
        LEFT JOIN pg_class AS inner_pg_class ON pg_depend.refobjid = inner_pg_class.oid
        LEFT JOIN pg_attribute ON (pg_depend.refobjid, pg_depend.refobjsubid) = (pg_attribute.attrelid, pg_attribute.attnum)
        WHERE pg_class.relkind = 'S'
        AND information_schema."sequences".sequence_schema = $1
        ORDER BY sequence_name, column_name;
        `},Id=i(t=>(Object.entries(ho).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");go.exports={getQueryName:Id,...ho}});var _o=N((fT,yo)=>{"use strict";var vd=Gn(),Ve=null,Vt=null;yo.exports={initializeClient(t,e){Ve=t,Vt=e,Ve.on("error",r=>e.error(r))},isClientInitialized(){return!!Ve},releaseClient(){return Ve?new Promise(t=>{Ve.end(()=>{Ve=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=vd.getQueryName(t);Vt.info("Execute query",{queryName:n,params:e});let s=Date.now(),a=await Ve.query(t,e),o=Date.now()-s;Vt.info("Query executed",{queryName:n,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,Vt.error(n),null}}}});var So=N((hT,To)=>{"use strict";var Eo=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...Eo(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");To.exports={getJsonSchema:Eo}});var Vn=N((yT,Co)=>{"use strict";var ke=null,Od=i(t=>{ke=t.require("lodash")},"setDependencies"),St={column_default:"default",is_nullable:{keyword:"required",values:{YES:!1,NO:!0}},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e)=>e!==-1&&Fd(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:"length",description:"description",domain_name:"domain_name"},Rd=i((t,e,r)=>{var n;return(n=St[e])!=null&&n.check?St[e].check(t,r)?r:"":ke.get(St,`${e}.values.${r}`,r)},"getColumnValue"),wd=i(t=>e=>ke.chain(e).toPairs().map(([r,n])=>{var s;return[((s=St[r])==null?void 0:s.keyword)||St[r],Rd(e,r,n)]}).filter(([r,n])=>r&&!ke.isNil(n)).fromPairs().thru(qd(t)).value(),"mapColumnData"),qd=i(t=>e=>({...e,...Dd(t,e)}),"setColumnType"),Dd=i((t,e)=>e.type==="ARRAY"?xd(t,e):e.type==="USER-DEFINED"?Ht(t,e.udt_name):e.domain_name?Ht(t,e.domain_name):Ht(t,e.type),"getType"),xd=i((t,e)=>({...Ht(t,e.udt_name.slice(1)),array_type:ke.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Ht=i((t,e)=>{switch(e){case"bigint":case"bigserial":case"smallint":case"integer":case"numeric":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"int8":return{type:"numeric",mode:"bigint"};case"int2":return{type:"numeric",mode:"smallint"};case"int4":return{type:"numeric",mode:"integer"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return ke.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Pd=i((t,e)=>{let r=ke.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],a=Ld(s),o=Md(a);return{...n,subtype:o}})},"setSubtypeFromSampledJsonValues"),Ld=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),Md=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),Fd=i(t=>ke.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");Co.exports={setDependencies:Od,mapColumnData:wd,setSubtypeFromSampledJsonValues:Pd}});var Ct=N((ET,Ao)=>{"use strict";var Ud=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],rt=null,kd=i(t=>{rt=t.require("lodash")},"setDependencies"),$d=i(t=>rt.chain(t).toPairs().reject(([e,r])=>rt.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Bd=i(t=>e=>{var r;return(r=rt.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),Kd=i(t=>/\s|\W/.test(t)||rt.includes(Ud,rt.toUpper(t))?`"${t}"`:t,"wrapInQuotes");Ao.exports={clearEmptyPropertiesInObject:$d,setDependencies:kd,getColumnNameByPosition:Bd,wrapInQuotes:Kd}});var Io=N((ST,bo)=>{"use strict";var{getColumnNameByPosition:Gd}=Ct(),Hn=null,Vd=i(t=>{Hn=t.require("lodash")},"setDependencies"),No=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),Hd=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";case"p":return"PARTIAL";default:return""}},"prepareMatch"),Wd=i((t,e,r,n)=>Hn.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:Hn.map(s.table_columns_positions,Gd(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:No(s.relationship_on_delete),relationshipOnUpdate:No(s.relationship_on_update),relationshipMatch:Hd(s.relationship_match)}})),"prepareForeignKeys");bo.exports={setDependencies:Vd,prepareForeignKeys:Wd}});var Ro=N((AT,Oo)=>{"use strict";var Wt=null,Qd=i(t=>{Wt=t.require("lodash")},"setDependencies"),vo=i(t=>Wt.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Yd(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Yd=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),jd=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),zd=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),Xd=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Zd=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:vo(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:Wt.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:jd(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:Xd(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:zd(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Jd=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:Wt.toLower(t.external_language),inputArgs:vo(e),body:t.routine_definition}),"mapProcedureData");Oo.exports={setDependencies:Qd,mapFunctionData:Zd,mapProcedureData:Jd}});var Po=N((bT,xo)=>{"use strict";var{clearEmptyPropertiesInObject:At,getColumnNameByPosition:Qt}=Ct(),V=null,ef=i(t=>{V=t.require("lodash")},"setDependencies"),qo=i((t,e)=>{if(!t&&!e)return null;let r=wo(t),n=wo(e==null?void 0:e.toast_options),s=r.fillfactor,a=r.parallel_workers,o=r.autovacuum_enabled,c=At({vacuum_index_cleanup:r.vacuum_index_cleanup,vacuum_truncate:r.vacuum_truncate,autovacuum_vacuum_threshold:r.autovacuum_vacuum_threshold,autovacuum_vacuum_scale_factor:r.autovacuum_vacuum_scale_factor,autovacuum_vacuum_insert_threshold:r.autovacuum_vacuum_insert_threshold,autovacuum_vacuum_insert_scale_factor:r.autovacuum_vacuum_insert_scale_factor,autovacuum_analyze_threshold:r.autovacuum_analyze_threshold,autovacuum_analyze_scale_factor:r.autovacuum_analyze_scale_factor,autovacuum_vacuum_cost_delay:r.autovacuum_vacuum_cost_delay,autovacuum_vacuum_cost_limit:r.autovacuum_vacuum_cost_limit,autovacuum_freeze_min_age:r.autovacuum_freeze_min_age,autovacuum_freeze_max_age:r.autovacuum_freeze_max_age,autovacuum_freeze_table_age:r.autovacuum_freeze_table_age,autovacuum_multixact_freeze_min_age:r.autovacuum_multixact_freeze_min_age,autovacuum_multixact_freeze_max_age:r.autovacuum_multixact_freeze_max_age,autovacuum_multixact_freeze_table_age:r.autovacuum_multixact_freeze_table_age,log_autovacuum_min_duration:r.log_autovacuum_min_duration}),u=r.user_catalog_table,l=n.autovacuum_enabled,d=At({toast_tuple_target:r.toast_tuple_target,toast_vacuum_index_cleanup:n.vacuum_index_cleanup,toast_vacuum_truncate:n.vacuum_truncate,toast_autovacuum_vacuum_threshold:n.autovacuum_vacuum_threshold,toast_autovacuum_vacuum_scale_factor:n.autovacuum_vacuum_scale_factor,toast_autovacuum_vacuum_insert_threshold:n.autovacuum_vacuum_insert_threshold,toast_autovacuum_vacuum_insert_scale_factor:n.autovacuum_vacuum_insert_scale_factor,toast_autovacuum_vacuum_cost_delay:n.autovacuum_vacuum_cost_delay,toast_autovacuum_vacuum_cost_limit:n.autovacuum_vacuum_cost_limit,toast_autovacuum_freeze_min_age:n.autovacuum_freeze_min_age,toast_autovacuum_freeze_max_age:n.autovacuum_freeze_max_age,toast_autovacuum_freeze_table_age:n.autovacuum_freeze_table_age,toast_autovacuum_multixact_freeze_min_age:n.autovacuum_multixact_freeze_min_age,toast_autovacuum_multixact_freeze_max_age:n.autovacuum_multixact_freeze_max_age,toast_autovacuum_multixact_freeze_table_age:n.autovacuum_multixact_freeze_table_age,toast_log_autovacuum_min_duration:n.log_autovacuum_min_duration}),p={fillfactor:s,parallel_workers:a,autovacuum_enabled:o,autovacuum:V.isEmpty(c)?null:c,toast_autovacuum_enabled:l,toast:V.isEmpty(d)?null:d,user_catalog_table:u};return At(p)},"prepareStorageParameters"),tf=i((t,e)=>{if(!t)return null;let r=rf(t),n=V.some(t.partition_attributes_positions,o=>o===0),s=n?"partitioning_expression":"compositePartitionKey",a=n?nf(t,e):V.map(t.partition_attributes_positions,Qt(e));return[{partitionMethod:r,partitionBy:n?"expression":"keys",[s]:a}]},"prepareTablePartition"),rf=i(t=>{switch(t.partition_method){case"h":return"HASH";case"l":return"LIST";case"r":return"RANGE";default:return""}},"getPartitionMethod"),nf=i((t,e)=>{let r=0,n=V.split(t.expressions,",");return V.chain(t.partition_attributes_positions).map(s=>{if(s===0){let a=n[r];return r++,a}return Qt(e)(s)}).join(",").value()},"getPartitionExpression"),Do=i(t=>V.split(t,"="),"splitByEqualitySymbol"),sf=i(t=>V.find(t,{type:"json"}),"checkHaveJsonTypes"),af=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),of=i((t,e,r)=>V.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,lf(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,cf(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,uf(s,e,r)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),cf=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:V.map(t.constraint_keys,Qt(e)),indexStorageParameters:V.join(t.storage_parameters,","),indexTablespace:t.tablespace}),"getPrimaryKeyConstraint"),uf=i((t,e,r)=>{let n=V.find(r,a=>a.indexname===t.constraint_name),s=n!=null&&n.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"";return{constraintName:t.constraint_name,compositeUniqueKey:V.map(t.constraint_keys,Qt(e)),indexStorageParameters:V.join(t.storage_parameters,","),indexTablespace:t.tablespace,indexComment:t.description,...s&&{nullsDistinct:s}}},"getUniqueKeyConstraint"),lf=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,noInherit:t.no_inherit,constrDescription:t.description}),"getCheckConstraint"),pf=i(t=>V.map(t,e=>{let r=mf(e),n=V.slice(r,0,e.number_of_keys),s=V.chain(r).slice(e.number_of_keys).map(c=>V.pick(c,"name")).value(),a=e.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"",o={indxName:e.indexname,index_method:e.index_method,unique:e.index_unique??!1,index_tablespace_name:e.tablespace_name||"",index_storage_parameter:ff(e.storage_parameters),where:e.where_expression||"",include:s,columns:e.index_method==="btree"?n:V.map(n,c=>V.omit(c,"sortOrder","nullsOrder")),...a&&{nullsDistinct:a}};return At(o)}),"prepareTableIndexes"),mf=i(t=>V.chain(t.columns).map((e,r)=>{if(!e)return;let n=V.get(t,`ascendings.${r}`,!1)?"ASC":"DESC",s=df(V.get(t,`nulls_first.${r}`)),a=V.get(t,`opclasses.${r}`,""),o=V.get(t,`collations.${r}`,"");return{name:e,sortOrder:n,nullsOrder:s,opclass:a,collation:o}}).compact().value(),"mapIndexColumns"),df=i(t=>V.isNil(t)?"":t?"NULLS FIRST":"NULLS LAST","getNullsOrder"),ff=i(t=>{if(!t)return null;let e=V.fromPairs(V.map(t,n=>Do(n))),r={index_fillfactor:e.fillfactor,deduplicate_items:e.deduplicate_items,index_buffering:e.index_buffering,fastupdate:e.fastupdate,gin_pending_list_limit:e.gin_pending_list_limit,pages_per_range:e.pages_per_range,autosummarize:e.autosummarize};return At(r)},"getIndexStorageParameters"),hf=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=qo(t==null?void 0:t.reloptions,e),a=t==null?void 0:t.spcname,o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,table_tablespace_name:a,partitionBounds:o}},"prepareTableLevelData"),gf=i(t=>{switch(yf(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),yf=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),wo=i(t=>V.chain(t).map(Do).map(([e,r])=>[e,gf(r)]).fromPairs().value()||{},"prepareOptions"),_f=i((t,e)=>V.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");xo.exports={prepareStorageParameters:qo,prepareTablePartition:tf,setDependencies:ef,checkHaveJsonTypes:sf,prepareTableConstraints:of,prepareTableLevelData:hf,prepareTableIndexes:pf,getSampleDocSize:af,prepareTableInheritance:_f}});var Mo=N((vT,Lo)=>{"use strict";var{mapColumnData:Ef}=Vn(),Oe=null,Tf=i(t=>{Oe=t.require("lodash")},"setDependencies"),Sf=i((t,e)=>Oe.chain(t).map(r=>{switch(r.type){case"e":return Cf(r);case"r":return Af(r);case"c":return Nf(r);default:return null}}).compact().concat(Oe.map(e,If)).value(),"getUserDefinedTypes"),Cf=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Af=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Nf=i(t=>{let e=Oe.map(t.columns,Ef([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),bf=i(t=>t.type==="c","isTypeComposite"),If=i(t=>{var e;return{name:t.domain_name,type:"domain",underlyingType:Oe.flow(Of(t),Rf(t),wf(t),qf(t))(vf(t)),collation:t.collation_name||"",default:t.domain_default||"",required:(e=Oe.first(t.constraints))==null?void 0:e.not_null,checkConstraints:Oe.map(t.constraints,Df)}},"mapDomainType"),vf=i(t=>t.data_type==="USER-DEFINED"?t.udt_name:t.data_type,"getUnderlyingType"),Of=i(t=>e=>t.character_maximum_length?`${e}(${t.character_maximum_length})`:e,"setLength"),Rf=i(t=>e=>e!=="numeric"?e:Oe.isNumber(t.numeric_precision)&&Oe.isNumber(t.numeric_scale)?`${e}(${t.numeric_precision},${t.numeric_scale})`:Oe.isNumber(t.numeric_precision)?`${e}(${t.numeric_precision})`:e,"setPrecisionAndScale"),wf=i(t=>e=>t.interval_type?`${e} ${t.interval_type}`:e,"setIntervalType"),qf=i(t=>e=>Oe.isNumber(t.interval_precision)?`${e}(${t.interval_precision})`:e,"setIntervalPrecision"),Df=i(t=>({name:t.constraint_name,expression:t.expression}),"mapDomainConstraint");Lo.exports={setDependencies:Tf,getUserDefinedTypes:Sf,isTypeComposite:bf}});var Uo=N((RT,Fo)=>{"use strict";var{clearEmptyPropertiesInObject:xf,wrapInQuotes:Pf}=Ct(),Me=null,Lf=i(t=>{Me=t.require("lodash")},"setDependencies"),Wn=" (v)",Mf=i(t=>t==="VIEW","isViewByTableType"),Ff=i(t=>Me.endsWith(t,Wn),"isViewByName"),Uf=i(t=>t.slice(0,-Wn.length),"removeViewNameSuffix"),kf=i(t=>`${t}${Wn}`,"setViewSuffix"),$f=i((t,e,r={})=>{let n=Me.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${Pf(t)} AS ${n}`:""},"generateCreateViewScript"),Bf=i((t,e,r)=>{let n={withCheckOption:t.check_option!=="NONE"||Me.isNil(t.check_option),checkTestingScope:Kf(t.check_option),viewOptions:Me.fromPairs(Me.map(e==null?void 0:e.view_options,Vf)),temporary:(e==null?void 0:e.persistence)==="t",recursive:Gf(t),description:e==null?void 0:e.description,triggers:r};return xf(n)},"prepareViewData"),Kf=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),Gf=i(t=>Me.startsWith(Me.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),Vf=i(t=>Me.split(t,"="),"splitByEqualitySymbol");Fo.exports={setDependencies:Lf,isViewByTableType:Mf,isViewByName:Ff,removeViewNameSuffix:Uf,generateCreateViewScript:$f,setViewSuffix:kf,prepareViewData:Bf}});var $o=N((qT,ko)=>{"use strict";var Yt=null,Hf=i(t=>{Yt=t.require("lodash")},"setDependencies"),Wf=i((t,e)=>Yt.chain(t).map(r=>({...r,...Yt.find(e,{trigger_name:r.trigger_name})||{}})).map(Qf).value(),"getTriggers"),Qf=i(t=>{var e;return{name:t.trigger_name,triggerDescription:t.description,triggerConstraint:t.constraint,triggerTable:`${t.event_object_schema}.${t.event_object_table}`,triggerReferencedTable:t.referenced_table_name?[t.referenced_table_schema,t.referenced_table_name]:[],triggerType:t.action_timing,triggerEvents:Yf(t),triggerUpdateColumns:(e=t.update_attributes)==null?void 0:e.filter(Boolean),triggerDeferrable:t.deferrable,triggerTimeConstraintCheck:t.deferred?"INITIALLY DEFERRED":"INITIALLY IMMEDIATE",triggerReferencing:!!t.action_reference_old_table||!!t.action_reference_new_table,triggerBeforeImageTransitionRelation:t.action_reference_old_table||"",triggerAfterImageTransitionRelation:t.action_reference_new_table||"",triggerEachRowStatement:t.action_orientation==="ROW"?"FOR EACH ROW":"FOR EACH STATEMENT",triggerCondition:t.action_condition,triggerFunction:jf(t.action_statement)}},"getTrigger"),Yf=i(t=>Yt.map(t.trigger_events,e=>({triggerEvent:e})),"getTriggerEvents"),jf=i(t=>{var e,r,n;return((n=(r=(e=/EXECUTE (?:FUNCTION|PROCEDURE)(?<function>[\s\S]*)/.exec(t))==null?void 0:e.groups)==null?void 0:r.function)==null?void 0:n.trim())||""},"getFunctionFromTrigger");ko.exports={setDependencies:Hf,getTriggers:Wf}});var Go=N((xT,Ko)=>{"use strict";var zf=i((t,e)=>[Xf,Zf].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),Xf=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Jf(t,s,n),entityLevel:nh(e)}},"reorganizePrimaryKeys"),Zf=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let o=s.compositeUniqueKey[0];return{attributes:th(r,o,s),entityLevel:sh(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Jf=i((t,e,r)=>t.map(n=>n.name!==e?n:eh(n,r)),"setAttributesPrimaryKeyData"),eh=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:Bo(e)}),"setPrimaryKeyData"),th=i((t,e,r)=>t.map(n=>n.name!==e?n:rh(n,r)),"setAttributesUniqueKeyData"),rh=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:Bo(e)}),"setUniqueKeyData"),Bo=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexComment:t.indexComment}],"getOptions"),nh=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),sh=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");Ko.exports={reorganizeConstraints:zf}});var jt=N((LT,Vo)=>{"use strict";var jn=class jn{cache;cycle;dataType;ifNotExist;increment;maxValue;minValue;ownedByColumn;ownedByNone;sequenceName;start;temporary;unlogged};i(jn,"Sequence");var Qn=jn,zn=class zn{sequence_name;increment;start;data_type;maximum_value;minimum_value;cycle_option;cache_size;rel_persistance;column_name;table_name};i(zn,"SequenceDto");var Yn=zn;Vo.exports={Sequence:Qn,SequenceDto:Yn}});var Wo=N((kT,Ho)=>{"use strict";var{Sequence:FT,SequenceDto:UT}=jt(),ih=i(({sequence:t})=>t.column_name?[{entity:t.table_name,name:t.column_name}]:[],"getOwnedByColumn"),ah=i(({sequence:t})=>({sequenceName:t.sequence_name,increment:Number(t.increment),start:Number(t.start_value),dataType:t.data_type,maxValue:Number(t.maximum_value),minValue:Number(t.minimum_value),cache:Number(t.cache_size),temporary:t.rel_persistance==="t",unlogged:t.rel_persistance==="u",cycle:t.cycle_option==="YES",ownedByColumn:ih({sequence:t}),ownedByNone:!t.column_name}),"mapSequenceData");Ho.exports={mapSequenceData:ah}});var Jn=N((BT,jo)=>{"use strict";var{createClient:oh}=mo(),U=_o(),{getJsonSchema:Qo}=So(),{setDependencies:ch,mapColumnData:uh,setSubtypeFromSampledJsonValues:lh}=Vn(),{setDependencies:ph,clearEmptyPropertiesInObject:Yo}=Ct(),{setDependencies:mh,prepareForeignKeys:dh}=Io(),{setDependencies:fh,mapFunctionData:hh,mapProcedureData:gh}=Ro(),{setDependencies:yh,prepareTablePartition:_h,checkHaveJsonTypes:Eh,prepareTableConstraints:Th,getSampleDocSize:Sh,prepareTableLevelData:Ch,prepareTableIndexes:Ah,prepareTableInheritance:Nh}=Po(),{setDependencies:bh,getUserDefinedTypes:Ih,isTypeComposite:vh}=Mo(),{setDependencies:Oh,isViewByTableType:Rh,isViewByName:wh,removeViewNameSuffix:qh,generateCreateViewScript:Dh,setViewSuffix:xh,prepareViewData:Ph}=Uo(),{setDependencies:Lh,getTriggers:Mh}=$o(),k=Gn(),{reorganizeConstraints:Fh}=Go(),{mapSequenceData:Uh}=Wo(),Xn=!1,J=null,he=null,Zn=14;jo.exports={setDependencies(t){J=t.require("lodash"),ph(t),yh(t),ch(t),mh(t),Oh(t),fh(t),bh(t),Lh(t)},async connect(t,e,r){U.isClientInitialized()&&await this.disconnect(e);let{client:n,isSshTunnel:s}=await oh(t,e,r);U.initializeClient(n,r),Xn=s,he=r,Zn=await this._getServerVersion()},async disconnect(t){Xn&&(Xn=!1,await t.closeConsumer()),await U.releaseClient()},pingDb(){return U.query(k.PING)},applyScript(t){return U.query(t)},async getDatabaseNames(){return J.map(await U.query(k.GET_DATABASES),"database_name")},async logVersion(){let t=await U.queryTolerant(k.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved";he.info(`PostgreSQL version: ${e}`)},async getAllSchemasNames(){return(await U.query(k.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!kh(e))},async getTablesNames(t){let e=await U.query(k.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!J.includes(r,n)).map(({table_name:n,table_type:s})=>Rh(s)?xh(n):n)},async getDbLevelData(){var n,s,a;he.progress("Get database data");let t=(n=await U.queryTolerant(k.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await U.queryTolerant(k.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(a=await U.queryTolerant(k.GET_DB_COLLATE_NAME,[],!0))==null?void 0:a.default_collate_name;return Yo({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r,n=!1,s=!1){let a=await this._retrieveUserDefinedTypes(t),o=await U.queryTolerant(k.GET_NAMESPACE_OID,[t],!0),c=o==null?void 0:o.oid,u=n?await U.queryTolerant(k.GET_PARTITIONS,[c]):[],[l,d]=J.partition(e,wh),p=d.flatMap(h=>[{tableName:h},...J.filter(u,{parent_name:h}).map(({child_name:T,is_parent_partitioned:_})=>({isParentPartitioned:_,tableName:T}))]),m=await nt(J.uniq(p),J.bind(this._retrieveSingleTableData,this,r,c,t,a,s));return{views:await nt(l,J.bind(this._retrieveSingleViewData,this,c,t,s)),tables:m,modelDefinitions:Qo(a)}},async retrieveSchemaLevelData(t,e){var p;if(e)return he.info("Functions and procedures ignored"),{functions:[],procedures:[]};he.progress("Get Functions and Procedures",t);let r=(p=await U.queryTolerant(k.GET_NAMESPACE_OID,[t],!0))==null?void 0:p.oid,n=await U.queryTolerant(k.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await U.queryTolerant(Bh(Zn),[r]),[a,o]=J.partition(J.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await nt(a,async m=>{let f=await U.queryTolerant(k.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[m.specific_name]),h=J.find(s,{function_name:m.name});return hh(m,f,h)}),u=await nt(o,async m=>{let f=await U.queryTolerant(k.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[m.specific_name]),h=J.find(s,{function_name:m.name});return gh(m,f,h)}),d=(await U.queryTolerant(k.GET_SEQUENCES,[t])).map(m=>Uh({sequence:m}));return{functions:c,procedures:u,sequences:d}},async _retrieveUserDefinedTypes(t){he.progress("Get User-Defined Types",t);let e=await U.queryTolerant(k.GET_USER_DEFINED_TYPES,[t]),r=await U.queryTolerant(k.GET_DOMAIN_TYPES,[t]),n=await nt(e,async a=>vh(a)?{...a,columns:await U.queryTolerant(k.GET_COMPOSITE_TYPE_COLUMNS,[a.pg_class_oid])}:a),s=await nt(r,async a=>({...a,constraints:await U.queryTolerant(k.GET_DOMAIN_TYPES_CONSTRAINTS,[a.domain_name,t])}));return Ih(n,s)},async _retrieveSingleTableData(t,e,r,n,s,{tableName:a,isParentPartitioned:o}){var Ne;he.progress("Get table data",r,a);let c=await U.queryTolerant(k.GET_TABLE_LEVEL_DATA,[a,e],!0),u=c==null?void 0:c.oid,l=await U.queryTolerant(k.GET_TABLE_TOAST_OPTIONS,[a,e],!0),d=await U.queryTolerant(k.GET_TABLE_PARTITION_DATA,[u],!0),p=await this._getTableColumns(a,r,u),m=await U.queryTolerant(k.GET_DESCRIPTION_BY_OID,[u],!0),f=await U.queryTolerant(k.GET_INHERITS_PARENT_TABLE_NAME,[u]),h=await U.queryTolerant(k.GET_TABLE_CONSTRAINTS,[u]),T=await U.queryTolerant($h(Zn),[u]),_=await U.queryTolerant(k.GET_TABLE_FOREIGN_KEYS,[u]),y=await this._getTriggers(r,a,e,u,s);he.info("Table data retrieved",{schemaName:r,tableName:a,columnTypes:p.map(C=>C.data_type)});let A=_h(d,p),S=Ch(c,l),I=Kh(m),v=Nh(r,f),w=Th(h,p,T),$=Ah(T),b=dh(_,a,r,p),q={partitioning:A,description:I,triggers:y,Indxs:$,...S,...w,...o?{partitionOf:(Ne=J.first(v))==null?void 0:Ne.parentTable}:{inherits:v}},G=Yo(q),P=p.map(uh(n)),z=Eh(P),Ae=[];z&&(Ae=await this._getDocuments(r,a,P,t),P=lh(P,Ae));let{attributes:le,entityLevel:F}=Fh(P,G);return{name:a,entityLevel:F,jsonSchema:Qo(le),documents:Ae,relationships:b}},async _getTriggers(t,e,r,n,s){if(s)return he.info("Triggers ignored"),[];let a=await U.queryTolerant(k.GET_TRIGGERS,[t,e]),o=await U.queryTolerant(k.GET_TRIGGERS_ADDITIONAL_DATA,[r,n]);return Mh(a,o)},async _getTableColumns(t,e,r){he.progress("Get columns",e,t);let n=await U.query(k.GET_TABLE_COLUMNS,[t,e]),s=await U.queryTolerant(k.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return J.map(n,a=>({...a,...J.find(s,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,n){var d;he.progress("Sampling table",t,e);let s=`${t}.${e}`,a=((d=await U.queryTolerant(k.GET_ROWS_COUNT(s),[],!0))==null?void 0:d.quantity)||0,o=Sh(a,n),c=r.filter(({type:p})=>J.includes(["json","jsonb"],p)),u=J.map(c,"name").join(", "),l=await U.queryTolerant(k.GET_SAMPLED_DATA_SIZE(s,u),[o],!0);return he.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:l==null?void 0:l._hackolade_tmp_sampling_tbl_size}),await U.queryTolerant(k.GET_SAMPLED_DATA(s,u),[o])},async _retrieveSingleViewData(t,e,r,n){he.progress("Get view data",e,n),n=qh(n);let s=await U.query(k.GET_VIEW_DATA,[n,e],!0),a=!s.view_definition&&await U.queryTolerant(k.GET_VIEW_SELECT_STMT_FALLBACK,[n,e],!0),o=await U.queryTolerant(k.GET_VIEW_OPTIONS,[n,t],!0),c=await this._getTriggers(e,n,t,o==null?void 0:o.oid,r),u=Dh(n,s,a),l=Ph(s,o,c);return u?{name:n,data:l,ddl:{script:u,type:"postgres"}}:(he.info("View select statement was not retrieved",{schemaName:e,viewName:n}),{name:n,data:l,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await U.queryTolerant(k.GET_VERSION_AS_NUM,[],!0),e=J.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var kh=i(t=>!!(J.startsWith(t,"pg_")||J.includes(["information_schema"],t)),"isSystemSchema"),$h=i(t=>t===10?k.GET_TABLE_INDEXES_V_10:t>15?k.GET_TABLE_INDEXES_V_15:k.GET_TABLE_INDEXES,"getGetIndexesQuery"),Bh=i(t=>t===10?k.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:k.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),Kh=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),nt=i((t,e)=>Promise.all(J.map(t,e)),"mapPromises")});var Xo=N((GT,zo)=>{"use strict";var{createLogger:zt}=pr(),te=Jn();zo.exports={async disconnect(t,e,r,n){let s=n.require("@hackolade/ssh-service");await te.disconnect(s),r()},async testConnection(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{es("Test connection",t,e);let a=zt({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});te.setDependencies(n),await te.connect(t,s,a),await te.pingDb(),await te.logVersion(),r()}catch(a){e.log("error",He(a),"Test connection instance log"),r(He(a))}finally{await te.disconnect(s)}},async getDatabases(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{es("Get databases",t,e);let a=zt({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});te.setDependencies(n),await te.connect(t,s,a),await te.logVersion();let o=await te.getDatabaseNames();return e.log("info",o,"All databases list",t.hiddenKeys),r(null,o)}catch(a){return e.log("error",a),r(He(a))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{es("Get DB table names",t,e);let a=zt({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});te.setDependencies(n),await te.connect(t,s,a),await te.logVersion();let c=await(await te.getAllSchemasNames()).reduce(async(u,l)=>{let d=await u;try{let p=await te.getTablesNames(l);return d.concat({dbName:l,dbCollections:p,isEmpty:p.length===0})}catch(p){return a.info(`Error reading database "${l}"`),a.error(p),d.concat({dbName:l,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,c)}catch(a){e.log("error",He(a),"Get DB collections names"),r(He(a)),await te.disconnect(s)}},async getDbCollectionsData(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let a=zt({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});a.progress("Start reverse engineering...");let o=t.collectionData.collections,c=t.collectionData.dataBaseNames,u=await te.getDbLevelData(),{packages:l,relationships:d}=await Promise.all(c.map(async p=>{let{tables:m,views:f,modelDefinitions:h}=await te.retrieveEntitiesData(p,o[p],t.recordSamplingSettings,t.includePartitions,t.ignoreUdfUdpTriggers),{functions:T,procedures:_,triggers:y,sequences:A}=await te.retrieveSchemaLevelData(p,t.ignoreUdfUdpTriggers);return a.progress("Schema data fetched successfully",p),{schemaName:p,tables:m,views:f,functions:T,procedures:_,modelDefinitions:h,triggers:y,sequences:A}})).then(p=>{let m=p.flatMap(({tables:h})=>h.map(T=>T.relationships)).flat();return{packages:p.flatMap(({schemaName:h,tables:T,views:_,functions:y,procedures:A,triggers:S,modelDefinitions:I,sequences:v})=>{let w={UDFs:y,Procedures:A,triggers:S,sequences:v},$=T.map(b=>({dbName:h,collectionName:b.name,documents:b.documents,views:[],emptyBucket:!1,entityLevel:b.entityLevel,validation:{jsonSchema:b.jsonSchema},bucketInfo:w,modelDefinitions:I})).sort(b=>n.require("lodash").isEmpty(b.entityLevel.inherits)?-1:1);if(_!=null&&_.length){let b={dbName:h,views:_,emptyBucket:!1};return[...$,b]}return $}),relationships:m}}).then(({packages:p,relationships:m})=>({packages:Gh(p),relationships:m}));a.info("The data is processed and sent to the application",{packagesLength:l==null?void 0:l.length,relationshipsLength:d==null?void 0:d.length}),r(null,l,u,d)}catch(a){e.log("error",He(a),"Retrieve tables data"),r(He(a))}finally{await te.disconnect(s)}}};var He=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),es=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),Gh=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages")});var Jo=N((HT,Zo)=>{"use strict";var Xt=Jn(),Vh=i(async(t,e,r)=>{try{let n=r.require("@hackolade/ssh-service");Xt.setDependencies(r),await Xt.connect(t,n,e),await Xt.logVersion(),await Xt.applyScript(Hh(t.script))}catch(n){throw e.error(n),Wh(n)}},"applyToInstance"),Hh=i(t=>{let e=/CREATE DATABASE[^;]*;/gi;return t.replace(e,"")},"removeCreateDbScript"),Wh=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");Zo.exports={applyToInstance:Vh}});var re=N((QT,ec)=>{"use strict";var ns=class ns{script;isDropScript};i(ns,"ModificationScript");var ts=ns,ss=class ss{isActivated;scripts;static getInstances(e,r,n){return(e||[]).filter(Boolean).map(s=>({isActivated:r,scripts:[{isDropScript:n,script:s}]}))}static getInstance(e,r,n){var s;if((s=e==null?void 0:e.filter(Boolean))!=null&&s.length)return{isActivated:r,scripts:e.filter(Boolean).map(a=>({isDropScript:n,script:a}))}}static getDropAndRecreateInstance(e,r,n){let s=[];if(e&&s.push({isDropScript:!0,script:e}),r&&s.push({isDropScript:!1,script:r}),!!(s!=null&&s.length))return{isActivated:n,scripts:s}}};i(ss,"AlterScriptDto");var rs=ss;ec.exports={ModificationScript:ts,AlterScriptDto:rs}});var ps=N((jT,tc)=>{"use strict";var cs=class cs{sortOrder;nullsOrder;isActivated;keyId;collation;opclass};i(cs,"AlterIndexColumnDto");var is=cs,us=class us{keyId};i(us,"AlterIndexIncludeColumnDto");var as=us,ls=class ls{id;isActivated;index_method;ifNotExist;only;index_tablespace_name;indxName;columns;include;index_storage_parameter};i(ls,"AlterIndexDto");var os=ls;tc.exports={AlterIndexDto:os,AlterIndexColumnDto:is,AlterIndexIncludeColumnDto:as}});var $e=N((ZT,rc)=>{"use strict";var{AlterIndexDto:XT}=ps(),Es=class Es{id;constraintName;indexStorageParameters;indexTablespace;indexInclude};i(Es,"AlterCollectionColumnKeyOptionDto");var Nt=Es,Ts=class Ts{type;isActivated;primaryKey;unique;mode;length;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;primaryKeyOptions;triggerUpdateColumns;compMod;GUID};i(Ts,"AlterCollectionColumnDto");var ms=Ts,Ss=class Ss extends Nt{compositePrimaryKey};i(Ss,"AlterCollectionRoleCompModPKDto");var ds=Ss,Cs=class Cs extends Nt{compositeUniqueKey};i(Cs,"AlterCollectionRoleCompModUniqueKeyDto");var fs=Cs,As=class As{new;old};i(As,"AlterCollectionRoleCompModPrimaryKey");var hs=As,Ns=class Ns{new;old};i(Ns,"AlterCollectionRoleCompModUniqueKey");var gs=Ns,bs=class bs{id;type;collectionName;properties;definitions;isActivated;additionalProperties;memory_optimized;collectionUsers;ifNotExist;on_commit;table_tablespace_name;bucketId;compMod;name;roleType;patternProperties};i(bs,"AlterCollectionRoleDto");var ys=bs,Is=class Is{type;isActivated;unique;subtype;properties;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(Is,"AlterCollectionDto");var _s=Is;rc.exports={AlterCollectionDto:_s,AlterCollectionRoleDto:ys,AlterCollectionColumnDto:ms,AlterCollectionColumnKeyOptionDto:Nt,AlterCollectionRoleCompModPrimaryKey:hs,AlterCollectionRoleCompModPKDto:ds,AlterCollectionRoleCompModUniqueKeyDto:fs,AlterCollectionRoleCompModUniqueKey:gs}});var sc=N((eS,nc)=>{"use strict";var Qh=Object.freeze({ALL:"ALL",ANALYSE:"ANALYSE",ANALYZE:"ANALYZE",AND:"AND",ANY:"ANY",ARRAY:"ARRAY",ASC:"ASC",ASYMMETRIC:"ASYMMETRIC",AUTHORIZATION:"AUTHORIZATION",BINARY:"BINARY",BOTH:"BOTH",CASE:"CASE",CAST:"CAST",CHECK:"CHECK",COLLATE:"COLLATE",COLUMN:"COLUMN",CONCURRENTLY:"CONCURRENTLY",CONSTRAINT:"CONSTRAINT",CREATE:"CREATE",CROSS:"CROSS",CURRENT_CATALOG:"CURRENT_CATALOG",CURRENT_DATE:"CURRENT_DATE",CURRENT_ROLE:"CURRENT_ROLE",CURRENT_SCHEMA:"CURRENT_SCHEMA",CURRENT_TIME:"CURRENT_TIME",CURRENT_TIMESTAMP:"CURRENT_TIMESTAMP",CURRENT_USER:"CURRENT_USER",DEFAULT:"DEFAULT",DEFERRABLE:"DEFERRABLE",DESC:"DESC",DISTINCT:"DISTINCT",DO:"DO",ELSE:"ELSE",END:"END",EXCEPT:"EXCEPT",FALSE:"FALSE",FOR:"FOR",FOREIGN:"FOREIGN",FREEZE:"FREEZE",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",GROUP:"GROUP",HAVING:"HAVING",ILIKE:"ILIKE",IN:"IN",INITIALLY:"INITIALLY",INTERSECT:"INTERSECT",INTO:"INTO",IS:"IS",ISNULL:"ISNULL",JOIN:"JOIN",LATERAL:"LATERAL",LEADING:"LEADING",LEFT:"LEFT",LIKE:"LIKE",LIMIT:"LIMIT",LOCALTIME:"LOCALTIME",LOCALTIMESTAMP:"LOCALTIMESTAMP",NATURAL:"NATURAL",NOT:"NOT",NULL:"NULL",OFFSET:"OFFSET",ON:"ON",ONLY:"ONLY",OR:"OR",ORDER:"ORDER",OUTER:"OUTER",OVERLAPS:"OVERLAPS",PLACING:"PLACING",PRIMARY:"PRIMARY",REFERENCES:"REFERENCES",RETURNING:"RETURNING",RIGHT:"RIGHT",SELECT:"SELECT",SESSION_USER:"SESSION_USER",SIMILAR:"SIMILAR",SOME:"SOME",SYMMETRIC:"SYMMETRIC",TABLE:"TABLE",TABLESAMPLE:"TABLESAMPLE",THEN:"THEN",TO:"TO",TRAILING:"TRAILING",TRUE:"TRUE",UNION:"UNION",UNIQUE:"UNIQUE",USER:"USER",USING:"USING",VARIADIC:"VARIADIC",VERBOSE:"VERBOSE",WHEN:"WHEN",WHERE:"WHERE",WINDOW:"WINDOW",WITH:"WITH"}),Yh=Object.values(Qh);nc.exports={ReservedWordsAsArray:Yh}});var L=N((nS,ic)=>{"use strict";var{AlterCollectionDto:tS,AlterCollectionRoleDto:rS}=$e(),{ReservedWordsAsArray:jh}=sc(),zh=/\t|\n|'|\f|\r/gm;ic.exports=t=>{let e=i(C=>t.get(C,"[0].code")||t.get(C,"[0].name",""),"getDbName"),r=i(C=>C&&(C.code||C.collectionName)||"","getEntityName"),n=i(C=>C&&(C.code||C.name)||"","getViewName"),s=i(C=>Object.assign({},t.get(C,"[0]",{}),{name:e(C)}),"getDbData"),a=i(C=>t.get(C,"[0].viewOn"),"getViewOn"),o=i((C,D="	")=>C.split(`
`).map(B=>D+B).join(`
`),"tab"),c=i((C,D)=>Object.keys(C).map(t.toLower).includes(t.toLower(D)),"hasType"),u=i(C=>({...C,...t.omit(C==null?void 0:C.role,"properties")||{}}),"getSchemaOfAlterCollection"),l=i(C=>{var H;let D=r(C),B=(H=C.compMod)==null?void 0:H.keyspaceName;return G(D,B)},"getFullCollectionName"),d=i(C=>Object.entries(C).filter(([D,B])=>!t.isNil(B)).reduce((D,[B,H])=>({...D,[B]:H}),{}),"clean"),p=i(C=>C.every(D=>t.get(D,"isActivated",!0)),"checkAllKeysActivated"),m=i(C=>C.length?C.every(D=>!t.get(D,"isActivated",!0)):!1,"checkAllKeysDeactivated"),f=i((C,D)=>{let B=C.filter(se=>t.get(se,"isActivated",!0)).map(D),H=C.filter(se=>!t.get(se,"isActivated",!0)).map(D);return{activatedItems:B,deactivatedItems:H}},"divideIntoActivatedAndDeactivated"),h=i((C,{isActivated:D,isPartOfLine:B,inlineComment:H="--"})=>C?D!==!1?C:B?"/* "+C+" */":C.includes(`
`)?`/*
`+C+` */
`:H+" "+C:"","commentIfDeactivated"),T=i((C,D="'",B="'")=>{let H=C[0];return C[C.length-1]===D&&H===B?C:`${D}${C}${B}`},"wrap"),_=i((C,D)=>D.some(B=>(C==null?void 0:C.oldField[B])!==(C==null?void 0:C.newField[B])),"checkFieldPropertiesChanged"),y=i(C=>{let D={...C,...t.omit(C==null?void 0:C.role,"properties")||{}},B=r(D),H=A({collection:D});return G(B,H)},"getFullTableName"),A=i(({collection:C})=>{var D;return(D=C.compMod)==null?void 0:D.keyspaceName},"getSchemaNameFromCollection"),S=i((C,D)=>`${y(C)}.${P(D)}`,"getFullColumnName"),I=i(C=>{var se;let D={...C,...t.omit(C==null?void 0:C.role,"properties")||{}},B=n(D),H=(se=D.compMod)==null?void 0:se.keyspaceName;return G(B,H)},"getFullViewName"),v=i(C=>C.code||C.name,"getUdtName"),w=i((C="")=>{let D=C.match(/\d+/);return Number(t.get(D,[0],0))},"getDbVersion"),$=i((C="")=>C.replace(zh,D=>`\\${D}`),"prepareComment"),b=i(C=>`E'${$(JSON.stringify(C)).slice(1,-1)}'`,"wrapComment"),q=i(C=>t.map(C,D=>{let B=D.defaultExpression?`DEFAULT ${D.defaultExpression}`:"";return t.trim(`${D.argumentMode} ${D.argumentName||""} ${D.argumentType} ${B}`)}).join(", "),"getFunctionArguments"),G=i((C,D)=>D?`${P(D)}.${P(C)}`:P(C),"getNamePrefixedWithSchemaName"),P=i(C=>/\s|\W/.test(C)||t.includes(jh,t.toUpper(C))?`"${C}"`:C,"wrapInQuotes"),z=i(({name:C})=>P(C),"columnMapToString"),Ae=i((C,D,B,H=z)=>{var Re;let se=f(C,H),qe=(Re=se==null?void 0:se.deactivatedItems)!=null&&Re.length?h(se.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!D&&B?" ("+se.activatedItems.join(", ")+qe+")":" ("+C.map(H).join(", ")+")"},"getColumnsList"),le=i(C=>C?C.alias?`${P(C.name)} as ${P(C.alias)}`:P(C.name):"","getKeyWithAlias");return{getDbName:e,getDbData:s,getEntityName:r,getViewName:n,getViewOn:a,tab:o,hasType:c,clean:d,checkAllKeysActivated:p,checkAllKeysDeactivated:m,divideIntoActivatedAndDeactivated:f,commentIfDeactivated:h,wrap:T,checkFieldPropertiesChanged:_,getFullTableName:y,getFullColumnName:S,getFullViewName:I,getUdtName:v,getDbVersion:w,wrapComment:b,getFunctionArguments:q,getNamePrefixedWithSchemaName:G,wrapInQuotes:P,getColumnsList:Ae,getViewData:i(C=>Array.isArray(C)?C.reduce((D,B)=>{if(!B.tableName)return D.columns.push(le(B)),D;let H=`${P(B.dbName)}.${P(B.tableName)}`;return D.tables.includes(H)||D.tables.push(H),D.columns.push({statement:`${H}.${le(B)}`,isActivated:B.isActivated}),D},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getSchemaOfAlterCollection:u,getFullCollectionName:l,getSchemaNameFromCollection:A,getGroupItemsByCompMode:i(({newItems:C=[],oldItems:D=[]})=>{let B=C.filter(qe=>!D.some(Re=>Re.id===qe.id)),H=[],se=[];return D.forEach(qe=>{let Re=C.find(cr=>cr.id===qe.id);Re?t.isEqual(Re,qe)||se.push(Re):H.push(qe)}),{added:B,removed:H,modified:se}},"getGroupItemsByCompMode")}}});var uc=N((iS,cc)=>{"use strict";var{AlterScriptDto:ac}=re(),oc=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),Xh=i((t,e)=>r=>{let{wrapComment:n,wrapInQuotes:s}=L()(t),a=oc(r);if(a.new&&a.new!==a.old){let o=n(a.new),c=s(r.role.name),u=e.updateSchemaComment(c,o);return ac.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),Zh=i((t,e)=>r=>{let{wrapInQuotes:n}=L()(t),s=oc(r);if(s.old&&!s.new){let a=n(r.role.name),o=e.dropSchemaComment(a);return ac.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),Jh=i((t,e)=>r=>{let n=Xh(t,e)(r),s=Zh(t,e)(r);return[n,s].filter(Boolean)},"getModifySchemaCommentsScriptDtos");cc.exports={getModifySchemaCommentsScriptDtos:Jh}});var pc=N((oS,lc)=>{"use strict";lc.exports={number:"numeric",string:"text",date:"date",timestamp:"timestamp",binary:"bytea",boolean:"boolean",document:"jsonb",array:"jsonb",objectId:"uuid",default:"char"}});var dc=N((cS,mc)=>{"use strict";mc.exports={char:{size:1},varchar:{mode:"varying"},text:{mode:"text"},bit:{size:1,mode:"bit"},varbit:{size:1,mode:"varying"},tsvector:{mode:"text"},tsquery:{mode:"text"},smallint:{capacity:2},integer:{capacity:4},bigint:{capacity:8},numeric:{capacity:12,mode:"decimal"},real:{capacity:4,mode:"floating"},"double precision":{capacity:8,mode:"floating"},smallserial:{capacity:2},serial:{capacity:4},bigserial:{capacity:8},money:{capacity:8,mode:"decimal"},bytea:{size:4,mode:"binary"},date:{format:"YYYY-MM-DD"},time:{format:"hh:mm:ss.nnnnnn"},timestamp:{format:"YYYY-MM-DD hh:mm:ss"},interval:{format:"PnYnMnDTnHnMnS"},boolean:{mode:"boolean"},int4range:{mode:"range",modeType:"integer",capacity:4},int8range:{mode:"range",modeType:"integer",capacity:8},numrange:{mode:"range",modeType:"decimal",capacity:12},daterange:{mode:"range",modeType:"date",format:"YYYY-MM-DD"},tsrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},int4multirange:{mode:"multirange",modeType:"integer",capacity:4},int8multirange:{mode:"multirange",modeType:"integer",capacity:8},nummultirange:{mode:"multirange",modeType:"decimal",capacity:12},datemultirange:{mode:"multirange",modeType:"date",format:"YYYY-MM-DD"},tsmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},geometry:{format:"euclidian",mode:"geospatial"},geography:{format:"euclidian",mode:"geospatial"},box2d:{format:"euclidian",mode:"geospatial"},box3d:{format:"euclidian",mode:"geospatial"},geometry_dump:{format:"euclidian",mode:"geospatial"},point:{format:"euclidian",mode:"geospatial"},line:{format:"euclidian",mode:"geospatial"},lseg:{format:"euclidian",mode:"geospatial"},box:{format:"euclidian",mode:"geospatial"},path:{format:"euclidian",mode:"geospatial"},polygon:{format:"euclidian",mode:"geospatial"},circle:{format:"euclidian",mode:"geospatial"},inet:{mode:"ip"},cidr:{mode:"ip"},macaddr:{},macaddr8:{},uuid:{mode:"uuid"},oid:{mode:"uuid"},regclass:{},regcollation:{},regconfig:{},regdictionary:{},regnamespace:{},regoper:{},regoperator:{},regproc:{},regprocedure:{},regrole:{},regtype:{},xml:{mode:"xml"},json:{format:"semi-structured"},jsonb:{format:"semi-structured"},composite:{format:"semi-structured",mode:"object"},enum:{mode:"enum"},range_udt:{mode:"range"},domain:{mode:"domain"}}});var hc=N((uS,fc)=>{"use strict";fc.exports={createDatabase:"CREATE DATABASE ${name}${template}${encoding}${locale}${collate}${characterClassification}${tablespace};\n",createSchema:"CREATE SCHEMA${ifNotExist} ${name};\nSET search_path TO ${name};\n\n${comment}\n",comment:"COMMENT ON ${object} ${objectName} IS ${comment};\n",createTable:"CREATE${temporary} TABLE${ifNotExist} ${name} (\n${columnDefinitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options};\n\n${comment}${columnDescriptions}",createTablePartitionOf:"CREATE${temporary} TABLE${ifNotExist} ${name}\n${partitionOf} ${openParenthesis}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n${closeParenthesis}${options};\n\n${comment}${columnDescriptions}",generatedColumnClause:" GENERATED ALWAYS AS (${generationExpression}) STORED",columnDefinition:"${name} ${type}${collation}${generatedColumnClause}${primaryKey}${uniqueKey}${defaultValue}${notNull}",checkConstraint:"${name} CHECK (${expression})${noInherit}",createForeignKeyConstraint:"${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable} (${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime}",createKeyConstraint:"${constraintName}${keyType}${columns}${includeNonKey}${storageParameters}${tablespace}${deferrable}${deferrableConstraintCheckTime}",alterColumnType:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DATA TYPE ${dataType};",addNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET NOT NULL;",dropNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP NOT NULL;",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldColumnName} TO ${newColumnName};",addCheckConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",dropConstraint:"ALTER TABLE IF EXISTS ${tableName} DROP CONSTRAINT IF EXISTS ${constraintName};",createForeignKey:"ALTER TABLE IF EXISTS ${foreignTable} ADD CONSTRAINT ${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime};",dropForeignKey:"ALTER TABLE ${tableName} DROP CONSTRAINT ${fkConstraintName};",addPkConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD ${constraintStatement};",dropTable:"DROP TABLE IF EXISTS ${tableName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",dropDomain:"DROP DOMAIN IF EXISTS ${udtName};",dropType:"DROP TYPE IF EXISTS ${udtName};",alterTypeAddAttribute:"ALTER TYPE ${udtName} ADD ATTRIBUTE ${columnDefinition};",alterTypeDropAttribute:"ALTER TYPE ${udtName} DROP ATTRIBUTE IF EXISTS ${attributeName};",alterTypeRenameAttribute:"ALTER TYPE ${udtName} RENAME ATTRIBUTE ${oldAttributeName} TO ${newAttributeName};",alterTypeChangeAttributeType:"ALTER TYPE ${udtName} ALTER ATTRIBUTE ${attributeName} SET DATA TYPE ${newDataType};",updateCommentOnTable:"COMMENT ON TABLE ${tableName} IS ${comment};",updateCommentOnColumn:"COMMENT ON COLUMN ${columnName} IS ${comment};",updateCommentOnSchema:"COMMENT ON SCHEMA ${schemaName} IS ${comment};",updateCommentOnView:"COMMENT ON VIEW ${viewName} IS ${comment};",createSchemaOnly:"CREATE SCHEMA IF NOT EXISTS ${schemaName};",dropSchema:"DROP SCHEMA IF EXISTS ${schemaName};",index:"CREATE${unique} INDEX${concurrently}${ifNotExist} ${name}\n ON${only} ${tableName}${using}${keys}${nullsDistinct}${options};\n",dropIndex:"DROP INDEX IF EXISTS ${indexName};\n",alterIndexRename:"ALTER INDEX IF EXISTS ${oldIndexName} RENAME TO ${newIndexName};\n",alterIndexTablespace:"ALTER INDEX IF EXISTS ${indexName} SET TABLESPACE ${tablespaceName};\n",alterIndexStorageParams:`ALTER INDEX IF EXISTS \${indexName} SET (
	\${options}
);
`,reindexIndex:"REINDEX INDEX ${indexName};\n",createView:"CREATE${orReplace}${temporary} VIEW ${name}${withOptions}\nAS ${selectStatement}${checkOption};\n\n${comment}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",dropView:"DROP VIEW IF EXISTS ${viewName};",createFunction:"CREATE${orReplace} FUNCTION ${name}\n	(${parameters})\n	RETURNS ${returnType}\n	LANGUAGE ${language}\n${properties}AS $BODY$\n${definition}\n$BODY$;\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name} (${parameters})\n	LANGUAGE ${language}\nAS $BODY$\n${body}\n$BODY$;\n",createCompositeType:`CREATE TYPE \${name} AS (
	\${columnDefinitions}
);

\${comment}`,createEnumType:"CREATE TYPE ${name} AS ENUM (${values});\n\n${comment}",createRangeType:"CREATE TYPE ${name} AS RANGE (\n	SUBTYPE=${subtype}${options}\n);\n\n${comment}",createDomainType:"CREATE DOMAIN ${name} AS ${underlyingType}${notNull}${collate}${default}${constraints};\n\n${comment}",createTrigger:"CREATE${orReplace}${constraint} TRIGGER ${name} ${actionTiming} ${events}\n	ON ${tableName}\n${options}	EXECUTE ${functionKey} ${functionName};\n",createSequence:"CREATE${sequenceType} SEQUENCE${ifNotExists} ${name}${options};\n",dropSequence:"DROP SEQUENCE IF EXISTS ${name};\n",renameSequence:"ALTER SEQUENCE IF EXISTS ${name} RENAME TO ${newName};\n",setSequenceType:"ALTER SEQUENCE IF EXISTS ${name} SET ${sequenceType};\n",alterSequence:"ALTER SEQUENCE IF EXISTS ${name}${options};\n"}});var _c=N((lS,yc)=>{"use strict";var gc=i((t="")=>new RegExp("\\$\\{(.*?)\\}",t),"template"),eg=i(t=>t.match(gc("gi"))||[],"getAllTemplates"),tg=i(t=>(t.match(gc("i"))||[])[1],"parseTemplate"),rg=i((t,e)=>eg(t).reduce((r,n)=>{let s=tg(n);return r.replace(n,()=>e[s]||e[s]===0?e[s]:"")},t),"assignTemplates");yc.exports=rg});var Tc=N((mS,Ec)=>{"use strict";Ec.exports=({_:t,commentIfDeactivated:e,checkAllKeysDeactivated:r,assignTemplates:n,wrapInQuotes:s,getColumnsList:a})=>({generateConstraintsString:i((m,f)=>{var y,A;let h=e(((m==null?void 0:m.deactivatedItems)||[]).join(`,
	`),{isActivated:!f,isPartOfLine:!0}),T=(y=m==null?void 0:m.activatedItems)!=null&&y.length?`,
	`+m.activatedItems.join(`,
	`):"",_=(A=m==null?void 0:m.deactivatedItems)!=null&&A.length?`
	`+h:"";return T+_},"generateConstraintsString"),foreignKeysToString:i(m=>{if(Array.isArray(m)){let f=m.filter(_=>t.get(_,"isActivated",!0)).map(_=>s(t.trim(_.name))),h=m.filter(_=>!t.get(_,"isActivated",!0)).map(_=>s(t.trim(_.name))),T=h.length?e(h,{isActivated:!1,isPartOfLine:!0}):"";return f.join(", ")+T}return m},"foreignKeysToString"),foreignActiveKeysToString:i(m=>m.map(f=>t.trim(f.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:i((m,f)=>h=>{let T=s(t.trim(h.name)),_=r(h.columns||[]),y=t.isEmpty(h.columns)?"":a(h.columns,_,f),A=h.include.length?` INCLUDE${a(h.include,_,f)}`:"",S=h.storageParameters?` WITH (${h.storageParameters})`:"",I=h.tablespace?` USING INDEX TABLESPACE ${s(h.tablespace)}`:"",v=h!=null&&h.deferrable?` ${h.deferrable}`:"",w=(h==null?void 0:h.deferrable)==="DEFERRABLE"&&(h!=null&&h.deferrableConstraintCheckTime)?` ${h==null?void 0:h.deferrableConstraintCheckTime}`:"";return{statement:n(m.createKeyConstraint,{constraintName:h.name?`CONSTRAINT ${T} `:"",keyType:h.keyType,columns:y,includeNonKey:A,storageParameters:S,tablespace:I,deferrable:v,deferrableConstraintCheckTime:w}),isActivated:!_}},"createKeyConstraint"),getConstraintsWarnings:i((m=[])=>t.isEmpty(m)?"":`
	`+m.map(f=>{let h=f.name?` [constraint name: ${f.name}]`:"";return`-- ${f.errorMessage}${h}`}).join(`
	`),"getConstraintsWarnings"),additionalPropertiesForForeignKey:i(m=>{let f=t.get(m,"relationshipOnDelete",""),h=t.get(m,"relationshipOnUpdate",""),T=t.get(m,"relationshipMatch",""),_=t.get(m,"deferrable",""),y=t.get(m,"deferrableConstraintCheckTime","");return{foreignOnDelete:f,foreignOnUpdate:h,foreignMatch:T,deferrable:_,deferrableConstraintCheckTime:y}},"additionalPropertiesForForeignKey")})});var Zt=N((fS,Sc)=>{"use strict";Sc.exports=(t,e)=>{let r=i((_,y)=>Object.entries(_.properties).map(y),"mapProperties"),n=i(_=>_.compositeUniqueKey?!1:!!_.unique,"isUniqueKey"),s=i(_=>{var y,A;return n(_)&&(((y=_.uniqueKeyOptions)==null?void 0:y.length)===1&&!((A=t.first(_.uniqueKeyOptions))!=null&&A.constraintName)||t.isEmpty(_.uniqueKeyOptions))},"isInlineUnique"),a=i(_=>_.compositeUniqueKey||_.compositePrimaryKey?!1:!!_.primaryKey,"isPrimaryKey"),o=i(_=>{var y;return a(_)&&!((y=t.first(_.primaryKeyOptions))!=null&&y.constraintName)},"isInlinePrimaryKey"),c=i((_,y)=>{let A=_.nullsDistinct;return`UNIQUE${y>=15&&A?` ${A}`:""}`},"getUniqueKeyType"),u=i(({options:_,columnName:y,isActivated:A,jsonSchema:S,dbVersion:I})=>e({keyType:c(_,I),name:_.constraintName,columns:[{name:y,isActivated:A}],include:m(_.indexInclude||[],S),storageParameters:_.indexStorageParameters,comment:_.indexComment,tablespace:_.indexTablespace,nullsDistinct:_.nullsDistinct,deferrable:_.deferrable,deferrableConstraintCheckTime:_.deferrableConstraintCheckTime}),"hydrateUniqueOptions"),l=i((_,y,A,S)=>e({keyType:"PRIMARY KEY",name:_.constraintName,columns:[{name:y,isActivated:A}],include:m(_.indexInclude||[],S),storageParameters:_.indexStorageParameters,comment:_.indexComment,tablespace:_.indexTablespace,deferrable:_.deferrable,deferrableConstraintCheckTime:_.deferrableConstraintCheckTime}),"hydratePrimaryKeyOptions"),d=i((_,y)=>Object.keys(y).find(A=>y[A].GUID===_),"findName"),p=i((_,y)=>t.get(Object.values(y).find(A=>A.GUID===_),"isActivated",!0),"checkIfActivated"),m=i((_,y)=>t.map(_,A=>({name:d(A.keyId,y.properties),isActivated:p(A.keyId,y.properties)})),"getKeys"),f=i(_=>Array.isArray(_.primaryKey)?_.primaryKey.map(y=>t.isEmpty(y.compositePrimaryKey)?{name:y.constraintName,errorMessage:"A primary key constraint cannot be created without any primary key selected"}:{...l(y,null,null,_),columns:m(y.compositePrimaryKey,_)}):[],"getCompositePrimaryKeys"),h=i((_,y)=>Array.isArray(_.uniqueKey)?_.uniqueKey.map(A=>t.isEmpty(A.compositeUniqueKey)?{name:A.constraintName,errorMessage:"A unique key constraint cannot be created without any unique key selected"}:{...u({options:A,columnName:null,isActivated:null,jsonSchema:_,dbVersion:y}),columns:m(A.compositeUniqueKey,_)}):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i((_,y)=>{if(!_.properties)return[];let A=r(_,([I,v])=>{if(!(!a(v)||o(v)))return l(t.first(v.primaryKeyOptions),I,v.isActivated,_)}).filter(Boolean),S=t.flatten(r(_,([I,v])=>!n(v)||s(v)?[]:(v.uniqueKeyOptions||[]).map(w=>u({options:w,columnName:I,isActivated:v.isActivated,jsonSchema:_,dbVersion:y})))).filter(Boolean);return[...A,...f(_),...S,...h(_,y)]},"getTableKeyConstraints"),isInlineUnique:s,isInlinePrimaryKey:o,getKeys:m,hydratePrimaryKeyOptions:l,hydrateUniqueOptions:u,getUniqueKeyType:c}}});var Ac=N((gS,Cc)=>{"use strict";Cc.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=i((S,I)=>t.map(I,v=>{let w=v.functionOrReplace?" OR REPLACE":"",$=r(e.createFunction,{name:s(v.name,S),orReplace:w,parameters:n(v.functionArguments),returnType:v.functionReturnsSetOf?`SETOF ${v.functionReturnType}`:v.functionReturnType,language:v.functionLanguage,properties:c(v),definition:v.functionBody}),b=v.functionDescription?r(e.comment,{object:"FUNCTION",objectName:s(v.name,S),comment:a(v.functionDescription)}):"";return[$,b].filter(Boolean).join(`
`)}).join(`
`),"getFunctionsScript"),c=i(S=>{let I=i(v=>v?`	${v}
`:"","wrap");return[{key:"functionWindow",getValue:u},{key:"functionVolatility",getValue:l},{key:"functionLeakProof",getValue:d},{key:"functionNullArgs",getValue:p},{key:"functionSqlSecurity",getValue:m},{key:"functionParallel",getValue:f},{key:"functionExecutionCost",getValue:h},{key:"functionExecutionRows",getValue:T},{key:"functionSupportFunction",getValue:_},{key:"functionConfigurationParameters",getValue:y}].map(v=>I(v.getValue(S[v.key],S))).filter(Boolean).join("")},"getProperties"),u=i((S,I)=>I.language!=="c"||!S?"":"WINDOW","getWindow"),l=i(S=>S,"getVolatility"),d=i(S=>S?"LEAKPROOF":"NOT LEAKPROOF","getLeakProof"),p=i(S=>S,"getNullArgs"),m=i(S=>{if(S)return`SECURITY ${S}`},"getSqlSecurity"),f=i(S=>{if(S)return`PARALLEL ${S}`},"getParallel"),h=i(S=>{if(S)return`COST ${S}`},"getExecutionCost"),T=i((S,I)=>!S||!I.functionReturnsSetOf&&!A(I)?"":`ROWS ${S}`,"getExecutionRows"),_=i(S=>{if(S)return`SUPPORT ${S}`},"getSupportFunction"),y=i(S=>{if(S)return`SET ${S}`},"getConfigurationParameters"),A=i(S=>(S.functionReturnType||"").trim().toUpperCase().startsWith("TABLE"),"isFunctionReturnsTable");return{getFunctionsScript:o}}});var bc=N((_S,Nc)=>{"use strict";Nc.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s})=>({getProceduresScript:i((o,c)=>t.map(c,u=>{let l=u.orReplace?" OR REPLACE":"";return r(e.createProcedure,{name:s(u.name,o),orReplace:l,parameters:n(u.inputArgs),language:u.language,body:u.body})}).join(`
`),"getProceduresScript")})});var vc=N((SS,Ic)=>{"use strict";var{Sequence:TS}=jt();Ic.exports=({_:t,templates:e,assignTemplates:r,getNamePrefixedWithSchemaName:n,wrapInQuotes:s})=>{let a=i(({schemaName:S,sequences:I})=>t.map(I,v=>o({schemaName:S,sequence:v})).join(`
`),"getSequencesScript"),o=i(({schemaName:S,sequence:I})=>{let v=I.temporary?"":S,w=n(I.sequenceName,v),$=f({sequence:I}),b=h({sequence:I}),q=l({sequence:I,schemaName:S});return r(e.createSequence,{name:w,ifNotExists:$,sequenceType:b,options:q})},"createSequenceScript"),c=i(({schemaName:S,sequence:I,oldSequence:v})=>{let w=I.temporary?"":S,$=v.sequenceName||I.sequenceName,b=n($,w),q=A({sequence:I,oldSequence:v}),G=l({schemaName:S,sequence:q}),P=T({sequence:q}),z=q.sequenceName;return[{key:"options",value:G,template:e.alterSequence},{key:"sequenceType",value:P,template:e.setSequenceType},{key:"newName",value:z,template:e.renameSequence}].filter(le=>le.value).map(le=>r(le.template,{[le.key]:le.value,name:b})).join(`
`)},"alterSequenceScript"),u=i(({schemaName:S,sequence:I})=>{let v=I.temporary?"":S,w=n(I.sequenceName,v);return r(e.dropSequence,{name:w})},"dropSequenceScript"),l=i(({schemaName:S,sequence:I})=>{let w=[{getOption:d,key:"dataType",clause:"AS"},{getOption:d,key:"increment",clause:"INCREMENT BY"},{getOption:d,key:"start",clause:"START WITH"},{getOption:d,key:"restart",clause:"RESTART WITH"},{getOption:d,key:"minValue",clause:"MINVALUE"},{getOption:d,key:"maxValue",clause:"MAXVALUE"},{getOption:d,key:"cache",clause:"CACHE"},{getOption:_,key:"cycle"},{getOption:y,key:"ownedByColumn"}].map($=>{let b=$.getOption({sequence:I,schemaName:S,config:$});return p({option:b})}).filter(Boolean).join("");return w&&m({options:w})},"getSequenceOptions"),d=i(({sequence:S,config:I})=>{let v=S[I.key];return v||v===0?`${I.clause} ${v}`:""},"getOption"),p=i(({option:S})=>S?`	${S}
`:"","wrapOption"),m=i(({options:S})=>`
`+S.replace(/\n$/,""),"wrapOptionsBlock"),f=i(({sequence:S})=>S.ifNotExist?" IF NOT EXISTS":"","getIfNotExists"),h=i(({sequence:S})=>S.temporary?" TEMPORARY":S.unlogged?" UNLOGGED":"","getSequenceType"),T=i(({sequence:S})=>S.temporary?"":S.unlogged===!0?"UNLOGGED":S.unlogged===!1?"LOGGED":"","getAlterSequenceType"),_=i(({sequence:S})=>S.cycle===!0?"CYCLE":S.cycle===!1?"NO CYCLE":"","getCycle"),y=i(({sequence:S,schemaName:I})=>{var w,$;if(S.ownedByNone)return"OWNED BY NONE";let v=(w=S.ownedByColumn)==null?void 0:w[0];if(v){let[b,q]=(($=v.name)==null?void 0:$.split("."))||[];return`OWNED BY ${[I,b,q].filter(Boolean).map(s).join(".")}`}return""},"getOwnedBy"),A=i(({sequence:S,oldSequence:I})=>{let v=t.omitBy(S,(w,$)=>t.isEqual(w,I[$]));return S.minValue>I.minValue?{...v,restart:S.start}:v},"getModifiedSequence");return{getSequencesScript:a,createSequenceScript:o,dropSequenceScript:u,alterSequenceScript:c}}});var Rc=N((AS,Oc)=>{"use strict";Oc.exports=({_:t,getColumnsList:e,checkAllKeysDeactivated:r})=>{let n=i((p,m)=>p?" TEMPORARY":m?" UNLOGGED":"","getTableTemporaryValue"),s=i(p=>{let m=i(h=>h?`${h}
`:"","wrap"),f=[{key:"inherits",getValue:u("INHERITS")},{key:"partitionBounds",getValue:u("")},{key:"partitioning",getValue:a},{key:"usingMethod",getValue:u("USING")},{key:"storage_parameter",getValue:d},{key:"on_commit",getValue:c},{key:"table_tablespace_name",getValue:u("TABLESPACE")},{key:"selectStatement",getValue:u("AS")}].map(h=>m(h.getValue(p[h.key],p))).filter(Boolean).join("");return t.trim(f)?` ${t.trim(f)}`:""},"getTableOptions"),a=i((p,{isActivated:m})=>{if(p&&p.partitionMethod){let f=p.partitionBy==="keys"?o(p,m):` (${p.partitioning_expression})`;return`PARTITION BY ${p.partitionMethod}${f}`}},"getPartitioning"),o=i((p,m)=>{let f=r(p.compositePartitionKey);return e(p.compositePartitionKey,f,m)},"getPartitionKeys"),c=i((p,m)=>{if(p&&m.temporary)return`ON COMMIT ${p}`},"getOnCommit"),u=i(p=>m=>{if(m)return`${p} ${m}`},"getBasicValue"),l=["toast_autovacuum_enabled","toast_vacuum_index_cleanup","toast_vacuum_truncate","toast_autovacuum_vacuum_threshold","toast_autovacuum_vacuum_scale_factor","toast_autovacuum_vacuum_insert_threshold","toast_autovacuum_vacuum_insert_scale_factor","toast_autovacuum_vacuum_cost_delay","toast_autovacuum_vacuum_cost_limit","toast_autovacuum_freeze_min_age","toast_autovacuum_freeze_max_age","toast_autovacuum_freeze_table_age","toast_autovacuum_multixact_freeze_min_age","toast_autovacuum_multixact_freeze_max_age","toast_autovacuum_multixact_freeze_table_age","toast_log_autovacuum_min_duration"],d=i(p=>{if(t.isEmpty(p))return"";let m=["autovacuum","toast","id"];return t.chain(p).toPairs().flatMap(([f,h])=>f==="autovacuum"||f==="toast"?t.toPairs(h):[[f,h]]).reject(([f])=>t.includes(m,f)).map(([f,h])=>{if(!(!h&&h!==0))return t.includes(l,f)?`toast.${f.slice(6)}=${h}`:`${f}=${h}`}).compact().join(`,
	`).trim().thru(f=>{if(f)return`WITH (
	${f}
)`}).value()},"getStorageParameters");return{getTableTemporaryValue:n,getTableOptions:s}}});var qc=N((bS,wc)=>{"use strict";wc.exports=({_:t,commentIfDeactivated:e,assignTemplates:r,templates:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=["composite","enum","range_udt","domain"],c=i((f,h)=>{let T=s(f.name,f.schemaName),_=r(n.comment,{object:"TYPE",objectName:T,comment:a(f.comment)});switch(f.type){case"composite":return r(n.createCompositeType,{name:T,columnDefinitions:t.join(h,`,
	`),comment:f.comment?_:""});case"enum":return r(n.createEnumType,{name:T,values:t.map(f.enum,y=>`'${y}'`).join(", "),comment:f.comment?_:""});case"range_udt":return r(n.createRangeType,{name:T,subtype:f.rangeSubtype,options:l(f),comment:f.comment?_:""});case"domain":{let y=r(n.comment,{object:"DOMAIN",objectName:T,comment:a(f.comment)});return r(n.createDomainType,{name:T,underlyingType:f.underlyingType,notNull:f.nullable?"":" NOT NULL",collate:f.collation?`
	COLLATE ${f.collation}`:"",default:f.default?`
	DEFAULT ${f.default}`:"",constraints:d(f),comment:f.comment?y:""})}default:return""}},"getPlainUdt"),u=i(f=>o.includes(f.type),"isNotPlainType"),l=i(f=>{let h=i(_=>_?`	${_}`:"","wrap"),T=[{key:"operatorClass",getValue:p("SUBTYPE_OPCLASS")},{key:"collation",getValue:p("COLLATION")},{key:"canonicalFunction",getValue:p("CANONICAL")},{key:"subtypeDiffFunction",getValue:p("SUBTYPE_DIFF")},{key:"multiRangeType",getValue:p("MULTIRANGE_TYPE_NAME")}].map(_=>h(_.getValue(f[_.key]))).filter(Boolean).join(`,
`);return t.trim(T)?`,
	`+t.trim(T):""},"getRangeOptions"),d=i(f=>t.map(f.checkConstraints,h=>h.name?`
	CONSTRAINT ${h.name} CHECK (${h.expression})`:`
	CHECK (${h.expression})`).join(""),"getDomainConstraints"),p=i(f=>h=>{if(h)return`${f}=${h}`},"getBasicValue");return{getUserDefinedType:i((f,h)=>e(c(f,h),{isActivated:f.isActivated}),"getUserDefinedType"),isNotPlainType:u}}});var xc=N((vS,Dc)=>{"use strict";Dc.exports=({_:t,wrapInQuotes:e,checkAllKeysDeactivated:r,getColumnsList:n})=>{let s=i(({name:d,sortOrder:p,nullsOrder:m,collation:f,opclass:h})=>{let T=p?` ${p}`:"",_=m?` ${m}`:"",y=t.includes(f,'"')?f:`"${f}"`,A=f?` COLLATE ${y}`:"",S=h?` ${h}`:"";return`${e(d)}${A}${S}${T}${_}`},"mapIndexKey"),a=i((d=[],p)=>{let m=r(d);return n(d,m,p,s)},"getIndexKeys"),o=i((d,p)=>{var A;let m=n(d.include||[],r(d.include||[]),p),f=(A=d.include)!=null&&A.length?` INCLUDE ${t.trim(m)}`:"",h=u(d),T=h?` WITH (
	${h})`:"",_=d.index_tablespace_name?` TABLESPACE ${d.index_tablespace_name}`:"",y=d.where?` WHERE ${d.where}`:"";return t.compact([" ",f,T,_,y]).join(`
`)},"getIndexOptions"),c={btree:{index_fillfactor:"fillfactor",deduplicate_items:"deduplicate_items"},hash:{index_fillfactor:"fillfactor"},spgist:{index_fillfactor:"fillfactor"},gist:{index_fillfactor:"fillfactor",index_buffering:"buffering"},gin:{fastupdate:"fastupdate",gin_pending_list_limit:"gin_pending_list_limit"},brin:{pages_per_range:"pages_per_range",autosummarize:"autosummarize"}},u=i(d=>{let p=c[d.index_method];return t.chain(p).toPairs().map(([m,f])=>{let h=(d.index_storage_parameter||{})[m];if(!(t.isNil(h)||h===""))return`${f}=${l(h)}`}).compact().join(`,
	`).value()},"getWithOptions"),l=i(d=>t.isBoolean(d)?d?"ON":"OFF":d,"getValue");return{getIndexKeys:a,getIndexOptions:o,getWithOptions:u}}});var Lc=N((RS,Pc)=>{"use strict";Pc.exports=({_:t,assignTemplates:e,templates:r,commentIfDeactivated:n,wrapComment:s,wrapInQuotes:a})=>{let o=i((b,q)=>`${b}(${q})`,"addLength"),c=i((b,q,G)=>t.isNumber(G)?`${b}(${q},${G})`:`${b}(${q})`,"addScalePrecision"),u=i((b,q)=>t.isNumber(q)?`${b}(${q})`:b,"addPrecision"),l=i((b,q)=>q?`${b} ${q}`:b,"addWithTimezone"),d=i(({type:b,typeModifier:q,srid:G})=>{let P=G?`, ${G}`:"";return q&&q!==""?`${b}(${q}${P})`:b},"addTypeModifier"),p=i((b,q)=>{let G=(q==null?void 0:q.map(P=>`[${(P==null?void 0:P.array_size_limit)??""}]`).join("").trim())||"";return`${b}${G}`},"addArrayDecorator"),m=i(b=>["char","varchar","bit","varbit"].includes(b),"canHaveLength"),f=i(b=>b==="numeric","canHavePrecision"),h=i(b=>["time","timestamp"].includes(b),"canHaveTimePrecision"),T=i(b=>b==="numeric","canHaveScale"),_=i(b=>["geography","geometry"].includes(b),"canHaveTypeModifier"),y=i((b,q)=>(m(b)&&t.isNumber(q.length)?b=o(b,q.length):f(b)&&T(b)&&t.isNumber(q.precision)?b=c(b,q.precision,q.scale):f(b)&&t.isNumber(q.precision)?b=u(b,q.precision):_(b)?b=d({type:b,typeModifier:q.typeModifier,srid:q.srid}):h(b)&&(t.isNumber(q.timePrecision)||q.timezone)&&(b=l(u(b,q.timePrecision),q.timezone)),p(b,q.array_type)),"decorateType"),A=i(b=>["char","varchar","text","bit","varbit"].includes(b),"isString"),S=i(b=>["date","time","timestamp","interval"].includes(b),"isDateTime"),I=i((b,q,G)=>{let P=["current_timestamp","null"];return(A(b)||S(b))&&!P.includes(t.toLower(q))&&!G?s(q):q},"decorateDefault"),v=i((b,q)=>t.chain(q).filter("comment").map(G=>{let P=e(r.comment,{object:"COLUMN",objectName:`${b}.${a(G.name)}`,comment:s(G.comment)});return n(P,G)}).join(`
`).value(),"getColumnComments"),w={"v13.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v12.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v11.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"},"v10.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"}};return{decorateType:y,decorateDefault:I,getColumnComments:v,replaceTypeByVersion:i((b,q)=>{let G=w[q];return t.get(G,b)||b},"replaceTypeByVersion")}}});var Fc=N((qS,Mc)=>{"use strict";Mc.exports=({_:t,assignTemplates:e,templates:r,getNamePrefixedWithSchemaName:n,wrap:s,commentIfDeactivated:a})=>{let o=i(({dbVersion:p,triggers:m,tableName:f})=>t.map(m,c(p,f)).join(`
`).trim(),"getTriggersScript"),c=i((p,m)=>f=>{let h=u(f),T=l(f);return e(r.createTrigger,{orReplace:f.triggerOrReplace?" OR REPLACE":"",constraint:f.triggerConstraint?" CONSTRAINT":"",actionTiming:f.triggerType??"",functionKey:p==="v10.x"?"PROCEDURE":"FUNCTION",functionName:f.triggerFunction,name:f.name,tableName:m,events:h,options:T})},"getTriggerScript"),u=i(p=>{var m;return(m=p.triggerEvents)==null?void 0:m.map(f=>{if(f.triggerEvent!=="UPDATE"||t.isEmpty(p.triggerUpdateColumns))return f.triggerEvent;let h=t.chain(p.triggerUpdateColumns).filter("isActivated").map(({name:y})=>y).join(", ").thru(y=>y&&`OF ${y}`).value(),T=t.chain(p.triggerUpdateColumns).reject("isActivated").map(({name:y})=>y).join(", ").thru(y=>!h&&y?`OF ${y}`:y).value(),_=T&&a(T,{isActivated:!1,isPartOfLine:!0});return`UPDATE ${h} ${_}`}).join(" OR ")},"getTriggerEvents"),l=i(p=>{let m="";if(p.triggerConstraint&&(p.triggerReferencedTable&&(m+=s(`FROM ${p.triggerReferencedTable}`,"	",`
`)),m+=s(p.triggerDeferrable?"DEFERRABLE":"NOT DEFERRABLE","	",`
`),p.triggerDeferrable&&p.triggerTimeConstraintCheck&&(m+=s(p.triggerTimeConstraintCheck,"	",`
`))),p.triggerReferencing){let f="REFERENCING";p.triggerBeforeImageTransitionRelation&&(f+=` OLD TABLE ${p.triggerBeforeImageTransitionRelation}`),p.triggerAfterImageTransitionRelation&&(f+=` NEW TABLE ${p.triggerAfterImageTransitionRelation}`),m+=s(f,"	",`
`)}return m+=s(p.triggerConstraint||p.triggerType==="INSTEAD OF"?"FOR EACH ROW":p.triggerEachRowStatement||"FOR EACH STATEMENT","	",`
`),p.triggerCondition&&(m+=s(`WHEN ${p.triggerCondition}`,"	",`
`)),m},"getTriggerOptions");return{getTriggersScript:o,hydrateTriggers:i((p,m={})=>{var f;return(((f=t.find(p,"triggers"))==null?void 0:f.triggers)||[]).map(h=>{let T=m[h.triggerReferencedTable];if(!T)return{...h,triggerReferencedTable:""};let _=n(T.code||T.collectionName,T.bucketName);return{...h,triggerReferencedTable:_}})},"hydrateTriggers")}}});var kc=N((xS,Uc)=>{"use strict";Uc.exports=()=>({getLocaleProperties:i(e=>{let r=["v13.x","v14.x","v15.x"].includes(e.dbVersion);return r&&e.locale?{locale:e.locale}:!r&&e.locale?{collate:e.locale,characterClassification:e.locale}:{collate:e.collate,characterClassification:e.characterClassification}},"getLocaleProperties")})});var ne=N((MS,Bc)=>{"use strict";var ng=pc(),$c=dc(),x=hc(),{Sequence:LS}=jt();Bc.exports=(t,e,r)=>{let n=r.require("lodash"),{tab:s,commentIfDeactivated:a,checkAllKeysDeactivated:o,divideIntoActivatedAndDeactivated:c,hasType:u,wrap:l,clean:d,wrapComment:p,getFunctionArguments:m,wrapInQuotes:f,getNamePrefixedWithSchemaName:h,getColumnsList:T,getViewData:_}=L()(n),y=_c(),{generateConstraintsString:A,foreignKeysToString:S,foreignActiveKeysToString:I,createKeyConstraint:v,getConstraintsWarnings:w,additionalPropertiesForForeignKey:$}=Tc()({_:n,commentIfDeactivated:a,checkAllKeysDeactivated:o,assignTemplates:y,getColumnsList:T,wrapInQuotes:f}),b=Zt()(n,d),{getFunctionsScript:q}=Ac()({_:n,templates:x,assignTemplates:y,getFunctionArguments:m,getNamePrefixedWithSchemaName:h,wrapComment:p}),{getProceduresScript:G}=bc()({_:n,templates:x,assignTemplates:y,getFunctionArguments:m,getNamePrefixedWithSchemaName:h}),{getSequencesScript:P,createSequenceScript:z,dropSequenceScript:Ae,alterSequenceScript:le}=vc()({_:n,templates:x,assignTemplates:y,getNamePrefixedWithSchemaName:h,wrapInQuotes:f}),{getTableTemporaryValue:F,getTableOptions:Ne}=Rc()({_:n,checkAllKeysDeactivated:o,getColumnsList:T}),{getUserDefinedType:C,isNotPlainType:D}=qc()({_:n,commentIfDeactivated:a,assignTemplates:y,templates:x,getNamePrefixedWithSchemaName:h,wrapComment:p}),{getIndexKeys:B,getIndexOptions:H,getWithOptions:se}=xc()({_:n,wrapInQuotes:f,checkAllKeysDeactivated:o,getColumnsList:T}),{decorateType:qe,decorateDefault:Re,getColumnComments:cr,replaceTypeByVersion:ol}=Lc()({_:n,wrap:l,assignTemplates:y,templates:x,commentIfDeactivated:a,wrapInQuotes:f,wrapComment:p}),{getTriggersScript:Si,hydrateTriggers:Ci}=Fc()({_:n,wrap:l,assignTemplates:y,templates:x,getNamePrefixedWithSchemaName:h,commentIfDeactivated:a}),{getLocaleProperties:cl}=kc()();return{createDatabase(g){if(!g.databaseName)return"";let{locale:E,collate:O,characterClassification:R}=cl(g);return y(x.createDatabase,{name:f(g.databaseName),template:g.template?`
	TEMPLATE ${g.template}`:"",encoding:g.encoding?`
	ENCODING ${g.encoding}`:"",locale:E?`
	LOCALE '${g.locale}'`:"",collate:O?`
	LC_COLLATE '${g.collate}'`:"",characterClassification:R?`
	LC_CTYPE '${R}'`:"",tablespace:g.tablespace?`
	TABLESPACE '${g.tablespace}'`:""})},createSchema({schemaName:g,ifNotExist:E,comments:O,udfs:R,procedures:K,sequences:X}){let W=y(x.comment,{object:"SCHEMA",objectName:f(g),comment:p(O)}),ee=y(x.createSchema,{name:f(g),ifNotExist:E?" IF NOT EXISTS":"",comment:O?W:""}),ie=q(g,R),oe=G(g,K);return n.chain([ee,ie,oe]).compact().map(n.trim).join(`

`).trim().value()},createTable({name:g,columns:E,checkConstraints:O,foreignKeyConstraints:R,schemaData:K,columnDefinitions:X,keyConstraints:W,inherits:ee,description:ie,ifNotExist:oe,usingMethod:Ee,on_commit:me,partitioning:Z,storage_parameter:be,table_tablespace_name:Ie,temporary:_e,unlogged:ve,selectStatement:De,triggers:we,partitionOf:ce,partitionBounds:xe},Pe){let vt=oe?" IF NOT EXISTS":"",Be=h(g,K.schemaName),Te=y(x.comment,{object:"TABLE",objectName:Be,comment:p(ie)}),ur=c(W.filter(({errorMessage:Ke})=>!Ke).map(v(x,Pe)),Ke=>Ke.statement),lr=w(W.filter(({errorMessage:Ke})=>Ke)),ut=`${A(ur,Pe)}${lr}`,Ai=ce?ut==null?void 0:ut.slice(1):ut,ul=c(R,Ke=>Ke.statement),Ni=A(ul,Pe),ll=`
`+cr(Be,X),pl=ce?x.createTablePartitionOf:x.createTable,ml=ce&&!ut?`
	`:`,
	`,bi=n.isEmpty(O)?"":l(n.join(O,`,
	`),ml,""),Ii=ce&&!Ai&&!bi&&!Ni,dl=Ii?"":"(",fl=Ii?"":")",hl=y(pl,{temporary:F(_e,ve),ifNotExist:vt,name:Be,columnDefinitions:ce?"":"	"+n.join(E,`,
	`),keyConstraints:Ai,checkConstraints:bi,foreignKeyConstraints:Ni,options:Ne({inherits:ee,partitioning:Z,usingMethod:Ee,on_commit:me,storage_parameter:be,table_tablespace_name:Ie,selectStatement:De,partitionBounds:xe}),comment:ie?Te:"",partitionOf:ce?` PARTITION OF ${ce} `:"",columnDescriptions:ll,openParenthesis:dl,closeParenthesis:fl}),gl=Si({dbVersion:K.dbVersion,tableName:Be,triggers:we});return a([hl,gl].map(n.trim).join(`

`).trim()+`
`,{isActivated:Pe})},convertColumnDefinition(g){let E=ol(g.type,g.dbVersion),O=g.nullable?"":" NOT NULL",R=g.primaryKey?" "+v(x,!0)(g.primaryKeyOptions).statement:"",K=g.unique?" "+v(x,!0)(g.uniqueKeyOptions).statement:"",X=g.collationRule?` COLLATE "${g.collationRule}"`:"",W=Array.isArray(g.array_type)&&g.array_type.length>0,ee=n.isUndefined(g.default)?"":" DEFAULT "+Re(E,g.default,W),ie=g.dbVersion>=12&&g.generatedColumn&&g.columnGenerationExpression?y(x.generatedColumnClause,{generationExpression:g.columnGenerationExpression}):"";return a(y(x.columnDefinition,{name:f(g.name),type:qe(E,g),generatedColumnClause:ie,notNull:O,primaryKey:R,uniqueKey:K,collation:X,defaultValue:ee}),{isActivated:g.isActivated})},createIndex(g,E,O,R=!0){let K=E.unique&&E.index_method==="btree",X=f(E.indxName),W=K?" UNIQUE":"",ee=E.concurrently?" CONCURRENTLY":"",ie=E.ifNotExist?" IF NOT EXISTS":"",oe=E.only?" ONLY":"",Ee=E.index_method?` USING ${n.toUpper(E.index_method)}`:"",{getDbVersion:me}=L()(n),Z=me(n.get(O,"dbVersion","")),be=K&&E.nullsDistinct&&Z>=15?`
 ${E.nullsDistinct}`:"",Ie=B(E.index_method==="btree"?E.columns:n.map(E.columns,ve=>n.omit(ve,"sortOrder","nullsOrder")),R),_e=H(E,R);return a(y(x.index,{unique:W,concurrently:ee,ifNotExist:ie,name:X,only:oe,using:Ee,keys:Ie,options:_e,nullsDistinct:be,tableName:h(g,E.schemaName)}),{isActivated:E.isActivated})},createCheckConstraint(g){return y(x.checkConstraint,{name:g.name?`CONSTRAINT ${f(g.name)}`:"",expression:n.trim(g.expression).replace(/^\(([\s\S]*)\)$/,"$1"),noInherit:g.noInherit?" NO INHERIT":""})},createForeignKeyConstraint({name:g,foreignKey:E,primaryTable:O,primaryKey:R,primaryTableActivated:K,foreignTableActivated:X,foreignSchemaName:W,primarySchemaName:ee,customProperties:ie,isActivated:oe},Ee,me){let Z=o(R),be=o(E),Ie=!Z&&!be&&K&&X,{foreignOnDelete:_e,foreignOnUpdate:ve,foreignMatch:De,deferrable:we,deferrableConstraintCheckTime:ce}=$(ie),xe=y(x.createForeignKeyConstraint,{primaryTable:h(O,ee||me.schemaName),name:g?`CONSTRAINT ${f(g)}`:"",foreignKey:Ie?S(E):I(E),primaryKey:Ie?S(R):I(R),onDelete:_e?` ON DELETE ${_e}`:"",onUpdate:ve?` ON UPDATE ${ve}`:"",match:De?` MATCH ${De}`:"",deferrable:we?` ${we}`:"",deferrableConstraintCheckTime:we==="DEFERRABLE"&&ce?` ${ce}`:""});return{statement:n.trim(xe),isActivated:Ie&&oe}},createForeignKey({name:g,foreignTable:E,foreignKey:O,primaryTable:R,primaryKey:K,primaryTableActivated:X,foreignTableActivated:W,foreignSchemaName:ee,primarySchemaName:ie,customProperties:oe,isActivated:Ee},me,Z){let be=o(K),Ie=o(O),_e=!be&&!Ie&&X&&W,{foreignOnDelete:ve,foreignOnUpdate:De,foreignMatch:we,deferrable:ce,deferrableConstraintCheckTime:xe}=$(oe),Pe=y(x.createForeignKey,{primaryTable:h(R,ie||Z.schemaName),foreignTable:h(E,ee||Z.schemaName),name:g?f(g):"",foreignKey:_e?S(O):I(O),primaryKey:_e?S(K):I(K),onDelete:ve?` ON DELETE ${ve}`:"",onUpdate:De?` ON UPDATE ${De}`:"",match:we?` MATCH ${we}`:"",deferrable:ce?` ${ce}`:"",deferrableConstraintCheckTime:ce==="DEFERRABLE"&&xe?` ${xe}`:""});return{statement:n.trim(Pe),isActivated:_e&&Ee}},createView(g,E,O){var xe,Pe,vt,Be;let R=h(g.name,g.schemaName),K=y(x.comment,{object:"VIEW",objectName:R,comment:p(g.comment)}),W=o(g.keys||[])||!O,{columns:ee,tables:ie}=_(g.keys),oe=ee.map(Te=>Te.statement).join(`,
		`);if(!W){let Te=c(ee,lr=>lr.statement),ur=Te.deactivatedItems.length?a(Te.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";oe=Te.activatedItems.join(`,
		`)+ur}let Ee=n.trim(g.selectStatement)?n.trim(s(g.selectStatement)):y(x.viewSelectStatement,{tableName:ie.join(", "),keys:oe}),me=(xe=g.viewOptions)!=null&&xe.check_option?`check_option=${(Pe=g.viewOptions)==null?void 0:Pe.check_option}`:"",Z=(vt=g.viewOptions)!=null&&vt.security_barrier?"security_barrier":"",be=15,{getDbVersion:Ie}=L()(n),_e=(Be=g.viewOptions)!=null&&Be.security_invoker&&Ie(E.dbVersion)>=be?"security_invoker":"",ve=me||Z||_e?`
	WITH (${n.compact([me,Z,_e]).join(",")})`:"",De=i(Te=>Te.withCheckOption&&Te.checkTestingScope?`
	WITH ${Te.checkTestingScope} CHECK OPTION`:Te.withCheckOption?`
	WITH CHECK OPTION`:"","getCheckOption"),we=a(y(x.createView,{name:R,orReplace:g.orReplace?" OR REPLACE":"",temporary:g.temporary?" TEMPORARY":"",checkOption:De(g),comment:g.comment?K:"",withOptions:ve,selectStatement:Ee}),{isActivated:!W}),ce=Si({dbVersion:g.dbVersion,tableName:R,triggers:g.triggers});return[we,ce].map(n.trim).join(`

`).trim()+`
`},dropView(g){let E={viewName:g};return y(x.dropView,E)},createViewIndex(){return""},createUdt(g){let E=n.map(g.properties,this.convertColumnDefinition);return C(g,E)},getDefaultType(g){return ng[g]},getTypesDescriptors(){return $c},hasType(g){return u($c,g)},hydrateDatabase({modelData:g}){return g=n.get(g,"0",{}),{databaseName:g.database_name,tablespace:g.tablespace_name,encoding:g.encoding,template:g.template,collate:g.LC_COLLATE,characterClassification:g.LC_CTYPE,dbVersion:g.dbVersion,locale:g.locale}},hydrateColumn({columnDefinition:g,jsonSchema:E,schemaData:O,definitionJsonSchema:R={},parentJsonSchema:K}){let X=n.includes(["char","varchar","text"],g.type)?E.collationRule:"",W=["time","timestamp"],ee=n.includes(W,g.type)?E.timePrecision:"",ie=n.includes(W,g.type)?E.timezone:"",oe=g.type==="interval"?E.intervalOptions:"",{getDbVersion:Ee}=L()(n),me=Ee(O.dbVersion),Z=n.omit(b.hydratePrimaryKeyOptions(n.first(E.primaryKeyOptions)||{},g.name,g.isActivated,K),"columns"),be=n.omit(b.hydrateUniqueOptions({options:n.first(E.uniqueKeyOptions)||{},columnName:g.name,isActivated:g.isActivated,jsonSchema:K,dbVersion:me}),"columns");return{name:g.name,type:g.type,primaryKey:b.isInlinePrimaryKey(E),primaryKeyOptions:Z,unique:b.isInlineUnique(E),uniqueKeyOptions:be,nullable:g.nullable,default:g.default,comment:E.refDescription||E.description||R.description,isActivated:g.isActivated,scale:g.scale,precision:g.precision,length:g.length,enum:E.enum,array_type:E.array_type,unit:E.unit,rangeSubtype:E.rangeSubtype,operatorClass:E.operatorClass,collation:E.collation,canonicalFunction:E.canonicalFunction,subtypeDiffFunction:E.subtypeDiffFunction,multiRangeType:E.multiRangeType,schemaName:O.schemaName,underlyingType:E.underlyingType,checkConstraints:E.checkConstraints,typeModifier:E.typeModifier,srid:E.srid,collationRule:X,timePrecision:ee,timezone:ie,intervalOptions:oe,dbVersion:me,generatedColumn:!!E.generatedColumn,columnGenerationExpression:E.columnGenerationExpression}},hydrateJsonSchemaColumn(g,E){return!g.$ref||n.isEmpty(E)||D(E)?g:(g=n.omit(g,"$ref"),{...E,...g})},hydrateIndex(g,E,O){return{...g,schemaName:O.schemaName}},hydrateViewIndex(g){return{}},hydrateCheckConstraint(g){return{name:g.chkConstrName,expression:g.constrExpression,noInherit:g.noInherit}},hydrateSchema(g,E){let O=n.get(E,"modelData.0.dbVersion");return{schemaName:g.name,ifNotExist:g.ifNotExist,comments:g.description,udfs:(E==null?void 0:E.udfs)||[],procedures:(E==null?void 0:E.procedures)||[],sequences:(E==null?void 0:E.sequences)||[],dbVersion:O}},hydrateTable({tableData:g,entityData:E,jsonSchema:O}){let R=E[0],K=n.chain(R.inherits).map(({parentTable:Z})=>n.get(g,`relatedSchemas[${Z}]`,"")).compact().map(Z=>Z.code||Z.collectionName).join(", ").thru(Z=>Z?`(${Z})`:"").value(),X=n.first(R.partitioning)||{},W=b.getKeys(X.compositePartitionKey,O),ee=n.get(g,`relatedSchemas[${R.partitionOf}]`),ie=ee?h(ee.collectionName,ee.bucketName):"",oe=Ci(E,g.relatedSchemas),{getDbVersion:Ee}=L()(n),me=Ee(n.get(g,"dbData.dbVersion",""));return{...g,triggers:oe,partitionOf:ie,keyConstraints:b.getTableKeyConstraints(O,me),inherits:K,selectStatement:n.trim(R.selectStatement),partitioning:n.assign({},X,{compositePartitionKey:W}),...n.pick(R,"temporary","unlogged","description","ifNotExist","usingMethod","on_commit","storage_parameter","table_tablespace_name","partitionBounds")}},hydrateViewColumn(g){return{name:g.name,tableName:g.entityName,alias:g.alias,isActivated:g.isActivated,dbName:g.dbName}},hydrateView({viewData:g,entityData:E,relatedSchemas:O}){let R=E[0],K=Ci(E,O);return{name:g.name,keys:g.keys,comment:R.description,orReplace:R.orReplace,temporary:R.temporary,recursive:R.recursive,viewOptions:R.viewOptions,selectStatement:R.selectStatement,withCheckOption:R.withCheckOption,checkTestingScope:R.withCheckOption?R.checkTestingScope:"",schemaName:g.schemaData.schemaName,triggers:K}},commentIfDeactivated(g,E,O){return g},alterColumnType(g,E,O,R){let K=O;return R.length?K+=`(${R.length})`:R.precision&&R.scale?K+=`(${R.precision},${R.scale})`:R.precision&&(K+=`(${R.precision})`),y(x.alterColumnType,{tableName:g,columnName:E,dataType:K})},setNotNullConstraint(g,E){return y(x.addNotNullConstraint,{tableName:g,columnName:E})},dropNotNullConstraint(g,E){return y(x.dropNotNullConstraint,{tableName:g,columnName:E})},renameColumn(g,E,O){return y(x.renameColumn,{tableName:g,oldColumnName:E,newColumnName:O})},addCheckConstraint(g,E,O){let R={tableName:g,constraintName:E,expression:O};return y(x.addCheckConstraint,R)},dropConstraint(g,E){let O={tableName:g,constraintName:E};return y(x.dropConstraint,O)},updateTableComment(g,E){let O={tableName:g,comment:E};return y(x.updateCommentOnTable,O)},dropTableComment(g){let E={tableName:g,comment:"NULL"};return y(x.updateCommentOnTable,E)},updateColumnComment(g,E){let O={columnName:g,comment:E};return y(x.updateCommentOnColumn,O)},dropColumnComment(g){let E={columnName:g,comment:"NULL"};return y(x.updateCommentOnColumn,E)},updateSchemaComment(g,E){let O={schemaName:g,comment:E};return y(x.updateCommentOnSchema,O)},dropSchemaComment(g){let E={schemaName:g,comment:"NULL"};return y(x.updateCommentOnSchema,E)},updateViewComment(g,E){let O={viewName:g,comment:E};return y(x.updateCommentOnView,O)},dropViewComment(g){let E={viewName:g,comment:"NULL"};return y(x.updateCommentOnView,E)},createSchemaOnly(g){let E={schemaName:g};return y(x.createSchemaOnly,E)},dropSchema(g){let E={schemaName:g};return y(x.dropSchema,E)},dropTable(g){let E={tableName:g};return y(x.dropTable,E)},addColumn(g,E){let O={tableName:g,columnDefinition:E};return y(x.addColumn,O)},dropColumn(g,E){let O={tableName:g,columnName:E};return y(x.dropColumn,O)},dropDomain(g){let E={udtName:g};return y(x.dropDomain,E)},dropType(g){let E={udtName:g};return y(x.dropType,E)},alterTypeAddAttribute(g,E){let O={udtName:g,columnDefinition:E};return y(x.alterTypeAddAttribute,O)},alterTypeDropAttribute(g,E){let O={udtName:g,attributeName:E};return y(x.alterTypeDropAttribute,O)},alterTypeRenameAttribute(g,E,O){let R={udtName:g,oldAttributeName:E,newAttributeName:O};return y(x.alterTypeRenameAttribute,R)},alterTypeChangeAttributeType(g,E,O){let R={udtName:g,attributeName:E,newDataType:O};return y(x.alterTypeChangeAttributeType,R)},dropForeignKey(g,E){let O={tableName:g,fkConstraintName:E};return y(x.dropForeignKey,O)},createKeyConstraint(g,E,O){let R=v(x,E)(O);return{statement:y(x.addPkConstraint,{constraintStatement:(R.statement||"").trim(),tableName:g}),isActivated:R.isActivated}},dropKeyConstraint(g,E){let O={tableName:g,constraintName:E};return y(x.dropConstraint,O)},createSchemaSequences({schemaName:g,sequences:E}){return P({schemaName:g,sequences:E})},createSchemaSequence({schemaName:g,sequence:E}){return z({schemaName:g,sequence:E})},dropSchemaSequence({schemaName:g,sequence:E}){return Ae({schemaName:g,sequence:E})},alterSchemaSequence({schemaName:g,sequence:E,oldSequence:O}){return le({schemaName:g,sequence:E,oldSequence:O})},dropIndex({indexName:g}){let E={indexName:g};return y(x.dropIndex,E)},alterIndexRename({schemaName:g,oldIndexName:E,newIndexName:O}){let R=f(g),K=h(f(E),R),X=f(O),W={oldIndexName:K,newIndexName:X};return y(x.alterIndexRename,W)},alterIndexTablespace({schemaName:g,indexName:E,tablespaceName:O}){let R=f(g),X={indexName:h(f(E),R),tablespaceName:O};return y(x.alterIndexTablespace,X)},alterIndexStorageParams({schemaName:g,indexName:E,index:O}){let R=f(g),K=h(f(E),R),X=se(O),W={indexName:K,options:X};return y(x.alterIndexStorageParams,W)},reindexIndex({schemaName:g,indexName:E}){let O=f(g),K={indexName:h(f(E),O)};return y(x.reindexIndex,K)}}}});var Vc=N((US,Gc)=>{"use strict";var{getModifySchemaCommentsScriptDtos:sg}=uc(),{AlterScriptDto:Kc}=re(),ig=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t),{wrapInQuotes:s}=L()(r),a=n.createSchemaOnly(s(e));return Kc.getInstance([a],!0,!1)},"getAddContainerScriptDto"),ag=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t),{wrapInQuotes:s}=L()(r),a=n.dropSchema(s(e));return Kc.getInstance([a],!0,!0)},"getDeleteContainerScriptDto"),og=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t);return[...sg(r,n)(e)]},"getModifyContainerScriptDtos");Gc.exports={getAddContainerScriptDto:ig,getDeleteContainerScriptDto:ag,getModifyContainerScriptDtos:og}});var Wc=N((BS,Hc)=>{"use strict";var{AlterCollectionDto:$S}=$e(),{AlterScriptDto:Jt}=re(),cg=i(t=>e=>{var o;let r=(o=e==null?void 0:e.compMod)==null?void 0:o.chkConstr;if(!r)return[];let n=r.new||[],s=r.old||[];return t.chain([...n,...s]).map(c=>c.chkConstrName).uniq().value().map(c=>({old:t.find(s,{chkConstrName:c}),new:t.find(n,{chkConstrName:c})}))},"mapCheckConstraintNamesToChangeHistory"),ug=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=L()(t);return r.filter(a=>a.old&&!a.new).map(a=>{let o=s(a.old.chkConstrName);return e.dropConstraint(n,o)}).map(a=>Jt.getInstance([a],!0,!0))},"getDropCheckConstraintScriptDtos"),lg=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=L()(t);return r.filter(a=>a.new&&!a.old).map(a=>{let{chkConstrName:o,constrExpression:c}=a.new;return e.addCheckConstraint(n,s(o),c)}).map(a=>Jt.getInstance([a],!0,!1))},"getAddCheckConstraintScriptDtos"),pg=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=L()(t);return r.filter(a=>{if(a.old&&a.new){let o=a.old.constrExpression,c=a.new.constrExpression;return o!==c}return!1}).map(a=>{let{chkConstrName:o}=a.old,c=e.dropConstraint(n,s(o)),{chkConstrName:u,constrExpression:l}=a.new,d=e.addCheckConstraint(n,s(u),l);return[Jt.getInstance([c],!0,!0),Jt.getInstance([d],!0,!1)]}).flat()},"getUpdateCheckConstraintScriptDtos"),mg=i((t,e)=>r=>{let{getFullTableName:n}=L()(t),s=n(r),a=cg(t)(r),o=lg(t,e)(a,s),c=ug(t,e)(a,s),u=pg(t,e)(a,s);return[...o,...c,...u]},"getModifyCheckConstraintScriptDtos");Hc.exports={getModifyCheckConstraintScriptDtos:mg}});var jc=N((VS,Yc)=>{"use strict";var{AlterScriptDto:Qc}=re(),{AlterCollectionDto:GS}=$e(),dg=i((t,e)=>r=>{var p;let{getFullTableName:n,wrapComment:s}=L()(t),a=(p=r==null?void 0:r.role.compMod)==null?void 0:p.description;if(!a)return;let{old:o,new:c}=a;if(!c||c===o)return;let u=n(r),l=s(c),d=e.updateTableComment(u,l);return Qc.getInstance([d],!0,!1)},"getUpdatedCommentOnCollectionScriptDto"),fg=i((t,e)=>r=>{var l;let{getFullTableName:n}=L()(t),s=(l=r==null?void 0:r.role.compMod)==null?void 0:l.description;if(!s)return;let{old:a,new:o}=s;if(!a||o)return;let c=n(r),u=e.dropTableComment(c);return Qc.getInstance([u],!0,!0)},"getDeletedCommentOnCollectionScriptDto"),hg=i((t,e)=>r=>{let n=dg(t,e)(r),s=fg(t,e)(r);return[n,s].filter(Boolean)},"getModifyEntityCommentsScriptDtos");Yc.exports={getModifyEntityCommentsScriptDtos:hg}});var Xc=N((WS,zc)=>{"use strict";var{AlterScriptDto:gg}=re(),yg=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.length,a=r==null?void 0:r.length;return s!==a},"hasLengthChanged"),_g=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.precision,a=r==null?void 0:r.precision,o=n==null?void 0:n.scale,c=r==null?void 0:r.scale;return s!==a||o!==c},"hasPrecisionOrScaleChanged"),Eg=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:a}=L()(t),o=s(r);return t.toPairs(r.properties).filter(([c,u])=>{let l=n(u.compMod,["type","mode"]);if(!l){let d=u.compMod.oldField.name,p=yg(r,d,u),m=_g(r,d,u);return p||m}return l}).map(([c,u])=>{let l=u.compMod.newField.mode||u.compMod.newField.type,d=a(c),p=t.pick(u,["length","precision","scale"]);return e.alterColumnType(o,d,l,p)}).map(c=>gg.getInstance([c],!0,!1))},"getUpdateTypesScriptDtos");zc.exports={getUpdateTypesScriptDtos:Eg}});var eu=N((YS,Jc)=>{"use strict";var{AlterScriptDto:Zc}=re(),Tg=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s}=L()(t),a=n(r),o=r.required||[],c=r.role.required||[],u=t.difference(o,c),l=t.difference(c,o),d=t.toPairs(r.properties).filter(([m,f])=>{let h=f.compMod.oldField.name,T=l.includes(h);return u.includes(m)&&!T}).map(([m])=>e.setNotNullConstraint(a,s(m))).map(m=>Zc.getInstance([m],!0,!1)),p=t.toPairs(r.properties).filter(([m,f])=>{let h=f.compMod.oldField.name,T=l.includes(h),_=u.includes(m);return T&&!_}).map(([m])=>e.dropNotNullConstraint(a,s(m))).map(m=>Zc.getInstance([m],!0,!0));return[...d,...p]},"getModifyNonNullColumnsScriptDtos");Jc.exports={getModifyNonNullColumnsScriptDtos:Tg}});var nu=N((zS,ru)=>{"use strict";var{AlterScriptDto:tu}=re(),Sg=i((t,e)=>r=>{let{getFullColumnName:n,wrapComment:s}=L()(t);return t.toPairs(r.properties).filter(([a,o])=>{var d;let c=o.description,u=o.compMod.oldField.name,l=(d=r.role.properties[u])==null?void 0:d.description;return c&&(!l||c!==l)}).map(([a,o])=>{let c=o.description,u=s(c),l=n(r,a);return e.updateColumnComment(l,u)}).map(a=>tu.getInstance([a],!0,!1))},"getUpdatedCommentOnColumnScriptDtos"),Cg=i((t,e)=>r=>{let{getFullColumnName:n}=L()(t);return t.toPairs(r.properties).filter(([s,a])=>{var l;let o=a.description,c=a.compMod.oldField.name;return((l=r.role.properties[c])==null?void 0:l.description)&&!o}).map(([s,a])=>{let o=n(r,s);return e.dropColumnComment(o)}).map(s=>tu.getInstance([s],!0,!0))},"getDeletedCommentOnColumnScriptDtos"),Ag=i((t,e)=>r=>{let n=Sg(t,e)(r),s=Cg(t,e)(r);return[...n,...s]},"getModifiedCommentOnColumnScriptDtos");ru.exports={getModifiedCommentOnColumnScriptDtos:Ag}});var iu=N((ZS,su)=>{"use strict";var{AlterScriptDto:Ng}=re(),bg=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:a}=L()(t),o=s(r);return t.values(r.properties).filter(c=>n(c.compMod,["name"])).map(c=>{let u=a(c.compMod.oldField.name),l=a(c.compMod.newField.name);return e.renameColumn(o,u,l)}).map(c=>Ng.getInstance([c],!0,!1))},"getRenameColumnScriptDtos");su.exports={getRenameColumnScriptDtos:bg}});var qs=N((eC,au)=>{"use strict";var Rs=class Rs{didTransitionHappen;wasPkChangedInTransition;static noTransition(){return{didTransitionHappen:!1}}static transition(e){return{didTransitionHappen:!0,wasPkChangedInTransition:e}}};i(Rs,"KeyTransitionDto");var vs=Rs,ws=class ws{script;isDropScript;fullTableName;isActivated;constructor(e,r,n,s){this.script=e,this.isDropScript=n,this.fullTableName=r,this.isActivated=s}};i(ws,"KeyScriptModificationDto");var Os=ws;au.exports={KeyScriptModificationDto:Os,KeyTransitionDto:vs}});var pu=N((oC,lu)=>{"use strict";var{AlterScriptDto:Ig}=re(),{AlterCollectionDto:rC,AlterCollectionColumnDto:nC,AlterCollectionRoleCompModPKDto:sC,AlterCollectionColumnKeyOptionDto:iC,AlterCollectionRoleCompModPrimaryKey:aC}=$e(),{KeyTransitionDto:ge,KeyScriptModificationDto:er}=qs(),st=1,Ds=i(t=>`${t}_pkey`,"getDefaultConstraintName"),ou=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularPkOptions"),it=i(t=>(t.primaryKeyOptions||[]).map(r=>ou(r)),"getCustomPropertiesOfRegularPkForComparisonWithRegularPkOptions"),tr=i(t=>[ou(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositePkForComparisonWithRegularPkOptions"),vg=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.primaryKey)||{}).old||[],s=n.flatMap(m=>m.compositePrimaryKey.map(f=>f.keyId));if(s.length!==st)return ge.noTransition();let a=s[0],o=Object.values(e.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return ge.noTransition();let u=it(o),l=n.some(m=>{if(m.compositePrimaryKey.length!==st)return!1;let f=tr(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return ge.transition(!l)},"wasCompositePkChangedInTransitionFromCompositeToRegular"),Og=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.primaryKey)||{}).new||[],s=n.flatMap(m=>m.compositePrimaryKey.map(f=>f.keyId));if(s.length!==st)return ge.noTransition();let a=s[0],o=Object.values(e.role.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return ge.noTransition();let u=it(o),l=n.some(m=>{if(m.compositePrimaryKey.length!==st)return!1;let f=tr(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return ge.transition(!l)},"wasCompositePkChangedInTransitionFromRegularToComposite"),Rg=i((t,e)=>t.constraintName?t.constraintName:Ds(e),"getConstraintNameForCompositePk"),wg=i(t=>(e,r,n)=>{let s=Rg(e,r),a=t.toPairs(n.role.properties).filter(([l,d])=>!!e.compositePrimaryKey.find(p=>p.keyId===d.GUID)).map(([l,d])=>({name:l,isActivated:d.isActivated})),o="",c="",u=[];return e.indexStorageParameters&&(o=e.indexStorageParameters),e.indexTablespace&&(c=e.indexTablespace),e.indexInclude&&(u=t.toPairs(n.role.properties).filter(([l,d])=>!!e.indexInclude.find(p=>p.keyId===d.GUID)).map(([l,d])=>({name:l,isActivated:d.isActivated}))),{name:s,keyType:"PRIMARY KEY",columns:a,include:u,storageParameters:o,tablespace:c}},"getCreateCompositePKDDLProviderConfig"),qg=i((t,e)=>r=>{var f,h;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=L()(t),o=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.primaryKey)||{},c=o.new||[],u=o.old||[];if(c.length===0&&u.length===0)return[];let l=Og(t)(r);if(l.didTransitionHappen&&!l.wasPkChangedInTransition)return[];if(c.length===u.length&&t(u).differenceWith(c,t.isEqual).isEmpty())return[];let d=s(r),p=n(d),m=a(d);return c.map(T=>{let _=wg(t)(T,m,r),y=e.createKeyConstraint(p,r.isActivated,_);return new er(y.statement,p,!1,y.isActivated)}).filter(T=>!!T.script)},"getAddCompositePkScriptDtos"),Dg=i((t,e)=>r=>{var h,T;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=((T=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:T.primaryKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let d=vg(t)(r);if(d.didTransitionHappen&&!d.wasPkChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let p=s(r),m=n(p),f=a(p);return l.map(_=>{let y=Ds(f);_.constraintName&&(y=_.constraintName);let A=o(y),S=e.dropKeyConstraint(m,A);return new er(S,m,!0,r.isActivated)}).filter(_=>!!_.script)},"getDropCompositePkScriptDtos"),xg=i((t,e)=>r=>{let n=Dg(t,e)(r),s=qg(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyCompositePkScriptDtos"),cu=i((t,e)=>{let r=t.primaryKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return Ds(e)},"getConstraintNameForRegularPk"),Pg=i(t=>(e,r,n,s)=>{let a=cu(r,n),o=[{name:e,isActivated:r.isActivated}],c="",u="",l=[],d=r.primaryKeyOptions;if(d!=null&&d.length&&(d==null?void 0:d.length)>0){let p=d[0];p.indexStorageParameters&&(c=p.indexStorageParameters),p.indexTablespace&&(u=p.indexTablespace),p.indexInclude&&(l=t.toPairs(s.role.properties).filter(([m,f])=>!!p.indexInclude.find(h=>h.keyId===f.GUID)).map(([m,f])=>({name:m,isActivated:f.isActivated})))}return{name:a,keyType:"PRIMARY KEY",columns:o,include:l,storageParameters:c,tablespace:u}},"getCreateRegularPKDDLProviderConfig"),Lg=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);return a&&!o},"wasFieldChangedToBeARegularPk"),Mg=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);if(!(a&&o))return ge.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.primaryKey)||{},u=c.new||[],l=c.old||[],d=l.some(T=>T.compositePrimaryKey.some(_=>_.keyId===s.GUID)),p=u.some(T=>T.compositePrimaryKey.some(_=>_.keyId===e.GUID));if(a&&(d&&!p)){let T=it(e),_=l.some(y=>{if(y.compositePrimaryKey.length!==st)return!1;let A=tr(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return ge.transition(!_)}return ge.noTransition()},"wasRegularPkChangedInTransitionFromCompositeToRegular"),Fg=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=s.primaryKey&&!s.compositePrimaryKey,o=!!(e!=null&&e.primaryKey);if(!(a&&o))return ge.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.primaryKey)||{},u=c.new||[],d=(c.old||[]).some(T=>T.compositePrimaryKey.some(_=>_.keyId===s.GUID)),m=u.some(T=>T.compositePrimaryKey.some(_=>_.keyId===e.GUID))&&!d;if(a&&m){let T=it(s),_=u.some(y=>{if(y.compositePrimaryKey.length!==st)return!1;let A=tr(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return ge.transition(!_)}return ge.noTransition()},"wasRegularPkChangedInTransitionFromRegularToComposite"),Ug=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey),o=!e.primaryKey&&!e.compositePrimaryKey;return a&&o},"isFieldNoLongerARegularPk"),uu=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},a=e.primaryKey&&!e.compositePrimaryKey,o=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey);if(!(a&&o))return!1;let c=it(e),u=it(s);return!t(u).differenceWith(c,t.isEqual).isEmpty()},"wasRegularPkModified"),kg=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=L()(t),o=s(r),c=n(o),u=a(o);return t.toPairs(r.properties).filter(([l,d])=>{if(Lg(t)(d,r))return!0;let p=Mg(t)(d,r);return p.didTransitionHappen?p.wasPkChangedInTransition:uu(t)(d,r)}).map(([l,d])=>{let p=Pg(t)(l,d,u,r),m=e.createKeyConstraint(c,r.isActivated,p);return new er(m.statement,c,!1,m.isActivated)}).filter(l=>!!l.script)},"getAddPkScriptDtos"),$g=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=s(r),u=n(c),l=a(c);return t.toPairs(r.properties).filter(([d,p])=>{if(Ug(t)(p,r))return!0;let m=Fg(t)(p,r);return m.didTransitionHappen?m.wasPkChangedInTransition:uu(t)(p,r)}).map(([d,p])=>{let m=p.compMod.oldField.name,f=r.role.properties[m],h=o(cu(f,l)),T=e.dropKeyConstraint(u,h);return new er(T,u,!0,r.isActivated)}).filter(d=>!!d.script)},"getDropPkScriptDto"),Bg=i((t,e)=>r=>{let n=$g(t,e)(r),s=kg(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyPkScriptDtos"),Kg=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyPkConstraints"),Gg=i((t,e)=>r=>{let n=xg(t,e)(r),s=Bg(t,e)(r),a=[...n,...s];return Kg(a).map(c=>Ig.getInstance([c.script],c.isActivated,c.isDropScript)).filter(Boolean)},"getModifyPkConstraintsScriptDtos");lu.exports={getModifyPkConstraintsScriptDtos:Gg}});var gu=N((fC,hu)=>{"use strict";var{AlterScriptDto:Vg}=re(),{AlterCollectionDto:uC,AlterCollectionColumnDto:lC,AlterCollectionRoleCompModUniqueKeyDto:pC,AlterCollectionColumnKeyOptionDto:mC,AlterCollectionRoleCompModUniqueKey:dC}=$e(),{KeyTransitionDto:ye,KeyScriptModificationDto:rr}=qs(),at=1,xs=i(t=>`${t}_ukey`,"getDefaultConstraintName"),mu=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularUniqueKeyOptions"),ot=i(t=>(t.uniqueKeyOptions||[]).map(r=>mu(r)),"getCustomPropertiesOfRegularUniqueKeyForComparisonWithRegularUniqueKeyOptions"),nr=i(t=>[mu(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositeUniqueKeyForComparisonWithRegularUniqueKeyOptions"),Hg=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.uniqueKey)||{}).old||[],s=n.flatMap(m=>m.compositeUniqueKey.map(f=>f.keyId));if(s.length!==at)return ye.noTransition();let a=s[0],o=Object.values(e.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.unique)&&!(o!=null&&o.compositeUniqueKey)))return ye.noTransition();let u=ot(o),l=n.some(m=>{if(m.compositeUniqueKey.length!==at)return!1;let f=nr(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return ye.transition(!l)},"wasCompositeUniqueKeyChangedInTransitionFromCompositeToRegular"),Wg=i(t=>e=>{var d,p;let n=(((p=(d=e==null?void 0:e.role)==null?void 0:d.compMod)==null?void 0:p.uniqueKey)||{}).new||[],s=n.flatMap(m=>m.compositeUniqueKey.map(f=>f.keyId));if(s.length!==at)return ye.noTransition();let a=s[0],o=Object.values(e.role.properties).find(m=>m.GUID===a);if(!o||!((o==null?void 0:o.unique)&&!(o!=null&&o.compositeUniqueKey)))return ye.noTransition();let u=ot(o),l=n.some(m=>{if(m.compositeUniqueKey.length!==at)return!1;let f=nr(m);return t(f).differenceWith(u,t.isEqual).isEmpty()});return ye.transition(!l)},"wasCompositeUniqueKeyChangedInTransitionFromRegularToComposite"),Qg=i((t,e)=>t.constraintName?t.constraintName:xs(e),"getConstraintNameForCompositeUniqueKey"),Yg=i(t=>(e,r,n,s)=>{let{clean:a,getDbVersion:o}=L()(t),c=Zt()(t,a),u=Qg(e,r),l=t.toPairs(n.role.properties).filter(([_,y])=>!!e.compositeUniqueKey.find(A=>A.keyId===y.GUID)).map(([_,y])=>({name:_,isActivated:y.isActivated})),d="",p="",m=[],f=e.deferrable,h=e.deferrableConstraintCheckTime;e.indexStorageParameters&&(d=e.indexStorageParameters),e.indexTablespace&&(p=e.indexTablespace),e.indexInclude&&(m=t.toPairs(n.role.properties).filter(([_,y])=>!!e.indexInclude.find(A=>A.keyId===y.GUID)).map(([_,y])=>({name:_,isActivated:y.isActivated})));let T=c.getUniqueKeyType(e,o(s));return{name:u,keyType:T,columns:l,include:m,storageParameters:d,tablespace:p,deferrable:f,deferrableConstraintCheckTime:h}},"getCreateCompositeUniqueKeyDDLProviderConfig"),jg=i((t,e)=>(r,n)=>{var h,T;let{getFullCollectionName:s,getSchemaOfAlterCollection:a,getEntityName:o}=L()(t),c=((T=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:T.uniqueKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let d=Wg(t)(r);if(d.didTransitionHappen&&!d.wasUniqueKeyChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let p=a(r),m=s(p),f=o(p);return u.map(_=>{let y=Yg(t)(_,f,r,n),A=e.createKeyConstraint(m,r.isActivated,y);return new rr(A.statement,m,!1,A.isActivated)}).filter(_=>!!_.script)},"getAddCompositeUniqueKeyScriptDtos"),zg=i((t,e)=>r=>{var h,T;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=((T=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:T.uniqueKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let d=Hg(t)(r);if(d.didTransitionHappen&&!d.wasUniqueKeyChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let p=s(r),m=n(p),f=a(p);return l.map(_=>{let y=xs(f);_.constraintName&&(y=_.constraintName);let A=o(y),S=e.dropKeyConstraint(m,A);return new rr(S,m,!0,r.isActivated)}).filter(_=>!!_.script)},"getDropCompositeUniqueKeyScriptDtos"),Xg=i((t,e)=>(r,n)=>{let s=zg(t,e)(r),a=jg(t,e)(r,n);return[...s,...a].filter(Boolean)},"getModifyCompositeUniqueKeyScriptDtos"),du=i((t,e)=>{let r=t.uniqueKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return xs(e)},"getConstraintNameForRegularUniqueKey"),Zg=i(t=>(e,r,n,s,a)=>{let{clean:o,getDbVersion:c}=L()(t),u=Zt()(t,o),l=du(r,n),d=[{name:e,isActivated:r.isActivated}],p="",m="",f=[],h="",T="",_="",y=r.uniqueKeyOptions;if(y!=null&&y.length&&(y==null?void 0:y.length)>0){let S=y[0];S.indexStorageParameters&&(p=S.indexStorageParameters),S.indexTablespace&&(m=S.indexTablespace),S.indexInclude&&(f=t.toPairs(s.role.properties).filter(([I,v])=>!!S.indexInclude.find(w=>w.keyId===v.GUID)).map(([I,v])=>({name:I,isActivated:v.isActivated}))),h=S.deferrable,T=S.deferrableConstraintCheckTime,_=S.nullsDistinct}let A=u.getUniqueKeyType({nullsDistinct:_},c(a));return{name:l,keyType:A,columns:d,include:f,storageParameters:p,tablespace:m,deferrable:h,deferrableConstraintCheckTime:T}},"getCreateRegularUniqueKeyDDLProviderConfig"),Jg=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)||s.compositeUniqueKey;return a&&!o},"wasFieldChangedToBeARegularUniqueKey"),ey=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)||s.compositeUniqueKey;if(!(a&&o))return ye.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.uniqueKey)||{},u=c.new||[],l=c.old||[],d=l.some(T=>T.compositeUniqueKey.some(_=>_.keyId===s.GUID)),p=u.some(T=>T.compositeUniqueKey.some(_=>_.keyId===e.GUID));if(a&&(d&&!p)){let T=ot(e),_=l.some(y=>{if(y.compositeUniqueKey.length!==at)return!1;let A=nr(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return ye.transition(!_)}return ye.noTransition()},"wasRegularUniqueKeyChangedInTransitionFromCompositeToRegular"),ty=i(t=>(e,r)=>{var f,h;let n=e.compMod.oldField.name,s=r.role.properties[n],a=s.unique&&!s.compositeUniqueKey,o=!!(e!=null&&e.unique);if(!(a&&o))return ye.noTransition();let c=((h=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:h.uniqueKey)||{},u=c.new||[],d=(c.old||[]).some(T=>T.compositeUniqueKey.some(_=>_.keyId===s.GUID)),m=u.some(T=>T.compositeUniqueKey.some(_=>_.keyId===e.GUID))&&!d;if(a&&m){let T=ot(s),_=u.some(y=>{if(y.compositeUniqueKey.length!==at)return!1;let A=nr(y);return t(A).differenceWith(T,t.isEqual).isEmpty()});return ye.transition(!_)}return ye.noTransition()},"wasRegularUniqueKeyChangedInTransitionFromRegularToComposite"),ry=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=(s==null?void 0:s.unique)&&!(s!=null&&s.compositeUniqueKey),o=!e.unique&&!e.compositeUniqueKey;return a&&o},"isFieldNoLongerARegularUniqueKey"),fu=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},a=e.unique&&!e.compositeUniqueKey,o=(s==null?void 0:s.unique)&&!(s!=null&&s.compositeUniqueKey);if(!(a&&o))return!1;let c=ot(e),u=ot(s);return!t(u).differenceWith(c,t.isEqual).isEmpty()},"wasRegularUniqueKeyModified"),ny=i((t,e)=>(r,n)=>{let{getFullCollectionName:s,getSchemaOfAlterCollection:a,getEntityName:o}=L()(t),c=a(r),u=s(c),l=o(c);return t.toPairs(r.properties).filter(([d,p])=>{if(Jg(t)(p,r))return!0;let m=ey(t)(p,r);return m.didTransitionHappen?m.wasUniqueKeyChangedInTransition:fu(t)(p,r)}).map(([d,p])=>{let m=Zg(t)(d,p,l,r,n),f=e.createKeyConstraint(u,r.isActivated,m);return new rr(f.statement,u,!1,f.isActivated)}).filter(d=>!!d.script)},"getAddUniqueKeyScriptDtos"),sy=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=L()(t),c=s(r),u=n(c),l=a(c);return t.toPairs(r.properties).filter(([d,p])=>{if(ry(t)(p,r))return!0;let m=ty(t)(p,r);return m.didTransitionHappen?m.wasUniqueKeyChangedInTransition:fu(t)(p,r)}).map(([d,p])=>{let m=p.compMod.oldField.name,f=r.role.properties[m],h=o(du(f,l)),T=e.dropKeyConstraint(u,h);return new rr(T,u,!0,r.isActivated)}).filter(d=>!!d.script)},"getDropUniqueKeyScriptDto"),iy=i((t,e)=>(r,n)=>{let s=sy(t,e)(r),a=ny(t,e)(r,n);return[...s,...a].filter(Boolean)},"getModifyUniqueKeyScriptDtos"),ay=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyUniqueKeyConstraints"),oy=i(({_:t,ddlProvider:e})=>({collection:r,dbVersion:n})=>{let s=Xg(t,e)(r,n),a=iy(t,e)(r,n),o=[...s,...a];return ay(o).map(u=>Vg.getInstance([u.script],u.isActivated,u.isDropScript)).filter(Boolean)},"getModifyUniqueKeyConstraintsScriptDtos");hu.exports={getModifyUniqueKeyConstraintsScriptDtos:oy}});var Nu=N((_C,Au)=>{"use strict";var{AlterCollectionDto:gC}=$e(),{AlterIndexDto:yC}=ps(),{AlterScriptDto:ct}=re(),cy=i(({_:t})=>({columnId:e,collection:r})=>{var c,u,l;let n=t.toPairs(((c=r==null?void 0:r.role)==null?void 0:c.properties)||(r==null?void 0:r.properties)||{}).map(([d,p])=>({...p,name:d})),s=(((l=(u=r==null?void 0:r.role)==null?void 0:u.compMod)==null?void 0:l.oldProperties)||[]).map(d=>({...d,GUID:d.id})),o=(n.length>0?n:s).find(d=>d.GUID===e);if(o)return o.name},"getColumnNameById"),yu=i(({_:t})=>({columns:e,collection:r})=>(e||[]).map(n=>({...n,name:cy({_:t})({columnId:n.keyId,collection:r})})).filter(n=>!!n.name),"setNamesToColumns"),uy=i(({_:t})=>({index:e,collection:r})=>{let{getSchemaNameFromCollection:n}=L()(t),s=n({collection:r}),a=yu({_:t})({columns:e.columns,collection:r}),o=yu({_:t})({columns:e.include,collection:r});return{...e,schemaName:s,columns:a,include:o}},"mapIndexToFeIndexDto"),_u=i(({_:t})=>({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})=>{let s=t.pick(r,n),a=t.pick(e,n);return!t.isEqual(s,a)},"areIndexesDifferent"),ly=i(({_:t})=>({oldIndex:e,newIndex:r})=>{let n=["index_method","columns","include","nullsDistinct","where"];return _u({_:t})({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})},"shouldDropAndRecreateIndex"),py=i(({_:t})=>({oldIndex:e,newIndex:r})=>{let n=["indxName","index_tablespace_name","index_storage_parameter"];return _u({_:t})({oldIndex:e,newIndex:r,indexPropertiesToCompare:n})},"shouldAlterIndex"),Ps=i(({oldIndex:t,newIndex:e})=>t.id===e.id||t.indxName===e.indxName,"areOldIndexDtoAndNewIndexDtoDescribingSameDatabaseIndex"),Eu=i(({_:t,ddlProvider:e})=>({index:r,collection:n,additionalDataForDdlProvider:s})=>{let{dbData:a,tableName:o,isParentActivated:c}=s,u=uy({_:t})({index:r,collection:n}),l=e.createIndex(o,u,a,c),d=u.isActivated&&c;return ct.getInstance([l],d,!1)},"getCreateIndexScriptDto"),Tu=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l;let s=((o=r==null?void 0:r.role)==null?void 0:o.Indxs)||[],a=((l=(u=(c=r==null?void 0:r.role)==null?void 0:c.compMod)==null?void 0:u.Indxs)==null?void 0:l.old)||[];return s.filter(d=>!a.find(m=>Ps({oldIndex:m,newIndex:d}))).map(d=>Eu({_:t,ddlProvider:e})({index:d,collection:r,additionalDataForDdlProvider:n})).filter(Boolean)},"getAddedIndexesScriptDtos"),Su=i(({_:t,ddlProvider:e})=>({index:r,additionalDataForDdlProvider:n})=>{let{getNamePrefixedWithSchemaName:s}=L()(t),{isParentActivated:a,schemaName:o}=n,c=s(r.indxName,o),u=e.dropIndex({indexName:c}),l=r.isActivated&&a;return ct.getInstance([u],l,!0)},"getDeleteIndexScriptDto"),my=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l,d,p;let s=((u=(c=(o=r==null?void 0:r.role)==null?void 0:o.compMod)==null?void 0:c.Indxs)==null?void 0:u.new)||[];return(((p=(d=(l=r==null?void 0:r.role)==null?void 0:l.compMod)==null?void 0:d.Indxs)==null?void 0:p.old)||[]).filter(m=>!s.find(h=>Ps({oldIndex:m,newIndex:h}))).map(m=>Su({_:t,ddlProvider:e})({index:m,additionalDataForDdlProvider:n})).filter(Boolean)},"getDeletedIndexesScriptDtos"),dy=i(({_:t,ddlProvider:e})=>({newIndex:r,oldIndex:n,additionalDataForDdlProvider:s})=>{let a=[],{isParentActivated:o,schemaName:c}=s,u=r.isActivated&&o;if(!t.isEqual(r.indxName,n.indxName)){let m=e.alterIndexRename({schemaName:c,oldIndexName:n.indxName,newIndexName:r.indxName}),f=ct.getInstance([m],u,!1);a.push(f)}if(!t.isEqual(r.index_tablespace_name,n.index_tablespace_name)){let m=e.alterIndexTablespace({schemaName:c,indexName:r.indxName,tablespaceName:r.index_tablespace_name}),f=ct.getInstance([m],u,!1);a.push(f)}if(!t.isEqual(r.index_storage_parameter,n.index_storage_parameter)){let m=e.alterIndexStorageParams({schemaName:c,indexName:r.indxName,index:r}),f=ct.getInstance([m],u,!1);a.push(f);let h=e.reindexIndex({schemaName:c,indexName:r.indxName}),T=ct.getInstance([h],u,!1);a.push(T)}return a.filter(Boolean)},"getAlterIndexScriptDtos"),fy=i(({_:t,ddlProvider:e})=>({collection:r,additionalDataForDdlProvider:n})=>{var o,c,u,l,d,p;let s=((u=(c=(o=r==null?void 0:r.role)==null?void 0:o.compMod)==null?void 0:c.Indxs)==null?void 0:u.new)||[],a=((p=(d=(l=r==null?void 0:r.role)==null?void 0:l.compMod)==null?void 0:d.Indxs)==null?void 0:p.old)||[];return s.map(m=>{let f=a.find(h=>Ps({oldIndex:h,newIndex:m}));if(f)return{newIndex:m,oldIndex:f}}).filter(Boolean).flatMap(({newIndex:m,oldIndex:f})=>{if(ly({_:t})({newIndex:m,oldIndex:f})){let _=Su({_:t,ddlProvider:e})({index:f,additionalDataForDdlProvider:n}),y=Eu({_:t,ddlProvider:e})({index:m,collection:r,additionalDataForDdlProvider:n});return[_,y]}return py({_:t})({oldIndex:f,newIndex:m})?dy({_:t,ddlProvider:e})({oldIndex:f,newIndex:m,additionalDataForDdlProvider:n}):[]}).filter(Boolean)},"getModifiedIndexesScriptDtos"),hy=i(({_:t,ddlProvider:e})=>({collection:r,dbVersion:n})=>{let s=Cu({_:t,dbVersion:n,collection:r}),a=my({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s}),o=Tu({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s}),c=fy({_:t,ddlProvider:e})({collection:r,additionalDataForDdlProvider:s});return[...a,...o,...c].filter(Boolean)},"getModifyIndexesScriptDtos"),Cu=i(({_:t,dbVersion:e,collection:r})=>{var s,a,o;let{getSchemaNameFromCollection:n}=L()(t);return{dbData:{dbVersion:e},tableName:((a=(s=r==null?void 0:r.compMod)==null?void 0:s.collectionName)==null?void 0:a.new)||((o=r==null?void 0:r.role)==null?void 0:o.name)||"",schemaName:n({collection:r})||"",isParentActivated:r.isActivated}},"getAdditionalDataForDdlProvider");Au.exports={getModifyIndexesScriptDtos:hy,getAddedIndexesScriptDtos:Tu,getAdditionalDataForDdlProvider:Cu}});var bt=N((TC,bu)=>{"use strict";bu.exports=t=>{let{createColumnDefinition:e}=t.require("@hackolade/ddl-fe-utils"),r=i(s=>s.$ref?s.$ref.split("/").pop():s.mode||s.childType||s.type,"getType");return{createColumnDefinitionBySchema:i(({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l})=>e({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l,getType:r}),"createColumnDefinitionBySchema")}}});var wu=N((AC,Ru)=>{"use strict";var{getModifyCheckConstraintScriptDtos:gy}=Wc(),{getModifyEntityCommentsScriptDtos:yy}=jc(),{getUpdateTypesScriptDtos:_y}=Xc(),{getModifyNonNullColumnsScriptDtos:Ey}=eu(),{getModifiedCommentOnColumnScriptDtos:Ty}=nu(),{getRenameColumnScriptDtos:Sy}=iu(),{AlterScriptDto:sr}=re(),{AlterCollectionDto:CC}=$e(),{getModifyPkConstraintsScriptDtos:Cy}=pu(),{getModifyUniqueKeyConstraintsScriptDtos:Ay}=gu(),{getModifyIndexesScriptDtos:Ny,getAddedIndexesScriptDtos:by,getAdditionalDataForDdlProvider:Iy}=Nu(),vy=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{getEntityName:c}=L()(o),{createColumnDefinitionBySchema:u}=bt()(t),l=ne()(null,null,t),{getDefinitionByReference:d}=t.require("@hackolade/ddl-fe-utils"),m={schemaName:a.compMod.keyspaceName,dbVersion:e},f={...a,...o.omit(a==null?void 0:a.role,"properties")||{}},h=o.toPairs(f.properties).map(([I,v])=>{let w=d({propertySchema:v,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return u({name:I,jsonSchema:v,parentJsonSchema:f,ddlProvider:l,schemaData:m,definitionJsonSchema:w})}),T=(f.chkConstr||[]).map(I=>l.createCheckConstraint(l.hydrateCheckConstraint(I))),_={name:c(f),columns:h.map(l.convertColumnDefinition),checkConstraints:T,foreignKeyConstraints:[],schemaData:m,columnDefinitions:h,dbData:{dbVersion:e}},y=l.hydrateTable({tableData:_,entityData:[f],jsonSchema:f}),A=vu({_:o,ddlProvider:l,collection:a,dbVersion:e}).flatMap(({scripts:I})=>I.map(({script:v})=>v)),S=l.createTable(y,f.isActivated);return sr.getInstance([S,...A],!0,!1)},"getAddCollectionScriptDto"),Oy=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t),{getFullTableName:s}=L()(r),a=s(e),o=n.dropTable(a);return sr.getInstance([o],!0,!0)},"getDeleteCollectionScriptDto"),Ry=i(({app:t,dbVersion:e})=>r=>{let n=t.require("lodash"),s=ne()(null,null,t),a=gy(n,s)(r),o=yy(n,s)(r),c=Cy(n,s)(r),u=Ay({_:n,ddlProvider:s})({collection:r,dbVersion:e}),l=Ny({_:n,ddlProvider:s})({collection:r,dbVersion:e});return[...a,...o,...c,...u,...l].filter(Boolean)},"getModifyCollectionScriptDtos"),Iu=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>(a,o)=>{var I;let c=t.require("lodash"),{getEntityName:u,getNamePrefixedWithSchemaName:l}=L()(c),{createColumnDefinitionBySchema:d}=bt()(t),p=ne()(null,null,t),{getDefinitionByReference:m}=t.require("@hackolade/ddl-fe-utils"),f={...a,...c.omit(a==null?void 0:a.role,"properties")||{}},h=u(f),T=(I=f.compMod)==null?void 0:I.keyspaceName,_=l(h,T),y={schemaName:T,dbVersion:e},A=c.toPairs(a.properties).filter(([v,w])=>o([v,w])).map(([v,w])=>{let $=m({propertySchema:w,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return d({name:v,jsonSchema:w,parentJsonSchema:f,ddlProvider:p,schemaData:y,definitionJsonSchema:$})}).map(p.convertColumnDefinition).map(v=>p.addColumn(_,v)).map(v=>sr.getInstance([v],!0,!1)),S=vu({_:c,ddlProvider:p,collection:a});return A.concat(S).filter(Boolean)},"getAddColumnsByConditionScriptDtos"),vu=i(({_:t,ddlProvider:e,dbVersion:r,collection:n})=>{var l,d;let s=((l=n==null?void 0:n.role)==null?void 0:l.Indxs)||[],a={...n==null?void 0:n.properties,...(d=n==null?void 0:n.role)==null?void 0:d.properties},o=Object.values(a).map(({GUID:p})=>p);if(s.length===0||o.length===0)return[];if(!s.some(({columns:p=[]})=>p.find(({keyId:m})=>o.includes(m))))return[];let u=Iy({_:t,dbVersion:r,collection:n});return by({_:t,ddlProvider:e})({collection:n,additionalDataForDdlProvider:u})},"getNewlyCreatedIndexesScripts"),wy=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>Iu({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(a,([o,c])=>!c.compMod),"getAddColumnScriptDtos"),Ou=i(t=>(e,r)=>{var m;let n=t.require("lodash"),s=ne()(null,null,t),{getEntityName:a,getNamePrefixedWithSchemaName:o,wrapInQuotes:c}=L()(n),u={...e,...n.omit(e==null?void 0:e.role,"properties")||{}},l=a(u),d=(m=u.compMod)==null?void 0:m.keyspaceName,p=o(l,d);return n.toPairs(e.properties).filter(([f,h])=>r([f,h])).map(([f])=>{let h=c(f);return s.dropColumn(p,h)}).map(f=>sr.getInstance([f],!0,!0)).filter(Boolean)},"getDeleteColumnsByConditionScriptDtos"),qy=i(t=>e=>Ou(t)(e,([r,n])=>!n.compMod),"getDeleteColumnScriptDtos"),Dy=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash");return o.toPairs(a.properties).filter(([c,u])=>{let l=u.compMod.oldField.name,d=a.role.properties[l];return d.generatedColumn!==u.generatedColumn||d.columnGenerationExpression!==u.columnGenerationExpression}).flatMap(([c,u])=>{let l={...a,properties:o.fromPairs([[c,u]])},d=Ou(t)(l,()=>!0),p=Iu({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(l,()=>!0);return[...d,...p]}).filter(Boolean)},"getDropAndRecreateColumnsScriptDtos"),xy=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),c=ne()(null,null,t),u=Sy(o,c)(a),l=Dy({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(a);if(l.length)return[...u,...l].filter(Boolean);let d=_y(o,c)(a),p=Ey(o,c)(a),m=Ty(o,c)(a);return[...u,...d,...p,...m].filter(Boolean)},"getModifyColumnScriptDtos");Ru.exports={getAddCollectionScriptDto:vy,getDeleteCollectionScriptDto:Oy,getModifyCollectionScriptDtos:Ry,getAddColumnScriptDtos:wy,getDeleteColumnScriptDtos:qy,getModifyColumnScriptDtos:xy}});var Du=N((bC,qu)=>{"use strict";var{AlterScriptDto:We}=re(),Py=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=bt()(t),u=ne()(null,null,t),{getDefinitionByReference:l}=t.require("@hackolade/ddl-fe-utils"),d={dbVersion:e},p=o.toPairs(a.properties||{}).map(([T,_])=>{let y=l({propertySchema:_,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:T,jsonSchema:_,parentJsonSchema:a,ddlProvider:u,schemaData:d,definitionJsonSchema:y})}),f={...c({name:a.code||a.name,jsonSchema:a,parentJsonSchema:{required:[]},definitionJsonSchema:{},ddlProvider:u,schemaData:d}),properties:p},h=u.createUdt(f);return We.getInstance([h],!0,!1)},"getCreateUdtScriptDto"),Ly=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t),{getUdtName:s,wrapInQuotes:a}=L()(r),o=a(s(e));if(e.type==="domain"){let c=n.dropDomain(o);return We.getInstance([c],!0,!0)}else{let c=n.dropType(o);return We.getInstance([c],!0,!0)}},"getDeleteUdtScriptDto"),My=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=bt()(t),{getUdtName:u,wrapInQuotes:l}=L()(o),d=ne()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),m=l(u(a)),f={dbVersion:e};return o.toPairs(a.properties).filter(([h,T])=>!T.compMod).map(([h,T])=>{let _=p({propertySchema:T,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:h,jsonSchema:T,parentJsonSchema:{required:[]},ddlProvider:d,schemaData:f,definitionJsonSchema:_})}).map(d.convertColumnDefinition).map(h=>d.alterTypeAddAttribute(m,h)).map(h=>We.getInstance([h],!0,!1)).filter(Boolean)},"getAddColumnToTypeScriptDtos"),Fy=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t),{wrapInQuotes:s}=L()(r),a=s(e.code||e.name);return r.toPairs(e.properties).filter(([o,c])=>!c.compMod).map(([o])=>n.alterTypeDropAttribute(a,s(o))).map(o=>We.getInstance([o],!0,!0)).filter(Boolean)},"getDeleteColumnFromTypeScriptDtos"),Uy=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t),{checkFieldPropertiesChanged:s,wrapInQuotes:a}=L()(r),o=a(e.code||e.name),c=r.values(e.properties).filter(l=>s(l.compMod,["name"])).map(l=>{let d=a(l.compMod.oldField.name),p=a(l.compMod.newField.name);return n.alterTypeRenameAttribute(o,d,p)}).map(l=>We.getInstance([l],!0,!1)),u=r.toPairs(e.properties).filter(([l,d])=>s(d.compMod,["type","mode"])).map(([l,d])=>{let p=a(l),m=d.compMod.newField.mode||d.compMod.newField.type;return n.alterTypeChangeAttributeType(o,p,m)}).map(l=>We.getInstance([l],!0,!1));return[...c,...u].filter(Boolean)},"getModifyColumnOfTypeScriptDtos");qu.exports={getCreateUdtScriptDto:Py,getDeleteUdtScriptDto:Ly,getAddColumnToTypeScriptDtos:My,getDeleteColumnFromTypeScriptDtos:Fy,getModifyColumnOfTypeScriptDtos:Uy}});var Mu=N((vC,Lu)=>{"use strict";var{AlterScriptDto:xu}=re(),Pu=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),ky=i((t,e)=>r=>{let{getFullViewName:n,wrapComment:s}=L()(t),a=Pu(r);if(a.new&&a.new!==a.old){let o=s(a.new),c=n(r),u=e.updateViewComment(c,o);return xu.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),$y=i((t,e)=>r=>{let n=Pu(r),{getFullViewName:s}=L()(t);if(n.old&&!n.new){let a=s(r),o=e.dropViewComment(a);return xu.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),By=i((t,e)=>r=>{let n=ky(t,e)(r),s=$y(t,e)(r);return[n,s].filter(Boolean)},"getModifyViewCommentsScriptDtos");Lu.exports={getModifyViewCommentsScriptDtos:By}});var ku=N((RC,Uu)=>{"use strict";var{getModifyViewCommentsScriptDtos:Ky}=Mu(),{AlterScriptDto:Fu}=re(),Gy=i(t=>e=>{let r=ne()(null,null,t),n={name:e.code||e.name,keys:[],schemaData:{schemaName:""}},s=r.hydrateView({viewData:n,entityData:[e]}),a=r.createView(s,{},e.isActivated);return Fu.getInstance([a],!0,!1)},"getAddViewScriptDto"),Vy=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t),{wrapInQuotes:s}=L()(r),a=s(e.code||e.name),o=n.dropView(a);return Fu.getInstance([o],!0,!0)},"getDeleteViewScriptDto"),Hy=i(t=>e=>{let r=t.require("lodash"),n=ne()(null,null,t);return[...Ky(r,n)(e)].filter(Boolean)},"getModifyViewScriptDtos");Uu.exports={getAddViewScriptDto:Gy,getDeleteViewScriptDto:Vy,getModifyViewScriptDtos:Hy}});var Bu=N((qC,$u)=>{"use strict";var Ks=class Ks{isActivated;name};i(Ks,"AlterRelationshipFKField");var Ls=Ks,Gs=class Gs{bucket;collection};i(Gs,"AlterRelationshipParentDto");var Ms=Gs,Vs=class Vs{bucket;collection};i(Vs,"AlterRelationshipChildDto");var Fs=Vs,Hs=class Hs{relationshipOnDelete;relationshipOnUpdate;relationshipMatch};i(Hs,"AlterRelationshipCustomProperties");var Us=Hs,Ws=class Ws{created;deleted;modified;parent;child;name;description;customProperties;isActivated};i(Ws,"AlterRelationshipRoleCompModDto");var ks=Ws,Qs=class Qs{id;name;relationshipType;parentField;parentCardinality;childField;isActivated;childCardinality;parentCollection;childCollection;hackoladeStyles;compMod;roleType};i(Qs,"AlterRelationshipRoleDto");var $s=Qs,Ys=class Ys{type;isActivated;unique;subtype;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(Ys,"AlterRelationshipDto");var Bs=Ys;$u.exports={AlterRelationshipRoleCompModDto:ks,AlterRelationshipRoleDto:$s,AlterRelationshipDto:Bs,AlterRelationshipFKField:Ls,AlterRelationshipParentDto:Ms,AlterRelationshipChildDto:Fs,AlterRelationshipCustomProperties:Us}});var Qu=N((PC,Wu)=>{"use strict";var{AlterScriptDto:js}=re(),{AlterRelationshipDto:xC}=Bu(),ir=i(t=>t.role.name,"getRelationshipName"),Wy=i(t=>e=>{let{getNamePrefixedWithSchemaName:r}=L()(t),n=e.role.compMod,s=n.child.bucket.name,a=n.child.collection.name;return r(a,s)},"getFullChildTableName"),Ku=i((t,e)=>r=>{var a,o,c,u,l;let n=r.role.compMod,s=((a=n.name)==null?void 0:a.new)||ir(r)||"";return t.createForeignKey({name:s,foreignKey:n.child.collection.fkFields,primaryKey:n.parent.collection.fkFields,customProperties:(o=n.customProperties)==null?void 0:o.new,foreignTable:n.child.collection.name,foreignSchemaName:n.child.bucket.name,foreignTableActivated:n.child.collection.isActivated,primaryTable:n.parent.collection.name,primarySchemaName:n.parent.bucket.name,primaryTableActivated:n.parent.collection.isActivated,isActivated:!!((l=(u=(c=r.role)==null?void 0:c.compMod)==null?void 0:u.isActivated)!=null&&l.new)})},"getAddSingleForeignKeyStatementDto"),Gu=i(t=>{var r,n,s,a,o,c,u,l,d,p,m;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.new)||ir(t),(n=e.parent)==null?void 0:n.bucket,(s=e.parent)==null?void 0:s.collection,(c=(o=(a=e.parent)==null?void 0:a.collection)==null?void 0:o.fkFields)==null?void 0:c.length,(u=e.child)==null?void 0:u.bucket,(l=e.child)==null?void 0:l.collection,(m=(p=(d=e.child)==null?void 0:d.collection)==null?void 0:p.fkFields)==null?void 0:m.length].every(f=>!!f):!1},"canRelationshipBeAdded"),Qy=i((t,e)=>r=>r.filter(n=>Gu(n)).map(n=>{let s=Ku(t,e)(n);return js.getInstance([s.statement],s.isActivated,!1)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getAddForeignKeyScriptDtos"),Vu=i((t,e)=>r=>{var p,m,f,h;let{wrapInQuotes:n}=L()(e),s=r.role.compMod,a=Wy(e)(r),o=((p=s.name)==null?void 0:p.old)||ir(r)||"",c=n(o),u=t.dropForeignKey(a,c),l=!!((h=(f=(m=r.role)==null?void 0:m.compMod)==null?void 0:f.isActivated)!=null&&h.new),d=s.child.collection.isActivated;return{statement:u,isActivated:l&&d}},"getDeleteSingleForeignKeyStatementDto"),Hu=i(t=>{var r,n,s;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.old)||ir(t),(n=e.child)==null?void 0:n.bucket,(s=e.child)==null?void 0:s.collection].every(a=>!!a):!1},"canRelationshipBeDeleted"),Yy=i((t,e)=>r=>r.filter(n=>Hu(n)).map(n=>{let s=Vu(t,e)(n);return js.getInstance([s.statement],s.isActivated,!0)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getDeleteForeignKeyScriptDtos"),jy=i((t,e)=>r=>r.filter(n=>Gu(n)&&Hu(n)).map(n=>{let s=Vu(t,e)(n),a=Ku(t,e)(n),o=a.isActivated&&s.isActivated;return js.getDropAndRecreateInstance(s.statement,a.statement,o)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getModifyForeignKeyScriptDtos");Wu.exports={getDeleteForeignKeyScriptDtos:Yy,getModifyForeignKeyScriptDtos:jy,getAddForeignKeyScriptDtos:Qy}});var si=N((MC,Yu)=>{"use strict";var ei=class ei{message;stack};i(ei,"PluginError");var zs=ei,ti=class ti{require};i(ti,"App");var Xs=ti,ri=class ri{log;clear};i(ri,"Logger");var Zs=ri,ni=class ni{jsonSchema;modelDefinitions;internalDefinitions;externalDefinitions;containerData;entityData;entities;views;viewData;relationships;collectionRefsDefinitionsMap;isUpdateScript;level;host;clusterId;accessToken;applyToInstanceQueryRequestTimeout;script;hiddenKeys;options;modelData};i(ni,"CoreData");var Js=ni;Yu.exports={App:Xs,CoreData:Js,Logger:Zs,PluginError:zs}});var zu=N((UC,ju)=>{"use strict";var di=class di{name;isActivated};i(di,"ContainerJsonSchema");var ii=di,fi=class fi{backgroundColor};i(fi,"ContainerStyles");var ai=fi,hi=class hi{collectionName;isActivated;bucketId;additionalProperties;tableIfNotExists};i(hi,"EntityData");var oi=hi,gi=class gi{$schema;type;GUID};i(gi,"InternalDefinitions");var ci=gi,yi=class yi{$schema;type;GUID};i(yi,"ModelDefinitions");var ui=yi,_i=class _i{$schema;type;GUID};i(_i,"ExternalDefinitions");var li=_i,Ei=class Ei{type;isActivated;mode;subtype;compositeKey;compositePartitionKey;compositeClusteringKey;compositePrimaryKey;compositeUniqueKey;GUID};i(Ei,"FieldJsonSchema");var pi=Ei,Ti=class Ti{$schema;type;title;properties;isActivated;additionalProperties;tableIfNotExists;GUID};i(Ti,"EntityJsonSchema");var mi=Ti;ju.exports={ContainerJsonSchema:ii,ContainerStyles:ai,EntityData:oi,InternalDefinitions:ci,ModelDefinitions:ui,ExternalDefinitions:li,FieldJsonSchema:pi,EntityJsonSchema:mi}});var ar=N(($C,Xu)=>{"use strict";Xu.exports=ne()});var Ju=N((KC,Zu)=>{"use strict";var{AlterScriptDto:It}=re(),{App:BC}=si(),zy="sequences",Xy=i(({app:t})=>({container:e})=>{var o;let r=t.require("lodash"),n=ar()(null,null,t),{getDbName:s}=L()(r),a=s([e.role]);return(((o=e.role)==null?void 0:o.sequences)||[]).map(c=>n.createSchemaSequence({schemaName:a,sequence:c})).map(c=>It.getInstance([c],!0,!1)).filter(Boolean)},"getAddContainerSequencesScriptDtos"),Zy=i(({app:t})=>({container:e})=>{var _,y;let r=t.require("lodash"),n=ar()(null,null,t),{getDbName:s,getGroupItemsByCompMode:a}=L()(r),o=s([e.role]),c=((y=(_=e.role)==null?void 0:_.compMod)==null?void 0:y[zy])||{},{new:u=[],old:l=[]}=c,{removed:d,added:p,modified:m}=a({newItems:u,oldItems:l}),f=d.map(A=>n.dropSchemaSequence({schemaName:o,sequence:A})).map(A=>It.getInstance([A],!0,!0)),h=p.map(A=>n.createSchemaSequence({schemaName:o,sequence:A})).map(A=>It.getInstance([A],!0,!1));return[...m.map(A=>{let S=r.find(l,{id:A.id})||{};return n.alterSchemaSequence({schemaName:o,sequence:A,oldSequence:S})}).map(A=>It.getInstance([A],!0,!1)),...f,...h].filter(Boolean)},"getModifyContainerSequencesScriptDtos"),Jy=i(({app:t})=>({container:e})=>{var o;let r=t.require("lodash"),n=ar()(null,null,t),{getDbName:s}=L()(r),a=s([e.role]);return(((o=e.role)==null?void 0:o.sequences)||[]).map(c=>n.dropSchemaSequence({schemaName:a,sequence:c})).map(c=>It.getInstance([c],!0,!0)).filter(Boolean)},"getDeleteContainerSequencesScriptDtos");Zu.exports={getAddContainerSequencesScriptDtos:Xy,getModifyContainerSequencesScriptDtos:Zy,getDeleteContainerSequencesScriptDtos:Jy}});var tl=N((XC,el)=>{"use strict";var{getAddContainerScriptDto:e_,getDeleteContainerScriptDto:t_,getModifyContainerScriptDtos:r_}=Vc(),{getAddCollectionScriptDto:n_,getDeleteCollectionScriptDto:s_,getAddColumnScriptDtos:i_,getDeleteColumnScriptDtos:a_,getModifyColumnScriptDtos:o_,getModifyCollectionScriptDtos:c_}=wu(),{getDeleteUdtScriptDto:u_,getCreateUdtScriptDto:l_,getAddColumnToTypeScriptDtos:p_,getDeleteColumnFromTypeScriptDtos:m_,getModifyColumnOfTypeScriptDtos:d_}=Du(),{getAddViewScriptDto:f_,getDeleteViewScriptDto:h_,getModifyViewScriptDtos:g_}=ku(),{getModifyForeignKeyScriptDtos:y_,getDeleteForeignKeyScriptDtos:__,getAddForeignKeyScriptDtos:E_}=Qu(),{AlterScriptDto:VC,ModificationScript:HC}=re(),{App:WC,CoreData:QC}=si(),{InternalDefinitions:YC,ModelDefinitions:jC,ExternalDefinitions:zC}=zu(),{getModifyContainerSequencesScriptDtos:T_,getDeleteContainerSequencesScriptDtos:S_,getAddContainerSequencesScriptDtos:C_}=Ju(),A_=i(({collection:t,app:e})=>{var u,l,d,p,m,f,h,T,_,y,A,S;let r=(p=(d=(l=(u=t.properties)==null?void 0:u.containers)==null?void 0:l.properties)==null?void 0:d.added)==null?void 0:p.items,n=(T=(h=(f=(m=t.properties)==null?void 0:m.containers)==null?void 0:f.properties)==null?void 0:h.deleted)==null?void 0:T.items,s=(S=(A=(y=(_=t.properties)==null?void 0:_.containers)==null?void 0:y.properties)==null?void 0:A.modified)==null?void 0:S.items,a=[].concat(r).filter(Boolean).map(I=>e_(e)(Object.keys(I.properties)[0])),o=[].concat(n).filter(Boolean).map(I=>t_(e)(Object.keys(I.properties)[0])),c=[].concat(s).filter(Boolean).map(I=>Object.values(I.properties)[0]).flatMap(I=>r_(e)(I));return[...a,...o,...c].filter(Boolean)},"getAlterContainersScriptDtos"),N_=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var T,_,y,A,S,I,v,w,$,b,q,G;let o=[].concat((A=(y=(_=(T=t.properties)==null?void 0:T.entities)==null?void 0:_.properties)==null?void 0:y.added)==null?void 0:A.items).filter(Boolean).map(P=>Object.values(P.properties)[0]),c=[].concat((w=(v=(I=(S=t.properties)==null?void 0:S.entities)==null?void 0:I.properties)==null?void 0:v.deleted)==null?void 0:w.items).filter(Boolean).map(P=>Object.values(P.properties)[0]),u=[].concat((G=(q=(b=($=t.properties)==null?void 0:$.entities)==null?void 0:b.properties)==null?void 0:q.modified)==null?void 0:G.items).filter(Boolean).map(P=>Object.values(P.properties)[0]),l=o.filter(P=>{var z;return(z=P.compMod)==null?void 0:z.created}).map(n_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),d=c.filter(P=>{var z;return(z=P.compMod)==null?void 0:z.deleted}).map(s_(e)),p=u.flatMap(c_({app:e,dbVersion:r})),m=o.filter(P=>{var z;return!((z=P==null?void 0:P.compMod)!=null&&z.created)}).flatMap(i_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),f=c.filter(P=>{var z;return!((z=P==null?void 0:P.compMod)!=null&&z.deleted)}).flatMap(a_(e)),h=u.flatMap(o_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}));return[...l,...d,...p,...m,...f,...h].filter(Boolean)},"getAlterCollectionsScriptDtos"),b_=i((t,e)=>{var a,o,c,u,l,d,p,m,f,h,T,_;let r=[].concat((u=(c=(o=(a=t.properties)==null?void 0:a.views)==null?void 0:o.properties)==null?void 0:c.added)==null?void 0:u.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).filter(y=>{var A;return((A=y.compMod)==null?void 0:A.created)&&y.selectStatement}).map(f_(e)),n=[].concat((m=(p=(d=(l=t.properties)==null?void 0:l.views)==null?void 0:d.properties)==null?void 0:p.deleted)==null?void 0:m.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).map(h_(e)),s=[].concat((_=(T=(h=(f=t.properties)==null?void 0:f.views)==null?void 0:h.properties)==null?void 0:T.modified)==null?void 0:_.items).filter(Boolean).map(y=>Object.values(y.properties)[0]).map(y=>({...y,...y.role||{}})).flatMap(y=>g_(e)(y));return[...n,...r,...s].filter(Boolean)},"getAlterViewScriptDtos"),I_=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var p,m,f,h,T,_,y,A,S,I,v,w,$,b,q,G,P,z,Ae,le;let o=[].concat((h=(f=(m=(p=t.properties)==null?void 0:p.modelDefinitions)==null?void 0:m.properties)==null?void 0:f.added)==null?void 0:h.items).filter(Boolean).map(F=>Object.values(F.properties)[0]).map(F=>({...F,...e.require("lodash").omit(F.role,"properties")||{}})).filter(F=>{var Ne;return(Ne=F.compMod)==null?void 0:Ne.created}).map(l_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),c=[].concat((A=(y=(_=(T=t.properties)==null?void 0:T.modelDefinitions)==null?void 0:_.properties)==null?void 0:y.deleted)==null?void 0:A.items).filter(Boolean).map(F=>Object.values(F.properties)[0]).map(F=>({...F,...e.require("lodash").omit(F.role,"properties")||{}})).filter(F=>{var Ne;return(Ne=F.compMod)==null?void 0:Ne.deleted}).map(u_(e)),u=[].concat((w=(v=(I=(S=t.properties)==null?void 0:S.modelDefinitions)==null?void 0:I.properties)==null?void 0:v.added)==null?void 0:w.items).filter(Boolean).map(F=>Object.values(F.properties)[0]).filter(F=>!F.compMod).map(F=>({...F,...e.require("lodash").omit(F.role,"properties")||{}})).filter(F=>F.childType==="composite").flatMap(p_({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),l=[].concat((G=(q=(b=($=t.properties)==null?void 0:$.modelDefinitions)==null?void 0:b.properties)==null?void 0:q.deleted)==null?void 0:G.items).filter(Boolean).map(F=>Object.values(F.properties)[0]).filter(F=>!F.compMod).map(F=>({...F,...e.require("lodash").omit(F.role,"properties")||{}})).filter(F=>F.childType==="composite").flatMap(m_(e)),d=[].concat((le=(Ae=(z=(P=t.properties)==null?void 0:P.modelDefinitions)==null?void 0:z.properties)==null?void 0:Ae.modified)==null?void 0:le.items).filter(Boolean).map(F=>Object.values(F.properties)[0]).filter(F=>!F.compMod).map(F=>({...F,...e.require("lodash").omit(F.role,"properties")||{}})).filter(F=>F.childType==="composite").flatMap(d_(e));return[...c,...o,...u,...l,...d].filter(Boolean)},"getAlterModelDefinitionsScriptDtos"),v_=i(({collection:t,app:e})=>{var d,p,m,f,h,T,_,y,A,S,I,v;let r=e.require("lodash"),n=ne()(null,null,e),s=[].concat((f=(m=(p=(d=t.properties)==null?void 0:d.relationships)==null?void 0:p.properties)==null?void 0:m.added)==null?void 0:f.items).filter(Boolean).map(w=>Object.values(w.properties)[0]).filter(w=>{var $,b;return(b=($=w==null?void 0:w.role)==null?void 0:$.compMod)==null?void 0:b.created}),a=[].concat((y=(_=(T=(h=t.properties)==null?void 0:h.relationships)==null?void 0:T.properties)==null?void 0:_.deleted)==null?void 0:y.items).filter(Boolean).map(w=>Object.values(w.properties)[0]).filter(w=>{var $,b;return(b=($=w==null?void 0:w.role)==null?void 0:$.compMod)==null?void 0:b.deleted}),o=[].concat((v=(I=(S=(A=t.properties)==null?void 0:A.relationships)==null?void 0:S.properties)==null?void 0:I.modified)==null?void 0:v.items).filter(Boolean).map(w=>Object.values(w.properties)[0]).filter(w=>{var $,b;return(b=($=w==null?void 0:w.role)==null?void 0:$.compMod)==null?void 0:b.modified}),c=__(n,r)(a),u=E_(n,r)(s),l=y_(n,r)(o);return[...c,...u,...l].filter(Boolean)},"getAlterRelationshipsScriptDtos"),O_=i(t=>{if(!t)return;let e=t.scripts.map(r=>({...r,script:(r.script||"").trim()})).filter(r=>!!r.script);if(e.length)return{...t,scripts:e}},"prettifyAlterScriptDto"),R_=i(({collection:t,app:e})=>{var u,l,d,p,m,f,h,T,_,y,A,S;let r=(p=(d=(l=(u=t.properties)==null?void 0:u.containers)==null?void 0:l.properties)==null?void 0:d.added)==null?void 0:p.items,n=(T=(h=(f=(m=t.properties)==null?void 0:m.containers)==null?void 0:f.properties)==null?void 0:h.deleted)==null?void 0:T.items,s=(S=(A=(y=(_=t.properties)==null?void 0:_.containers)==null?void 0:y.properties)==null?void 0:A.modified)==null?void 0:S.items,a=[].concat(r).filter(Boolean).map(I=>Object.values(I.properties)[0]).flatMap(I=>C_({app:e})({container:I})),o=[].concat(n).filter(Boolean).map(I=>Object.values(I.properties)[0]).flatMap(I=>S_({app:e})({container:I})),c=[].concat(s).filter(Boolean).map(I=>Object.values(I.properties)[0]).flatMap(I=>T_({app:e})({container:I}));return[...a,...o,...c].filter(Boolean)},"getAlterContainersSequencesScriptDtos"),w_=i((t,e)=>{var f;let r=JSON.parse(t.jsonSchema);if(!r)throw new Error('"comparisonModelCollection" is not found. Alter script can be generated only from Delta model');let n=JSON.parse(t.modelDefinitions),s=JSON.parse(t.internalDefinitions),a=JSON.parse(t.externalDefinitions),o=(f=t.modelData[0])==null?void 0:f.dbVersion,c=A_({collection:r,app:e}),u=N_({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),l=b_(r,e),d=I_({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),p=v_({collection:r,app:e}),m=R_({collection:r,app:e});return[...c,...d,...u,...m,...l,...p].filter(Boolean).map(h=>O_(h)).filter(Boolean)},"getAlterScriptDtos");el.exports={getAlterScriptDtos:w_}});var il=N((eA,sl)=>{"use strict";var{getAlterScriptDtos:or}=tl(),{AlterScriptDto:JC}=re(),rl=i(t=>(e,r)=>{let{commentIfDeactivated:n}=L()(t);return e.map(s=>s.isActivated===!1?s.scripts.map(a=>n(a.script,{isActivated:!1,isPartOfLine:!1})):r?s.scripts.map(a=>a.script):s.scripts.map(a=>n(a.script,{isActivated:!a.isDropScript,isPartOfLine:!1}))).flat().filter(Boolean).map(s=>s.trim()).filter(Boolean).join(`

`)},"joinAlterScriptDtosIntoScript"),q_=i((t,e)=>{var a,o;let r=e.require("lodash"),n=or(t,e),s=(o=(a=t.options)==null?void 0:a.additionalOptions)==null?void 0:o.some(c=>c.id==="applyDropStatements"&&c.value);return rl(r)(n,s)},"buildEntityLevelAlterScript"),D_=i((t,e)=>or(t,e).some(n=>n.isActivated&&n.scripts.some(s=>s.isDropScript)),"doesEntityLevelAlterScriptContainDropStatements"),nl=i(t=>({...t,jsonSchema:t.collections[0],internalDefinitions:Object.values(t.internalDefinitions)[0]}),"mapCoreDataForContainerLevelScripts"),x_=i((t,e)=>{var o,c;let r=nl(t),n=e.require("lodash"),s=or(r,e),a=(c=(o=r.options)==null?void 0:o.additionalOptions)==null?void 0:c.some(u=>u.id==="applyDropStatements"&&u.value);return rl(n)(s,a)},"buildContainerLevelAlterScript"),P_=i((t,e)=>{let r=nl(t);return or(r,e).some(s=>s.isActivated&&s.scripts.some(a=>a.isDropScript))},"doesContainerLevelAlterScriptContainDropStatements");sl.exports={buildEntityLevelAlterScript:q_,doesEntityLevelAlterScriptContainDropStatements:D_,buildContainerLevelAlterScript:x_,doesContainerLevelAlterScriptContainDropStatements:P_}});var al=Xo(),{createLogger:L_}=pr(),M_=Jo(),{buildEntityLevelAlterScript:F_,buildContainerLevelAlterScript:U_,doesContainerLevelAlterScriptContainDropStatements:k_,doesEntityLevelAlterScriptContainDropStatements:$_}=il();module.exports={generateScript(t,e,r,n){try{let s=F_(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"PostgreSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},generateViewScript(t,e,r,n){r(new Error("Forward-Engineering of delta model on view level is not supported"))},generateContainerScript(t,e,r,n){try{let s=U_(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"PostgreSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},getDatabases(t,e,r,n){e.progress({message:"Find all databases"}),al.getDatabases(t,e,r,n)},applyToInstance(t,e,r,n){e.clear(),e.log("info",n.require("lodash").omit(t,"script","containerData"),"connectionInfo",t.hiddenKeys);let s=L_({title:"Apply to instance",hiddenKeys:t.hiddenKeys,logger:e});M_.applyToInstance(t,s,n).then(r,r)},testConnection(t,e,r,n){al.testConnection(t,e,r,n).then(r,r)},isDropInStatements(t,e,r,n){try{if(t.level==="container"){let s=k_(t,n);r(null,s)}else{let s=$_(t,n);r(null,s)}}catch(s){r({message:s.message,stack:s.stack})}}};
