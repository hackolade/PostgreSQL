"use strict";var Le=Object.defineProperty;var aa=Object.getOwnPropertyDescriptor;var oa=Object.getOwnPropertyNames;var ca=Object.prototype.hasOwnProperty;var i=(t,e)=>Le(t,"name",{value:e,configurable:!0});var ua=(t,e)=>()=>(t&&(e=t(t=0)),e);var h=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),la=(t,e)=>{for(var r in e)Le(t,r,{get:e[r],enumerable:!0})},pa=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of oa(e))!ca.call(t,s)&&s!==r&&Le(t,s,{get:()=>e[s],enumerable:!(n=aa(e,s))||n.enumerable});return t};var ha=t=>pa(Le({},"__esModule",{value:!0}),t);var an=h((Gh,sn)=>{var fa=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",a=""){e.progress({message:n,containerName:s,entityName:a})},error(n){e.log("error",da(n),t)}}),"createLogger"),da=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");sn.exports={createLogger:fa}});var cn=h((Hh,on)=>{var ue=1e3,le=ue*60,pe=le*60,he=pe*24,_a=he*365.25;on.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return ma(t);if(r==="number"&&isNaN(t)===!1)return e.long?ya(t):ga(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function ma(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*_a;case"days":case"day":case"d":return r*he;case"hours":case"hour":case"hrs":case"hr":case"h":return r*pe;case"minutes":case"minute":case"mins":case"min":case"m":return r*le;case"seconds":case"second":case"secs":case"sec":case"s":return r*ue;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}i(ma,"parse");function ga(t){return t>=he?Math.round(t/he)+"d":t>=pe?Math.round(t/pe)+"h":t>=le?Math.round(t/le)+"m":t>=ue?Math.round(t/ue)+"s":t+"ms"}i(ga,"fmtShort");function ya(t){return Pe(t,he,"day")||Pe(t,pe,"hour")||Pe(t,le,"minute")||Pe(t,ue,"second")||t+" ms"}i(ya,"fmtLong");function Pe(t,e,r){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}i(Pe,"plural")});var ct=h((E,un)=>{E=un.exports=ot.debug=ot.default=ot;E.coerce=ba;E.disable=Ta;E.enable=Sa;E.enabled=va;E.humanize=cn();E.names=[];E.skips=[];E.formatters={};var at;function Ea(t){var e=0,r;for(r in t)e=(e<<5)-e+t.charCodeAt(r),e|=0;return E.colors[Math.abs(e)%E.colors.length]}i(Ea,"selectColor");function ot(t){function e(){if(e.enabled){var r=e,n=+new Date,s=n-(at||n);r.diff=s,r.prev=at,r.curr=n,at=n;for(var a=new Array(arguments.length),o=0;o<a.length;o++)a[o]=arguments[o];a[0]=E.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(l,p){if(l==="%%")return l;c++;var f=E.formatters[p];if(typeof f=="function"){var _=a[c];l=f.call(r,_),a.splice(c,1),c--}return l}),E.formatArgs.call(r,a);var u=e.log||E.log||console.log.bind(console);u.apply(r,a)}}return i(e,"debug"),e.namespace=t,e.enabled=E.enabled(t),e.useColors=E.useColors(),e.color=Ea(t),typeof E.init=="function"&&E.init(e),e}i(ot,"createDebug");function Sa(t){E.save(t),E.names=[],E.skips=[];for(var e=(typeof t=="string"?t:"").split(/[\s,]+/),r=e.length,n=0;n<r;n++)e[n]&&(t=e[n].replace(/\*/g,".*?"),t[0]==="-"?E.skips.push(new RegExp("^"+t.substr(1)+"$")):E.names.push(new RegExp("^"+t+"$")))}i(Sa,"enable");function Ta(){E.enable("")}i(Ta,"disable");function va(t){var e,r;for(e=0,r=E.skips.length;e<r;e++)if(E.skips[e].test(t))return!1;for(e=0,r=E.names.length;e<r;e++)if(E.names[e].test(t))return!0;return!1}i(va,"enabled");function ba(t){return t instanceof Error?t.stack||t.message:t}i(ba,"coerce")});var hn=h((x,pn)=>{x=pn.exports=ct();x.log=Ca;x.formatArgs=wa;x.save=Oa;x.load=ln;x.useColors=Aa;x.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:Na();x.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function Aa(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}i(Aa,"useColors");x.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function wa(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+x.humanize(this.diff),!!e){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,function(a){a!=="%%"&&(n++,a==="%c"&&(s=n))}),t.splice(s,0,r)}}i(wa,"formatArgs");function Ca(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}i(Ca,"log");function Oa(t){try{t==null?x.storage.removeItem("debug"):x.storage.debug=t}catch{}}i(Oa,"save");function ln(){var t;try{t=x.storage.debug}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}i(ln,"load");x.enable(ln());function Na(){try{return window.localStorage}catch{}}i(Na,"localstorage")});var mn=h((O,_n)=>{var fn=require("tty"),fe=require("util");O=_n.exports=ct();O.init=Ma;O.log=La;O.formatArgs=xa;O.save=Pa;O.load=dn;O.useColors=Ra;O.colors=[6,2,3,4,5,1];O.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(s,a){return a.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});var J=parseInt(process.env.DEBUG_FD,10)||2;J!==1&&J!==2&&fe.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var Ia=J===1?process.stdout:J===2?process.stderr:qa(J);function Ra(){return"colors"in O.inspectOpts?!!O.inspectOpts.colors:fn.isatty(J)}i(Ra,"useColors");O.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,fe.inspect(t,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};O.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,fe.inspect(t,this.inspectOpts)};function xa(t){var e=this.namespace,r=this.useColors;if(r){var n=this.color,s="  \x1B[3"+n+";1m"+e+" \x1B[0m";t[0]=s+t[0].split(`
`).join(`
`+s),t.push("\x1B[3"+n+"m+"+O.humanize(this.diff)+"\x1B[0m")}else t[0]=new Date().toUTCString()+" "+e+" "+t[0]}i(xa,"formatArgs");function La(){return Ia.write(fe.format.apply(fe,arguments)+`
`)}i(La,"log");function Pa(t){t==null?delete process.env.DEBUG:process.env.DEBUG=t}i(Pa,"save");function dn(){return process.env.DEBUG}i(dn,"load");function qa(t){var e,r=process.binding("tty_wrap");switch(r.guessHandleType(t)){case"TTY":e=new fn.WriteStream(t),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(t,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var s=require("net");e=new s.Socket({fd:t,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=t,e._isStdio=!0,e}i(qa,"createWritableStdioStream");function Ma(t){t.inspectOpts={};for(var e=Object.keys(O.inspectOpts),r=0;r<e.length;r++)t.inspectOpts[e[r]]=O.inspectOpts[e[r]]}i(Ma,"init");O.enable(dn())});var lt=h((zh,ut)=>{typeof process<"u"&&process.type==="renderer"?ut.exports=hn():ut.exports=mn()});var gn=h(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.default=null});var wn=h((Jh,An)=>{var En=9007199254740991,Da="[object Arguments]",Fa="[object Function]",Ba="[object GeneratorFunction]",ka=/^(?:0|[1-9]\d*)$/;function Sn(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}i(Sn,"apply");function Ua(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}i(Ua,"baseTimes");var de=Object.prototype,_e=de.hasOwnProperty,Tn=de.toString,Ga=de.propertyIsEnumerable,yn=Math.max;function Qa(t,e){var r=Za(t)||Ya(t)?Ua(t.length,String):[],n=r.length,s=!!n;for(var a in t)(e||_e.call(t,a))&&!(s&&(a=="length"||bn(a,n)))&&r.push(a);return r}i(Qa,"arrayLikeKeys");function Ha(t,e,r,n){return t===void 0||ht(t,de[r])&&!_e.call(n,r)?e:t}i(Ha,"assignInDefaults");function ja(t,e,r){var n=t[e];(!(_e.call(t,e)&&ht(n,r))||r===void 0&&!(e in t))&&(t[e]=r)}i(ja,"assignValue");function Wa(t){if(!dt(t))return Ja(t);var e=Ka(t),r=[];for(var n in t)n=="constructor"&&(e||!_e.call(t,n))||r.push(n);return r}i(Wa,"baseKeysIn");function vn(t,e){return e=yn(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=yn(r.length-e,0),a=Array(s);++n<s;)a[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=a,Sn(t,this,o)}}i(vn,"baseRest");function Va(t,e,r,n){r||(r={});for(var s=-1,a=e.length;++s<a;){var o=e[s],c=n?n(r[o],t[o],o,r,t):void 0;ja(r,o,c===void 0?t[o]:c)}return r}i(Va,"copyObject");function $a(t){return vn(function(e,r){var n=-1,s=r.length,a=s>1?r[s-1]:void 0,o=s>2?r[2]:void 0;for(a=t.length>3&&typeof a=="function"?(s--,a):void 0,o&&za(r[0],r[1],o)&&(a=s<3?void 0:a,s=1),e=Object(e);++n<s;){var c=r[n];c&&t(e,c,n,a)}return e})}i($a,"createAssigner");function bn(t,e){return e=e??En,!!e&&(typeof t=="number"||ka.test(t))&&t>-1&&t%1==0&&t<e}i(bn,"isIndex");function za(t,e,r){if(!dt(r))return!1;var n=typeof e;return(n=="number"?ft(r)&&bn(e,r.length):n=="string"&&e in r)?ht(r[e],t):!1}i(za,"isIterateeCall");function Ka(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||de;return t===r}i(Ka,"isPrototype");function Ja(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}i(Ja,"nativeKeysIn");function ht(t,e){return t===e||t!==t&&e!==e}i(ht,"eq");function Ya(t){return Xa(t)&&_e.call(t,"callee")&&(!Ga.call(t,"callee")||Tn.call(t)==Da)}i(Ya,"isArguments");var Za=Array.isArray;function ft(t){return t!=null&&to(t.length)&&!eo(t)}i(ft,"isArrayLike");function Xa(t){return ro(t)&&ft(t)}i(Xa,"isArrayLikeObject");function eo(t){var e=dt(t)?Tn.call(t):"";return e==Fa||e==Ba}i(eo,"isFunction");function to(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=En}i(to,"isLength");function dt(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}i(dt,"isObject");function ro(t){return!!t&&typeof t=="object"}i(ro,"isObjectLike");var no=$a(function(t,e,r,n){Va(e,io(e),t,n)}),so=vn(function(t){return t.push(void 0,Ha),Sn(no,void 0,t)});function io(t){return ft(t)?Qa(t,!0):Wa(t)}i(io,"keysIn");An.exports=so});var On=h((Zh,Cn)=>{var ao=require("util"),oo=wn(),co=lt()("tunnel-ssh-config"),_t=i(function(t,e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=t,this.extra=e},"ConfigError");ao.inherits(_t,Error);function uo(t){var e=process.env;if(oo(t||{},{username:e.TUNNELSSH_USER||e.USER||e.USERNAME||"root",port:22,host:null,srcPort:0,srcHost:"127.0.0.1",dstPort:null,dstHost:"127.0.0.1",localHost:"127.0.0.1",localPort:t.dstPort,agent:process.env.SSH_AUTH_SOCK}),!t.host)throw new _t("host not set");if(!t.dstPort)throw new _t("dstPort not set");return co("ssh-config",function(){var r=["password","privateKey"];return Object.keys(t).reduce(function(n,s){return r.indexOf(s)===-1?n[s]=t[s]:n[s]="***HIDDEN***",n},{})}()),t}i(uo,"createConfig");Cn.exports=uo});var In=h((ef,Nn)=>{var lo=require("net"),mt=lt()("tunnel-ssh"),po=gn().Client,ho=On(),fo=require("events"),_o=i(function(){},"noop");function mo(t,e){var r=new po;return e.on("close",r.end.bind(r)),r.on("ready",function(){mt("sshConnection:ready"),e.emit("sshConnection",r,e),r.forwardOut(t.srcHost,t.srcPort,t.dstHost,t.dstPort,function(n,s){if(n){e.emit("error",n),mt("Destination port:",n);return}mt("sshStream:create"),e.emit("sshStream",s),e.pipe(s).pipe(e)})}),r}i(mo,"bindSSHConnection");function go(t,e){return e.reduce(function(r,n){return delete r[n],r},Object.assign({},t))}i(go,"omit");function yo(t){var e,r=[],n=0;return e=lo.createServer(function(s){var a;n++,s.on("error",e.emit.bind(e,"error")),s.on("close",function(){n--,n===0&&(t.keepAlive||setTimeout(function(){n===0&&e.close()},2))}),e.emit("netConnection",s,e),a=mo(t,s),a.on("error",e.emit.bind(e,"error")),s.on("sshStream",function(o){o.on("error",function(){e.close()})}),r.push(a,s);try{a.connect(go(t,["localPort","localHost"]))}catch(o){e.emit("error",o)}}),e.on("close",function(){r.forEach(function(s){s.end()})}),e}i(yo,"createServer");function Eo(t,e){var r,n;e||(e=_o);try{n=ho(t),r=yo(n),r.listen(n.localPort,n.localHost,function(s){e(s,r)})}catch(s){r=new fo.EventEmitter,setImmediate(function(){e(s),r.emit("error",s)})}return r}i(Eo,"tunnel");Nn.exports=Eo});var yt=h(Rn=>{"use strict";Rn.parse=function(t,e){return new gt(t,e).parse()};var qe=class qe{constructor(e,r){this.source=e,this.transform=r||So,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new qe(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(qe,"ArrayParser");var gt=qe;function So(t){return t}i(So,"identity")});var Et=h((sf,xn)=>{var To=yt();xn.exports={create:i(function(t,e){return{parse:i(function(){return To.parse(t,e)},"parse")}},"create")}});var qn=h((of,Pn)=>{"use strict";var vo=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,bo=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Ao=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,wo=/^-?infinity$/;Pn.exports=i(function(e){if(wo.test(e))return Number(e.replace("i","I"));var r=vo.exec(e);if(!r)return Co(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=Ln(s));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),u=parseInt(r[5],10),l=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var f,_=Oo(e);return _!=null?(f=new Date(Date.UTC(s,a,o,c,u,l,p)),St(s)&&f.setUTCFullYear(s),_!==0&&f.setTime(f.getTime()-_)):(f=new Date(s,a,o,c,u,l,p),St(s)&&f.setFullYear(s)),f},"parseDate");function Co(t){var e=bo.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=Ln(r));var s=parseInt(e[2],10)-1,a=e[3],o=new Date(r,s,a);return St(r)&&o.setFullYear(r),o}}i(Co,"getDate");function Oo(t){if(t.endsWith("+00"))return 0;var e=Ao.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(Oo,"timeZoneOffset");function Ln(t){return-(t-1)}i(Ln,"bcYearToNegativeYear");function St(t){return t>=0&&t<100}i(St,"is0To99")});var Dn=h((uf,Mn)=>{Mn.exports=Io;var No=Object.prototype.hasOwnProperty;function Io(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)No.call(r,n)&&(t[n]=r[n])}return t}i(Io,"extend")});var kn=h((pf,Bn)=>{"use strict";var Ro=Dn();Bn.exports=Y;function Y(t){if(!(this instanceof Y))return new Y(t);Ro(this,Qo(t))}i(Y,"PostgresInterval");var xo=["seconds","minutes","hours","days","months","years"];Y.prototype.toPostgres=function(){var t=xo.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var Lo={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Po=["years","months","days"],qo=["hours","minutes","seconds"];Y.prototype.toISOString=Y.prototype.toISO=function(){var t=Po.map(r,this).join(""),e=qo.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+Lo[n]}};var Tt="([+-]?\\d+)",Mo=Tt+"\\s+years?",Do=Tt+"\\s+mons?",Fo=Tt+"\\s+days?",Bo="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",ko=new RegExp([Mo,Do,Fo,Bo].map(function(t){return"("+t+")?"}).join("\\s*")),Fn={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Uo=["hours","minutes","seconds","milliseconds"];function Go(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Go,"parseMilliseconds");function Qo(t){if(!t)return{};var e=ko.exec(t),r=e[8]==="-";return Object.keys(Fn).reduce(function(n,s){var a=Fn[s],o=e[a];return!o||(o=s==="milliseconds"?Go(o):parseInt(o,10),!o)||(r&&~Uo.indexOf(s)&&(o*=-1),n[s]=o),n},{})}i(Qo,"parse")});var Gn=h((ff,Un)=>{"use strict";Un.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var a=0;a<Math.floor(s/2);++a)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var zn=h((_f,$n)=>{var me=yt(),ge=Et(),Me=qn(),Hn=kn(),jn=Gn();function De(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(De,"allowNull");function Wn(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(Wn,"parseBool");function Ho(t){return t?me.parse(t,Wn):null}i(Ho,"parseBoolArray");function jo(t){return parseInt(t,10)}i(jo,"parseBaseTenInt");function vt(t){return t?me.parse(t,De(jo)):null}i(vt,"parseIntegerArray");function Wo(t){return t?me.parse(t,De(function(e){return Vn(e).trim()})):null}i(Wo,"parseBigIntegerArray");var Vo=i(function(t){if(!t)return null;var e=ge.create(t,function(r){return r!==null&&(r=Ct(r)),r});return e.parse()},"parsePointArray"),bt=i(function(t){if(!t)return null;var e=ge.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),D=i(function(t){if(!t)return null;var e=ge.create(t);return e.parse()},"parseStringArray"),At=i(function(t){if(!t)return null;var e=ge.create(t,function(r){return r!==null&&(r=Me(r)),r});return e.parse()},"parseDateArray"),$o=i(function(t){if(!t)return null;var e=ge.create(t,function(r){return r!==null&&(r=Hn(r)),r});return e.parse()},"parseIntervalArray"),zo=i(function(t){return t?me.parse(t,De(jn)):null},"parseByteAArray"),wt=i(function(t){return parseInt(t,10)},"parseInteger"),Vn=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Qn=i(function(t){return t?me.parse(t,De(JSON.parse)):null},"parseJsonArray"),Ct=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Ko=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var a=Ct(e);return a.radius=parseFloat(r),a},"parseCircle"),Jo=i(function(t){t(20,Vn),t(21,wt),t(23,wt),t(26,wt),t(700,parseFloat),t(701,parseFloat),t(16,Wn),t(1082,Me),t(1114,Me),t(1184,Me),t(600,Ct),t(651,D),t(718,Ko),t(1e3,Ho),t(1001,zo),t(1005,vt),t(1007,vt),t(1028,vt),t(1016,Wo),t(1017,Vo),t(1021,bt),t(1022,bt),t(1231,bt),t(1014,D),t(1015,D),t(1008,D),t(1009,D),t(1040,D),t(1041,D),t(1115,At),t(1182,At),t(1185,At),t(1186,Hn),t(1187,$o),t(17,jn),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Qn),t(3807,Qn),t(3907,D),t(2951,D),t(791,D),t(1183,D),t(1270,D)},"init");$n.exports={init:Jo}});var Jn=h((gf,Kn)=>{"use strict";var P=1e6;function Yo(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",a,o,c,u,l,p;{if(a=e%P,e=e/P>>>0,o=4294967296*a+r,r=o/P>>>0,c=""+(o-P*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,p=0;p<l;p++)u+="0";s=u+c+s}{if(a=e%P,e=e/P>>>0,o=4294967296*a+r,r=o/P>>>0,c=""+(o-P*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,p=0;p<l;p++)u+="0";s=u+c+s}{if(a=e%P,e=e/P>>>0,o=4294967296*a+r,r=o/P>>>0,c=""+(o-P*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,p=0;p<l;p++)u+="0";s=u+c+s}return a=e%P,o=4294967296*a+r,c=""+o%P,n+c+s}i(Yo,"readInt8");Kn.exports=Yo});var ts=h((Ef,es)=>{var Zo=Jn(),T=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(S,C,R){return S*Math.pow(2,R)+C};var a=r>>3,o=i(function(S){return n?~S&255:S},"inv"),c=255,u=8-r%8;e<u&&(c=255<<8-e&255,u=e),r&&(c=c>>r%8);var l=0;r%8+e>=8&&(l=s(0,o(t[a])&c,u));for(var p=e+r>>3,f=a+1;f<p;f++)l=s(l,o(t[f]),8);var _=(e+r)%8;return _>0&&(l=s(l,o(t[p])>>8-_,_)),l},"parseBits"),Xn=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=T(t,1),a=T(t,r,1);if(a===0)return 0;var o=1,c=i(function(l,p,f){l===0&&(l=1);for(var _=1;_<=f;_++)o/=2,(p&1<<f-_)>0&&(l+=o);return l},"parsePrecisionBits"),u=T(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?u===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,a-n)*u},"parseFloatFromBits"),Xo=i(function(t){return T(t,1)==1?-1*(T(t,15,1,!0)+1):T(t,15,1)},"parseInt16"),Yn=i(function(t){return T(t,1)==1?-1*(T(t,31,1,!0)+1):T(t,31,1)},"parseInt32"),ec=i(function(t){return Xn(t,23,8)},"parseFloat32"),tc=i(function(t){return Xn(t,52,11)},"parseFloat64"),rc=i(function(t){var e=T(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,T(t,16,16)),n=0,s=[],a=T(t,16),o=0;o<a;o++)n+=T(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,T(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),Zn=i(function(t,e){var r=T(e,1),n=T(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(a){this.usec=a},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),ye=i(function(t){for(var e=T(t,32),r=T(t,32,32),n=T(t,32,64),s=96,a=[],o=0;o<e;o++)a[o]=T(t,32,s),s+=32,s+=32;var c=i(function(l){var p=T(t,32,s);if(s+=32,p==4294967295)return null;var f;if(l==23||l==20)return f=T(t,p*8,s),s+=p*8,f;if(l==25)return f=t.toString(this.encoding,s>>3,(s+=p<<3)>>3),f;console.log("ERROR: ElementType not implemented: "+l)},"parseElement"),u=i(function(l,p){var f=[],_;if(l.length>1){var S=l.shift();for(_=0;_<S;_++)f[_]=u(l,p);l.unshift(S)}else for(_=0;_<l[0];_++)f[_]=c(p);return f},"parse");return u(a,n)},"parseArray"),nc=i(function(t){return t.toString("utf8")},"parseText"),sc=i(function(t){return t===null?null:T(t,8)>0},"parseBool"),ic=i(function(t){t(20,Zo),t(21,Xo),t(23,Yn),t(26,Yn),t(1700,rc),t(700,ec),t(701,tc),t(16,sc),t(1114,Zn.bind(null,!1)),t(1184,Zn.bind(null,!0)),t(1e3,ye),t(1007,ye),t(1016,ye),t(1008,ye),t(1009,ye),t(25,nc)},"init");es.exports={init:ic}});var ns=h((Tf,rs)=>{rs.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var Te=h(Se=>{var ac=zn(),oc=ts(),cc=Et(),uc=ns();Se.getTypeParser=lc;Se.setTypeParser=pc;Se.arrayParser=cc;Se.builtins=uc;var Ee={text:{},binary:{}};function ss(t){return String(t)}i(ss,"noParse");function lc(t,e){return e=e||"text",Ee[e]&&Ee[e][t]||ss}i(lc,"getTypeParser");function pc(t,e,r){typeof e=="function"&&(r=e,e="text"),Ee[e][t]=r}i(pc,"setTypeParser");ac.init(function(t,e){Ee.text[t]=e});oc.init(function(t,e){Ee.binary[t]=e})});var ve=h((Af,Ot)=>{"use strict";Ot.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Z=Te(),hc=Z.getTypeParser(20,"text"),fc=Z.getTypeParser(1016,"text");Ot.exports.__defineSetter__("parseInt8",function(t){Z.setTypeParser(20,"text",t?Z.getTypeParser(23,"text"):hc),Z.setTypeParser(1016,"text",t?Z.getTypeParser(1007,"text"):fc)})});var be=h((wf,as)=>{"use strict";var dc=ve();function _c(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(_c,"escapeElement");function is(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+is(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=_c(Fe(t[r]));return e=e+"}",e}i(is,"arrayString");var Fe=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?dc.parseInputDatesAsUTC?yc(t):gc(t):Array.isArray(t)?is(t):typeof t=="object"?mc(t,e):t.toString()},"prepareValue");function mc(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),Fe(t.toPostgres(Fe),e)}return JSON.stringify(t)}i(mc,"prepareObject");function I(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(I,"pad");function gc(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=I(r,4)+"-"+I(t.getMonth()+1,2)+"-"+I(t.getDate(),2)+"T"+I(t.getHours(),2)+":"+I(t.getMinutes(),2)+":"+I(t.getSeconds(),2)+"."+I(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=I(Math.floor(e/60),2)+":"+I(e%60,2),n&&(s+=" BC"),s}i(gc,"dateToString");function yc(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=I(e,4)+"-"+I(t.getUTCMonth()+1,2)+"-"+I(t.getUTCDate(),2)+"T"+I(t.getUTCHours(),2)+":"+I(t.getUTCMinutes(),2)+":"+I(t.getUTCSeconds(),2)+"."+I(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(yc,"dateToStringUTC");function Ec(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(Ec,"normalizeQueryConfig");var Sc=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),Tc=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");as.exports={prepareValue:i(function(e){return Fe(e)},"prepareValueWrapper"),normalizeQueryConfig:Ec,escapeIdentifier:Sc,escapeLiteral:Tc}});var cs=h((Of,os)=>{"use strict";var Ae=require("crypto");function Nt(t){return Ae.createHash("md5").update(t,"utf-8").digest("hex")}i(Nt,"md5");function vc(t,e,r){var n=Nt(e+t),s=Nt(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(vc,"postgresMd5PasswordHash");function bc(t){return Ae.createHash("sha256").update(t).digest()}i(bc,"sha256");function Ac(t,e){return Ae.createHmac("sha256",t).update(e).digest()}i(Ac,"hmacSha256");async function wc(t,e,r){return Ae.pbkdf2Sync(t,e,r,32,"sha256")}i(wc,"deriveKey");os.exports={postgresMd5PasswordHash:vc,randomBytes:Ae.randomBytes,deriveKey:wc,sha256:bc,hmacSha256:Ac,md5:Nt}});var hs=h((If,ps)=>{var us=require("crypto");ps.exports={postgresMd5PasswordHash:Oc,randomBytes:Cc,deriveKey:Rc,sha256:Nc,hmacSha256:Ic,md5:It};var ls=us.webcrypto||globalThis.crypto,X=ls.subtle,Rt=new TextEncoder;function Cc(t){return ls.getRandomValues(Buffer.alloc(t))}i(Cc,"randomBytes");async function It(t){try{return us.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?Rt.encode(t):t,n=await X.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(It,"md5");async function Oc(t,e,r){var n=await It(e+t),s=await It(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Oc,"postgresMd5PasswordHash");async function Nc(t){return await X.digest("SHA-256",t)}i(Nc,"sha256");async function Ic(t,e){let r=await X.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await X.sign("HMAC",r,Rt.encode(e))}i(Ic,"hmacSha256");async function Rc(t,e,r){let n=await X.importKey("raw",Rt.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await X.deriveBits(s,n,32*8,["deriveBits"])}i(Rc,"deriveKey")});var Lt=h((xf,xt)=>{"use strict";var xc=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;xc?xt.exports=cs():xt.exports=hs()});var ms=h((Lf,_s)=>{"use strict";var V=Lt();function Lc(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=V.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(Lc,"startSession");async function Pc(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=Dc(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o="c=biws,r="+n.nonce,c=s+","+a+","+o,u=Buffer.from(n.salt,"base64"),l=await V.deriveKey(e,u,n.iteration),p=await V.hmacSha256(l,"Client Key"),f=await V.sha256(p),_=await V.hmacSha256(f,c),S=Bc(Buffer.from(p),Buffer.from(_)).toString("base64"),C=await V.hmacSha256(l,"Server Key"),R=await V.hmacSha256(C,c);t.message="SASLResponse",t.serverSignature=Buffer.from(R).toString("base64"),t.response=o+",p="+S}i(Pc,"continueSession");function qc(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=Fc(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(qc,"finalizeSession");function Mc(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Mc,"isPrintableChars");function fs(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(fs,"isBase64");function ds(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(ds,"parseAttributePairs");function Dc(t){let e=ds(t),r=e.get("r");if(r){if(!Mc(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!fs(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(s,10);return{nonce:r,salt:n,iteration:a}}i(Dc,"parseServerFirstMessage");function Fc(t){let r=ds(t).get("v");if(r){if(!fs(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(Fc,"parseServerFinalMessage");function Bc(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(Bc,"xorBuffers");_s.exports={startSession:Lc,continueSession:Pc,finalizeSession:qc}});var Pt=h((qf,gs)=>{"use strict";var kc=Te();function Be(t){this._types=t||kc,this.text={},this.binary={}}i(Be,"TypeOverrides");Be.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};Be.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};Be.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};gs.exports=Be});var Es=h((Df,ys)=>{"use strict";function qt(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(qt,"parse");ys.exports=qt;qt.parse=qt});var Ft=h((Bf,vs)=>{"use strict";var Uc=require("dns"),Ts=ve(),Ss=Es().parse,L=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||Ts[t]},"val"),Gc=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Ts.ssl},"readSSLConfigFromEnvironment"),ee=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),F=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+ee(n))},"add"),Dt=class Dt{constructor(e){e=typeof e=="string"?Ss(e):e||{},e.connectionString&&(e=Object.assign({},e,Ss(e.connectionString))),this.user=L("user",e),this.database=L("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(L("port",e),10),this.host=L("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:L("password",e)}),this.binary=L("binary",e),this.options=L("options",e),this.ssl=typeof e.ssl>"u"?Gc():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=L("client_encoding",e),this.replication=L("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=L("application_name",e,"PGAPPNAME"),this.fallback_application_name=L("fallback_application_name",e,!1),this.statement_timeout=L("statement_timeout",e,!1),this.lock_timeout=L("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=L("idle_in_transaction_session_timeout",e,!1),this.query_timeout=L("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];F(r,this,"user"),F(r,this,"password"),F(r,this,"port"),F(r,this,"application_name"),F(r,this,"fallback_application_name"),F(r,this,"connect_timeout"),F(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(F(r,n,"sslmode"),F(r,n,"sslca"),F(r,n,"sslkey"),F(r,n,"sslcert"),F(r,n,"sslrootcert"),this.database&&r.push("dbname="+ee(this.database)),this.replication&&r.push("replication="+ee(this.replication)),this.host&&r.push("host="+ee(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+ee(this.client_encoding)),Uc.lookup(this.host,function(s,a){return s?e(s,null):(r.push("hostaddr="+ee(a)),e(null,r.join(" ")))})}};i(Dt,"ConnectionParameters");var Mt=Dt;vs.exports=Mt});var ws=h((Uf,As)=>{"use strict";var Qc=Te(),bs=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,kt=class kt{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=bs.exec(e.text):r=bs.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var a=e[n];a!==null?r[n]=this._parsers[n](a):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var a=e[n],o=this.fields[n].name;a!==null?r[o]=this._parsers[n](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=Qc.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(kt,"Result");var Bt=kt;As.exports=Bt});var Is=h((Qf,Ns)=>{"use strict";var{EventEmitter:Hc}=require("events"),Cs=ws(),Os=be(),Gt=class Gt extends Hc{constructor(e,r,n){super(),e=Os.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Cs(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Cs(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Os.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(Gt,"Query");var Ut=Gt;Ns.exports=Ut});var mr=h(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.NoticeMessage=d.DataRowMessage=d.CommandCompleteMessage=d.ReadyForQueryMessage=d.NotificationResponseMessage=d.BackendKeyDataMessage=d.AuthenticationMD5Password=d.ParameterStatusMessage=d.ParameterDescriptionMessage=d.RowDescriptionMessage=d.Field=d.CopyResponse=d.CopyDataMessage=d.DatabaseError=d.copyDone=d.emptyQuery=d.replicationStart=d.portalSuspended=d.noData=d.closeComplete=d.bindComplete=d.parseComplete=void 0;d.parseComplete={name:"parseComplete",length:5};d.bindComplete={name:"bindComplete",length:5};d.closeComplete={name:"closeComplete",length:5};d.noData={name:"noData",length:5};d.portalSuspended={name:"portalSuspended",length:5};d.replicationStart={name:"replicationStart",length:4};d.emptyQuery={name:"emptyQuery",length:4};d.copyDone={name:"copyDone",length:4};var rr=class rr extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(rr,"DatabaseError");var Qt=rr;d.DatabaseError=Qt;var nr=class nr{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(nr,"CopyDataMessage");var Ht=nr;d.CopyDataMessage=Ht;var sr=class sr{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(sr,"CopyResponse");var jt=sr;d.CopyResponse=jt;var ir=class ir{constructor(e,r,n,s,a,o,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(ir,"Field");var Wt=ir;d.Field=Wt;var ar=class ar{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(ar,"RowDescriptionMessage");var Vt=ar;d.RowDescriptionMessage=Vt;var or=class or{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(or,"ParameterDescriptionMessage");var $t=or;d.ParameterDescriptionMessage=$t;var cr=class cr{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(cr,"ParameterStatusMessage");var zt=cr;d.ParameterStatusMessage=zt;var ur=class ur{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(ur,"AuthenticationMD5Password");var Kt=ur;d.AuthenticationMD5Password=Kt;var lr=class lr{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(lr,"BackendKeyDataMessage");var Jt=lr;d.BackendKeyDataMessage=Jt;var pr=class pr{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(pr,"NotificationResponseMessage");var Yt=pr;d.NotificationResponseMessage=Yt;var hr=class hr{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(hr,"ReadyForQueryMessage");var Zt=hr;d.ReadyForQueryMessage=Zt;var fr=class fr{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(fr,"CommandCompleteMessage");var Xt=fr;d.CommandCompleteMessage=Xt;var dr=class dr{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(dr,"DataRowMessage");var er=dr;d.DataRowMessage=er;var _r=class _r{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(_r,"NoticeMessage");var tr=_r;d.NoticeMessage=tr});var Rs=h(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.Writer=void 0;var yr=class yr{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(yr,"Writer");var gr=yr;ke.Writer=gr});var Ls=h(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.serialize=void 0;var Er=Rs(),v=new Er.Writer,jc=i(t=>{v.addInt16(3).addInt16(0);for(let n of Object.keys(t))v.addCString(n).addCString(t[n]);v.addCString("client_encoding").addCString("UTF8");var e=v.addCString("").flush(),r=e.length+4;return new Er.Writer().addInt32(r).add(e).flush()},"startup"),Wc=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Vc=i(t=>v.addCString(t).flush(112),"password"),$c=i(function(t,e){return v.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),v.flush(112)},"sendSASLInitialResponseMessage"),zc=i(function(t){return v.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Kc=i(t=>v.addCString(t).flush(81),"query"),xs=[],Jc=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||xs;for(var n=r.length,s=v.addCString(e).addCString(t.text).addInt16(n),a=0;a<n;a++)s.addInt32(r[a]);return v.flush(80)},"parse"),te=new Er.Writer,Yc=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(v.addInt16(0),te.addInt32(-1)):n instanceof Buffer?(v.addInt16(1),te.addInt32(n.length),te.add(n)):(v.addInt16(0),te.addInt32(Buffer.byteLength(n)),te.addString(n))}},"writeValues"),Zc=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||xs,a=s.length;return v.addCString(e).addCString(r),v.addInt16(a),Yc(s,t.valueMapper),v.addInt16(a),v.add(te.flush()),v.addInt16(n?1:0),v.flush(66)},"bind"),Xc=Buffer.from([69,0,0,0,9,0,0,0,0,0]),eu=i(t=>{if(!t||!t.portal&&!t.rows)return Xc;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,a=Buffer.allocUnsafe(1+s);return a[0]=69,a.writeInt32BE(s,1),a.write(e,5,"utf-8"),a[n+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),tu=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),Sr=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),ru=v.addCString("P").flush(68),nu=v.addCString("S").flush(68),su=i(t=>t.name?Sr(68,`${t.type}${t.name||""}`):t.type==="P"?ru:nu,"describe"),iu=i(t=>{let e=`${t.type}${t.name||""}`;return Sr(67,e)},"close"),au=i(t=>v.add(t).flush(100),"copyData"),ou=i(t=>Sr(102,t),"copyFail"),Ue=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),cu=Ue(72),uu=Ue(83),lu=Ue(88),pu=Ue(99),hu={startup:jc,password:Vc,requestSsl:Wc,sendSASLInitialResponseMessage:$c,sendSCRAMClientFinalMessage:zc,query:Kc,parse:Jc,bind:Zc,execute:eu,describe:su,close:iu,flush:i(()=>cu,"flush"),sync:i(()=>uu,"sync"),end:i(()=>lu,"end"),copyData:au,copyDone:i(()=>pu,"copyDone"),copyFail:ou,cancel:tu};Ge.serialize=hu});var Ps=h(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.BufferReader=void 0;var fu=Buffer.allocUnsafe(0),vr=class vr{constructor(e=0){this.offset=e,this.buffer=fu,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(vr,"BufferReader");var Tr=vr;Qe.BufferReader=Tr});var Ds=h(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.Parser=void 0;var b=mr(),du=Ps(),br=1,_u=4,qs=br+_u,Ms=Buffer.allocUnsafe(0),wr=class wr{constructor(e){if(this.buffer=Ms,this.bufferLength=0,this.bufferOffset=0,this.reader=new du.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+qs<=n;){let a=this.buffer[s],o=this.buffer.readUInt32BE(s+br),c=br+o;if(c+s<=n){let u=this.handlePacket(s+qs,a,o,this.buffer);r(u),s+=c}else break}s===n?(this.buffer=Ms,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;s=Buffer.allocUnsafe(a)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return b.bindComplete;case 49:return b.parseComplete;case 51:return b.closeComplete;case 110:return b.noData;case 115:return b.portalSuspended;case 99:return b.copyDone;case 87:return b.replicationStart;case 73:return b.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new b.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new b.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new b.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new b.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new b.CopyResponse(r,s,a,o);for(let u=0;u<o;u++)c.columnTypes[u]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new b.NotificationResponseMessage(r,s,a,o)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new b.RowDescriptionMessage(r,s);for(let o=0;o<s;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new b.Field(e,r,n,s,a,o,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new b.ParameterDescriptionMessage(r,s);for(let o=0;o<s;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new Array(s);for(let o=0;o<s;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new b.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),a=this.reader.cstring();return new b.ParameterStatusMessage(r,s,a)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.int32();return new b.BackendKeyDataMessage(r,s,a)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new b.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return a}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,u=s==="notice"?new b.NoticeMessage(r,c):new b.DatabaseError(c,r,s);return u.severity=a.S,u.code=a.C,u.detail=a.D,u.hint=a.H,u.position=a.P,u.internalPosition=a.p,u.internalQuery=a.q,u.where=a.W,u.schema=a.s,u.table=a.t,u.column=a.c,u.dataType=a.d,u.constraint=a.n,u.file=a.F,u.line=a.L,u.routine=a.R,u}};i(wr,"Parser");var Ar=wr;He.Parser=Ar});var Cr=h(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.DatabaseError=Q.serialize=Q.parse=void 0;var mu=mr();Object.defineProperty(Q,"DatabaseError",{enumerable:!0,get:i(function(){return mu.DatabaseError},"get")});var gu=Ls();Object.defineProperty(Q,"serialize",{enumerable:!0,get:i(function(){return gu.serialize},"get")});var yu=Ds();function Eu(t,e){let r=new yu.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(Eu,"parse");Q.parse=Eu});var Fs={};la(Fs,{default:()=>Su});var Su,Bs=ua(()=>{Su={}});var ks=h((rd,Or)=>{Or.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(Bs(),ha(Fs));return new n(e)}},"getStream");Or.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var Rr=h((id,Us)=>{"use strict";var sd=require("net"),Tu=require("events").EventEmitter,{parse:vu,serialize:N}=Cr(),{getStream:bu,getSecureStream:Au}=ks(),wu=N.flush(),Cu=N.sync(),Ou=N.end(),Ir=class Ir extends Tu{constructor(e){super(),e=e||{},this.stream=e.stream||bu(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(a){n._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||n.emit("error",a)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var u=require("net");u.isIP&&u.isIP(r)===0&&(c.servername=r);try{n.stream=Au(c)}catch(l){return n.emit("error",l)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){vu(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(N.requestSsl())}startup(e){this.stream.write(N.startup(e))}cancel(e,r){this._send(N.cancel(e,r))}password(e){this._send(N.password(e))}sendSASLInitialResponseMessage(e,r){this._send(N.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(N.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(N.query(e))}parse(e){this._send(N.parse(e))}bind(e){this._send(N.bind(e))}execute(e){this._send(N.execute(e))}flush(){this.stream.writable&&this.stream.write(wu)}sync(){this._ending=!0,this._send(Cu)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(Ou,()=>{this.stream.end()})}close(e){this._send(N.close(e))}describe(e){this._send(N.describe(e))}sendCopyFromChunk(e){this._send(N.copyData(e))}endCopyFrom(){this._send(N.copyDone())}sendCopyFail(e){this._send(N.copyFail(e))}};i(Ir,"Connection");var Nr=Ir;Us.exports=Nr});var js=h((od,Hs)=>{"use strict";var{Transform:Nu}=require("stream"),{StringDecoder:Iu}=require("string_decoder"),H=Symbol("last"),je=Symbol("decoder");function Ru(t,e,r){let n;if(this.overflow){if(n=this[je].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[H]+=this[je].write(t),n=this[H].split(this.matcher);this[H]=n.pop();for(let s=0;s<n.length;s++)try{Qs(this,this.mapper(n[s]))}catch(a){return r(a)}if(this.overflow=this[H].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(Ru,"transform");function xu(t){if(this[H]+=this[je].end(),this[H])try{Qs(this,this.mapper(this[H]))}catch(e){return t(e)}t()}i(xu,"flush");function Qs(t,e){e!==void 0&&t.push(e)}i(Qs,"push");function Gs(t){return t}i(Gs,"noop");function Lu(t,e,r){switch(t=t||/\r?\n/,e=e||Gs,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Gs)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=Ru,r.flush=xu,r.readableObjectMode=!0;let n=new Nu(r);return n[H]="",n[je]=new Iu("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,a){this._writableState.errorEmitted=!1,a(s)},n}i(Lu,"split");Hs.exports=Lu});var $s=h((ud,U)=>{"use strict";var Ws=require("path"),Pu=require("stream").Stream,qu=js(),Vs=require("util"),Mu=5432,We=process.platform==="win32",we=process.stderr,Du=56,Fu=7,Bu=61440,ku=32768;function Uu(t){return(t&Bu)==ku}i(Uu,"isRegFile");var re=["host","port","database","user","password"],xr=re.length,Gu=re[xr-1];function Lr(){var t=we instanceof Pu&&we.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);we.write(Vs.format.apply(Vs,e))}}i(Lr,"warn");Object.defineProperty(U.exports,"isWin",{get:i(function(){return We},"get"),set:i(function(t){We=t},"set")});U.exports.warnTo=function(t){var e=we;return we=t,e};U.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(We?Ws.join(e.APPDATA||"./","postgresql","pgpass.conf"):Ws.join(e.HOME||"./",".pgpass"));return r};U.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:We?!0:(e=e||"<unkn>",Uu(t.mode)?t.mode&(Du|Fu)?(Lr('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Lr('WARNING: password file "%s" is not a plain file',e),!1))};var Qu=U.exports.match=function(t,e){return re.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||Mu)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};U.exports.getPassword=function(t,e,r){var n,s=e.pipe(qu());function a(u){var l=Hu(u);l&&ju(l)&&Qu(t,l)&&(n=l[Gu],s.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(u){e.destroy(),Lr("WARNING: error on reading file: %s",u),r(void 0)},"onErr");e.on("error",c),s.on("data",a).on("end",o).on("error",c)};var Hu=U.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,a=0,o={},c=!1,u=i(function(p,f,_){var S=t.substring(f,_);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(S=S.replace(/\\([:\\])/g,"$1")),o[re[p]]=S},"addToObj"),l=0;l<t.length-1;l+=1){if(e=t.charAt(l+1),r=t.charAt(l),c=n==xr-1,c){u(n,s);break}l>=0&&e==":"&&r!=="\\"&&(u(n,s,l+1),s=l+2,n+=1)}return o=Object.keys(o).length===xr?o:null,o},ju=U.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<re.length;r+=1){var n=e[r],s=t[re[r]]||"",a=n(s);if(!a)return!1}return!0}});var Ks=h((hd,Pr)=>{"use strict";var pd=require("path"),zs=require("fs"),Ve=$s();Pr.exports=function(t,e){var r=Ve.getFileName();zs.stat(r,function(n,s){if(n||!Ve.usePgPass(s,r))return e(void 0);var a=zs.createReadStream(r);Ve.getPassword(t,a,e)})};Pr.exports.warnTo=Ve.warnTo});var Xs=h((fd,Zs)=>{"use strict";var Wu=require("events").EventEmitter,Js=be(),qr=ms(),Vu=Pt(),$u=Ft(),Ys=Is(),zu=ve(),Ku=Rr(),Ju=Lt(),Mr=class Mr extends Wu{constructor(e){super(),this.connectionParameters=new $u(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Vu(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Ku({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||zu.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{Ks()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await Ju.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=qr.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await qr.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{qr.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Js.escapeIdentifier(e)}escapeLiteral(e){return Js.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,a,o,c,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(o=this.connectionParameters.query_timeout,s=new Ys(e,r,n),s.callback||(a=new this._Promise((l,p)=>{s.callback=(f,_)=>f?p(f):l(_)}).catch(l=>{throw Error.captureStackTrace(l),l}))),o&&(u=s.callback,c=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),u(l),s.callback=()=>{};var p=this.queryQueue.indexOf(s);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},o),s.callback=(l,p)=>{clearTimeout(c),u(l,p)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(s),this._pulseQueryQueue(),a):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(Mr,"Client");var $e=Mr;$e.Query=Ys;Zs.exports=$e});var ni=h((_d,ri)=>{"use strict";var Yu=require("events").EventEmitter,ei=i(function(){},"NOOP"),ti=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),Br=class Br{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(Br,"IdleItem");var Dr=Br,kr=class kr{constructor(e){this.callback=e}};i(kr,"PendingItem");var ne=kr;function Zu(){throw new Error("Release called on client which has already been released to the pool.")}i(Zu,"throwOnDoubleRelease");function ze(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(o,c){o?r(o):n(c)},"cb"),a=new t(function(o,c){n=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:s,result:a}}i(ze,"promisify");function Xu(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(Xu,"makeIdleListener");var Ur=class Ur extends Yu{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Gr().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=ti(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=ze(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ne(r.callback)),n;let s=i((c,u,l)=>{clearTimeout(o),r.callback(c,u,l)},"queueCallback"),a=new ne(s),o=setTimeout(()=>{ti(this._pendingQueue,c=>c.callback===s),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),n}return this.newClient(new ne(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=Xu(this,r);this.log("checking client timeout");let s,a=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(s&&clearTimeout(s),r.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,ei);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(l=>l.client===r)!==-1&&this._acquireClient(r,new ne((l,p,f)=>f()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,ei);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&Zu(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Dr(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=ze(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let s=ze(this.Promise,n);return n=s.callback,this.connect((a,o)=>{if(a)return n(a);let c=!1,u=i(l=>{c||(c=!0,o.release(l),n(l))},"onError");o.once("error",u),this.log("dispatching query");try{o.query(e,r,(l,p)=>{if(this.log("query dispatched"),o.removeListener("error",u),!c)return c=!0,o.release(l),l?n(l):n(void 0,p)})}catch(l){return o.release(l),n(l)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=ze(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(Ur,"Pool");var Fr=Ur;ri.exports=Fr});var ai=h((gd,ii)=>{"use strict";var si=require("events").EventEmitter,el=require("util"),Qr=be(),se=ii.exports=function(t,e,r){si.call(this),t=Qr.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};el.inherits(se,si);var tl={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};se.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=tl[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};se.prototype.then=function(t,e){return this._getPromise().then(t,e)};se.prototype.catch=function(t){return this._getPromise().catch(t)};se.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};se.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((u,l)=>{u.forEach(p=>{e.emit("row",p,c[l])})}):o.forEach(function(u){e.emit("row",u,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(Qr.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var s=this.values.map(Qr.prepareValue);t.native.query(this.text,s,r)}else t.native.query(this.text,r)}});var pi=h((Ed,li)=>{"use strict";var oi;try{oi=require("pg-native")}catch(t){throw t}var rl=Pt(),ci=require("events").EventEmitter,nl=require("util"),sl=Ft(),ui=ai(),q=li.exports=function(t){ci.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new rl(t.types),this.native=new oi({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new sl(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};q.Query=ui;nl.inherits(q,ci);q.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};q.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};q.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};q.prototype.query=function(t,e,r){var n,s,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,n=new ui(t,e,r),!n.callback){let u,l;s=new this._Promise((p,f)=>{u=p,l=f}).catch(p=>{throw Error.captureStackTrace(p),p}),n.callback=(p,f)=>p?l(p):u(f)}return a&&(c=n.callback,o=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),c(u),n.callback=()=>{};var l=this._queryQueue.indexOf(n);l>-1&&this._queryQueue.splice(l,1),this._pulseQueryQueue()},a),n.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};q.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(a=>a?s(a):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};q.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};q.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};q.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};q.prototype.ref=function(){};q.prototype.unref=function(){};q.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};q.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Hr=h((Td,hi)=>{"use strict";hi.exports=pi()});var Gr=h((vd,Ce)=>{"use strict";var il=Xs(),al=ve(),ol=Rr(),cl=ni(),{DatabaseError:ul}=Cr(),{escapeIdentifier:ll,escapeLiteral:pl}=be(),hl=i(t=>{var e;return e=class extends cl{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),jr=i(function(t){this.defaults=al,this.Client=t,this.Query=this.Client.Query,this.Pool=hl(this.Client),this._pools=[],this.Connection=ol,this.types=Te(),this.DatabaseError=ul,this.escapeIdentifier=ll,this.escapeLiteral=pl},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Ce.exports=new jr(Hr()):(Ce.exports=new jr(il),Object.defineProperty(Ce.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new jr(Hr())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Ce.exports,"native",{value:t}),t}}))});var di=h((Ad,fi)=>{var $=require("fs"),fl=In(),dl=Gr(),_l="The server does not support SSL connections",ml="28000",gl=i(t=>{let e={username:t.ssh_user,host:t.ssh_host,port:t.ssh_port,dstHost:t.host,dstPort:t.port,localHost:"127.0.0.1",localPort:t.port,keepAlive:!0};return t.ssh_method==="privateKey"?Object.assign({},e,{privateKey:$.readFileSync(t.ssh_key_file),passphrase:t.ssh_key_passphrase}):Object.assign({},e,{password:t.ssh_password})},"getSshConfig"),yl=i(t=>new Promise((e,r)=>{fl(gl(t),(n,s)=>{n?r(n):e({tunnel:s,info:Object.assign({},t,{host:"127.0.0.1"})})})}),"connectViaSsh"),El=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,a){e.info("Certificate",{hostname:s,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return $.existsSync(t.certAuthority)&&(n.ca=$.readFileSync(t.certAuthority).toString()),$.existsSync(t.clientCert)&&(n.cert=$.readFileSync(t.clientCert).toString()),$.existsSync(t.clientPrivateKey)&&(n.key=$.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),Sl=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),Tl=i(async(t,e)=>{let r=null;if(t.ssh){let{info:a,tunnel:o}=await yl(t);r=o,t=a}t=Object.assign({},t,{sslType:Sl(t.sslType)});let n={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:El(t,e),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await Wr(n,e),sshTunnel:r}},"createClient"),vl=i((t,e,r)=>{var n;if(r.message===_l&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),Wr({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===ml&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),Wr({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),Wr=i((t,e)=>{let r=new dl.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return vl(t,e,n)})},"createConnectionPool");fi.exports={createClient:Tl}});var $r=h((Cd,gi)=>{var Vr=i(t=>`
        SELECT indexname,
               index_method,
               index_unique,
               index_indnullsnotdistinct,
               number_of_keys,
               where_expression,
               array_agg(attname
                         ORDER BY ord)::text[] AS columns,
               array_agg(coll
                         ORDER BY ord) AS collations,
               array_agg(opclass
                         ORDER BY ord) AS opclasses,
               array_agg(expression
                         ORDER BY ord) AS expressions,
               array_agg(ascending
                         ORDER BY ord) AS ascendings,
               array_agg(nulls_first
                         ORDER BY ord) AS nulls_first,
                reloptions AS storage_parameters,
                tablespace_name
        FROM
            (SELECT ct.oid AS table_oid,
                    c.relname AS indexname,
                    m.amname AS index_method,
                    indexes.indisunique AS index_unique,
                    ${t===15?"indexes.indnullsnotdistinct":"FALSE"} AS index_indnullsnotdistinct,
                    indexes.ord,
                    attribute.attname,
                     c.reloptions,
                     tablespace_t.spcname AS tablespace_name,
                    indexes.${t===10?"indnatts":"indnkeyatts"} AS number_of_keys,
                    pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
                    CASE
                        WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
                    END AS coll,
                    CASE
                        WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
                    END AS opclass,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'asc')
                    END AS ascending,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'nulls_first')
                    END AS nulls_first,
                    pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
             FROM
                 (SELECT *,
                         generate_series(1,array_length(i.indkey,1)) AS ord,
                         unnest(i.indkey) AS key,
                         unnest(i.indcollation) AS coll,
                         unnest(i.indclass) AS class,
                         unnest(i.indoption) AS option
                  FROM pg_catalog.pg_index i) indexes
             JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
             JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
             JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
             LEFT JOIN pg_catalog.pg_attribute attribute ON (attribute.attrelid=indexes.indrelid
                                                  AND attribute.attnum=indexes.key)
             LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
             LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
             LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
             LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
             LEFT JOIN pg_catalog.pg_tablespace tablespace_t ON (tablespace_t.oid = c.reltablespace)) s2
        WHERE table_oid = $1
        GROUP BY indexname,
                 index_method,
                 index_unique,
                 index_indnullsnotdistinct,
                 reloptions,
                 number_of_keys,
                 where_expression,
                 tablespace_name;
        `,"getGET_TABLE_INDEXES"),_i=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),mi={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
        SELECT tables.table_name, tables.table_type FROM information_schema.tables AS tables
        INNER JOIN 
        (SELECT
                pg_class.relname AS table_name,
                 pg_namespace.nspname AS table_schema
        FROM pg_catalog.pg_class AS pg_class
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace 
                ON (pg_namespace.oid = pg_class.relnamespace)
        WHERE pg_class.relispartition = false
                AND pg_class.relkind = ANY('{"r","v","t","m","p"}'))
        AS catalog_table_data
        ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
	LEFT JOIN (SELECT relname AS child_name FROM pg_catalog.pg_inherits AS inherit
		LEFT JOIN pg_catalog.pg_class AS child ON (child.oid = inherit.inhrelid)) AS inherited_tables
	ON (inherited_tables.child_name = tables.table_name)
	WHERE inherited_tables.child_name IS NULL
        AND tables.table_schema = $1;`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pt.spcname, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc 
            LEFT JOIN pg_catalog.pg_tablespace AS pt 
            ON pc.reltablespace = pt.oid
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_PARTITION_DATA:`
        SELECT partstrat as partition_method,
	            partattrs::int2[] as partition_attributes_positions,
	            pg_catalog.pg_get_expr(partexprs, partrelid) AS expressions
            FROM pg_catalog.pg_partitioned_table
            WHERE partrelid = $1;`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1)",GET_ROWS_COUNT:i(t=>`SELECT COUNT(*) AS quantity FROM ${t};`,"GET_ROWS_COUNT"),GET_SAMPLED_DATA:i((t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,"GET_SAMPLED_DATA"),GET_SAMPLED_DATA_SIZE:i((t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,"GET_SAMPLED_DATA_SIZE"),GET_INHERITS_PARENT_TABLE_NAME:`
        SELECT pc.relname AS parent_table_name FROM pg_catalog.pg_inherits AS pi
	        INNER JOIN pg_catalog.pg_class AS pc
	        ON pc.oid = pi.inhparent
	        WHERE pi.inhrelid = $1;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.connoinherit AS no_inherit,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters,
	            pt.spcname AS tablespace
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        LEFT JOIN pg_catalog.pg_tablespace AS pt
	        ON pc.reltablespace = pt.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:Vr(),GET_TABLE_INDEXES_V_10:Vr(10),GET_TABLE_INDEXES_V_15:Vr(15),GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_tablespace AS pt ON pc.reltablespace = pt.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:_i(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:_i(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND ((pg_type.typtype = 'c'
               AND pg_class.relkind = 'c')
              OR pg_type.typtype = 'e'
              OR pg_type.typtype = 'r')
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DOMAIN_TYPES:"SELECT * FROM information_schema.domains WHERE domain_schema = $1",GET_DOMAIN_TYPES_CONSTRAINTS:`
        SELECT pg_type.typname AS type_name,
        	pg_type.typnotnull AS not_null,
        	pg_constraint.conname AS constraint_name,
        	pg_catalog.pg_get_expr(pg_constraint.conbin, pg_constraint.conrelid) AS expression
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_constraint AS pg_constraint ON (pg_constraint.contypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        WHERE pg_type.typname = $1 AND pg_namespace.nspname = $2 AND pg_constraint.contype = 'c';`,GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;",GET_TRIGGERS:`
        SELECT trigger_name,
                array_agg(event_manipulation::text) AS trigger_events,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement
        FROM
            -- This is information_schema.triggers view but without permitions
            (SELECT (current_database())::information_schema.sql_identifier AS trigger_catalog,
                    (n.nspname)::information_schema.sql_identifier AS trigger_schema,
                    (t.tgname)::information_schema.sql_identifier AS trigger_name,
                    (em.text)::information_schema.character_data AS event_manipulation,
                    (current_database())::information_schema.sql_identifier AS event_object_catalog,
                    (n.nspname)::information_schema.sql_identifier AS event_object_schema,
                    (c.relname)::information_schema.sql_identifier AS event_object_table,
                    (rank() OVER (PARTITION BY (n.nspname)::information_schema.sql_identifier,
                                               (c.relname)::information_schema.sql_identifier,
                                               em.num, ((t.tgtype)::integer & 1), ((t.tgtype)::integer & 66)
                                  ORDER BY t.tgname))::information_schema.cardinal_number AS action_order,
                    (regexp_match(pg_get_triggerdef(t.oid), '.{35,} WHEN ((.+)) EXECUTE FUNCTION'::text))[1]::information_schema.character_data AS action_condition,
                    (SUBSTRING(pg_get_triggerdef(t.oid)
                               FROM (POSITION(('EXECUTE FUNCTION'::text) IN (SUBSTRING(pg_get_triggerdef(t.oid)
                                                                                       FROM 48))) + 47)))::information_schema.character_data AS action_statement,
                    (CASE ((t.tgtype)::integer & 1)
                         WHEN 1 THEN 'ROW'::text
                         ELSE 'STATEMENT'::text
                     END)::information_schema.character_data AS action_orientation,
                    (CASE ((t.tgtype)::integer & 66)
                         WHEN 2 THEN 'BEFORE'::text
                         WHEN 64 THEN 'INSTEAD OF'::text
                         ELSE 'AFTER'::text
                     END)::information_schema.character_data AS action_timing,
                    (t.tgoldtable)::information_schema.sql_identifier AS action_reference_old_table,
                    (t.tgnewtable)::information_schema.sql_identifier AS action_reference_new_table,
                    (NULL::timestamp with time zone)::information_schema.time_stamp AS created
                FROM pg_namespace n,
                        pg_class c,
                        pg_trigger t, (VALUES (4,'INSERT'::text), (8,'DELETE'::text), (16,'UPDATE'::text)) em(num, text)
                WHERE ((n.oid = c.relnamespace)
                        AND (c.oid = t.tgrelid)
                        AND (((t.tgtype)::integer & em.num) <> 0)
                        AND (NOT t.tgisinternal)
                        AND (NOT pg_is_other_temp_schema(n.oid)))) AS tmp_views
        WHERE event_object_schema = $1 AND event_object_table = $2
        GROUP BY
                trigger_schema,
                trigger_name,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement;`,GET_TRIGGERS_ADDITIONAL_DATA:`
        SELECT
                pg_catalog.obj_description(pg_trigger.oid, 'pg_trigger') AS description,
        	pg_trigger.tgname AS trigger_name,
        	pg_proc.proname AS function_name,
        	CASE WHEN pg_trigger.tgconstraint != 0 THEN true ELSE false END AS "constraint",
        	array_agg(pg_attribute.attname)::text[] AS update_attributes,
        	tgdeferrable AS "deferrable",
        	tginitdeferred AS deferred,
                pg_class_referenced.relname AS referenced_table_name,
                pg_namespace_referenced.nspname AS referenced_table_schema
        FROM pg_catalog.pg_trigger as pg_trigger
        LEFT JOIN pg_catalog.pg_proc AS pg_proc 
        	ON (pg_trigger.tgfoid = pg_proc.oid)
        LEFT JOIN pg_catalog.pg_attribute AS pg_attribute
        	ON (pg_attribute.attnum = ANY(pg_trigger.tgattr::int2[]) AND pg_trigger.tgrelid = pg_attribute.attrelid)
        INNER JOIN pg_catalog.pg_class AS pg_class
        	ON (pg_class.oid = pg_trigger.tgrelid)
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace
        	ON (pg_class.relnamespace = pg_namespace.oid)
        LEFT JOIN pg_catalog.pg_class AS pg_class_referenced
                ON(pg_class_referenced.oid = pg_trigger.tgconstrrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace_referenced
                ON(pg_namespace_referenced.oid = pg_class_referenced.relnamespace)
        WHERE pg_class.relnamespace = $1 AND pg_class.oid = $2
        GROUP BY 
        	trigger_name,
        	function_name,
        	"constraint",
        	"deferrable",
        	deferred,
                description,
                referenced_table_name,
                referenced_table_schema;`,GET_PARTITIONS:`
        SELECT
        	inher_child.relname AS child_name,
        	inher_parent.relname AS parent_name,
                CASE WHEN inher_parent.relkind = 'p' THEN TRUE ELSE FALSE END AS is_parent_partitioned
        FROM pg_inherits
        LEFT JOIN pg_class AS inher_child ON (inher_child.oid = pg_inherits.inhrelid)
        LEFT JOIN pg_class AS inher_parent ON (inher_parent.oid = pg_inherits.inhparent)
        WHERE inher_parent.relnamespace = $1;`,GET_SEQUENCES:`
        SELECT DISTINCT ON (sequence_name)
                information_schema."sequences".sequence_name,
                information_schema."sequences".data_type,
                information_schema."sequences".start_value,
                information_schema."sequences".minimum_value,
                information_schema."sequences".maximum_value,
                information_schema."sequences"."increment",
                information_schema."sequences".cycle_option,
                pg_catalog.pg_sequences.cache_size,
                pg_class.relpersistence as rel_persistance,
                inner_pg_class.relname AS table_name,
                pg_attribute.attname AS column_name
        FROM information_schema."sequences"
        JOIN pg_class ON pg_class.relname = information_schema."sequences".sequence_name
        JOIN pg_depend ON pg_depend.objid = pg_class.oid
        LEFT JOIN pg_catalog.pg_sequences ON (pg_catalog.pg_sequences.schemaname, pg_catalog.pg_sequences.sequencename) = (information_schema."sequences".sequence_schema, information_schema."sequences".sequence_name)
        LEFT JOIN pg_class AS inner_pg_class ON pg_depend.refobjid = inner_pg_class.oid
        LEFT JOIN pg_attribute ON (pg_depend.refobjid, pg_depend.refobjsubid) = (pg_attribute.attrelid, pg_attribute.attnum)
        WHERE pg_class.relkind = 'S'
        AND information_schema."sequences".sequence_schema = $1
        ORDER BY sequence_name, column_name;
        `},bl=i(t=>(Object.entries(mi).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");gi.exports={getQueryName:bl,...mi}});var Ei=h((Nd,yi)=>{var Al=$r(),z=null,Ke=null;yi.exports={initializeClient(t,e){z=t,Ke=e,z.on("error",r=>e.error(r))},isClientInitialized(){return!!z},releaseClient(){return z?new Promise(t=>{z.end(()=>{z=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=Al.getQueryName(t);Ke.info("Execute query",{queryName:n,params:e});let s=Date.now(),a=await z.query(t,e),o=Date.now()-s;Ke.info("Query executed",{queryName:n,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,Ke.error(n),null}}}});var vi=h((Id,Ti)=>{var Si=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...Si(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");Ti.exports={getJsonSchema:Si}});var zr=h((xd,bi)=>{var j=null,wl=i(t=>{j=t.require("lodash")},"setDependencies"),Oe={column_default:"default",is_nullable:{keyword:"required",values:{YES:!1,NO:!0}},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:i((t,e)=>e!==-1&&ql(t.data_type),"check")},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:"length",description:"description",domain_name:"domain_name"},Cl=i((t,e,r)=>{var n;return(n=Oe[e])!=null&&n.check?Oe[e].check(t,r)?r:"":j.get(Oe,`${e}.values.${r}`,r)},"getColumnValue"),Ol=i(t=>e=>j.chain(e).toPairs().map(([r,n])=>{var s;return[((s=Oe[r])==null?void 0:s.keyword)||Oe[r],Cl(e,r,n)]}).filter(([r,n])=>r&&!j.isNil(n)).fromPairs().thru(Nl(t)).value(),"mapColumnData"),Nl=i(t=>e=>({...e,...Il(t,e)}),"setColumnType"),Il=i((t,e)=>e.type==="ARRAY"?Rl(t,e):e.type==="USER-DEFINED"?Je(t,e.udt_name):e.domain_name?Je(t,e.domain_name):Je(t,e.type),"getType"),Rl=i((t,e)=>({...Je(t,e.udt_name.slice(1)),array_type:j.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Je=i((t,e)=>{switch(e){case"bigint":case"bigserial":case"smallint":case"integer":case"numeric":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"int8":return{type:"numeric",mode:"bigint"};case"int2":return{type:"numeric",mode:"smallint"};case"int4":return{type:"numeric",mode:"integer"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return j.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),xl=i((t,e)=>{let r=j.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],a=Ll(s),o=Pl(a);return{...n,subtype:o}})},"setSubtypeFromSampledJsonValues"),Ll=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),Pl=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),ql=i(t=>j.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");bi.exports={setDependencies:wl,mapColumnData:Ol,setSubtypeFromSampledJsonValues:xl}});var Ne=h((Pd,Ai)=>{var Ml=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],ie=null,Dl=i(t=>{ie=t.require("lodash")},"setDependencies"),Fl=i(t=>ie.chain(t).toPairs().reject(([e,r])=>ie.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Bl=i(t=>e=>{var r;return(r=ie.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),kl=i(t=>/\s|\W/.test(t)||ie.includes(Ml,ie.toUpper(t))?`"${t}"`:t,"wrapInQuotes");Ai.exports={clearEmptyPropertiesInObject:Fl,setDependencies:Dl,getColumnNameByPosition:Bl,wrapInQuotes:kl}});var Oi=h((Md,Ci)=>{var{getColumnNameByPosition:Ul}=Ne(),Kr=null,Gl=i(t=>{Kr=t.require("lodash")},"setDependencies"),wi=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),Ql=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";case"p":return"PARTIAL";default:return""}},"prepareMatch"),Hl=i((t,e,r,n)=>Kr.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:Kr.map(s.table_columns_positions,Ul(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:wi(s.relationship_on_delete),relationshipOnUpdate:wi(s.relationship_on_update),relationshipMatch:Ql(s.relationship_match)}})),"prepareForeignKeys");Ci.exports={setDependencies:Gl,prepareForeignKeys:Hl}});var Ri=h((Fd,Ii)=>{var Ye=null,jl=i(t=>{Ye=t.require("lodash")},"setDependencies"),Ni=i(t=>Ye.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Wl(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Wl=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),Vl=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),$l=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),zl=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Kl=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:Ni(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:Ye.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:Vl(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:zl(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:$l(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Jl=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:Ye.toLower(t.external_language),inputArgs:Ni(e),body:t.routine_definition}),"mapProcedureData");Ii.exports={setDependencies:jl,mapFunctionData:Kl,mapProcedureData:Jl}});var Mi=h((kd,qi)=>{var{clearEmptyPropertiesInObject:Ie,getColumnNameByPosition:Ze}=Ne(),y=null,Yl=i(t=>{y=t.require("lodash")},"setDependencies"),Li=i((t,e)=>{if(!t&&!e)return null;let r=xi(t),n=xi(e==null?void 0:e.toast_options),s=r.fillfactor,a=r.parallel_workers,o=r.autovacuum_enabled,c=Ie({vacuum_index_cleanup:r.vacuum_index_cleanup,vacuum_truncate:r.vacuum_truncate,autovacuum_vacuum_threshold:r.autovacuum_vacuum_threshold,autovacuum_vacuum_scale_factor:r.autovacuum_vacuum_scale_factor,autovacuum_vacuum_insert_threshold:r.autovacuum_vacuum_insert_threshold,autovacuum_vacuum_insert_scale_factor:r.autovacuum_vacuum_insert_scale_factor,autovacuum_analyze_threshold:r.autovacuum_analyze_threshold,autovacuum_analyze_scale_factor:r.autovacuum_analyze_scale_factor,autovacuum_vacuum_cost_delay:r.autovacuum_vacuum_cost_delay,autovacuum_vacuum_cost_limit:r.autovacuum_vacuum_cost_limit,autovacuum_freeze_min_age:r.autovacuum_freeze_min_age,autovacuum_freeze_max_age:r.autovacuum_freeze_max_age,autovacuum_freeze_table_age:r.autovacuum_freeze_table_age,autovacuum_multixact_freeze_min_age:r.autovacuum_multixact_freeze_min_age,autovacuum_multixact_freeze_max_age:r.autovacuum_multixact_freeze_max_age,autovacuum_multixact_freeze_table_age:r.autovacuum_multixact_freeze_table_age,log_autovacuum_min_duration:r.log_autovacuum_min_duration}),u=r.user_catalog_table,l=n.autovacuum_enabled,p=Ie({toast_tuple_target:r.toast_tuple_target,toast_vacuum_index_cleanup:n.vacuum_index_cleanup,toast_vacuum_truncate:n.vacuum_truncate,toast_autovacuum_vacuum_threshold:n.autovacuum_vacuum_threshold,toast_autovacuum_vacuum_scale_factor:n.autovacuum_vacuum_scale_factor,toast_autovacuum_vacuum_insert_threshold:n.autovacuum_vacuum_insert_threshold,toast_autovacuum_vacuum_insert_scale_factor:n.autovacuum_vacuum_insert_scale_factor,toast_autovacuum_vacuum_cost_delay:n.autovacuum_vacuum_cost_delay,toast_autovacuum_vacuum_cost_limit:n.autovacuum_vacuum_cost_limit,toast_autovacuum_freeze_min_age:n.autovacuum_freeze_min_age,toast_autovacuum_freeze_max_age:n.autovacuum_freeze_max_age,toast_autovacuum_freeze_table_age:n.autovacuum_freeze_table_age,toast_autovacuum_multixact_freeze_min_age:n.autovacuum_multixact_freeze_min_age,toast_autovacuum_multixact_freeze_max_age:n.autovacuum_multixact_freeze_max_age,toast_autovacuum_multixact_freeze_table_age:n.autovacuum_multixact_freeze_table_age,toast_log_autovacuum_min_duration:n.log_autovacuum_min_duration}),f={fillfactor:s,parallel_workers:a,autovacuum_enabled:o,autovacuum:y.isEmpty(c)?null:c,toast_autovacuum_enabled:l,toast:y.isEmpty(p)?null:p,user_catalog_table:u};return Ie(f)},"prepareStorageParameters"),Zl=i((t,e)=>{if(!t)return null;let r=Xl(t),n=y.some(t.partition_attributes_positions,o=>o===0),s=n?"partitioning_expression":"compositePartitionKey",a=n?ep(t,e):y.map(t.partition_attributes_positions,Ze(e));return[{partitionMethod:r,partitionBy:n?"expression":"keys",[s]:a}]},"prepareTablePartition"),Xl=i(t=>{switch(t.partition_method){case"h":return"HASH";case"l":return"LIST";case"r":return"RANGE";default:return""}},"getPartitionMethod"),ep=i((t,e)=>{let r=0,n=y.split(t.expressions,",");return y.chain(t.partition_attributes_positions).map(s=>{if(s===0){let a=n[r];return r++,a}return Ze(e)(s)}).join(",").value()},"getPartitionExpression"),Pi=i(t=>y.split(t,"="),"splitByEqualitySymbol"),tp=i(t=>y.find(t,{type:"json"}),"checkHaveJsonTypes"),rp=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),np=i((t,e,r)=>y.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,ap(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,sp(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,ip(s,e,r)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),sp=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:y.map(t.constraint_keys,Ze(e)),indexStorageParameters:y.join(t.storage_parameters,","),indexTablespace:t.tablespace}),"getPrimaryKeyConstraint"),ip=i((t,e,r)=>{let n=y.find(r,a=>a.indexname===t.constraint_name),s=n!=null&&n.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"";return{constraintName:t.constraint_name,compositeUniqueKey:y.map(t.constraint_keys,Ze(e)),indexStorageParameters:y.join(t.storage_parameters,","),indexTablespace:t.tablespace,indexComment:t.description,...s&&{nullsDistinct:s}}},"getUniqueKeyConstraint"),ap=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,noInherit:t.no_inherit,constrDescription:t.description}),"getCheckConstraint"),op=i(t=>y.map(t,e=>{let r=cp(e),n=y.slice(r,0,e.number_of_keys),s=y.chain(r).slice(e.number_of_keys).map(c=>y.pick(c,"name")).value(),a=e.index_indnullsnotdistinct?"NULLS NOT DISTINCT":"",o={indxName:e.indexname,index_method:e.index_method,unique:e.index_unique??!1,index_tablespace_name:e.tablespace_name||"",index_storage_parameter:lp(e.storage_parameters),where:e.where_expression||"",include:s,columns:e.index_method==="btree"?n:y.map(n,c=>y.omit(c,"sortOrder","nullsOrder")),...a&&{nullsDistinct:a}};return Ie(o)}),"prepareTableIndexes"),cp=i(t=>y.chain(t.columns).map((e,r)=>{if(!e)return;let n=y.get(t,`ascendings.${r}`,!1)?"ASC":"DESC",s=up(y.get(t,`nulls_first.${r}`)),a=y.get(t,`opclasses.${r}`,""),o=y.get(t,`collations.${r}`,"");return{name:e,sortOrder:n,nullsOrder:s,opclass:a,collation:o}}).compact().value(),"mapIndexColumns"),up=i(t=>y.isNil(t)?"":t?"NULLS FIRST":"NULLS LAST","getNullsOrder"),lp=i(t=>{if(!t)return null;let e=y.fromPairs(y.map(t,n=>Pi(n))),r={index_fillfactor:e.fillfactor,deduplicate_items:e.deduplicate_items,index_buffering:e.index_buffering,fastupdate:e.fastupdate,gin_pending_list_limit:e.gin_pending_list_limit,pages_per_range:e.pages_per_range,autosummarize:e.autosummarize};return Ie(r)},"getIndexStorageParameters"),pp=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Li(t==null?void 0:t.reloptions,e),a=t==null?void 0:t.spcname,o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,table_tablespace_name:a,partitionBounds:o}},"prepareTableLevelData"),hp=i(t=>{switch(fp(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),fp=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),xi=i(t=>y.chain(t).map(Pi).map(([e,r])=>[e,hp(r)]).fromPairs().value()||{},"prepareOptions"),dp=i((t,e)=>y.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");qi.exports={prepareStorageParameters:Li,prepareTablePartition:Zl,setDependencies:Yl,checkHaveJsonTypes:tp,prepareTableConstraints:np,prepareTableLevelData:pp,prepareTableIndexes:op,getSampleDocSize:rp,prepareTableInheritance:dp}});var Fi=h((Gd,Di)=>{var{mapColumnData:_p}=zr(),B=null,mp=i(t=>{B=t.require("lodash")},"setDependencies"),gp=i((t,e)=>B.chain(t).map(r=>{switch(r.type){case"e":return yp(r);case"r":return Ep(r);case"c":return Sp(r);default:return null}}).compact().concat(B.map(e,vp)).value(),"getUserDefinedTypes"),yp=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Ep=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Sp=i(t=>{let e=B.map(t.columns,_p([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Tp=i(t=>t.type==="c","isTypeComposite"),vp=i(t=>{var e;return{name:t.domain_name,type:"domain",underlyingType:B.flow(Ap(t),wp(t),Cp(t),Op(t))(bp(t)),collation:t.collation_name||"",default:t.domain_default||"",required:(e=B.first(t.constraints))==null?void 0:e.not_null,checkConstraints:B.map(t.constraints,Np)}},"mapDomainType"),bp=i(t=>t.data_type==="USER-DEFINED"?t.udt_name:t.data_type,"getUnderlyingType"),Ap=i(t=>e=>t.character_maximum_length?`${e}(${t.character_maximum_length})`:e,"setLength"),wp=i(t=>e=>e!=="numeric"?e:B.isNumber(t.numeric_precision)&&B.isNumber(t.numeric_scale)?`${e}(${t.numeric_precision},${t.numeric_scale})`:B.isNumber(t.numeric_precision)?`${e}(${t.numeric_precision})`:e,"setPrecisionAndScale"),Cp=i(t=>e=>t.interval_type?`${e} ${t.interval_type}`:e,"setIntervalType"),Op=i(t=>e=>B.isNumber(t.interval_precision)?`${e}(${t.interval_precision})`:e,"setIntervalPrecision"),Np=i(t=>({name:t.constraint_name,expression:t.expression}),"mapDomainConstraint");Di.exports={setDependencies:mp,getUserDefinedTypes:gp,isTypeComposite:Tp}});var ki=h((Hd,Bi)=>{var{clearEmptyPropertiesInObject:Ip,wrapInQuotes:Rp}=Ne(),G=null,xp=i(t=>{G=t.require("lodash")},"setDependencies"),Jr=" (v)",Lp=i(t=>t==="VIEW","isViewByTableType"),Pp=i(t=>G.endsWith(t,Jr),"isViewByName"),qp=i(t=>t.slice(0,-Jr.length),"removeViewNameSuffix"),Mp=i(t=>`${t}${Jr}`,"setViewSuffix"),Dp=i((t,e,r={})=>{let n=G.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${Rp(t)} AS ${n}`:""},"generateCreateViewScript"),Fp=i((t,e,r)=>{let n={withCheckOption:t.check_option!=="NONE"||G.isNil(t.check_option),checkTestingScope:Bp(t.check_option),viewOptions:G.fromPairs(G.map(e==null?void 0:e.view_options,Up)),temporary:(e==null?void 0:e.persistence)==="t",recursive:kp(t),description:e==null?void 0:e.description,triggers:r};return Ip(n)},"prepareViewData"),Bp=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),kp=i(t=>G.startsWith(G.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),Up=i(t=>G.split(t,"="),"splitByEqualitySymbol");Bi.exports={setDependencies:xp,isViewByTableType:Lp,isViewByName:Pp,removeViewNameSuffix:qp,generateCreateViewScript:Dp,setViewSuffix:Mp,prepareViewData:Fp}});var Gi=h((Wd,Ui)=>{var Xe=null,Gp=i(t=>{Xe=t.require("lodash")},"setDependencies"),Qp=i((t,e)=>Xe.chain(t).map(r=>({...r,...Xe.find(e,{trigger_name:r.trigger_name})||{}})).map(Hp).value(),"getTriggers"),Hp=i(t=>{var e;return{name:t.trigger_name,triggerDescription:t.description,triggerConstraint:t.constraint,triggerTable:`${t.event_object_schema}.${t.event_object_table}`,triggerReferencedTable:t.referenced_table_name?[t.referenced_table_schema,t.referenced_table_name]:[],triggerType:t.action_timing,triggerEvents:jp(t),triggerUpdateColumns:(e=t.update_attributes)==null?void 0:e.filter(Boolean),triggerDeferrable:t.deferrable,triggerTimeConstraintCheck:t.deferred?"INITIALLY DEFERRED":"INITIALLY IMMEDIATE",triggerReferencing:!!t.action_reference_old_table||!!t.action_reference_new_table,triggerBeforeImageTransitionRelation:t.action_reference_old_table||"",triggerAfterImageTransitionRelation:t.action_reference_new_table||"",triggerEachRowStatement:t.action_orientation==="ROW"?"FOR EACH ROW":"FOR EACH STATEMENT",triggerCondition:t.action_condition,triggerFunction:Wp(t.action_statement)}},"getTrigger"),jp=i(t=>Xe.map(t.trigger_events,e=>({triggerEvent:e})),"getTriggerEvents"),Wp=i(t=>{var e,r,n;return((n=(r=(e=/EXECUTE (?:FUNCTION|PROCEDURE)(?<function>[\s\S]*)/.exec(t))==null?void 0:e.groups)==null?void 0:r.function)==null?void 0:n.trim())||""},"getFunctionFromTrigger");Ui.exports={setDependencies:Gp,getTriggers:Qp}});var ji=h(($d,Hi)=>{var Vp=i((t,e)=>[$p,zp].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),$p=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Kp(t,s,n),entityLevel:Xp(e)}},"reorganizePrimaryKeys"),zp=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let o=s.compositeUniqueKey[0];return{attributes:Yp(r,o,s),entityLevel:eh(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Kp=i((t,e,r)=>t.map(n=>n.name!==e?n:Jp(n,r)),"setAttributesPrimaryKeyData"),Jp=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:Qi(e)}),"setPrimaryKeyData"),Yp=i((t,e,r)=>t.map(n=>n.name!==e?n:Zp(n,r)),"setAttributesUniqueKeyData"),Zp=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:Qi(e)}),"setUniqueKeyData"),Qi=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexComment:t.indexComment}],"getOptions"),Xp=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),eh=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");Hi.exports={reorganizeConstraints:Vp}});var Vi=h((Kd,Wi)=>{var Xr=class Xr{cache;cycle;dataType;ifNotExist;increment;maxValue;minValue;ownedByColumn;ownedByNone;sequenceName;start;temporary;unlogged};i(Xr,"Sequence");var Yr=Xr,en=class en{sequence_name;increment;start;data_type;maximum_value;minimum_value;cycle_option;cache_size;rel_persistance;column_name;table_name};i(en,"SequenceDto");var Zr=en;Wi.exports={Sequence:Yr,SequenceDto:Zr}});var zi=h((Xd,$i)=>{var{Sequence:Yd,SequenceDto:Zd}=Vi(),th=i(({sequence:t})=>t.column_name?[{entity:t.table_name,name:t.column_name}]:[],"getOwnedByColumn"),rh=i(({sequence:t})=>({sequenceName:t.sequence_name,increment:Number(t.increment),start:Number(t.start_value),dataType:t.data_type,maxValue:Number(t.maximum_value),minValue:Number(t.minimum_value),cache:Number(t.cache_size),temporary:t.rel_persistance==="t",unlogged:t.rel_persistance==="u",cycle:t.cycle_option==="YES",ownedByColumn:th({sequence:t}),ownedByNone:!t.column_name}),"mapSequenceData");$i.exports={mapSequenceData:rh}});var Zi=h((t_,Yi)=>{var{createClient:nh}=di(),m=Ei(),{getJsonSchema:Ki}=vi(),{setDependencies:sh,mapColumnData:ih,setSubtypeFromSampledJsonValues:ah}=zr(),{setDependencies:oh,clearEmptyPropertiesInObject:Ji}=Ne(),{setDependencies:ch,prepareForeignKeys:uh}=Oi(),{setDependencies:lh,mapFunctionData:ph,mapProcedureData:hh}=Ri(),{setDependencies:fh,prepareTablePartition:dh,checkHaveJsonTypes:_h,prepareTableConstraints:mh,getSampleDocSize:gh,prepareTableLevelData:yh,prepareTableIndexes:Eh,prepareTableInheritance:Sh}=Mi(),{setDependencies:Th,getUserDefinedTypes:vh,isTypeComposite:bh}=Fi(),{setDependencies:Ah,isViewByTableType:wh,isViewByName:Ch,removeViewNameSuffix:Oh,generateCreateViewScript:Nh,setViewSuffix:Ih,prepareViewData:Rh}=ki(),{setDependencies:xh,getTriggers:Lh}=Gi(),g=$r(),{reorganizeConstraints:Ph}=ji(),{mapSequenceData:qh}=zi(),et=null,A=null,M=null,tn=14;Yi.exports={setDependencies(t){A=t.require("lodash"),oh(t),fh(t),sh(t),ch(t),Ah(t),lh(t),Th(t),xh(t)},async connect(t,e){m.isClientInitialized()&&await this.disconnect();let{client:r,sshTunnel:n}=await nh(t,e);m.initializeClient(r,e),et=n,M=e,tn=await this._getServerVersion()},async disconnect(){et&&(et.close(),et=null),await m.releaseClient()},pingDb(){return m.query(g.PING)},applyScript(t){return m.query(t)},async getDatabaseNames(){return A.map(await m.query(g.GET_DATABASES),"database_name")},async logVersion(){let t=await m.queryTolerant(g.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved";M.info(`PostgreSQL version: ${e}`)},async getAllSchemasNames(){return(await m.query(g.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!Mh(e))},async getTablesNames(t){let e=await m.query(g.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!A.includes(r,n)).map(({table_name:n,table_type:s})=>wh(s)?Ih(n):n)},async getDbLevelData(){var n,s,a;M.progress("Get database data");let t=(n=await m.queryTolerant(g.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await m.queryTolerant(g.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(a=await m.queryTolerant(g.GET_DB_COLLATE_NAME,[],!0))==null?void 0:a.default_collate_name;return Ji({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r,n=!1,s=!1){let a=await this._retrieveUserDefinedTypes(t),o=await m.queryTolerant(g.GET_NAMESPACE_OID,[t],!0),c=o==null?void 0:o.oid,u=n?await m.queryTolerant(g.GET_PARTITIONS,[c]):[],[l,p]=A.partition(e,Ch),f=p.flatMap(C=>[{tableName:C},...A.filter(u,{parent_name:C}).map(({child_name:R,is_parent_partitioned:W})=>({isParentPartitioned:W,tableName:R}))]),_=await ae(A.uniq(f),A.bind(this._retrieveSingleTableData,this,r,c,t,a,s));return{views:await ae(l,A.bind(this._retrieveSingleViewData,this,c,t,s)),tables:_,modelDefinitions:Ki(a)}},async retrieveSchemaLevelData(t,e){var f;if(e)return M.info("Functions and procedures ignored"),{functions:[],procedures:[]};M.progress("Get Functions and Procedures",t);let r=(f=await m.queryTolerant(g.GET_NAMESPACE_OID,[t],!0))==null?void 0:f.oid,n=await m.queryTolerant(g.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await m.queryTolerant(Fh(tn),[r]),[a,o]=A.partition(A.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await ae(a,async _=>{let S=await m.queryTolerant(g.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[_.specific_name]),C=A.find(s,{function_name:_.name});return ph(_,S,C)}),u=await ae(o,async _=>{let S=await m.queryTolerant(g.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[_.specific_name]),C=A.find(s,{function_name:_.name});return hh(_,S,C)}),p=(await m.queryTolerant(g.GET_SEQUENCES,[t])).map(_=>qh({sequence:_}));return{functions:c,procedures:u,sequences:p}},async _retrieveUserDefinedTypes(t){M.progress("Get User-Defined Types",t);let e=await m.queryTolerant(g.GET_USER_DEFINED_TYPES,[t]),r=await m.queryTolerant(g.GET_DOMAIN_TYPES,[t]),n=await ae(e,async a=>bh(a)?{...a,columns:await m.queryTolerant(g.GET_COMPOSITE_TYPE_COLUMNS,[a.pg_class_oid])}:a),s=await ae(r,async a=>({...a,constraints:await m.queryTolerant(g.GET_DOMAIN_TYPES_CONSTRAINTS,[a.domain_name,t])}));return vh(n,s)},async _retrieveSingleTableData(t,e,r,n,s,{tableName:a,isParentPartitioned:o}){var nn;M.progress("Get table data",r,a);let c=await m.queryTolerant(g.GET_TABLE_LEVEL_DATA,[a,e],!0),u=c==null?void 0:c.oid,l=await m.queryTolerant(g.GET_TABLE_TOAST_OPTIONS,[a,e],!0),p=await m.queryTolerant(g.GET_TABLE_PARTITION_DATA,[u],!0),f=await this._getTableColumns(a,r,u),_=await m.queryTolerant(g.GET_DESCRIPTION_BY_OID,[u],!0),S=await m.queryTolerant(g.GET_INHERITS_PARENT_TABLE_NAME,[u]),C=await m.queryTolerant(g.GET_TABLE_CONSTRAINTS,[u]),R=await m.queryTolerant(Dh(tn),[u]),W=await m.queryTolerant(g.GET_TABLE_FOREIGN_KEYS,[u]),oe=await this._getTriggers(r,a,e,u,s);M.info("Table data retrieved",{schemaName:r,tableName:a,columnTypes:f.map(ia=>ia.data_type)});let rt=dh(p,f),nt=yh(c,l),st=Bh(_),Re=Sh(r,S),xe=mh(C,f,R),k=Eh(R),Xi=uh(W,a,r,f),ea={partitioning:rt,description:st,triggers:oe,Indxs:k,...nt,...xe,...o?{partitionOf:(nn=A.first(Re))==null?void 0:nn.parentTable}:{inherits:Re}},ta=Ji(ea),ce=f.map(ih(n)),ra=_h(ce),it=[];ra&&(it=await this._getDocuments(r,a,ce,t),ce=ah(ce,it));let{attributes:na,entityLevel:sa}=Ph(ce,ta);return{name:a,entityLevel:sa,jsonSchema:Ki(na),documents:it,relationships:Xi}},async _getTriggers(t,e,r,n,s){if(s)return M.info("Triggers ignored"),[];let a=await m.queryTolerant(g.GET_TRIGGERS,[t,e]),o=await m.queryTolerant(g.GET_TRIGGERS_ADDITIONAL_DATA,[r,n]);return Lh(a,o)},async _getTableColumns(t,e,r){M.progress("Get columns",e,t);let n=await m.query(g.GET_TABLE_COLUMNS,[t,e]),s=await m.queryTolerant(g.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return A.map(n,a=>({...a,...A.find(s,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,n){var p;M.progress("Sampling table",t,e);let s=`${t}.${e}`,a=((p=await m.queryTolerant(g.GET_ROWS_COUNT(s),[],!0))==null?void 0:p.quantity)||0,o=gh(a,n),c=r.filter(({type:f})=>A.includes(["json","jsonb"],f)),u=A.map(c,"name").join(", "),l=await m.queryTolerant(g.GET_SAMPLED_DATA_SIZE(s,u),[o],!0);return M.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:l==null?void 0:l._hackolade_tmp_sampling_tbl_size}),await m.queryTolerant(g.GET_SAMPLED_DATA(s,u),[o])},async _retrieveSingleViewData(t,e,r,n){M.progress("Get view data",e,n),n=Oh(n);let s=await m.query(g.GET_VIEW_DATA,[n,e],!0),a=!s.view_definition&&await m.queryTolerant(g.GET_VIEW_SELECT_STMT_FALLBACK,[n,e],!0),o=await m.queryTolerant(g.GET_VIEW_OPTIONS,[n,t],!0),c=await this._getTriggers(e,n,t,o==null?void 0:o.oid,r),u=Nh(n,s,a),l=Rh(s,o,c);return u?{name:n,data:l,ddl:{script:u,type:"postgres"}}:(M.info("View select statement was not retrieved",{schemaName:e,viewName:n}),{name:n,data:l,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await m.queryTolerant(g.GET_VERSION_AS_NUM,[],!0),e=A.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var Mh=i(t=>!!(A.startsWith(t,"pg_")||A.includes(["information_schema"],t)),"isSystemSchema"),Dh=i(t=>t===10?g.GET_TABLE_INDEXES_V_10:t>15?g.GET_TABLE_INDEXES_V_15:g.GET_TABLE_INDEXES,"getGetIndexesQuery"),Fh=i(t=>t===10?g.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:g.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),Bh=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),ae=i((t,e)=>Promise.all(A.map(t,e)),"mapPromises")});var{createLogger:tt}=an(),w=Zi();module.exports={async disconnect(t,e,r,n){await w.disconnect(),r()},async testConnection(t,e,r,n){try{rn("Test connection",t,e);let s=tt({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(n),await w.connect(t,s),await w.pingDb(),await w.logVersion(),r()}catch(s){e.log("error",K(s),"Test connection instance log"),r(K(s))}finally{await w.disconnect()}},async getDatabases(t,e,r,n){try{rn("Get databases",t,e);let s=tt({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(n),await w.connect(t,s),await w.logVersion();let a=await w.getDatabaseNames();return e.log("info",a,"All databases list",t.hiddenKeys),r(null,a)}catch(s){return e.log("error",s),r(K(s))}},getDocumentKinds:i(function(t,e,r){r(null,[])},"getDocumentKinds"),async getDbCollectionsNames(t,e,r,n){try{rn("Get DB table names",t,e);let s=tt({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(n),await w.connect(t,s),await w.logVersion();let o=await(await w.getAllSchemasNames()).reduce(async(c,u)=>{let l=await c;try{let p=await w.getTablesNames(u);return l.concat({dbName:u,dbCollections:p,isEmpty:p.length===0})}catch(p){return s.info(`Error reading database "${u}"`),s.error(p),l.concat({dbName:u,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,o)}catch(s){e.log("error",K(s),"Get DB collections names"),r(K(s)),await w.disconnect()}},async getDbCollectionsData(t,e,r,n){try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let s=tt({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});s.progress("Start reverse engineering...");let a=t.collectionData.collections,o=t.collectionData.dataBaseNames,c=await w.getDbLevelData(),{packages:u,relationships:l}=await Promise.all(o.map(async p=>{let{tables:f,views:_,modelDefinitions:S}=await w.retrieveEntitiesData(p,a[p],t.recordSamplingSettings,t.includePartitions,t.ignoreUdfUdpTriggers),{functions:C,procedures:R,triggers:W,sequences:oe}=await w.retrieveSchemaLevelData(p,t.ignoreUdfUdpTriggers);return s.progress("Schema data fetched successfully",p),{schemaName:p,tables:f,views:_,functions:C,procedures:R,modelDefinitions:S,triggers:W,sequences:oe}})).then(p=>{let f=p.flatMap(({tables:S})=>S.map(C=>C.relationships)).flat();return{packages:p.flatMap(({schemaName:S,tables:C,views:R,functions:W,procedures:oe,triggers:rt,modelDefinitions:nt,sequences:st})=>{let Re={UDFs:W,Procedures:oe,triggers:rt,sequences:st},xe=C.map(k=>({dbName:S,collectionName:k.name,documents:k.documents,views:[],emptyBucket:!1,entityLevel:k.entityLevel,validation:{jsonSchema:k.jsonSchema},bucketInfo:Re,modelDefinitions:nt})).sort(k=>n.require("lodash").isEmpty(k.entityLevel.inherits)?-1:1);if(R!=null&&R.length){let k={dbName:S,views:R,emptyBucket:!1};return[...xe,k]}return xe}),relationships:f}}).then(({packages:p,relationships:f})=>({packages:kh(p),relationships:f}));s.info("The data is processed and sent to the application",{packagesLength:u==null?void 0:u.length,relationshipsLength:l==null?void 0:l.length}),r(null,u,c,l)}catch(s){e.log("error",K(s),"Retrieve tables data"),r(K(s))}finally{await w.disconnect()}}};var K=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),rn=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),kh=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages");
